<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/hexo/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hexo/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hexo/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/hexo/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="UgODgWVmvTsdD--vjodDR3tPUZRWM3i7JpHzbYejxUM">

<link rel="stylesheet" href="/hexo/css/main.css">


<link rel="stylesheet" href="/hexo/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hexo/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="我是张江搬砖小码农, 知识搬运工">
<meta property="og:type" content="website">
<meta property="og:title" content="Jackpot">
<meta property="og:url" content="https://jack-zheng.github.io/hexo/page/12/index.html">
<meta property="og:site_name" content="Jackpot">
<meta property="og:description" content="我是张江搬砖小码农, 知识搬运工">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jack Zheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jack-zheng.github.io/hexo/page/12/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Jackpot</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/hexo/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jackpot</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-tags">

    <a href="/hexo/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/hexo/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hexo/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/jack-zheng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/12/01/Java-methods-equals-and-hashcode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/12/01/Java-methods-equals-and-hashcode/" class="post-title-link" itemprop="url">Java 中重写 equals 和 hashcode 的问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-01 17:25:15" itemprop="dateCreated datePublished" datetime="2020-12-01T17:25:15+08:00">2020-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>刚好最近遇到需要重写 equals 和 hashcode 的情况，总结记录一下，加深印象。</p>
<h2 id="官方对-hashCode-方法的描述"><a href="#官方对-hashCode-方法的描述" class="headerlink" title="官方对 hashCode 方法的描述"></a>官方对 hashCode 方法的描述</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Returns a hash code value for the object. This method is supported for the benefit of hash tables such as those provided by HashMap.</span><br><span class="line"></span><br><span class="line">The general contract of hashCode is:</span><br><span class="line"></span><br><span class="line">1. Whenever it is invoked on the same object more than once during an execution of a Java application, the hashCode method must consistently return the same integer, provided no information used in equals comparisons on the object is modified. This integer need not remain consistent from one execution of an application to another execution of the same application.</span><br><span class="line">2. If two objects are equal according to the equals(Object) method, then calling the hashCode method on each of the two objects must produce the same integer result.</span><br><span class="line">3. It is not required that if two objects are unequal according to the equals(java.lang.Object) method, then calling the hashCode method on each of the two objects must produce distinct integer results. However, the programmer should be aware that producing distinct integer results for unequal objects may improve the performance of hash tables.</span><br><span class="line"></span><br><span class="line">As much as is reasonably practical, the hashCode method defined by class Object does return distinct integers for distinct objects. (This is typically implemented by converting the internal address of the object into an integer, but this implementation technique is not required by the JavaTM programming language.)</span><br></pre></td></tr></table></figure>

<p>概括起来就是 equals 相等的两个对象 hashcode 必须相同，反过来，hashcode 相等的像个对象，equals 可以不想等。</p>
<p>hashcode 是需要结合集合类才能体现出来的。试想一下，如果没有 hashcode, 那么我们在一个存了 1000 个对象的 HashSet 中添加一个新的对象就要进行 1000 次的 equals 比较，这样的性能消耗无疑是巨大的。所以 HashXXX 的数据结构引入 hash 算法来简化比较。</p>
<p>hash 的数据结构中是允许存在 hash 值相同的对象的，这种情况下，他会在 hash 的地址位置创建一个链表存储 hash 值相同的对象。</p>
<p>当集合存入一个对象时，他会先根据 hash 值判断是否有重复的元素， 如果 hash 值已经存在，那么他会找到对应的链表然后一次进行对象的 equals 判断重复。好的 hash 算法要尽量减少 hash 冲突来提高检索效率。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/27/No-sleep-night/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/27/No-sleep-night/" class="post-title-link" itemprop="url">码农生活小记 之 无眠的夜</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-27 11:13:52" itemprop="dateCreated datePublished" datetime="2020-11-27T11:13:52+08:00">2020-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/%E6%9D%82%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">杂记</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>231</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="2020-11-27"><a href="#2020-11-27" class="headerlink" title="2020-11-27"></a>2020-11-27</h2><p>Cross pillar 的改动，我们 team 在做重构的时候改了其他 team 的 code，半年过去了，突然告诉我上线出问题了，也不知道他们之前都是怎么做的测试，无力吐槽。打了 emergency 的 patch。也是各种折腾，第一次 fix 还导致了更大的 issue，瑟瑟发抖。搞到将近一点，release 成功，等第二天的测试结果。索性一切 OK。发现老板工作是真的拼，晚上守到近两点，早上七点多又起来 verify，大老板也是，佩服佩服。敬业没得说，值的学习。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/19/Java-class-file-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/19/Java-class-file-structure/" class="post-title-link" itemprop="url">Java class 文件架构摘要</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-19 10:45:30" itemprop="dateCreated datePublished" datetime="2020-11-19T10:45:30+08:00">2020-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>21k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>19 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>目标：通过阅读 深入理解 JVM 虚拟机 第三版 的第 6 章，结合 ASM 里的 Reader 和 Visitor 对 class 文件有个一比较深入的了解。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12y4y1B7pn?p=12">bilibili 参考视频</a>，很棒，白嫖</li>
</ul>
<h2 id="6-2-无关性的基石"><a href="#6-2-无关性的基石" class="headerlink" title="6.2 无关性的基石"></a>6.2 无关性的基石</h2><p>Java 虚拟机不与包括 Java 语言在内的任何语言绑定，它只与 Class 文件这种特定的二进制文件格式所关联，Class 文件中包含了 Java 虚拟机指令集，符号表以及若干其他辅助信息。</p>
<h2 id="6-3-Class-类文件的结构"><a href="#6-3-Class-类文件的结构" class="headerlink" title="6.3 Class 类文件的结构"></a>6.3 Class 类文件的结构</h2><blockquote>
<p>Idea 安装 BinEd 插件可以查看 Class 文件在各种进制下的值</p>
</blockquote>
<p>Class 文件是一组以 8 个字节为基础单位的二进制流，各个数据项目严格按照顺序紧凑排列在文件之中，中间没有添加任何分隔符，这使得整个 Class 文件中存储的内容几乎全部是程序运行的必要数据，没有空隙存在。</p>
<p>Class 文件结构中只有两种数据类型：无符号数 + 表</p>
<ul>
<li>无符号数：是基本数据类，以 u1, u2, u4, u8 分别表示 1，2，4，8 个字节的无符号数。无符号数可以用来描述数字，索引引用，数量值或者按照 UTF-8 编码构成的字符串值</li>
<li>表：n 个无符号数 + 其他表构成的复合数据类型，命名习惯性的以 _info 结尾。表用于描述有层次关系的复合结构数据，整个 Class 可以看作一张表。</li>
</ul>
<p>Class 文件格式表：</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u4</td>
<td align="left">magic</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">minor_version</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">major_version</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">constant_pool_count</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">cp_info</td>
<td align="left">constant_pool</td>
<td align="left">constant_pool_count-1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">access_flags</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">this_class</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">super_class</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">interfaces_count</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">interfaces</td>
<td align="left">interfaces_count</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">fields_count</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">field_info</td>
<td align="left">fields</td>
<td align="left">fields_count</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">methods_count</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">method_info</td>
<td align="left">methods</td>
<td align="left">methods_count</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">attributes_count</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">attribute_info</td>
<td align="left">attributes</td>
<td align="left">attributes_count</td>
</tr>
</tbody></table>
<h3 id="6-3-1-魔数与-Class-文件的版本"><a href="#6-3-1-魔数与-Class-文件的版本" class="headerlink" title="6.3.1 魔数与 Class 文件的版本"></a>6.3.1 魔数与 Class 文件的版本</h3><p>Class 文件前 4 个字节被称为魔数，值为 0xCAFEBABE，用来表明文件类型。紧接着 4 个字节为主次版本号。</p>
<p>Java 虚拟机规范在 Class 文件校验部分明确要求，即使文件格式并未发生任何变化，虚拟机也必须<strong>拒绝执行</strong>超过其版本号的 Class 文件。</p>
<table>
<thead>
<tr>
<th align="left">JDK version</th>
<th align="left">version number</th>
</tr>
</thead>
<tbody><tr>
<td align="left">JDK 13</td>
<td align="left">57</td>
</tr>
<tr>
<td align="left">JDK 12</td>
<td align="left">56</td>
</tr>
<tr>
<td align="left">JDK 11</td>
<td align="left">55</td>
</tr>
<tr>
<td align="left">JDK 10</td>
<td align="left">54</td>
</tr>
<tr>
<td align="left">JDK 9</td>
<td align="left">53</td>
</tr>
<tr>
<td align="left">JDK 8</td>
<td align="left">52</td>
</tr>
<tr>
<td align="left">JDK 7</td>
<td align="left">51</td>
</tr>
<tr>
<td align="left">JDK 6.0</td>
<td align="left">50</td>
</tr>
<tr>
<td align="left">JDK 5.0</td>
<td align="left">49</td>
</tr>
<tr>
<td align="left">JDK 1.4</td>
<td align="left">48</td>
</tr>
<tr>
<td align="left">JDK 1.3</td>
<td align="left">47</td>
</tr>
<tr>
<td align="left">JDK 1.2</td>
<td align="left">46</td>
</tr>
<tr>
<td align="left">JDK 1.1</td>
<td align="left">45</td>
</tr>
</tbody></table>
<p>仿照参考书写下测试代码, 不知道是不是编译器版本不一样，结果从常量池开始有些许偏差，不过无伤大雅，学习路径，方法还是一样的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> c631;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> m;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">inc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Class 文件 16 进制表达式</p>
<table>
<thead>
<tr>
<th align="center">line</th>
<th align="left">00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f</th>
<th align="left">hex value</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0000000000</td>
<td align="left">ca fe ba be 00 00 00 32 00 16 0a 00 04 00 12 09</td>
<td align="left">…….2……..</td>
</tr>
<tr>
<td align="center">0000000010</td>
<td align="left">00 03 00 13 07 00 14 07 00 15 01 00 01 6d 01 00</td>
<td align="left">………….m..</td>
</tr>
<tr>
<td align="center">0000000020</td>
<td align="left">01 49 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29</td>
<td align="left">.I…<init>…()</td>
</tr>
<tr>
<td align="center">0000000030</td>
<td align="left">56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e</td>
<td align="left">V…Code…LineN</td>
</tr>
<tr>
<td align="center">0000000040</td>
<td align="left">75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63</td>
<td align="left">umberTable…Loc</td>
</tr>
<tr>
<td align="center">0000000050</td>
<td align="left">61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01</td>
<td align="left">alVariableTable.</td>
</tr>
<tr>
<td align="center">0000000060</td>
<td align="left">00 04 74 68 69 73 01 00 10 4c 63 36 33 31 2f 54</td>
<td align="left">..this…Lc631/T</td>
</tr>
<tr>
<td align="center">0000000070</td>
<td align="left">65 73 74 43 6c 61 73 73 3b 01 00 03 69 6e 63 01</td>
<td align="left">estClass;…inc.</td>
</tr>
<tr>
<td align="center">0000000080</td>
<td align="left">00 03 28 29 49 01 00 0a 53 6f 75 72 63 65 46 69</td>
<td align="left">..()I…SourceFi</td>
</tr>
<tr>
<td align="center">0000000090</td>
<td align="left">6c 65 01 00 0e 54 65 73 74 43 6c 61 73 73 2e 6a</td>
<td align="left">le…TestClass.j</td>
</tr>
<tr>
<td align="center">00000000a0</td>
<td align="left">61 76 61 0c 00 07 00 08 0c 00 05 00 06 01 00 0e</td>
<td align="left">ava………….</td>
</tr>
<tr>
<td align="center">00000000b0</td>
<td align="left">63 36 33 31 2f 54 65 73 74 43 6c 61 73 73 01 00</td>
<td align="left">c631/TestClass..</td>
</tr>
<tr>
<td align="center">00000000c0</td>
<td align="left">10 6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63</td>
<td align="left">.java/lang/Objec</td>
</tr>
<tr>
<td align="center">00000000d0</td>
<td align="left">74 00 21 00 03 00 04 00 00 00 01 00 02 00 05 00</td>
<td align="left">t.!………….</td>
</tr>
<tr>
<td align="center">00000000e0</td>
<td align="left">06 00 00 00 02 00 01 00 07 00 08 00 01 00 09 00</td>
<td align="left">…………….</td>
</tr>
<tr>
<td align="center">00000000f0</td>
<td align="left">00 00 2f 00 01 00 01 00 00 00 05 2a b7 00 01 b1</td>
<td align="left">../……..*….</td>
</tr>
<tr>
<td align="center">0000000100</td>
<td align="left">00 00 00 02 00 0a 00 00 00 06 00 01 00 00 00 03</td>
<td align="left">…………….</td>
</tr>
<tr>
<td align="center">0000000110</td>
<td align="left">00 0b 00 00 00 0c 00 01 00 00 00 05 00 0c 00 0d</td>
<td align="left">…………….</td>
</tr>
<tr>
<td align="center">0000000120</td>
<td align="left">00 00 00 01 00 0e 00 0f 00 01 00 09 00 00 00 31</td>
<td align="left">……………1</td>
</tr>
<tr>
<td align="center">0000000130</td>
<td align="left">00 02 00 01 00 00 00 07 2a b4 00 02 04 60 ac 00</td>
<td align="left">……..*….`..</td>
</tr>
<tr>
<td align="center">0000000140</td>
<td align="left">00 00 02 00 0a 00 00 00 06 00 01 00 00 00 07 00</td>
<td align="left">…………….</td>
</tr>
<tr>
<td align="center">0000000150</td>
<td align="left">0b 00 00 00 0c 00 01 00 00 00 07 00 0c 00 0d 00</td>
<td align="left">…………….</td>
</tr>
<tr>
<td align="center">0000000160</td>
<td align="left">00 00 01 00 10 00 00 00 02 00 11</td>
<td align="left">………..</td>
</tr>
</tbody></table>
<p>魔数值 cafe, 版本号 <code>00 00 00 32</code> 转化后位 50 和我在 pom 指定的 1.6 版本 JDK 编译一致</p>
<h3 id="6-3-2-常量池"><a href="#6-3-2-常量池" class="headerlink" title="6.3.2 常量池"></a>6.3.2 常量池</h3><p>第 9-8 个字节表示常量池。常量池是从 1 开始的。示例中对应的值位 <code>00 16 - 22</code> 表明常量池总共有 21 个值。</p>
<p>PS: 常量池的 0 位空余，是为了考虑特殊情况。当指向常量池的数据需要表达 <code>不引用任何常量池中的项目</code> 这样的意思时，可以将索引值设置位 0 表示。</p>
<p>常量池主要存放两大类的常量：字面量 Literal + 符号引用 Symbolic References。字面量接近于 Java 语言层面的常量概念，符号引用则属于编译原理的概念主要包括下面几类常量：</p>
<ol>
<li>被模块导出或者开放的包 package</li>
<li>类和接口的全名限定 Fully Qualified Name</li>
<li>字段名称和描述符 Desciptor</li>
<li>方法名称和描述符</li>
<li>方法句柄和方法类型 Method Handle, Mehtod Type, Invoke Dynamic</li>
<li>动态调用点和动态常量 Dynamically-Computed Call Site, Dynamically-Computed Constant</li>
</ol>
<p>Class 文件中没有类似 C 语言中的链接，只有当 Class 文件在虚拟机中加载后才能确定内存分布。</p>
<p>常量池中每一项都是一个表，到 JDK13 为止有 17 种表结构</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Flag</th>
<th align="left">Desc</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONSTANT_Utf8_info</td>
<td align="left">1</td>
<td align="left">UTF-8 编码的字符串</td>
</tr>
<tr>
<td align="left">CONSTANT_Integer_info</td>
<td align="left">3</td>
<td align="left">整型字面量</td>
</tr>
<tr>
<td align="left">CONSTANT_Float_info</td>
<td align="left">4</td>
<td align="left">浮点型字面量</td>
</tr>
<tr>
<td align="left">CONSTANT_Long_info</td>
<td align="left">5</td>
<td align="left">长整型型字面量</td>
</tr>
<tr>
<td align="left">CONSTANT_Class_info</td>
<td align="left">7</td>
<td align="left">类或接口的符号引用</td>
</tr>
<tr>
<td align="left">CONSTANT_String_info</td>
<td align="left">8</td>
<td align="left">字符串类型字面量</td>
</tr>
<tr>
<td align="left">CONSTANT_Fieldref_info</td>
<td align="left">9</td>
<td align="left">字段的符号引用</td>
</tr>
<tr>
<td align="left">CONSTANT_Methodref_info</td>
<td align="left">10</td>
<td align="left">类中方法的符号引用</td>
</tr>
<tr>
<td align="left">CONSTANT_InterfaceMethodref_info</td>
<td align="left">11</td>
<td align="left">接口中方法的符号引用</td>
</tr>
<tr>
<td align="left">CONSTANT_NameAndType_info</td>
<td align="left">12</td>
<td align="left">字段或方法的部分符号引用</td>
</tr>
<tr>
<td align="left">CONSTANT_MethodHandle_info</td>
<td align="left">15</td>
<td align="left">表示方法句柄</td>
</tr>
<tr>
<td align="left">CONSTANT_MethodType_info</td>
<td align="left">16</td>
<td align="left">表示方法类型</td>
</tr>
<tr>
<td align="left">CONSTANT_Dynamic_info</td>
<td align="left">17</td>
<td align="left">表示一个动态计算常量</td>
</tr>
<tr>
<td align="left">CONSTANT_InvokeDynamic_info</td>
<td align="left">18</td>
<td align="left">表示一个动态方法调用点</td>
</tr>
<tr>
<td align="left">CONSTANT_Module_info</td>
<td align="left">19</td>
<td align="left">表示一个模块</td>
</tr>
<tr>
<td align="left">CONSTANT_Package_info</td>
<td align="left">20</td>
<td align="left">表示一个模块中开放或者导出的包</td>
</tr>
</tbody></table>
<p>常量池第一项以 <code>0a - 10</code> 开头，查看上表得知为 CONSTANT_Methodref_info 类型的表，查询可知对应的表结构为</p>
<table>
<thead>
<tr>
<th align="left">Const Name</th>
<th align="left">Item</th>
<th align="left">Length</th>
<th align="left">desc</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONSTANT_Methodref_info</td>
<td align="left">tag</td>
<td align="left">u1</td>
<td align="left">值为 10</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">index</td>
<td align="left">u2</td>
<td align="left">指向声明方法的类描述符 CONSTANT_Class_info 的索引项</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">index</td>
<td align="left">u2</td>
<td align="left">指向名称及类型描述符 CONSTANT_NameAndType 的索引项</td>
</tr>
</tbody></table>
<p>所以第一个常量值总共 5 个字节组成 <code>0a 00 04 00 12</code>，表示的是方法引用，类引用地址为 4，方法名称和类型地址为 18。</p>
<p>为了反向验证这样分析是否正确可以通过反编译命令 <code>javap -verbose TestClass</code> 查看 class 文件。</p>
<p>第一个常量值内容为 <code>#1 = Methodref          #4.#18         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</code> 和分析结果一致</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\jack\Downloads\helloworld\understanding-the-jvm\c6-file-structure\target\classes\c631&gt;javap -verbose TestClass</span><br><span class="line">警告: 文件 .\TestClass.class 不包含类 TestClass</span><br><span class="line">Classfile /C:/Users/jack/Downloads/helloworld/understanding-the-jvm/c6-file-structure/target/classes/c631/TestClass.class</span><br><span class="line">  Last modified 2020年11月19日; size 363 bytes</span><br><span class="line">  MD5 checksum 16826804824a30e99e96960a47c3a47a</span><br><span class="line">  Compiled from &quot;TestClass.java&quot;</span><br><span class="line">public class c631.TestClass</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 50</span><br><span class="line">  flags: (0x0021) ACC_PUBLIC, ACC_SUPER</span><br><span class="line">  this_class: #3                          // c631/TestClass</span><br><span class="line">  super_class: #4                         // java/lang/Object</span><br><span class="line">  interfaces: 0, fields: 1, methods: 2, attributes: 1</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #4.#18         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">   #2 = Fieldref           #3.#19         // c631/TestClass.m:I</span><br><span class="line">   #3 = Class              #20            // c631/TestClass</span><br><span class="line">   #4 = Class              #21            // java/lang/Object</span><br><span class="line">   #5 = Utf8               m</span><br><span class="line">   #6 = Utf8               I</span><br><span class="line">   #7 = Utf8               &lt;init&gt;</span><br><span class="line">   #8 = Utf8               ()V</span><br><span class="line">   #9 = Utf8               Code</span><br><span class="line">  #10 = Utf8               LineNumberTable</span><br><span class="line">  #11 = Utf8               LocalVariableTable</span><br><span class="line">  #12 = Utf8               this</span><br><span class="line">  #13 = Utf8               Lc631/TestClass;</span><br><span class="line">  #14 = Utf8               inc</span><br><span class="line">  #15 = Utf8               ()I</span><br><span class="line">  #16 = Utf8               SourceFile</span><br><span class="line">  #17 = Utf8               TestClass.java</span><br><span class="line">  #18 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">  #19 = NameAndType        #5:#6          // m:I</span><br><span class="line">  #20 = Utf8               c631/TestClass</span><br><span class="line">  #21 = Utf8               java/lang/Object</span><br><span class="line">&#123;</span><br><span class="line">  public c631.TestClass();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: (0x0001) ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 3: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       5     0  this   Lc631/TestClass;</span><br><span class="line"></span><br><span class="line">  public int inc();</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: (0x0001) ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: getfield      #2                  // Field m:I</span><br><span class="line">         4: iconst_1</span><br><span class="line">         5: iadd</span><br><span class="line">         6: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 7: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       7     0  this   Lc631/TestClass;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: &quot;TestClass.java&quot;</span><br></pre></td></tr></table></figure>

<p>第二个常量为 09 开头，查表可知为 field 的引用</p>
<table>
<thead>
<tr>
<th align="left">Const Name</th>
<th align="left">Item</th>
<th align="left">Length</th>
<th align="left">desc</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONSTANT_Fieldref_info</td>
<td align="left">tag</td>
<td align="left">u1</td>
<td align="left">值为 9</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">index</td>
<td align="left">u2</td>
<td align="left">指向声明字段的类或接口类描述符 CONSTANT_Class_info 的索引项</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">index</td>
<td align="left">u2</td>
<td align="left">指向字段描述符 CONSTANT_NameAndType 的索引项</td>
</tr>
</tbody></table>
<p>值为 <code>09 00 03 00 13</code> 对应 <code>#2 = Fieldref           #3.#19         // c631/TestClass.m:I</code></p>
<p>第三个常量为 07 开头，为 Class 常量表</p>
<table>
<thead>
<tr>
<th align="left">Const Name</th>
<th align="left">Item</th>
<th align="left">Length</th>
<th align="left">desc</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONSTANT_Class_info</td>
<td align="left">tag</td>
<td align="left">u1</td>
<td align="left">值为 7</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">index</td>
<td align="left">u2</td>
<td align="left">指向全限定名常量的索引项</td>
</tr>
</tbody></table>
<p><code>07 00 14</code> 对应 <code>#3 = Class              #20            // c631/TestClass</code></p>
<p>第四个也是 07 开头</p>
<p><code>07 00 15</code> - <code>#4 = Class              #21            // java/lang/Object</code></p>
<p>第五个为 01 开头, 表示 Utf8 类型的常量</p>
<table>
<thead>
<tr>
<th align="left">Const Name</th>
<th align="left">Item</th>
<th align="left">Type</th>
<th align="left">desc</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONSTANT_Utf8_info</td>
<td align="left">tag</td>
<td align="left">u1</td>
<td align="left">值为 1</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">index</td>
<td align="left">u2</td>
<td align="left">UTF-8 编码的字符串占用的字节数</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">bytes</td>
<td align="left">u1</td>
<td align="left">长度为 length 的 UTF-8 编码字符串</td>
</tr>
</tbody></table>
<p><code>01 00 01 6d</code>, 占用字节数 1，内容为 6d 的 UTF 内容 <code>m</code>，对应关系可以通过各种在线工具查看，很常用 <code>#5 = Utf8               m</code></p>
<p>第六个常量 <code>01 00 01 49</code> - <code>#6 = Utf8               I</code></p>
<p>第七个常量 <code>01 00 06 3c 69 6e 69 74 3e</code> 占用字节数 6 个 - <code>#7 = Utf8               &lt;init&gt;</code></p>
<p>第八个 <code>01 00 03 28 29 56</code> - <code>#8 = Utf8               ()V</code></p>
<p>第九个 <code>01 00 04 43 6f 64 65</code> - <code>#9 = Utf8               Code</code> </p>
<p>第十个 <code>01 00 0f 4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65</code> - <code>#10 = Utf8               LineNumberTable</code></p>
<p>第十一个 <code>01 00 12 4c 6f 63 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65</code> - <code>#11 = Utf8               LocalVariableTable</code></p>
<p>第十二个 <code>01 00 04 74 68 69 73</code> - <code>#12 = Utf8               this</code></p>
<p>第十三个 <code>01 00 10 4c 63 36 33 31 2f 54 65 73 74 43 6c 61 73 73 3b</code> - <code>#13 = Utf8               Lc631/TestClass;</code></p>
<p>第十四个 <code>01 00 03 69 6e 63</code> - <code>#14 = Utf8               inc</code></p>
<p>第十五个 <code>01 00 03 28 29 49</code> - <code>#15 = Utf8               ()I</code></p>
<p>第十六个 <code>01 00 0a 53 6f 75 72 63 65 46 69 6c 65</code> - <code>#16 = Utf8               SourceFile</code></p>
<p>第十七个 <code>01 00 0e 54 65 73 74 43 6c 61 73 73 2e 6a 61 76 61</code> - <code>#17 = Utf8               TestClass.java</code></p>
<p>第十八个 <code>0c</code> 开头，为 NameAndType 类型</p>
<table>
<thead>
<tr>
<th align="left">Const Name</th>
<th align="left">Item</th>
<th align="left">Length</th>
<th align="left">desc</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONSTANT_NameAndType_info</td>
<td align="left">tag</td>
<td align="left">u1</td>
<td align="left">值为 12</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">index</td>
<td align="left">u2</td>
<td align="left">指向该字段或方法<strong>名称</strong>常量项的索引项</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">index</td>
<td align="left">u2</td>
<td align="left">指向该字段或方法<strong>描述符</strong>常量项的索引项</td>
</tr>
</tbody></table>
<p><code>0c 00 07 00 08</code> - <code>#18 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V</code></p>
<p>第十九 <code>0c 00 05 00 06</code> - <code>#19 = NameAndType        #5:#6          // m:I</code></p>
<p>第二十 <code>01 00 0e 63 36 33 31 2f 54 65 73 74 43 6c 61 73 73</code> - <code>#20 = Utf8               c631/TestClass</code></p>
<p>第二十一 <code>01 00 10 6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74</code> - <code>#21 = Utf8               java/lang/Object</code></p>
<p>到此为止，常量池分析完毕</p>
<h3 id="6-3-3-访问标志"><a href="#6-3-3-访问标志" class="headerlink" title="6.3.3 访问标志"></a>6.3.3 访问标志</h3><p>紧跟在常量池之后，由两个字节组成，有 16 个标志位，当前只定义了 9 种。</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">flag value</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ACC_PUBLIC</td>
<td align="left">0x0001</td>
<td align="left">是否为 public 类型</td>
</tr>
<tr>
<td align="left">ACC_FINAL</td>
<td align="left">0x0010</td>
<td align="left">是否为 final 类型, 只有类可设置</td>
</tr>
<tr>
<td align="left">ACC_SUPER</td>
<td align="left">0x0020</td>
<td align="left">是否允许使用 invokespecial 字节码指定的新语义，<BR>invokespecial 语义在 JDK 1.0.2 发生过改变，<br>为了区别这条指令使用哪种语义， <BR>JDK 1.0.2 之后编译出来的类这个标志必须为真</td>
</tr>
<tr>
<td align="left">ACC_INTERFACE</td>
<td align="left">0x0200</td>
<td align="left">是否是一个接口</td>
</tr>
<tr>
<td align="left">ACC_ABSTRACT</td>
<td align="left">0x0400</td>
<td align="left">是否为 abstract 类型，对于接口或者抽象类来说，此标志必须为真，其他类型为假</td>
</tr>
<tr>
<td align="left">ACC_SYNTHETIC</td>
<td align="left">0x1000</td>
<td align="left">表示这个类并非由用户代码产生</td>
</tr>
<tr>
<td align="left">ACC_ANNOTATION</td>
<td align="left">0x2000</td>
<td align="left">标识这是一个注解</td>
</tr>
<tr>
<td align="left">ACC_ENUM</td>
<td align="left">0x4000</td>
<td align="left">标识这是一个枚举</td>
</tr>
<tr>
<td align="left">ACC_MODULE</td>
<td align="left">0x8000</td>
<td align="left">标识这是一个模块</td>
</tr>
</tbody></table>
<p>示例种值为 <code>00 21</code> 即 0020 &amp; 0001 所以是 public + super 类型</p>
<h3 id="6-3-4-类索引，父索引和接口索引集合"><a href="#6-3-4-类索引，父索引和接口索引集合" class="headerlink" title="6.3.4 类索引，父索引和接口索引集合"></a>6.3.4 类索引，父索引和接口索引集合</h3><ul>
<li>类索引（this_class） - u2 类型数据</li>
<li>父索引（super_class） - u2 类型数据</li>
<li>接口索引集合（super_class） - u2 类型数据</li>
</ul>
<p>这些所以确定类的继承关系，实例中数据 <code>00 03 00 04 00 00</code> 表示 类所以指向常量池第三个常量，父索引指向第四个常量，接口集合数量为 0 </p>
<p><code>#3 = Class              #20            // c631/TestClass</code></p>
<p><code>#4 = Class              #21            // java/lang/Object</code></p>
<h3 id="6-3-5-字段表集合"><a href="#6-3-5-字段表集合" class="headerlink" title="6.3.5 字段表集合"></a>6.3.5 字段表集合</h3><p>用来描述接口或类中声明的变量。这里的变量只包括<strong>类级</strong>变量以及<strong>实例级</strong>变量，不包含局部变量。</p>
<p>字段表结构</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">名称</th>
<th align="left">数量</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">access_flags</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">descriptor_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">attribute_count</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">attribute_info</td>
<td align="left">attributes</td>
<td align="left">attribute_count</td>
</tr>
</tbody></table>
<p>字段修饰符 access_flags 和类的访问修饰符很想都由一个 u2 的数据类型表示</p>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">标志值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ACC_PUBLIC</td>
<td align="left">0x0001</td>
<td align="left">字段是否 public</td>
</tr>
<tr>
<td align="left">ACC_PRIVATE</td>
<td align="left">0x0002</td>
<td align="left">字段是否 private</td>
</tr>
<tr>
<td align="left">ACC_PROTECTED</td>
<td align="left">0x0004</td>
<td align="left">字段是否 protected</td>
</tr>
<tr>
<td align="left">ACC_STATIC</td>
<td align="left">0x0008</td>
<td align="left">字段是否 static</td>
</tr>
<tr>
<td align="left">ACC_FINAL</td>
<td align="left">0x0010</td>
<td align="left">字段是否 final</td>
</tr>
<tr>
<td align="left">ACC_VOLATILE</td>
<td align="left">0x0040</td>
<td align="left">字段是否 volatile</td>
</tr>
<tr>
<td align="left">ACC_TRANSIENT</td>
<td align="left">0x0080</td>
<td align="left">字段是否 transient</td>
</tr>
<tr>
<td align="left">ACC_SYNTHTIC</td>
<td align="left">0x0100</td>
<td align="left">字段是否由编译器产生</td>
</tr>
<tr>
<td align="left">ACC_ENUM</td>
<td align="left">0x0400</td>
<td align="left">字段是否 enum</td>
</tr>
</tbody></table>
<ul>
<li>作用域修饰符： public/private/protected</li>
<li>是否是类级字段：static</li>
<li>是否可变：final</li>
<li>是否强制主从内存读写：volatile</li>
<li>是否可序列化：transient</li>
</ul>
<p>name_index 和 descriptor_index 都指向常量池引用，表示字段简单名称以及字段和方法描述符。</p>
<ul>
<li>全名限定：用斜线分割的 路径+类名</li>
<li>简单名称：只有名字，没有路径信息</li>
<li>方法和字段描述符：参数列表+返回值类型，例如 ()V, (Lcom/lang/Object;)V</li>
</ul>
<p>基本数据类型含义表</p>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">B</td>
<td align="left">byte</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">char</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">F</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">I</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">J</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">short</td>
</tr>
<tr>
<td align="left">Z</td>
<td align="left">boolean</td>
</tr>
<tr>
<td align="left">V</td>
<td align="left">void</td>
</tr>
<tr>
<td align="left">L</td>
<td align="left">对象类型</td>
</tr>
</tbody></table>
<p>表示数组类型时，每一维度将使用一个前置的 <code>[</code> 字符描述，比如 String[][] 表示为 <code>[[Ljava/lang/String;</code>, 整形数组 int[] 表示为 <code>[I</code>。</p>
<p>实例中对应的字段表集合内容为 <code>00 01 00 02 00 05 00 06 00 00</code>， interface 之后紧接着为 fields_count 的表示位， <code>00 01</code>， 表示只有一个 field。</p>
<p><code>00 02</code> 表示方位权限 private，<code>00 05</code> 表示名字指向常量池第五个常量 <code>m</code>, <code>00 06</code> 表示描述符指向第六个常量 <code>I</code>，<code>00 00</code> 属性表个数位 0 个。</p>
<h3 id="6-3-6-方法表集合"><a href="#6-3-6-方法表集合" class="headerlink" title="6.3.6 方法表集合"></a>6.3.6 方法表集合</h3><p>方法表和之前的属性表，class 表是一个套路的, 方法表结构如下</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">名称</th>
<th align="left">数量</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">access_flags</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">descriptor_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">attribute_count</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">attribute_info</td>
<td align="left">attributes</td>
<td align="left">attribute_count</td>
</tr>
</tbody></table>
<p>方法表的 access_flag 相对 field 少了 volatile 和 trasient, 多了 synchronized, native, strictfp 和 abstract</p>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">标志值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ACC_PUBLIC</td>
<td align="left">0x0001</td>
<td align="left">方法是否 public</td>
</tr>
<tr>
<td align="left">ACC_PRIVATE</td>
<td align="left">0x0002</td>
<td align="left">方法是否 private</td>
</tr>
<tr>
<td align="left">ACC_PROTECTED</td>
<td align="left">0x0004</td>
<td align="left">方法是否 protected</td>
</tr>
<tr>
<td align="left">ACC_STATIC</td>
<td align="left">0x0008</td>
<td align="left">方法是否 static</td>
</tr>
<tr>
<td align="left">ACC_FINAL</td>
<td align="left">0x0010</td>
<td align="left">方法是否 final</td>
</tr>
<tr>
<td align="left">ACC_SYNCHRONIZED</td>
<td align="left">0x0020</td>
<td align="left">方法是否 synchronized</td>
</tr>
<tr>
<td align="left">ACC_BRIDGE</td>
<td align="left">0x0040</td>
<td align="left">方法是否是由编译器产生的桥接方法</td>
</tr>
<tr>
<td align="left">ACC_VARARGS</td>
<td align="left">0x0080</td>
<td align="left">方法是否接收不定长参数</td>
</tr>
<tr>
<td align="left">ACC_NATIVE</td>
<td align="left">0x0100</td>
<td align="left">方法是否为 native</td>
</tr>
<tr>
<td align="left">ACC_ABSTRACT</td>
<td align="left">0x0400</td>
<td align="left">字段是否 abstract</td>
</tr>
<tr>
<td align="left">ACC_STRICT</td>
<td align="left">0x0800</td>
<td align="left">字段是否 strictfp</td>
</tr>
<tr>
<td align="left">ACC_SYNTHETIC</td>
<td align="left">0x1000</td>
<td align="left">字段是否由编译器自动产生</td>
</tr>
</tbody></table>
<p>方法中的具体实现经过 javac 编译成字节码指令后存在属性表集合中一个名为 Code 的属性里面。</p>
<p>实例内容 <code>00 02 00 01 00 07 00 08 00 01 00 09</code></p>
<ul>
<li>00 02 - 有两个方法</li>
<li>00 01 - public 类型的方法</li>
<li>00 07 - name 指向常量池7 - <init></li>
<li>00 08 - 描述符指向8 - ()V</li>
<li>00 01 - 属性数量 1</li>
<li>00 09 - 属性表索引 9，指向 Code</li>
</ul>
<p>方法签名：Java 语法中的方法签名可以从重载(Overload)理解。Java 中重载要求方法名一致，参数列表及参数类型不同。返回值并不在比较范围内。方法除了返回值不同的重载是会编译错误的。但是在字节码的语义中，只有返回值不同的重载是合法的。</p>
<h3 id="6-3-7-属性表集合"><a href="#6-3-7-属性表集合" class="headerlink" title="6.3.7 属性表集合"></a>6.3.7 属性表集合</h3><p>属性表集合的限制比前面那些结构要宽松一些，对虚拟机不认识的属性，会自动跳过。到 java 12 一共有 29 种预定义的属性</p>
<table>
<thead>
<tr>
<th align="left">属性名称</th>
<th align="left">使用位置</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Code</td>
<td align="left">方法表</td>
<td align="left">Java代码编译成的自己吗指令</td>
</tr>
<tr>
<td align="left">ConstantValue</td>
<td align="left">字段表</td>
<td align="left">由 final 关键字定义的常量值</td>
</tr>
<tr>
<td align="left">Deprecated</td>
<td align="left">类，方法，字段表</td>
<td align="left">被声明为 deprecated 的方法和字段</td>
</tr>
<tr>
<td align="left">Exceptions</td>
<td align="left">方法表</td>
<td align="left">方法抛出的异常列表</td>
</tr>
<tr>
<td align="left">EnclosingMethod</td>
<td align="left">类文件</td>
<td align="left">仅当一个类为局部类或匿名类是才拥有这个属性，用于标识这个类所在的外围方法</td>
</tr>
<tr>
<td align="left">InnerClasses</td>
<td align="left">类文件</td>
<td align="left">内部类列表</td>
</tr>
<tr>
<td align="left">LineNumberTable</td>
<td align="left">Code属性</td>
<td align="left">Java 源码的行号与字节码指令的对应关系</td>
</tr>
<tr>
<td align="left">LocalVariableTable</td>
<td align="left">Code属性</td>
<td align="left">方法的局部变量描述</td>
</tr>
<tr>
<td align="left">StackMapTable</td>
<td align="left">Code属性</td>
<td align="left">JDK6 新增，供新的类型检查验证器检查和处理目标方法的局部变量和操作数栈所需的类型是否匹配</td>
</tr>
<tr>
<td align="left">Signature</td>
<td align="left">类，方法表和字段表</td>
<td align="left">JDK5新增，用于支持泛型情况下的方法签名</td>
</tr>
<tr>
<td align="left">SourceFile</td>
<td align="left">类文件</td>
<td align="left">记录源文件名称</td>
</tr>
<tr>
<td align="left">SourceDebugExtension</td>
<td align="left">类文件</td>
<td align="left">JDK5新增，存储额外的调试信息</td>
</tr>
<tr>
<td align="left">Synthetic</td>
<td align="left">类，方法表，字段表</td>
<td align="left">标识是否由编译器产生</td>
</tr>
<tr>
<td align="left">LocalVariableTypeTable</td>
<td align="left">类</td>
<td align="left">JDK5新增，使用特征签名代替描述符，为了支持泛型</td>
</tr>
<tr>
<td align="left">RuntimeVisibleAnnotations</td>
<td align="left">类，方法表，字段表</td>
<td align="left">JDK5新增，为动态注解提供支持</td>
</tr>
<tr>
<td align="left">RuntimeInVisibleAnnotations</td>
<td align="left">类，方法表，字段表</td>
<td align="left">JDK5新增，为动态注解提供支持,标识不可见</td>
</tr>
<tr>
<td align="left">RuntimeVisibleParameterAnnotations</td>
<td align="left">方法表</td>
<td align="left">JDK5新增，作用对象为方法参数</td>
</tr>
<tr>
<td align="left">RuntimeInvisibleParameterAnnotations</td>
<td align="left">方法表</td>
<td align="left">JDK5新增，作用对象为方法参数</td>
</tr>
<tr>
<td align="left">AnnotationDefault</td>
<td align="left">方法表</td>
<td align="left">JDK5新增，注解类元素默认值</td>
</tr>
<tr>
<td align="left">BootstrapMethods</td>
<td align="left">类文件</td>
<td align="left">JDK7新增，保存 invokedynamic 指令引用的引导犯法限定符</td>
</tr>
<tr>
<td align="left">RuntimeVisibleTypeAnnotations</td>
<td align="left">类，方法表，字段表, Code属性</td>
<td align="left">JDK8新增</td>
</tr>
<tr>
<td align="left">RuntimeInvisibleTypeAnnotations</td>
<td align="left">类，方法表，字段表, Code属性</td>
<td align="left">JDK8新增</td>
</tr>
<tr>
<td align="left">MethodParameters</td>
<td align="left">方法表</td>
<td align="left">JDK8新增</td>
</tr>
<tr>
<td align="left">Module</td>
<td align="left">类</td>
<td align="left">JDK9新增</td>
</tr>
<tr>
<td align="left">ModulePackages</td>
<td align="left">类</td>
<td align="left">JDK9新增</td>
</tr>
<tr>
<td align="left">ModuleMainClass</td>
<td align="left">类</td>
<td align="left">JDK9新增</td>
</tr>
<tr>
<td align="left">NestHost</td>
<td align="left">类</td>
<td align="left">JDK11新增</td>
</tr>
<tr>
<td align="left">NestMembers</td>
<td align="left">类</td>
<td align="left">JDK11新增</td>
</tr>
</tbody></table>
<p>属性表结构</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">名称</th>
<th align="left">数量</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u1</td>
<td align="left">info</td>
<td align="left">attribute_length</td>
</tr>
</tbody></table>
<p>attribute_name_index 指向常量池中的一个引用，属性值结构完全自定义，attribute_length 说明属性值所占的位数。</p>
<h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><p>Java 方法体种的代码经过 javac 编译器处理之后都会转化为字节码指令存储在 Code 属性内。Code 属性出现在方法表的属性集合中，但并非所有方法表都必须存在这个属性，比如抽象方法或接口中就可以不存在 Code 属性。</p>
<p>Code 属性表的结构</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">名称</th>
<th align="left">数量</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
<td align="left">指向 CONSTANT_Utf8_info 常量的索引，为固定值 Code</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
<td align="left">属性值长度</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">max_stack</td>
<td align="left">1</td>
<td align="left">操作数栈深度的最大值</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">max_locals</td>
<td align="left">1</td>
<td align="left">局部变量表存储空间，单位-变量槽(Slot)</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">code_length</td>
<td align="left">1</td>
<td align="left">编译后字节码指令个数</td>
</tr>
<tr>
<td align="left">u1</td>
<td align="left">code</td>
<td align="left">code_length</td>
<td align="left">编译后字节码指令</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">exception_table_length</td>
<td align="left">1</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">exception_info</td>
<td align="left">exception_table</td>
<td align="left">exception_table_length</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">attribute_count</td>
<td align="left">1</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">attribute_info</td>
<td align="left">attributes</td>
<td align="left">attribute_count</td>
<td align="left">-</td>
</tr>
</tbody></table>
<p>对于 byte, char, float, int, short, boolean 和 returnAddress 等长度不超过 32 byte 的数据类型，每个局部变量占用一个变量槽，double, long 这两个 64 位的占两个槽。</p>
<p>同时生存的最大局部变量和类型计算出 max_locals</p>
<p>字节码指令长度 u1。u1 可以最多表达 255 个指令，现在大约已经定义了 200 条。</p>
<p>测试案例中 init 方法对应的 code 代码块为 <code>00 09 00 00 00 2f 00 01 00 01 00 00 00 05 2a b7 00 01 b1 00 00 00 02</code></p>
<p><code>00 09</code> 前面已经说过，指向固定的 Code 字符地址</p>
<p><code>00 00 00 31</code> 属性表长度 3*16 + 1 = 49</p>
<p><code>00 01</code> 栈深 1</p>
<p><code>00 01</code> 本地变量表大小 1</p>
<p><code>00 00 00 05</code> code 长度 5</p>
<p><code>2a b7 00 01 b1</code> code 内容</p>
<ul>
<li><code>2a</code>: aload_0 将第一个变量推送至栈顶</li>
<li><code>b7</code> invokespecial, 后面接一个 u2 类型引用数据，执行构造方法或 private 方法，或它的父类方法</li>
<li><code>00 01</code> 方法引用，指向 init</li>
<li><code>b1</code> return 指令</li>
</ul>
<p>对应的 javap 代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public c631.TestClass();</span><br><span class="line">  descriptor: ()V</span><br><span class="line">  flags: (0x0001) ACC_PUBLIC</span><br><span class="line">  Code:</span><br><span class="line">    stack&#x3D;1, locals&#x3D;1, args_size&#x3D;1</span><br><span class="line">        0: aload_0</span><br><span class="line">        1: invokespecial #1                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">        4: return</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line 3: 0</span><br><span class="line">    LocalVariableTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">          0       5     0  this   Lc631&#x2F;TestClass;</span><br></pre></td></tr></table></figure>

<p><code>args_size=1</code> 方法虽然没有参数，但是 Java 编译时会把 this 作为第一个默认参数塞入 code 代码块中。</p>
<p><code>00 00 00 02</code> 异常表长度 0， 属性表长度 2</p>
<p>异常表结构</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">名称</th>
<th align="left">数量</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">start_pc</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">end_pc</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">handler_pc</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">catch_type</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>异常代码案例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">inc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> x;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          x = <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">return</span> x;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          x = <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">return</span> x;</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          x = <span class="number">3</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>对应的 javap 代码</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public int inc();</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: (0x0001) ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=5, args_size=1</span><br><span class="line">         0: iconst_1</span><br><span class="line">         1: istore_1</span><br><span class="line">         2: iload_1</span><br><span class="line">         3: istore_2</span><br><span class="line">         4: iconst_3</span><br><span class="line">         5: istore_1</span><br><span class="line">         6: iload_2</span><br><span class="line">         7: ireturn</span><br><span class="line">         8: astore_2</span><br><span class="line">         9: iconst_2</span><br><span class="line">        10: istore_1</span><br><span class="line">        11: iload_1</span><br><span class="line">        12: istore_3</span><br><span class="line">        13: iconst_3</span><br><span class="line">        14: istore_1</span><br><span class="line">        15: iload_3</span><br><span class="line">        16: ireturn</span><br><span class="line">        17: astore        4</span><br><span class="line">        19: iconst_3</span><br><span class="line">        20: istore_1</span><br><span class="line">        21: aload         4</span><br><span class="line">        23: athrow</span><br><span class="line">      Exception table:</span><br><span class="line">         from    to  target type</span><br><span class="line">             0     4     8   Class java/lang/Exception</span><br><span class="line">             0     4    17   any</span><br><span class="line">             8    13    17   any</span><br><span class="line">            17    19    17   any</span><br></pre></td></tr></table></figure>

<p>和书上的结果略有差别，但基本一致</p>
<h4 id="Exceptions-属性"><a href="#Exceptions-属性" class="headerlink" title="Exceptions 属性"></a>Exceptions 属性</h4><p>和 Code 平级的概念，并不是上一章节里 Code 下面的 exception 表。这里表示的是方法可能抛出的异常，就是 throws 后面的那些东西。属性结构如下:</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">number_of_exceptions</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">exception_index_table</td>
<td align="left">number_of_exceptions</td>
</tr>
</tbody></table>
<p>number_of_exceptions: 可能抛出的受检测的异常类型<br>exception_index_table: 指向常量池中的 CONSTANT_Class_info 索引</p>
<h4 id="LineNumberTable-属性"><a href="#LineNumberTable-属性" class="headerlink" title="LineNumberTable 属性"></a>LineNumberTable 属性</h4><p>描述 Java 源码行号和字节码行号之间的对应关系。可以在编译时指定不生成行号，但是会影响异常信息显示和 debug, 表结构如下:</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">line_number_table_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">line_number_info</td>
<td align="left">line_number_table</td>
<td align="left">line_number_table_length</td>
</tr>
</tbody></table>
<p>line_number_info: 包含 start_pc 和 line_number 两个 u2 类型的数据项，前者是字节码行号，后者是 Java 源码行号。</p>
<h4 id="LocalVarableTable-及-LocalVarableTypeTable-属性"><a href="#LocalVarableTable-及-LocalVarableTypeTable-属性" class="headerlink" title="LocalVarableTable 及 LocalVarableTypeTable 属性"></a>LocalVarableTable 及 LocalVarableTypeTable 属性</h4><p>LocalVarableTable 描述局部变量表的变量与 Java 源码中定义的变量之间的关系。非必须，可以指定 javac 参数去除且不影响运行。但是去除后方法参数名称会变为类似 arg0, arg1 的表示，不方便，表结构如下：</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">local_variable_table_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">local_variable_info</td>
<td align="left">local_variable_table</td>
<td align="left">local_variable_table_length</td>
</tr>
</tbody></table>
<p>local_variable_info 代表栈帧与源码中局部变量的关联，结构如下：</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">start_pc</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">descriptor_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">index</td>
<td align="left">1</td>
</tr>
</tbody></table>
<ul>
<li>start_pc + length: 限定了局部变量的作用范围，即作用域</li>
<li>name_index + descriptor_index: 指向常量池中 CONSTANT_Utf8_info 类型索引</li>
<li>index: 栈帧局部变量槽位置，当数据类型为 64 位则占用 index 和 index+1 两个</li>
</ul>
<p>LocalVarableTypeTable 是 JDK5 时为了支持泛型而引入的，基本功能和 LocalVarableTable 一样。</p>
<h4 id="SourceFile-及-SourceDebugExtension-属性"><a href="#SourceFile-及-SourceDebugExtension-属性" class="headerlink" title="SourceFile 及 SourceDebugExtension 属性"></a>SourceFile 及 SourceDebugExtension 属性</h4><p>SourceFile 记录生成 Class 文件的源码文件名称，可选，通常与类名同，特殊情况除外(如内部类)。表结构如下:</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">sourcefile_index</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>sourcefile_index: 指向常量池中 CONSTANT_Utf8_info 型常量的索引，值问文件名。</p>
<p>SourceDebugExtension 是 JDK5 中加入的新特性，存储额外调试信息，支持类似 JSP 这种使用 Java 编译器但是语法不同的语言，类中最多只允许一个该属性。表结构如下：</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">debug_extension[attribute_length]</td>
<td align="left">1</td>
</tr>
</tbody></table>
<h4 id="ConstantValue-属性"><a href="#ConstantValue-属性" class="headerlink" title="ConstantValue 属性"></a>ConstantValue 属性</h4><p>ConstantValue 通知虚拟机自动为静态变量赋值。只有被 static 修饰的变量才能使用这个属性。虚拟机中对非 static 变量在 <init>() 方法总进行，对于静态变量则有两种方式，一种是构造器 <clinit>() 另一种是 ConstantValue。Oracle 的 javac 中的实现方式为：static + final + 基本类型/String 在 ConstantValue 中赋值， 没有 final 或者是其他数据类型则在 <clinit>() 中赋值。表结构如下：</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">constantvalue_index</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>constantvalue_index: 指向常量池中一个引用，可选类型有 CONSTANT_Long_info, CONSTANT_Float_info, CONSTANT_Double_info, CONSTANT_Integer_info 和 CONSTANT_String_info。</p>
<h4 id="InnerClasses-属性"><a href="#InnerClasses-属性" class="headerlink" title="InnerClasses 属性"></a>InnerClasses 属性</h4><p>InnerClasses 记录内部类与宿主类之间的关联。结构如下：</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">number_of_classes</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">inner_classes_info</td>
<td align="left">inner_classes</td>
<td align="left">number_of_classes</td>
</tr>
</tbody></table>
<p>number_of_classes: 内部类个数</p>
<p>inner_classes_info 结构如下</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">inner_class_info_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">outer_class_info_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">inner_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">inner_class_access_flags</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>inner_class_info_index, outer_class_info_index：指向常量池中 CONSTANT_Class_info 常量索引，分别代表内部类和宿主类</p>
<p>inner_name_index：指向常量池 CONSTANT_Utf8_info 引用，代表内部类名称，如果是匿名内部类，值为 0</p>
<p>inner_class_access_flags：和 class 定义相似，类的访问标示符，取值范围如下</p>
<table>
<thead>
<tr>
<th align="left">标志名称</th>
<th align="left">标志值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ACC_PUBLIC</td>
<td align="left">0x0001</td>
<td align="left">内部类是否为 public</td>
</tr>
<tr>
<td align="left">ACC_PRIVATE</td>
<td align="left">0x0002</td>
<td align="left">内部类是否为 private</td>
</tr>
<tr>
<td align="left">ACC_PROTECTED</td>
<td align="left">0x0004</td>
<td align="left">内部类是否为 protected</td>
</tr>
<tr>
<td align="left">ACC_STATIC</td>
<td align="left">0x0008</td>
<td align="left">内部类是否为 static</td>
</tr>
<tr>
<td align="left">ACC_FINAL</td>
<td align="left">0x0010</td>
<td align="left">内部类是否为 final</td>
</tr>
<tr>
<td align="left">ACC_INTERFACE</td>
<td align="left">0x0020</td>
<td align="left">内部类是否为 接口</td>
</tr>
<tr>
<td align="left">ACC_ABSTRACT</td>
<td align="left">0x0400</td>
<td align="left">内部类是否为 abstract</td>
</tr>
<tr>
<td align="left">ACC_SYNTHETIC</td>
<td align="left">0x1000</td>
<td align="left">内部类是否并非由用户代码产生</td>
</tr>
<tr>
<td align="left">ACC_ANNOTATION</td>
<td align="left">0x2000</td>
<td align="left">内部类是否为一个注解</td>
</tr>
<tr>
<td align="left">ACC_ENUM</td>
<td align="left">0x4000</td>
<td align="left">内部类是否为一个枚举</td>
</tr>
</tbody></table>
<h4 id="Deprecated-及-Synthetic-属性"><a href="#Deprecated-及-Synthetic-属性" class="headerlink" title="Deprecated 及 Synthetic 属性"></a>Deprecated 及 Synthetic 属性</h4><p>都是标志符类型的布尔属性，只有存在有和没有的区别，没有属性概念。Deprecated 对应 @deprecated 注解，表示不推荐使用。</p>
<p>Synthetic 标示字段或方法由编译器产生，JDK5之后同样的功能可以通过设置 ACC_SYNTHETIC 标志位达到。通过这种方式甚至可以越权访问或绕开语言限制功能。典型例子是枚举类中自动生成枚举元素数组和嵌套类的桥接方法(Bridge Method)。</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>attribute_length 必须为 0x00000000，因为诶呦任何属性需要设置。</p>
<h4 id="StackMapTable-属性"><a href="#StackMapTable-属性" class="headerlink" title="StackMapTable 属性"></a>StackMapTable 属性</h4><p>JDK6 增加到 Class 文件规范，一个相当复杂的变长属性，位于 Code 属性表中，用来代替原来的类型检查验证器，提升性能。实现很复杂，Java SE7 新增 120 页篇幅讲解描述。</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">number_of_entries</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">stack_map_frame</td>
<td align="left">stack_map_frame entries</td>
<td align="left">number_of_entries</td>
</tr>
</tbody></table>
<p>SE7 之后规定，版本号 &gt;= 50.0 的 class 文件都必须带有 StackMapTable 属性。一个 Code 属性最多只能有一个 StackMapTable 不然抛错 ClassFormatError。</p>
<h4 id="Signature-属性"><a href="#Signature-属性" class="headerlink" title="Signature 属性"></a>Signature 属性</h4><p>在 JDK5 中和泛型一起加入的，记录泛型签名信息。Java 中的泛型是伪泛型。</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">signature_index</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>signature_index 指向常量池的一个 CONSTANT_Utf8_info 索引。</p>
<h4 id="BootstrapMethods-属性"><a href="#BootstrapMethods-属性" class="headerlink" title="BootstrapMethods 属性"></a>BootstrapMethods 属性</h4><p>JDK7 时新增，JDK8 中通过 lambda 发扬光大。位于类文件属性表中，用于保存 invokeDynamic 指令引用的引导方法限定符。类文件常量池中出现过 CONSTANT_InvokeDynamic_info 类型的常量，那么属性表中必有 BootstrapMethods 属性，一个类文件中至多只能有一个 BootstrapMethods 属性。</p>
<p>BootstrapMethods 属性结构</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">num_bootstrap_methods</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">bootstrap_method</td>
<td align="left">bootstrap_methods</td>
<td align="left">num_bootstrap_methods</td>
</tr>
</tbody></table>
<p>bootstrap_methods[]: 每个成员包含一个指向常量池 CONSTANT_MethodHandle 结构的索引，代表一个引导方法。</p>
<p>bootstrap_method 属性结构</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">bootstrap_method_ref</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">num_bootstrap_arguments</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">bootstrap_arguments</td>
<td align="left">num_bootstrap_arguments</td>
</tr>
</tbody></table>
<ul>
<li>bootstrap_method_ref：对常量池的一个有效索引，索引处必须是一个 CONSTNAT_MethodHandle_info 结构</li>
<li>num_bootstrap_arguments：arg 数量</li>
<li>bootstrap_arguments：每个成员必须是对常量池的有效引用，指向的结构必须是：CONSTANT_String_info，CONSTANT_Class_info, CONSTANT_Integer_info, CONSTANT_Long_info, CONSTANT_Float_info, CONSTANT_Double_info, CONSTANT_MethodHandle_info 或 CONSTANT_MethodType_info 之一</li>
</ul>
<h4 id="MethodParameters-属性"><a href="#MethodParameters-属性" class="headerlink" title="MethodParameters 属性"></a>MethodParameters 属性</h4><p>JDK8 时加入，之前没有这个属性， jar 包反编译时缺少参数信息，不方便理解，影响传播。之前还有个替代方案，通过 ‘-g:var’ 存入 LocalVariableTable, 但是他时 Code 的字表，在接口方法这类没有具体实现的方法时不生效。</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u1</td>
<td align="left">parameters_count</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">parameter</td>
<td align="left">parameters</td>
<td align="left">parameters_count</td>
</tr>
</tbody></table>
<p>parameter 属性</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">access_flags</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>name_index 指向常量池 CONTANT_Utf8_info 的索引值，代表名称</p>
<p>access_flags 有三种 0x0001-ACC_FINAL, 0x1000-ACC_SYNTHETIC, 0x8000-ACC_MANDATED(原文件中隐式定义，典型用法 this)</p>
<h4 id="模块化相关属性"><a href="#模块化相关属性" class="headerlink" title="模块化相关属性"></a>模块化相关属性</h4><p>TBD 怎是没用到就不记了，以后用到再看看</p>
<h4 id="运行时注解相关属性"><a href="#运行时注解相关属性" class="headerlink" title="运行时注解相关属性"></a>运行时注解相关属性</h4><p>JDK5 时加入了注解相关信息到 Class 文件，他们是 RuntimeVisibleAnnotations, RuntimeInvisibleAnnotations, RuntimeVisibleParameterAnnotations 和 RuntimeInvisibleParameterAnnotations。JDK8 时新家了 RuntimeVisibleTypeAnnotations, RuntimeInvisibleTypeAnnotations。这些属性功能和结构都很雷同。</p>
<p>RuntimeVisibleAnnotations 属性结构</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">attribute_name_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u4</td>
<td align="left">attribute_length</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">num_annotations</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">annotation</td>
<td align="left">annotations</td>
<td align="left">num_annotations</td>
</tr>
</tbody></table>
<p>annotations 属性结构</p>
<table>
<thead>
<tr>
<th align="left">type</th>
<th align="left">name</th>
<th align="left">count</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u2</td>
<td align="left">type_index</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">u2</td>
<td align="left">num_element_value_pairs</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">element_value_pair</td>
<td align="left">element_value_pairs</td>
<td align="left">num_element_value_pairs</td>
</tr>
</tbody></table>
<p>type_index 指向常量池 CONSTANT_Utf8_info 常量的索引， num_element_value_pairs 数组计数器，element_value_pair 为键值对</p>
<h2 id="6-4-字节码指令简介"><a href="#6-4-字节码指令简介" class="headerlink" title="6.4 字节码指令简介"></a>6.4 字节码指令简介</h2><p>虚拟机指令 = 操作码(opcode) + 操作数(oprand)</p>
<p>操作码为一个字节长度，操作数为 0 至 n 个，虚拟机执行模型</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">do &#123;</span><br><span class="line">  自动计算 PC 寄存器的值加 1；</span><br><span class="line">  根据 PC 寄存器指示的位置，从字节码流中取出操作码；</span><br><span class="line">  if (字节码存在操作数) 从字节码流中取出操作数；</span><br><span class="line">  执行操作吗所定义的操作；</span><br><span class="line">&#125; while (字节码流长度 &gt; 0)</span><br></pre></td></tr></table></figure>

<h3 id="6-4-1-字节码与数据类型"><a href="#6-4-1-字节码与数据类型" class="headerlink" title="6.4.1 字节码与数据类型"></a>6.4.1 字节码与数据类型</h3><p>大多数操作码都包含对应操作数类型信息，比如 iload。</p>
<ul>
<li>i - int</li>
<li>l - long</li>
<li>s - short</li>
<li>b - byte</li>
<li>c - char</li>
<li>f - float</li>
<li>d - double</li>
<li>a - reference</li>
</ul>
<p>boolean, byte, short, char 在编译时会被扩展成 int 类型再处理。</p>
<h3 id="6-4-2-加载和存储指令"><a href="#6-4-2-加载和存储指令" class="headerlink" title="6.4.2 加载和存储指令"></a>6.4.2 加载和存储指令</h3><p>用于将数据在栈帧中的局部变量表和操作数栈之间来回传输</p>
<p>将局部变量加载到操作栈：(i/l/f/d/a)load, (i/l/f/d/a)load_<n></p>
<p>将一个数值从操作数栈存储到局部变量表：(i/l/f/d/a)store, (i/l/f/d/a)store_<n></p>
<p>将一个常量加载到操作数栈：bipush, sipush, ldc, ldc_w, ldc2_w, aconst_null, iconst_m1, icont_<i>, lconst_<l>, fconst_<f>, dconst_<d></p>
<p>扩充局部变量表的访问索引指令： wide</p>
<p>iload_<n> 代表了 iload_1, iload_2, iload_3</p>
<h3 id="6-4-3-运算指令"><a href="#6-4-3-运算指令" class="headerlink" title="6.4.3 运算指令"></a>6.4.3 运算指令</h3><p>算术指令用于对 操作数栈 上的两个值进行某种特定运算，并把 结果 重新存入操作栈 顶。byte, short, char 和 Boolean 会转化为 int 计算</p>
<ul>
<li>加法指令： (i, l, f, d)add</li>
<li>减法指令： (i, l, f, d)sub</li>
<li>乘法指令： (i, l, f, d)mul</li>
<li>除法指令： (i, l, f, d)div</li>
<li>求余指令： (i, l, f, d)rem</li>
<li>取反指令： (i, l, f, d)neg</li>
<li>位移指令： ishl, ishr, iushr, lshl, lshr, lushr</li>
<li>按位或指令： ior, lor</li>
<li>按位与指令： iand, land</li>
<li>按位异或指令： ixor, lxor</li>
<li>局部变量自增指令： iinc</li>
<li>比较指令： dcmpg, dcmpl, fcmpg, fcmpl, lcmp</li>
</ul>
<h3 id="6-4-4-类型转换指令"><a href="#6-4-4-类型转换指令" class="headerlink" title="6.4.4 类型转换指令"></a>6.4.4 类型转换指令</h3><p>该指令可以将两种不同数值类型的数据互相转化，这些转化操作一般用于用户代码中的显示类型转化，或者前面提到的字节码指令集中数据类型相关指令无法与数据类型一一对应的问题。</p>
<p>虚拟机直接支持宽化类型转化，及小范围向大范围转换</p>
<ol>
<li>int 类型到 long, float, double</li>
<li>long 到 float， double</li>
<li>float 到 double</li>
</ol>
<p>窄化转化指令： i2b, i2c, i2s, l2i, f2i, f2l, d2i, d2l, d2f。</p>
<p>窄化转化可能发生上限溢出，下限溢出 或精度丢失，但是这些问题都不会抛出运行时异常。</p>
<h3 id="6-4-5-对象创建与访问指令"><a href="#6-4-5-对象创建与访问指令" class="headerlink" title="6.4.5 对象创建与访问指令"></a>6.4.5 对象创建与访问指令</h3><ul>
<li>创建类实例 new</li>
<li>创建数组 newarray, anewarray, multianewarray</li>
<li>访问类字段和实例字段的指令：getfield, putfield, getstatic, putstatic</li>
<li>把一个数组元素加载到操作数栈中的指令：baload, caload, saload, iaload, laload, faload, daload, aaload</li>
<li>将一个操作数栈的值存储到数组元素中：bastore, castore, sastore, iastore, fastore, dastore, aastore</li>
<li>取数组长度的指令：arraylength</li>
<li>检查类实例类型的指令：instanceof, checkcast</li>
</ul>
<h3 id="6-4-6-操作数栈管理指令"><a href="#6-4-6-操作数栈管理指令" class="headerlink" title="6.4.6 操作数栈管理指令"></a>6.4.6 操作数栈管理指令</h3><ul>
<li>将操作数栈栈顶的一个或两个元素出栈：pop, pop2</li>
<li>复制栈顶的一个或两个数值并将复制或双份复制值重新压入栈顶：dup, dup2, dup_x1, dup2_x1, dup_x2, dup2_x2</li>
</ul>
<h3 id="6-4-7-控制转移指令"><a href="#6-4-7-控制转移指令" class="headerlink" title="6.4.7 控制转移指令"></a>6.4.7 控制转移指令</h3><p>可以让 Java 虚拟机有条件或五天见的从指定位置指令的吓一跳指令继续执行程序。</p>
<ul>
<li>条件分支： ifeq, iflt, ifle, ifne, ifgt, ifge, ifnull, ifnonnull, if_icmpeq, if_icmpne, if_icmplt, if_icompgt, if_icomple, if_icompge, if_acmpeq, if_acmpne</li>
<li>复合条件分支：tableswitch, lookupswitch</li>
<li>无条件分支：goto, goto_w, jsr, jsr_w, ret</li>
</ul>
<h3 id="6-4-8-方法调用和返回指令"><a href="#6-4-8-方法调用和返回指令" class="headerlink" title="6.4.8 方法调用和返回指令"></a>6.4.8 方法调用和返回指令</h3><ul>
<li>invokevirtual: 调用对象的实例方法，根据对象的世纪类型进行分派，Java 中最常见的分派方式</li>
<li>invokeinterface: 调用接口方法，运行时搜索一个实现了该接口方法的对象，找出适合的方法进行调用</li>
<li>invokespecial: 调用一些需要特殊处理的实例方法，包括实例初始化方法，私有方法和父类方法</li>
<li>invokestatic: 调用静态方法</li>
<li>invokedynamic: 运行时动态解析出调用点限定符所应用的方法，并执行该方法。</li>
</ul>
<p>返回指令：当返回值是 boolean, byte, char, short, int 时使用 ireturn, 其他还有 lreturn, freturn, dreturn 和 areturn。还有为 void 准备的 return。</p>
<h3 id="6-4-9-异常处理指令"><a href="#6-4-9-异常处理指令" class="headerlink" title="6.4.9 异常处理指令"></a>6.4.9 异常处理指令</h3><p>Java 中显示的排除异常操作由 athrow 指令实现，虚拟机中异常处理不是由字节码指令实现，而是通过 异常表</p>
<h3 id="6-4-10-同步指令"><a href="#6-4-10-同步指令" class="headerlink" title="6.4.10 同步指令"></a>6.4.10 同步指令</h3><p>虚拟机支持方法级别的同步和方法内部一段指令序列的同步，这两种同步结构都是用管程，也叫锁。方法级别的管程是隐示的无需通过字节码指令控制。他的实现在方法调用和返回之间。虚拟机可以重常量池方法表结构中的 ACC_SYNCHRONIZED 得知是否被声明为同步方法。如果执行时出现异常，同步方法所持有的锁会在异常抛到同步方法边界之外时自动释放。对应的指令为 monitorenter 和 monitorexit。</p>
<p>虚拟机必须保证每条 monitorenter 指令都有一条 monitorexit 指令与之对应。</p>
<h2 id="6-5-公有设计，私有实现"><a href="#6-5-公有设计，私有实现" class="headerlink" title="6.5 公有设计，私有实现"></a>6.5 公有设计，私有实现</h2><p>Class 文件格式和字节码集是完全独立于操作系统和虚拟机实现的，任何一款虚拟机实现都必须能够读取 Class 文件并精确实现包含在其中的 Java 虚拟机代码的语义。虚拟机规范鼓励在满足约束的条件下修改和优化实现。虚拟机实现方式主要有两种：</p>
<ol>
<li>将输入的 Java 虚拟机代码在加载或执行时翻译成另一种虚拟机代码</li>
<li>将输入的 Java 虚拟机代码在加载或执行时翻译成宿主机本地指令集，即 即时编译器代码生成技术</li>
</ol>
<h2 id="6-6-Class-文件结构的发展"><a href="#6-6-Class-文件结构的发展" class="headerlink" title="6.6 Class 文件结构的发展"></a>6.6 Class 文件结构的发展</h2><p>相对与 Java 技术体系的变化，Class 文件结构可谓是相当的稳定了。。。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/18/ASM-basic-concept/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/18/ASM-basic-concept/" class="post-title-link" itemprop="url">ASM 中的一些基本概念</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-18 15:43:43" itemprop="dateCreated datePublished" datetime="2020-11-18T15:43:43+08:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>记录下收集到的 ASM 的基础概念和例子</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://gitlab.ow2.org/asm/asm/-/blob/master/asm/src/test/java/org/objectweb/asm/TypeTest.java">ASM 官方 repo</a></p>
<h2 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h2><p>Type 类代 field 和 method 的 descriptor 属性。就是类似 <code>(Ljava/lang/String;)V</code> 这种表达式。该类中所有的方法几乎都是静态的，提供的功能也基本一致，传入某种类型的参数，然后返回代表 descriptor 的 type 对象。当传入为 method 类型的参数时，type 中会包含 <code>参数 + 返回值</code> 类型信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException </span>&#123;</span><br><span class="line">    System.out.println(Type.getType(String.class));</span><br><span class="line">    System.out.println(Type.getType(<span class="keyword">this</span>.getClass().getMethod(<span class="string">&quot;testGetTypeFromDescriptor&quot;</span>, String.class)));</span><br><span class="line">    System.out.println(Arrays.toString(Type.getArgumentTypes(<span class="string">&quot;(Ljava/lang/String;)V&quot;</span>)));</span><br><span class="line">    System.out.println(Type.getType(<span class="keyword">this</span>.getClass().getMethod(<span class="string">&quot;getList&quot;</span>)));</span><br><span class="line">    System.out.println(Type.getType(<span class="keyword">this</span>.getClass().getMethod(<span class="string">&quot;getArr&quot;</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetTypeFromDescriptor</span><span class="params">(<span class="keyword">final</span> String descriptor)</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> Collections.emptyList();&#125;</span><br><span class="line"><span class="keyword">public</span> String[] getArr() &#123;<span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">&quot;A&quot;</span>&#125;;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// Ljava/lang/String;</span></span><br><span class="line"><span class="comment">// (Ljava/lang/String;)V</span></span><br><span class="line"><span class="comment">// [Ljava/lang/String;]</span></span><br><span class="line"><span class="comment">// ()Ljava/util/List;</span></span><br><span class="line"><span class="comment">// ()[Ljava/lang/String;</span></span><br></pre></td></tr></table></figure>

<h2 id="Junit5-是怎么实现-Excutable-接口的？-看不懂"><a href="#Junit5-是怎么实现-Excutable-接口的？-看不懂" class="headerlink" title="Junit5 是怎么实现 Excutable 接口的？ 看不懂"></a>Junit5 是怎么实现 Excutable 接口的？ 看不懂</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConstructor_validApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Executable constructor = () -&gt; <span class="keyword">new</span> ClassVisitor(Opcodes.ASM4) &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    assertDoesNotThrow(constructor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ClassReader"><a href="#ClassReader" class="headerlink" title="ClassReader"></a>ClassReader</h2><p>这个类可以看作字节码文件的读操作的入口，只负责读取，其他处理逻辑是在 XXXVisitor 里面实现的。</p>
<p>PS: 该类方法打印的类信息都是斜线 <code>/</code> 分割的</p>
<h2 id="官方测试是怎么测试-ClassReader-ClassVisitor-等类的"><a href="#官方测试是怎么测试-ClassReader-ClassVisitor-等类的" class="headerlink" title="官方测试是怎么测试 ClassReader, ClassVisitor 等类的"></a>官方测试是怎么测试 ClassReader, ClassVisitor 等类的</h2><p>ClassReader 其核心功能有两个，一个是解析文件流，拿到基本信息，比如编译版本，常量池信息等。另一个是定义 Visitor 接解析顺序。</p>
<p>测试时官方也分两类，第一类就是测试解析出来的信息，比如 ‘testGetClassName’ 等，第二类就是测试流程的，比如 ‘testAccept_emptyVisitor’。</p>
<p>测试 Visitor 时也很简单，定义一个自己的 Visitor，官方示例中是定义一个 LogMethodVisitor，然后直接调用对应 visitor.visitMethodInsn 等方法，测试自定义在 LogMethodVisitor 里的逻辑是不是符合预期就行了。这个还是很有启发的，可以用这种方法来完善 TraceSonar 的项目。</p>
<h2 id="Class-文件的格式"><a href="#Class-文件的格式" class="headerlink" title="Class 文件的格式"></a>Class 文件的格式</h2><p>以 ASM 官方例子的 <code>ClassVisitorTest.class</code> 为例，注意查看的是 <code>.class</code> 文件，不是 <code>.java</code> 文件。下载插件 BinEd 可以查看文件在不同进制下的内容。右键 class 文件 <code>open as Binary</code> 即可。</p>
<p>Class 文件在格式上有特殊的规定，比如以 16 进制打开 class 可以看到前 4 位值为：0xCAFE(B1100 1010 1111 1110/202 254)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testReadByte</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ClassReader classReader = <span class="keyword">new</span> ClassReader(getClass().getName());</span><br><span class="line">    System.out.println(bytesToHex(Arrays.copyOf(classReader.classFileBuffer, <span class="number">2</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] HEX_ARRAY = <span class="string">&quot;0123456789ABCDEF&quot;</span>.toCharArray();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">bytesToHex</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>[] hexChars = <span class="keyword">new</span> <span class="keyword">char</span>[bytes.length * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; bytes.length; j++) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = bytes[j] &amp; <span class="number">0xFF</span>;</span><br><span class="line">        hexChars[j * <span class="number">2</span>] = HEX_ARRAY[v &gt;&gt;&gt; <span class="number">4</span>];</span><br><span class="line">        hexChars[j * <span class="number">2</span> + <span class="number">1</span>] = HEX_ARRAY[v &amp; <span class="number">0x0F</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(hexChars);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output: CAFE</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/12/Spring-service-run-once-after-server-up/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/12/Spring-service-run-once-after-server-up/" class="post-title-link" itemprop="url">Spring 怎么实现 server 启动之后立刻执行一个服务</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-12 12:59:19" itemprop="dateCreated datePublished" datetime="2020-11-12T12:59:19+08:00">2020-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近遇到一个需求需要在 Spring web service 启动之后立即执行，类似一个初始化的工作，搜出来有好多实现方式，稍微记录一下他们的区别</p>
<h2 id="ApplicationListener"><a href="#ApplicationListener" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitTraceSourceEventListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ApplicationReadyEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationReadyEvent applicationReadyEvent)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;InitTraceSourceEventListener triggered...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProjectConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = </span><br><span class="line">   LoggerFactory.getLogger(ProjectConfiguration.class);</span><br><span class="line"></span><br><span class="line">   <span class="meta">@EventListener(ApplicationReadyEvent.class)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomethingAfterStartup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;hello world, I have just started up&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SpringBootServletInitializer"><a href="#SpringBootServletInitializer" class="headerlink" title="SpringBootServletInitializer"></a>SpringBootServletInitializer</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(Application.class, args);</span><br><span class="line"></span><br><span class="line">        context.getBean(Table.class).fillWithTestdata(); // &lt;-- here</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Monitor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> SomeService service</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// start your monitoring in here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ApplicationRunner"><a href="#ApplicationRunner" class="headerlink" title="ApplicationRunner"></a>ApplicationRunner</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerInitializer</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments applicationArguments)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//code goes here</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="CommandLineRunner"><a href="#CommandLineRunner" class="headerlink" title="CommandLineRunner"></a>CommandLineRunner</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandLineAppStartupRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(CommandLineAppStartupRunner.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String...args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Application started with command-line arguments: &#123;&#125; . \n To kill this application, press Ctrl + C.&quot;</span>, Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="InitializingBean"><a href="#InitializingBean" class="headerlink" title="InitializingBean"></a>InitializingBean</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInitializingBean</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = ...;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    logger.info(<span class="string">&quot;InitializingBean#afterPropertiesSet()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/11/Springboot-add-local-jar-into-dependency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/11/Springboot-add-local-jar-into-dependency/" class="post-title-link" itemprop="url">Springboot 通过本地方式添加依赖</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-11 17:18:57" itemprop="dateCreated datePublished" datetime="2020-11-11T17:18:57+08:00">2020-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Springboot 项目中怎么添加本地 jar 包记录</p>
<ol>
<li>在项目资源目录下创建一个文件夹，用来存放本地 jar 包</li>
<li>在 pom.xml 中添加 本地 jar 包的引用，引用目录为第一步创建的文件目录</li>
<li>在 pom.xml 的 plugins 中添加编译打包的目录，使本地jar包能打到项目中去</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">resources</span><br><span class="line">├── application.properties</span><br><span class="line">├── lib</span><br><span class="line">│   └── tracesonar-0.1-SNAPSHOT.jar (本地包)</span><br><span class="line">├── static</span><br><span class="line">└── templates</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- add local lib reference --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.TraceSonar<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>TraceSonar<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources/lib/tracesonar-0.1-SNAPSHOT.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">compilerArguments</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">extdirs</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources/lib<span class="tag">&lt;/<span class="name">extdirs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">compilerArguments</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/10/Java-tree-related-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/10/Java-tree-related-code/" class="post-title-link" itemprop="url">Java 表示一棵树</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-10 15:27:57" itemprop="dateCreated datePublished" datetime="2020-11-10T15:27:57+08:00">2020-11-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近在看 TraceSonar 的源码的时候，看到生成树相关的代码， 感觉我自己徒手写应该是没戏了，至少他的这个方案是可以 work 的，同时像收集一下网上能找到的生成树的一些优秀代码</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; parent = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Node&lt;T&gt;&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node&lt;T&gt; <span class="title">addChild</span><span class="params">(Node&lt;T&gt; child)</span> </span>&#123;</span><br><span class="line">        child.setParent(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.children.add(child);</span><br><span class="line">        <span class="keyword">return</span> child;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChildren</span><span class="params">(List&lt;Node&lt;T&gt;&gt; children)</span> </span>&#123;</span><br><span class="line">        children.forEach(each -&gt; each.setParent(<span class="keyword">this</span>));</span><br><span class="line">        <span class="keyword">this</span>.children.addAll(children);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Node&lt;T&gt;&gt; getChildren() &#123;</span><br><span class="line">        <span class="keyword">return</span> children;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(Node&lt;T&gt; parent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node&lt;T&gt; <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node&lt;T&gt; <span class="title">getRoot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parent == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parent.getRoot();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node&lt;String&gt; root = <span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Node&lt;String&gt; node1 = root.addChild(<span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;node 1&quot;</span>));</span><br><span class="line"></span><br><span class="line">    Node&lt;String&gt; node11 = node1.addChild(<span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;node 11&quot;</span>));</span><br><span class="line">    node11.addChild(<span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;node 111&quot;</span>));</span><br><span class="line">    node11.addChild(<span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;node 112&quot;</span>));</span><br><span class="line"></span><br><span class="line">    node1.addChild(<span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;node 12&quot;</span>));</span><br><span class="line"></span><br><span class="line">    Node&lt;String&gt; node2 = root.addChild(<span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;node 2&quot;</span>));</span><br><span class="line"></span><br><span class="line">    node2.addChild(<span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;node 21&quot;</span>));</span><br><span class="line">    node2.addChild(<span class="keyword">new</span> Node&lt;&gt;(<span class="string">&quot;node 22&quot;</span>));</span><br><span class="line"></span><br><span class="line">    printTree(root, <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">printTree</span><span class="params">(Node&lt;T&gt; node, String appender)</span> </span>&#123;</span><br><span class="line">    System.out.println(appender + node.getData());</span><br><span class="line">    node.getChildren().forEach(each -&gt; printTree(each, appender + appender));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// root</span></span><br><span class="line"><span class="comment">//   node 1</span></span><br><span class="line"><span class="comment">//     node 11</span></span><br><span class="line"><span class="comment">//         node 111</span></span><br><span class="line"><span class="comment">//         node 112</span></span><br><span class="line"><span class="comment">//     node 12</span></span><br><span class="line"><span class="comment">//   node 2</span></span><br><span class="line"><span class="comment">//     node 21</span></span><br><span class="line"><span class="comment">//     node 22</span></span><br></pre></td></tr></table></figure>

<p>这种解法，首先把树这种结构解析出来，单独作为一个载体，你可以根据自己的需求填充树中的内容，其次打印的时候用的 lambda 表达式也很简洁，很喜欢这个例子。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.javagists.com/java-tree-data-structure">javagists</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/06/Java-ClassLoader-getResources/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/06/Java-ClassLoader-getResources/" class="post-title-link" itemprop="url">Java 通过 ClassLoader 获取 resources</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-06 19:22:08" itemprop="dateCreated datePublished" datetime="2020-11-06T19:22:08+08:00">2020-11-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>199</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天突然发现了一个 class loader 的新用法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enumeration&lt;URL&gt; urls = Thread.currentThread().getContextClassLoader().getResources(<span class="string">&quot;my.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>getResources</code> 竟然连 jar 包中的资源文件也会加载，以前一只以为只会加载当前项目的资源的，孤陋寡闻了，哈哈哈哈 ε-(´∀｀; )</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/05/Springboot-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/05/Springboot-note/" class="post-title-link" itemprop="url">Springboot 视频笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-05 21:42:07" itemprop="dateCreated datePublished" datetime="2020-11-05T21:42:07+08:00">2020-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Springboot 学习笔记，核心<strong>自动配置</strong></p>
<p>社区版的 Idea 少了一些配置，从网上下下来的 initializr 直接倒入的还一些配置可能失效，可以看文件前缀判断</p>
<h2 id="HelloWorld-web-mode"><a href="#HelloWorld-web-mode" class="headerlink" title="HelloWorld web mode"></a>HelloWorld web mode</h2><ol>
<li>访问 <a target="_blank" rel="noopener" href="https://start.spring.io/">Initializr</a> 定制项目， dependencies 选 Spring Web 即可</li>
<li>下载项目 jar 文件并解压，使用 Idea import，构建项目</li>
<li>Springboot 的项目结构和 Springmvc 基本一样，在 HelloWorldApplication 同级目录下创建 controller 包并添加 controller 类</li>
<li>Springboot 项目默认集成 tomcat，直接运行 application class 即可启动服务器</li>
<li>该 tomcat 应该是优化过的，启动速度飞起，访问 <code>http://localhost:8080/hello</code> 可以看到返回 hello 字符串</li>
<li>查看 idea 右边的 maven tab, 在 Lifecycle 下双击执行 package 打包项目 </li>
<li>可以看到打包好的项目 <code>Building jar: ...\helloworld\target\helloworld-0.0.1-SNAPSHOT.jar</code></li>
<li>到对应的路径下，cmd 窗口输入 <code>java -jar helloworld-0.0.1-SNAPSHOT.jar</code> 可以直接启动</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="HelloWorld-idea-mode"><a href="#HelloWorld-idea-mode" class="headerlink" title="HelloWorld idea mode"></a>HelloWorld idea mode</h2><ol>
<li>Idea -&gt; file -&gt; new -&gt; project -&gt; Spring Initialzr</li>
<li>填入必要信息，可以修改 package 简化路径</li>
<li>其他步骤和上面的练习一样</li>
</ol>
<p>彩蛋：banner 替换，在 resources 下新建 banner.txt 文件，替换终端启动图标</p>
<h2 id="Autowired-替代方案"><a href="#Autowired-替代方案" class="headerlink" title="Autowired 替代方案"></a>Autowired 替代方案</h2><p>方案一 可以通过把注解放到对应的 setter 方法上绕过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">InitBean initBean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInitBean</span><span class="params">(InitBean initBean)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.initBean = initBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方案二 放入构造函数中自动识别</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitTraceSourceEventListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ApplicationReadyEvent</span>&gt; </span>&#123;</span><br><span class="line">    InitBean bean;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InitTraceSourceEventListener</span><span class="params">(InitBean bean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bean = bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方案三 用 <code>@Resource</code> 代替</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">InitBean bean;</span><br></pre></td></tr></table></figure>

<p>或者最粗暴的: Settings -&gt; Editor -&gt; Code Style -&gt; Inspections -&gt; Spring Core -&gt; Code -&gt; Field injection warning 选项 disable 掉</p>
<h2 id="自动配置原理初探"><a href="#自动配置原理初探" class="headerlink" title="自动配置原理初探"></a>自动配置原理初探</h2><ol>
<li>核心依赖都在父工程中</li>
<li>写入依赖时不需要指定版本，父类 pom 已经管理了</li>
</ol>
<p><strong>启动器</strong>, 即 Springboot 的启动场景</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>各种场景有对应的启动器，比如 <code>spring-boot-starter-web</code>, 开发时只需要找到对应的启动器即可</p>
<p><strong>主程序</strong></p>
<p>这部分需要 实操+完善 好几遍才行，流程有点长</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@SpringBootApplication 标注这个类是一个 springboot 应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello02Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 启动应用</span></span><br><span class="line">        SpringApplication.run(Hello02Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要注解关系</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication </span><br><span class="line">    @SpringBootConfiguration - springboot 配置</span><br><span class="line">        @Configuration - spring 配置类</span><br><span class="line">            @Component - 说明时一个 spring 组件</span><br><span class="line">    @EnableAutoConfiguration</span><br><span class="line">        @AutoConfigurationPackage</span><br><span class="line">            @Import(AutoConfigurationPackages.Registrar.class)</span><br></pre></td></tr></table></figure>

<p>结论：Springboot 所有自动配置都是在启动的时候扫描并加载(spring.factories). 所有的自动配置配都在里面，但不一定生效。要判断条件是否成立，只有导入了对应的启动器(starter), 才会生效。</p>
<p>spring-boot-autoconfiguration.jar 包含所有的配置</p>
<p>SpringApplication.run() 完了可以深入了解一下，不过，前面的自动装备更重要</p>
<h2 id="YAML-给属性赋值"><a href="#YAML-给属性赋值" class="headerlink" title="YAML 给属性赋值"></a>YAML 给属性赋值</h2><ul>
<li>yaml 和 properties 是可以共存的</li>
<li>共存时 properties 的优先级要高于 yaml</li>
<li>yaml 的后缀可以是 yaml 或 yml 都可以生效</li>
</ul>
<p>yaml 格式：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure>

<p>可以直接给对象赋值</p>
<h3 id="基本赋值用法"><a href="#基本赋值用法" class="headerlink" title="基本赋值用法"></a>基本赋值用法</h3><p>通过添加 @Value 实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;旺财&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value(&quot;3&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DogTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(dog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output: Dog(name=旺财, age=3)</span></span><br></pre></td></tr></table></figure>

<h3 id="yaml-配置属性"><a href="#yaml-配置属性" class="headerlink" title="yaml 配置属性"></a>yaml 配置属性</h3><p>配置 pom 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>类添加 <code>@ConfigurationProperties</code> 注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isHappy;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加 <code>application.yaml</code> 文件并设置属性</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jack</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">isHappy:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2020</span><span class="string">/01/01</span></span><br><span class="line">  <span class="attr">maps:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>, <span class="attr">K2:</span> <span class="string">v2</span>&#125;</span><br><span class="line">  <span class="attr">lists:</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">  <span class="attr">dog:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">旺财</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output: Person(name=jack, age=30, isHappy=false, birth=Wed Jan 01 00:00:00 CST 2020, maps=&#123;k1=v1, K2=v2&#125;, lists=[1, 2, 3], dog=Dog(name=旺财, age=2))</span></span><br></pre></td></tr></table></figure>

<p>PS: yaml 还支持各种随机占位符，一元表达式等，可扩展性要更强</p>
<h3 id="通过-properties-配置"><a href="#通过-properties-配置" class="headerlink" title="通过 properties 配置"></a>通过 properties 配置</h3><p>缺点：表示起来比较冗余</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@PropertySource(value=&quot;classpath:application.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isHappy;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JSR-303-校验"><a href="#JSR-303-校验" class="headerlink" title="JSR 303 校验"></a>JSR 303 校验</h2><p>spring 自带的验证注解，添加之后可以再给 bean 赋值的时候带上校验效果</p>
<p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>数据配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mailbox:</span></span><br><span class="line">  <span class="attr">email:</span> <span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>添加 <code>@Validated</code>, <code>@Email</code> 等注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Email;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mailbox&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailBox</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Email(message = &quot;Email format is incorrect!!!&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MailBoxTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MailBox box;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(box);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抛异常：org.springframework.boot.context.properties.bind.validation.BindValidationException</span></span><br></pre></td></tr></table></figure>

<h2 id="默认配置文件优先级"><a href="#默认配置文件优先级" class="headerlink" title="默认配置文件优先级"></a>默认配置文件优先级</h2><p>方式一：root/config &gt; root/. &gt; classpath:/config &gt; classpath:/.</p>
<p>方式二： 新建 <code>application-xx.properties</code>, 再 default 中的配置文件中通过 <code>spring.profile.active=xx</code> 指定激活的配置</p>
<p>方式三：yaml + —</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8082</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<h2 id="application-properties-中支持的属性源码中在哪里写的"><a href="#application-properties-中支持的属性源码中在哪里写的" class="headerlink" title="application.properties 中支持的属性源码中在哪里写的"></a>application.properties 中支持的属性源码中在哪里写的</h2><ol>
<li>SpringBoot 启动会加载大量的配置类</li>
<li>我们看需要的功能有没有在 SpringBoot 默认写好的自动配置类当中</li>
<li>再看这个配置类中到底配置了哪些组件</li>
<li>给容器中自动皮欸之类添加组件的时候，会从 properties 类中获取某些属性</li>
</ol>
<p>xxxAutoConfiguration: 自动配置类，给容器添加组件</p>
<p>xxxProperties：封装配置文件中相关属性</p>
<p>debug=true 可以查看配置详情</p>
<h2 id="静态资源加载原理"><a href="#静态资源加载原理" class="headerlink" title="静态资源加载原理"></a>静态资源加载原理</h2><p>分析一波 WebMvcAutoConfiuration.java<br>    -&gt; webjars， web 相关的包封装成 Java 模式，但是不建议这么做</p>
<p>优先级： resources &gt; script &gt; public</p>
<p>首页定制 getIndexHtml()</p>
<p>template 文件夹下的内容需要使用模板引擎，添加 dependency + 注解</p>
<h2 id="thymeleaf"><a href="#thymeleaf" class="headerlink" title="thymeleaf"></a>thymeleaf</h2><p>导入 starter</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>在 template 下新建页面文件 test.html，新建 controller 文件夹并创建 controller</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;hello, springboot&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动服务，访问 localhost:8080/hello 可以看到新建的页面</p>
<h2 id="MVC-配置原理"><a href="#MVC-配置原理" class="headerlink" title="MVC 配置原理"></a>MVC 配置原理</h2><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/boot-features-developing-web-applications.html">https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/boot-features-developing-web-applications.html</a></p>
<p>自定义视图解析器 @Configuration + implement WebMvcConfigurer 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定制功能只需要鞋各组件，然后交给 springboot，他会帮我们自动装配</span></span><br><span class="line"><span class="comment">// dispatchservlet</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ViewResolver 实现了视图解析器的接口类，我们可以把它看作是退解析器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewResolver <span class="title">myViewResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyViewResolver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewResolver</span> <span class="keyword">implements</span> <span class="title">ViewResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 DispatcherServlet 的 doDispatch 方法打上断点，在 this 下的 viewResolver 变量中可以看到自定义的解析器</p>
<p>@Configuration 修饰的类可以帮你扩展功能</p>
<h2 id="员工管理模块案例"><a href="#员工管理模块案例" class="headerlink" title="员工管理模块案例"></a>员工管理模块案例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config 下通过 WebMvcConfigurer 管理首页会更合适一点</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/index.html&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关闭 thymeleaf cache</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">cache:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="i18n-国际化实现"><a href="#i18n-国际化实现" class="headerlink" title="i18n 国际化实现"></a>i18n 国际化实现</h3><ol>
<li>resource 下新建 i18n 文件夹，添加 properties（默认 login.properties + 语言支持版本 login_en_US.properties, login_zh_CN.properties）</li>
<li>自定义 LocaleResolver 做切换</li>
<li>自定义组件配置到 Spring 容器中 @Bean</li>
<li>用 #{} 替换模板</li>
</ol>
<p>源码中在 WebMvcAutoConfiguration 类中有配置 localeResolver 方法，通过这个引出自定义的类实现</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/index.html(l=&#x27;zh_CN&#x27;)&#125;&quot;</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/index.html(l=&#x27;en_US&#x27;)&#125;&quot;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义 resolver</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//解析请求</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得请求中的语言参数</span></span><br><span class="line">        String language = request.getParameter(<span class="string">&quot;l&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Locale locale = Locale.getDefault(); <span class="comment">//如果没有就使用默认的</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果请求的连接携带了国际化的参数</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(language)) &#123;</span><br><span class="line">            <span class="comment">//zh_CN</span></span><br><span class="line">            String[] split = language.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            <span class="comment">//国家，地区</span></span><br><span class="line">            locale = <span class="keyword">new</span> Locale(split[<span class="number">0</span>], split[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在自定义 config 类中通过 @Bean 注册</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过-session-拦截器实现强制登录"><a href="#通过-session-拦截器实现强制登录" class="headerlink" title="通过 session  + 拦截器实现强制登录"></a>通过 session  + 拦截器实现强制登录</h3><p>LoginController 在登录成功的时候 set 一下 session</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/user/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(...Model model, HttpSession session)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//具體的業務：</span></span><br><span class="line">    <span class="keyword">if</span> ( !StringUtils.isEmpty(username) &amp;&amp; <span class="string">&quot;123456&quot;</span>.equals(password)) &#123;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;loginUser&quot;</span>, username);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/main.html&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定制拦截器实现 HandlerInterceptor 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Object loginUser = request.getSession().getAttribute(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (loginUser == <span class="keyword">null</span>) &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Please login first...&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/index.html&quot;</span>).forward(request, response);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 config 类中注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;/user/login&quot;</span>, <span class="string">&quot;/css/**&quot;</span>, <span class="string">&quot;/js/**&quot;</span>, <span class="string">&quot;/img/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="thymeleaf-标签修改方式"><a href="#thymeleaf-标签修改方式" class="headerlink" title="thymeleaf 标签修改方式"></a>thymeleaf 标签修改方式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">原来： <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;asserts/js/jquery-3.2.1.slim.min.js&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">修改： <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/Chart.min.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/css/bootstrap.min.css&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2020/11/05/Java-xml-parser-compare/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2020/11/05/Java-xml-parser-compare/" class="post-title-link" itemprop="url">Java xml parser compare</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-05 14:49:50" itemprop="dateCreated datePublished" datetime="2020-11-05T14:49:50+08:00">2020-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-16 10:28:11" itemprop="dateModified" datetime="2021-11-16T10:28:11+08:00">2021-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>记录一下公司实际项目中新老两种 XML 解析框架的实现方式，作为以后类似问题的参考</p>
<h2 id="老的实现方式"><a href="#老的实现方式" class="headerlink" title="老的实现方式"></a>老的实现方式</h2><p>用的是最传统的 SAX 解析模式，优点是很直观，在这个模块规模还小的时候挺好的，只要熟悉 SAX 的使用方式上手很快，但是不管什么功能，在经过十几年的反复堆砌之后都会变成一个难以维护的怪物。</p>
<p>实现的时候，最大的弊端应该是参杂了很多的业务逻辑到解析过程中，就我看来，解析就应该是纯粹的过程，业务相关的验证应该放到解析后做才对！</p>
<p>重构前：</p>
<ul>
<li>最外层有 3k 的代码来解析 xml</li>
<li>最外层到 DefaultHandler 接口，中间还有 2 个父类继承关系存放各种公共变量和方法</li>
<li>所有的模块组都在一个 class 中维护代码，很臃肿，很多冗余</li>
<li>一些公共的 element, 比如 description, label 之类的每个模块都可能出一些奇葩用法，维护更难</li>
<li>在最外层的 Handler 实现中需要存储很多变量来存储中间状态的值</li>
</ul>
<p>实现伪代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LegacyParser</span> <span class="keyword">extends</span> <span class="title">SuperParser3</span>...<span class="title">SuperParser1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ParsedResultBean bean;</span><br><span class="line">    <span class="keyword">private</span> ModuleElement1 element1;</span><br><span class="line">    <span class="keyword">private</span> ModuleElement2 element1;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">private</span> ModuleElementN elementn;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IModuleElement&gt; elementGroup1 = <span class="keyword">new</span> HashMap();</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IModuleElement&gt; elementGroupn = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多种重载的构造函数包含 module 各自的 flag 参数，再定制后面 module 内容部的处理逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="title">LegacyParser</span><span class="params">(ParsedResultBean bean)</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="title">LegacyParser</span><span class="params">(ParsedResultBean bean, <span class="keyword">boolean</span> moduleFlag1)</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="title">LegacyParser</span><span class="params">(ParsedResultBean bean, <span class="keyword">boolean</span> moduleFlag1, <span class="keyword">boolean</span> moduleFlag2)</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个集合存储可用解析器</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, ElementParser&gt; availableParsers = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ElementParser1</span> <span class="keyword">extends</span> <span class="title">BaseElementParser</span>...<span class="title">DefaultHander</span> <span class="keyword">implements</span> <span class="title">IElementParser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getElementName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ElementName1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startElement</span><span class="params">(String uri, String localName, String qName, Attributes attrs)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">          <span class="comment">// module logic</span></span><br><span class="line">          elementGroup1.put(...);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endElement</span><span class="params">(String uri, String localName, String qName)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">            <span class="comment">// do something</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">moduleMehtods</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// do something</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ElementParser2</span>...<span class="title">N</span> <span class="keyword">extends</span> <span class="title">BaseElementParser</span>...<span class="title">DefaultHander</span> <span class="keyword">implements</span> <span class="title">IElementParser</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最外部一个</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startElement</span><span class="params">(String uri, String localName, String name, Attributes attrs)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (availableParsers.containsKey(name)) &#123;</span><br><span class="line">            elementParsers.get(name).startElement(uri, localName, name, attrs);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SAXException(<span class="string">&quot;Unexpected element &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endElement</span><span class="params">(String uri, String localName, String name, Attributes attrs)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (availableParsers.containsKey(name)) &#123;</span><br><span class="line">            elementParsers.get(name).endElement(uri, localName, name, attrs);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SAXException(<span class="string">&quot;Unexpected element &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hexo/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/hexo/">1</a><span class="space">&hellip;</span><a class="page-number" href="/hexo/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/hexo/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/hexo/page/20/">20</a><a class="extend next" rel="next" href="/hexo/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jack Zheng"
      src="/hexo/images/jack.jpg">
  <p class="site-author-name" itemprop="name">Jack Zheng</p>
  <div class="site-description" itemprop="description">我是张江搬砖小码农, 知识搬运工</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hexo/archives/">
        
          <span class="site-state-item-count">200</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hexo/categories/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/hexo/tags/">
          
        <span class="site-state-item-count">181</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Zheng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">1.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">16:09</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v5.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/hexo/lib/anime.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.ui.min.js"></script>

<script src="/hexo/js/utils.js"></script>

<script src="/hexo/js/motion.js"></script>


<script src="/hexo/js/schemes/muse.js"></script>


<script src="/hexo/js/next-boot.js"></script>




  




  
<script src="/hexo/js/local-search.js"></script>














  

  


</body>
</html>
