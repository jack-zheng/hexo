<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/hexo/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hexo/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hexo/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/hexo/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="UgODgWVmvTsdD--vjodDR3tPUZRWM3i7JpHzbYejxUM">

<link rel="stylesheet" href="/hexo/css/main.css">


<link rel="stylesheet" href="/hexo/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hexo/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="我是张江搬砖小码农, 知识搬运工">
<meta property="og:type" content="website">
<meta property="og:title" content="Jackpot">
<meta property="og:url" content="https://jack-zheng.github.io/hexo/page/8/index.html">
<meta property="og:site_name" content="Jackpot">
<meta property="og:description" content="我是张江搬砖小码农, 知识搬运工">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jack Zheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jack-zheng.github.io/hexo/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Jackpot</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/hexo/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jackpot</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-tags">

    <a href="/hexo/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/hexo/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hexo/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/jack-zheng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/06/05/LSCASSB-partiii-advanced-shell-scripting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/06/05/LSCASSB-partiii-advanced-shell-scripting/" class="post-title-link" itemprop="url">Linux命令行与shell脚本编程大全 第三章 Shell 高级用法</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-05 16:38:52" itemprop="dateCreated datePublished" datetime="2021-06-05T16:38:52+08:00">2021-06-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Shell</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>64k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>58 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Creating-Functions"><a href="#Creating-Functions" class="headerlink" title="Creating Functions"></a>Creating Functions</h2><h3 id="Basic-Script-Functions"><a href="#Basic-Script-Functions" class="headerlink" title="Basic Script Functions"></a>Basic Script Functions</h3><h4 id="Creating-a-function"><a href="#Creating-a-function" class="headerlink" title="Creating a function"></a>Creating a function</h4><p>方式一：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> name &#123;</span><br><span class="line">    commands</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">name</span></span>() &#123;</span><br><span class="line">    commands</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Using-functions"><a href="#Using-functions" class="headerlink" title="Using functions"></a>Using functions</h4><p>function 不一定要写在开头，但是你使用之前，他的定义必须已经声明了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat test1</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using a function in a script</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;This is an example of a function&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 4 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    func1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the loop&quot;</span></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Now this is the end of the script&quot;</span></span><br><span class="line"></span><br><span class="line">./test1</span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># This is the end of the loop</span></span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># Now this is the end of the script</span></span><br></pre></td></tr></table></figure>

<h3 id="Returning-a-Value"><a href="#Returning-a-Value" class="headerlink" title="Returning a Value"></a>Returning a Value</h3><p>bash shell 会在函数结束后给他一个返回值</p>
<h4 id="The-default-exit-status"><a href="#The-default-exit-status" class="headerlink" title="The default exit status"></a>The default exit status</h4><p>默认情况下，exit status 是函数中最后一个命令的返回值，可以使用 <code>$?</code> 查看</p>
<p>下面实验中，我们在 func1 中 ls 一个不存在的文件，并打印 exit code</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">cat test4</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># testing the exit status of a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Trying to display a non-existent file&quot;</span></span><br><span class="line">    ls -l badfile</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;testing the function&quot;</span></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The exit status is: $?&quot;</span></span><br><span class="line"></span><br><span class="line">./test4 </span><br><span class="line"><span class="comment"># testing the function</span></span><br><span class="line"><span class="comment"># Trying to display a non-existent file</span></span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br><span class="line"><span class="comment"># The exit status is: 1</span></span><br><span class="line"></span><br><span class="line">cat test4b</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># testing the exit status of a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    ls -l badfile</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Trying to display a non-existent file&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;testing the function&quot;</span></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The exit status is: $?&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./test4b</span><br><span class="line"><span class="comment"># testing the function</span></span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br><span class="line"><span class="comment"># Trying to display a non-existent file</span></span><br><span class="line"><span class="comment"># The exit status is: 0</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-the-return-command"><a href="#Using-the-return-command" class="headerlink" title="Using the return command"></a>Using the return command</h4><p>你也可以用 return 关键子在函数末尾给他返回一个整数最 exit code</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test5</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using the return command in a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> db1 &#123;</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Enter a value: &quot;</span> value</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;doubling the value&quot;</span></span><br><span class="line">    <span class="built_in">return</span> $[ <span class="variable">$value</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">db1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The new value is $?&quot;</span></span><br><span class="line"></span><br><span class="line">./test5</span><br><span class="line"><span class="comment"># Enter a value: 10</span></span><br><span class="line"><span class="comment"># doubling the value</span></span><br><span class="line"><span class="comment"># The new value is 20</span></span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<ul>
<li>记得在 function 执行完成后立刻取值备用</li>
<li>exit code 返回只能在 0-255 之间</li>
</ul>
<h4 id="Using-function-output"><a href="#Using-function-output" class="headerlink" title="Using function output"></a>Using function output</h4><p>你也可以将返回值包装在输出里面，通过 <code>result=$(db1)</code> 的形式拿到。和之前调用系统函数一个套路</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test5b</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using the return command in a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> db1 &#123;</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Enter a value: &quot;</span> value</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$value</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=$(db1)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The new value is <span class="variable">$result</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test5b</span><br><span class="line"><span class="comment"># Enter a value: 20</span></span><br><span class="line"><span class="comment"># The new value is 40</span></span><br></pre></td></tr></table></figure>

<p><strong>Caution</strong> 如果函数中有多个 echo 他会将所有的 echo 内容合在一起作为 return 的值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat freturn.sh</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># multiple echo sentence in function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> multiecho &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;return 1&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;return 2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">./freturn.sh</span><br><span class="line"><span class="comment"># return 1</span></span><br><span class="line"><span class="comment"># return 2</span></span><br></pre></td></tr></table></figure>

<p><strong>Question</strong> 如果我把 echo 和 return 结合使用，他会拿什么当返回值？？？</p>
<p>结论：return 会被忽略</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat ./returnwithecho.sh</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># multiple echo sentence and return in function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> multiecho &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;return 1&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;return 2&quot;</span></span><br><span class="line">  <span class="built_in">return</span> 55</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">./freturn.sh</span><br><span class="line"><span class="comment"># return 1</span></span><br><span class="line"><span class="comment"># return 2</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Variables-in-Functions"><a href="#Using-Variables-in-Functions" class="headerlink" title="Using Variables in Functions"></a>Using Variables in Functions</h3><h4 id="Passing-parameters-to-a-function"><a href="#Passing-parameters-to-a-function" class="headerlink" title="Passing parameters to a function"></a>Passing parameters to a function</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cat test6</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># passing parameters to a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> addem &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ] || [ <span class="variable">$#</span> -gt 2 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -1</span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$#</span> -eq 1 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> $[ <span class="variable">$1</span> + <span class="variable">$1</span> ]</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> $[ <span class="variable">$1</span> + <span class="variable">$2</span> ]</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Adding 10 and 15: &quot;</span></span><br><span class="line">value=$(addem 10 15)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$value</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Let&#x27;s try adding just one number: &quot;</span></span><br><span class="line">value=$(addem 10)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$value</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Now trying adding no numbers: &quot;</span></span><br><span class="line">value=$(addem)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$value</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Finally, try adding three numbers: &quot;</span></span><br><span class="line">value=$(addem 10 15 20)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$value</span></span><br><span class="line"></span><br><span class="line">./test6</span><br><span class="line"><span class="comment"># Adding 10 and 15: 25</span></span><br><span class="line"><span class="comment"># Let&#x27;s try adding just one number: 20</span></span><br><span class="line"><span class="comment"># Now trying adding no numbers: -1</span></span><br><span class="line"><span class="comment"># Finally, try adding three numbers: -1</span></span><br></pre></td></tr></table></figure>

<p>但是脚本文件中的参数并不会默认的应用到你定义的 function 中去，你需要显示的指定才能使他生效</p>
<p>下面实验中，当我们运行脚本是没有给参数，则直接运行了 else 的路径，如果给了参数，这个参数也不会传递给 badfunc1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat badtest1</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Trying to access script parameters inside a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> badfunc1 &#123;</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 2 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    value=$(badfunc1)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$value</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: badtest1 a b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">./badtest1</span><br><span class="line"><span class="comment"># Usage: badtest1 a b</span></span><br><span class="line">./badtest1 10 15</span><br><span class="line"><span class="comment"># ./badtest1: line 5: *  : syntax error: operand expected (error token is &quot;*  &quot;)</span></span><br><span class="line"><span class="comment"># The result is</span></span><br></pre></td></tr></table></figure>

<p>如果要修复上面的脚本，你可以直接在实现中指定 <code>value=$(badfunc1 $1 $2)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat test7</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Trying to access script parameters inside a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func7 &#123;</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 2 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    value=$(func7 <span class="variable">$1</span> <span class="variable">$2</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$value</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: badtest1 a b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">./test7</span><br><span class="line"><span class="comment"># Usage: badtest1 a b</span></span><br><span class="line">./test7 10 15</span><br><span class="line"><span class="comment"># The result is 150</span></span><br></pre></td></tr></table></figure>

<h4 id="Handling-variables-in-a-function"><a href="#Handling-variables-in-a-function" class="headerlink" title="Handling variables in a function"></a>Handling variables in a function</h4><p>Functions 使用两种类型的变量</p>
<ul>
<li>Global</li>
<li>Local</li>
</ul>
<p>Global 变量是在 script 中任何地方都可以访问的变量。在主程序中定义的 global 变量，function 中可以访问到。function 中定义的 global 变量，主程序也能访问到。一般来说你在脚本中定义的变量都是 global 的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test8</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using a global variable to pass a value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> db1 &#123;</span><br><span class="line">    value=$[ <span class="variable">$value</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter a value: &quot;</span> value</span><br><span class="line">db1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The new value is: <span class="variable">$value</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test8</span><br><span class="line"><span class="comment"># Enter a value: 10</span></span><br><span class="line"><span class="comment"># The new value is: 20</span></span><br></pre></td></tr></table></figure>

<p>如果你在 script 和 function 中都用到了同名的变量，就可能导致赋值出问题，是你的程序难以排错</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat badtest2</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Demonstrating a db use of variables</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    temp=$[ <span class="variable">$value</span> + 5 ]</span><br><span class="line">    result=$[ <span class="variable">$temp</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">temp=4</span><br><span class="line">value=6</span><br><span class="line"></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$result</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$temp</span> -gt <span class="variable">$value</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;temp is larger&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;temp is smaller&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">./badtest2</span><br><span class="line"><span class="comment"># The result is 22</span></span><br><span class="line"><span class="comment"># temp is larger</span></span><br></pre></td></tr></table></figure>

<p>我们可以使用 local variables 避免这种问题，格式如下 <code>local temp</code>. 他让你的变量只在 function 中生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat test9</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Demonstrating the local keyword</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    <span class="built_in">local</span> temp=$[ <span class="variable">$value</span> + 5 ]</span><br><span class="line">    result=$[ <span class="variable">$temp</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">temp=4</span><br><span class="line">value=6</span><br><span class="line"></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$result</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$temp</span> -gt <span class="variable">$value</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;temp is larger&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;temp is smaller&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./test9</span><br><span class="line"><span class="comment"># The result is 22</span></span><br><span class="line"><span class="comment"># temp is smaller</span></span><br></pre></td></tr></table></figure>

<h3 id="Array-Variables-and-Functions"><a href="#Array-Variables-and-Functions" class="headerlink" title="Array Variables and Functions"></a>Array Variables and Functions</h3><h4 id="Passing-arrays-to-functions"><a href="#Passing-arrays-to-functions" class="headerlink" title="Passing arrays to functions"></a>Passing arrays to functions</h4><p>函数处理数组的方式有点特别，如果你传给函数一个数组，他默认只会取第一个元素作为参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat badtest3</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Trying to pass an array variable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> testit &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The parameters are: <span class="variable">$@</span>&quot;</span></span><br><span class="line">    thisarray=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The received array is <span class="variable">$&#123;thisarray[*]&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myarray=(1 2 3 4 5)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The original array is: <span class="variable">$&#123;myarray[*]&#125;</span>&quot;</span></span><br><span class="line">testit  <span class="variable">$myarray</span></span><br><span class="line"></span><br><span class="line">./badtest3</span><br><span class="line"><span class="comment"># The original array is: 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># The parameters are: 1</span></span><br><span class="line"><span class="comment"># The received array is 1</span></span><br></pre></td></tr></table></figure>

<p>你可以将数组 disassemble 之后传给函数，在使用时在 reassemble 即可. 书上给的例子不能运行，网上找了一个可用的表达式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test10</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># array variable to function test</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> testit &#123;</span><br><span class="line">    <span class="built_in">local</span> newarray</span><br><span class="line">    <span class="comment"># 原始表达式为 newarray=(;&#x27;echo &quot;$@&quot;&#x27;)</span></span><br><span class="line">    newarray=($(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>))</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The new array value is <span class="variable">$&#123;newarray[*]&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myarray=(1 2 3 4 5)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The original array is: <span class="variable">$&#123;myarray[*]&#125;</span>&quot;</span></span><br><span class="line">testit  <span class="variable">$&#123;myarray[*]&#125;</span></span><br><span class="line"></span><br><span class="line">./test10</span><br><span class="line"><span class="comment"># The original array is: 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># The new array value is 1 2 3 4 5</span></span><br></pre></td></tr></table></figure>

<h4 id="Return-arrays-from-functions"><a href="#Return-arrays-from-functions" class="headerlink" title="Return arrays from functions"></a>Return arrays from functions</h4><p>函数返回一个数组用了同样的技巧，函数中一个一个的 echo 值，接收方需要 reassemble 它们</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat test12</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># returning an array value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> arraydblr &#123;</span><br><span class="line">    <span class="built_in">local</span> origarray</span><br><span class="line">    <span class="built_in">local</span> newarray</span><br><span class="line">    <span class="built_in">local</span> elements</span><br><span class="line">    <span class="built_in">local</span> i</span><br><span class="line">    origarray=($(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>))</span><br><span class="line">    newarray=($(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>))</span><br><span class="line">    elements=$[ <span class="variable">$#</span> - 1 ]</span><br><span class="line">    <span class="keyword">for</span> (( i=0; i&lt;= <span class="variable">$elements</span>; i++ ))</span><br><span class="line">    &#123;</span><br><span class="line">        newarray[<span class="variable">$i</span>]=$[ <span class="variable">$&#123;origarray[$i]&#125;</span> * 2 ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;newarray[*]&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myarray=(1 2 3 4 5)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The original array is: <span class="variable">$&#123;myarray[*]&#125;</span>&quot;</span></span><br><span class="line">arg1=$(<span class="built_in">echo</span> <span class="variable">$&#123;myarray[*]&#125;</span>)</span><br><span class="line">result=($(arraydblr <span class="variable">$arg1</span>))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The new array is: <span class="variable">$&#123;result[*]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test12</span><br><span class="line"><span class="comment"># The original array is: 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># The new array is: 2 4 6 8 10</span></span><br></pre></td></tr></table></figure>

<h3 id="Function-Recursion"><a href="#Function-Recursion" class="headerlink" title="Function Recursion"></a>Function Recursion</h3><p>local function variable 提供 self-containment 功能。他使得函数可以实现 recursively 的效果</p>
<p>实现斐波那契数列</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat test13</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using recursion</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> factorial &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> -eq 1 ]</span><br><span class="line">    <span class="keyword">then</span> </span><br><span class="line">        <span class="built_in">echo</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">local</span> temp=$[ <span class="variable">$1</span> - 1 ]</span><br><span class="line">        <span class="built_in">local</span> result=$(factorial <span class="variable">$temp</span>)</span><br><span class="line">        <span class="built_in">echo</span> $[ <span class="variable">$result</span> * <span class="variable">$1</span> ]</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter value: &quot;</span> value</span><br><span class="line">result=$(factorial <span class="variable">$value</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The factorial of <span class="variable">$value</span> is: <span class="variable">$result</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test13</span><br><span class="line"><span class="comment"># Enter value: 5</span></span><br><span class="line"><span class="comment"># The factorial of 5 is: 120</span></span><br></pre></td></tr></table></figure>

<h3 id="Creating-a-Library"><a href="#Creating-a-Library" class="headerlink" title="Creating a Library"></a>Creating a Library</h3><p>建立自己的函数库，实现脚本文件中的可复用。简单来说，就是将所有的函数都写在文件中。在其他脚本文件中，通过 <code>. path/to/myfuncs</code> 的语法引入自己的库文件即可。这个点号是 <code>source</code> 的快捷方式叫做 dot operator.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cat myfuncs </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># my script functions</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> addem &#123;</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$1</span> + <span class="variable">$2</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> multem &#123;</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> divem &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$2</span> -ne 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> $[ <span class="variable">$1</span> / <span class="variable">$2</span> ]</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cat test14</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using functions defined in a library file</span></span><br><span class="line">. ./myfuncs</span><br><span class="line"></span><br><span class="line">value1=10</span><br><span class="line">value2=5</span><br><span class="line">result1=$(addem <span class="variable">$value1</span> <span class="variable">$value2</span>)</span><br><span class="line">result2=$(multem <span class="variable">$value1</span> <span class="variable">$value2</span>)</span><br><span class="line">result3=$(divem <span class="variable">$value1</span> <span class="variable">$value2</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result of adding them is: <span class="variable">$result1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result of multiplying them is: <span class="variable">$result2</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result of dividing them is: <span class="variable">$result3</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test14</span><br><span class="line"><span class="comment"># The result of adding them is: 15</span></span><br><span class="line"><span class="comment"># The result of multiplying them is: 50</span></span><br><span class="line"><span class="comment"># The result of dividing them is: 2</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Functions-on-the-Command-Line"><a href="#Using-Functions-on-the-Command-Line" class="headerlink" title="Using Functions on the Command Line"></a>Using Functions on the Command Line</h3><h4 id="Creating-functions-on-the-command-line"><a href="#Creating-functions-on-the-command-line" class="headerlink" title="Creating functions on the command line"></a>Creating functions on the command line</h4><p>方式一：终端一行定义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> doubleit &#123; <span class="built_in">read</span> -p <span class="string">&quot;Enter value:&quot;</span> value; <span class="built_in">echo</span> $[ <span class="variable">$value</span> * 2 ]; &#125;</span><br><span class="line">doubleit</span><br><span class="line"><span class="comment"># Enter value:3</span></span><br><span class="line">6</span><br></pre></td></tr></table></figure>

<p>方式二：多行定义，in this way, no need of semicolon</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> multem &#123;</span><br><span class="line">&gt; <span class="built_in">echo</span> $[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line">&gt; &#125;</span><br><span class="line">multem 2 5</span><br><span class="line"><span class="comment"># 10</span></span><br></pre></td></tr></table></figure>

<p><strong>Caution</strong> 如果你终端定义函数的时候和系统自带的函数重名了，那么这个函数会覆盖系统函数。</p>
<h4 id="Defining-functions-in-the-bashrc-file"><a href="#Defining-functions-in-the-bashrc-file" class="headerlink" title="Defining functions in the .bashrc file"></a>Defining functions in the .bashrc file</h4><p>上面的这个方式，当终端退出时，函数就丢失了，你可以将函数写入 .bashrc 文件或使用 source 函数库的方式达到复用的效果。而且最方便的事，如果你将他们通过 bashrc 引入，你在写脚本的时候就不需要 source 了，直接可以调用</p>
<h3 id="Following-a-Practical-Example"><a href="#Following-a-Practical-Example" class="headerlink" title="Following a Practical Example"></a>Following a Practical Example</h3><p>这章展示如何使用开源 shell 工具包</p>
<ol>
<li><code>wget ftp://ftp.gnu.org/gnu/shtool/shtool-2.0.8.tar.gz</code> 下载实验包并 <code>tar -zxvf shtool-2.0.8.tar.gz</code> 解压</li>
<li>cd 到解压后的文件夹，<code>./configure</code> + <code>make</code>, 当然你也可以用 <code>make test</code> 测试一下构建</li>
<li><code>make install</code> 安装库文件</li>
</ol>
<p>shtool 包含了一系列的工具集，可以使用 <code>shtool [options] [fucntion [options] [args]]</code> 来查看</p>
<p>The shtool Library Functions</p>
<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">platform</td>
<td align="left">Displays the platform identity</td>
</tr>
<tr>
<td align="left">Prop</td>
<td align="left">Dispalys an animated progress propeller</td>
</tr>
</tbody></table>
<p>只列出用到的几个</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat test16</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"></span><br><span class="line">shtool platform</span><br><span class="line"></span><br><span class="line">./test16</span><br><span class="line"><span class="comment"># Mac OS X 11.4 (iX86)</span></span><br></pre></td></tr></table></figure>

<p>带进度条的显示 <code>ls -al /usr/bin | shtool prop -p &quot;waiting...&quot;</code> 太快了，看不出效果</p>
<h2 id="Chapter-18-Writing-Scripts-for-Graphical-Desktops"><a href="#Chapter-18-Writing-Scripts-for-Graphical-Desktops" class="headerlink" title="Chapter 18: Writing Scripts for Graphical Desktops"></a>Chapter 18: Writing Scripts for Graphical Desktops</h2><p>和我这次看书的目标不符，跳过</p>
<h2 id="Chapter-19-Introducing-sed-and-gawk"><a href="#Chapter-19-Introducing-sed-and-gawk" class="headerlink" title="Chapter 19: Introducing sed and gawk"></a>Chapter 19: Introducing sed and gawk</h2><p>实际工作中，很多工作都是文字处理相关的。使用 shell 自带工具处理文字会显得很笨拙。这时候就要用到 sed 和 gawk 了。</p>
<h3 id="Manipulating-Text"><a href="#Manipulating-Text" class="headerlink" title="Manipulating Text"></a>Manipulating Text</h3><p>Mac 自带的 sed 工具和书上的是不一样的，好像做了很多裁剪，很多 flag 是不支持的，可以通过 brew 重新装一个</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">brew install gnu-sed</span><br><span class="line"><span class="comment"># 会给出添加 PATH 的提示，按照提示添加到配置文件中(.zshrc)</span></span><br><span class="line">brew info gnu-sed</span><br><span class="line"><span class="comment"># ==&gt; Caveats</span></span><br><span class="line"><span class="comment"># GNU &quot;sed&quot; has been installed as &quot;gsed&quot;.</span></span><br><span class="line"><span class="comment"># If you need to use it as &quot;sed&quot;, you can add a &quot;gnubin&quot; directory</span></span><br><span class="line"><span class="comment"># to your PATH from your bashrc like:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     PATH=&quot;/usr/local/opt/gnu-sed/libexec/gnubin:$PATH&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="Getting-to-know-the-sed-editor"><a href="#Getting-to-know-the-sed-editor" class="headerlink" title="Getting to know the sed editor"></a>Getting to know the sed editor</h4><p>sed 是一个流处理编辑器(stream editor)，你可以设定一系列的规则，然后通过这个流编辑器处理他。</p>
<p>sed 可以做如下事情</p>
<ol>
<li>Reads one data line at a time from the input</li>
<li>Matches that data with the supplied editor commands</li>
<li>Changes data in the stream as specified in the commands</li>
<li>Outputs the new data to STDOUT</li>
</ol>
<p>按行依次处理文件直到所有内容处理完毕结束，格式 <code>sed options script file</code></p>
<p>The sed Command Options</p>
<table>
<thead>
<tr>
<th align="left">Option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-e script</td>
<td align="left">Adds commands specified in the script to the commands run while processing the input</td>
</tr>
<tr>
<td align="left">-f file</td>
<td align="left">Adds the commands specified in the file to the commands run while processing the input</td>
</tr>
<tr>
<td align="left">-n</td>
<td align="left">Doesn’t produce output for each command, but waits for the print command</td>
</tr>
</tbody></table>
<h4 id="Defining-an-editor-command-int-the-command-line"><a href="#Defining-an-editor-command-int-the-command-line" class="headerlink" title="Defining an editor command int the command line"></a>Defining an editor command int the command line</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test&quot;</span> | sed <span class="string">&#x27;s/test/big test/&#x27;</span></span><br><span class="line"><span class="comment"># This is a big test</span></span><br></pre></td></tr></table></figure>

<p><code>s</code> 表示替换(substitutes), 他会用后一个字符串替换前一个. 下面是替换文件内容的例子. sed 只会在输出内容中做修改，原文件还是保持原样</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line">sed <span class="string">&#x27;s/dog/cat/&#x27;</span> data1.txt </span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-mulitple-editor-commands-int-the-command-line"><a href="#Using-mulitple-editor-commands-int-the-command-line" class="headerlink" title="Using mulitple editor commands int the command line"></a>Using mulitple editor commands int the command line</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/brown/green/; s/dog/cat/&#x27;</span> data1.txt </span><br><span class="line"><span class="comment"># The quick green fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green fox jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<p>如果不想写在一行，可以写在多行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&gt; s/brown/green/</span></span><br><span class="line"><span class="string">&gt; s/fox/elephant/</span></span><br><span class="line"><span class="string">&gt; s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<h4 id="Reading-editor-commands-from-a-file"><a href="#Reading-editor-commands-from-a-file" class="headerlink" title="Reading editor commands from a file"></a>Reading editor commands from a file</h4><p>如果命令太多，也可以将他们放到文件中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat script1.sed </span><br><span class="line"><span class="comment"># s/brown/green/</span></span><br><span class="line"><span class="comment"># s/fox/elephant/</span></span><br><span class="line"><span class="comment"># s/dog/cat/</span></span><br><span class="line">sed -f script1.sed data1.txt </span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<p>为了便于区分 shell 文件和 sed 条件，我们将 sed 条件文件存储为 <code>.sed</code> 结尾</p>
<h4 id="Getting-to-know-the-gawk-program"><a href="#Getting-to-know-the-gawk-program" class="headerlink" title="Getting to know the gawk program"></a>Getting to know the gawk program</h4><p>sed 让你动态改变文件内容，但是还是有局限性。gawk 提供一个更程序化的方式来处理文本信息. 这个工具包默认是没有的一般需要自己手动安装。gawk 是 GNU 版本的 awk, 通过它你可以</p>
<ul>
<li>Define variables to store data</li>
<li>Use arithmetic and string operatiors to perate on data</li>
<li>Use structured programming concepts, such as if-then statements and loops, to add logic to your data processing</li>
<li>Generate formatted reports by extracting data elements within the data file and repositioning them in another order or format</li>
</ul>
<p>第四点经常用来批量处理数据使之更具可读性，典型应用就是处理 log 文件。</p>
<h4 id="Visiting-the-gawk-command-format"><a href="#Visiting-the-gawk-command-format" class="headerlink" title="Visiting the gawk command format"></a>Visiting the gawk command format</h4><p>格式 <code>gawk options program file</code></p>
<p>The gawk Options</p>
<table>
<thead>
<tr>
<th align="left">Option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-F fs</td>
<td align="left">Specifies a file separator for delineating data fields in a line</td>
</tr>
<tr>
<td align="left">-f file</td>
<td align="left">Specifies a file name to read the program from</td>
</tr>
<tr>
<td align="left">-v var=value</td>
<td align="left">Defines a variable and default value used in the gawk program</td>
</tr>
<tr>
<td align="left">-mf N</td>
<td align="left">Specifies the maximum number of fields to process in the data file</td>
</tr>
<tr>
<td align="left">-mr N</td>
<td align="left">Specifies the maximum record size in the data file</td>
</tr>
<tr>
<td align="left">-W keyword</td>
<td align="left">Specifies the compatibility mode or warning level of gawk</td>
</tr>
</tbody></table>
<p>gawk 最大的优势是可以用编程的手段，将数据重新格式化输出</p>
<h4 id="Reading-the-program-script-from-the-command-line"><a href="#Reading-the-program-script-from-the-command-line" class="headerlink" title="Reading the program script from the command line"></a>Reading the program script from the command line</h4><p>格式 <code>gawk &#39;&#123; commands &#125;&#39;</code> 比如 <code>gawk &#39;&#123;print &quot;Hello World!&quot;&#125;&#39;</code> 这个 demo 命令并没有做什么文字处理，只是简单的接收标准输入然后打印 Hello World. 使用 Ctrl + D 结束对话</p>
<p>gawk 最主要的功能是提供操作文本中数据的功能，默认情况下，gawk 会提取如下变量</p>
<ul>
<li>$0 represents the entire line of text</li>
<li>$1 represents the first data field in the line of text</li>
<li>$2 represents the second data field in the line of text</li>
<li>$n represents the nth data field in the line of text</li>
</ul>
<p>gawk 会根据命令中提供的分割符做行的分割，下面是 gawk 读取文件并显示第一行的示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt </span><br><span class="line"><span class="comment"># One line of test text.</span></span><br><span class="line"><span class="comment"># Two lines of test text.</span></span><br><span class="line"><span class="comment"># Three lines of test text.</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;&#123; print $1 &#125;&#x27;</span> data2.txt </span><br><span class="line"><span class="comment"># One</span></span><br><span class="line"><span class="comment"># Two</span></span><br><span class="line"><span class="comment"># Three</span></span><br></pre></td></tr></table></figure>

<p>可以用 <code>-F</code> 指定分割符，比如你要处理 /etc/passwd 这个文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd | tail -3</span><br><span class="line"><span class="comment"># _coreml:*:280:280:CoreML Services:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _trustd:*:282:282:trustd:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false</span></span><br><span class="line"></span><br><span class="line">gawk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> /etc/passwd | tail -3 </span><br><span class="line"><span class="comment"># _coreml</span></span><br><span class="line"><span class="comment"># _trustd</span></span><br><span class="line"><span class="comment"># _oahd</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-multiple-commands-in-the-program-script"><a href="#Using-multiple-commands-in-the-program-script" class="headerlink" title="Using multiple commands in the program script"></a>Using multiple commands in the program script</h4><p>使用分号分割 gawk 中想要运行的多个命令, 下面的命令会替换第四个 field 并打印整行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;My name is Rich&quot;</span> | gawk <span class="string">&#x27;&#123;$4=&quot;Christine&quot;;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># My name is Christine</span></span><br></pre></td></tr></table></figure>

<p>多行表示也是 OK 的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; $4=&quot;Christine&quot;</span></span><br><span class="line"><span class="string">&gt; print $0</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line">my name is Rich</span><br><span class="line">my name is Christine</span><br></pre></td></tr></table></figure>

<h4 id="Reading-the-program-from-a-file"><a href="#Reading-the-program-from-a-file" class="headerlink" title="Reading the program from a file"></a>Reading the program from a file</h4><p>和 sed 一样，gawk 也支持从文件读取命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat script2.gawk </span><br><span class="line"><span class="comment"># &#123;print $1 &quot;&#x27;s hoe directory is &quot; $6&#125;</span></span><br><span class="line">gawk -F: -f script2.gawk /etc/passwd | tail -3</span><br><span class="line"><span class="comment"># _coreml&#x27;s hoe directory is /var/empty</span></span><br><span class="line"><span class="comment"># _trustd&#x27;s hoe directory is /var/empty</span></span><br><span class="line"><span class="comment"># _oahd&#x27;s hoe directory is /var/empty</span></span><br></pre></td></tr></table></figure>

<p>gawk 文件中包含多个命令的示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat script3.gawk </span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     text = &quot;&#x27;s home directory is &quot;</span></span><br><span class="line"><span class="comment">#     print $1 text $6</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">gawk -F: -f script3.gawk /etc/passwd | tail -3</span><br><span class="line"><span class="comment"># _coreml&#x27;s home directory is /var/empty</span></span><br><span class="line"><span class="comment"># _trustd&#x27;s home directory is /var/empty</span></span><br><span class="line"><span class="comment"># _oahd&#x27;s home directory is /var/empty</span></span><br></pre></td></tr></table></figure>

<h4 id="Running-scripts-before-processing-data"><a href="#Running-scripts-before-processing-data" class="headerlink" title="Running scripts before processing data"></a>Running scripts before processing data</h4><p>gawk 提供了 BEGIN 关键字在处理文本前做一些操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN &#123;print &quot;Hello World!&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Hello World!</span></span><br></pre></td></tr></table></figure>

<p>BEGIN 处理文本的示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data3.txt </span><br><span class="line"><span class="comment"># Line 1</span></span><br><span class="line"><span class="comment"># Line 2</span></span><br><span class="line"><span class="comment"># Line 3</span></span><br><span class="line">gawk <span class="string">&#x27;BEGIN &#123;print &quot;The data3 File Contents: &quot;&#125;</span></span><br><span class="line"><span class="string">&gt; &#123;print $0&#125;&#x27;</span> data3.txt</span><br><span class="line">The data3 File Contents: </span><br><span class="line"><span class="comment"># Line 1</span></span><br><span class="line"><span class="comment"># Line 2</span></span><br><span class="line"><span class="comment"># Line 3</span></span><br></pre></td></tr></table></figure>

<h4 id="Running-scripts-after-processing-data"><a href="#Running-scripts-after-processing-data" class="headerlink" title="Running scripts after processing data"></a>Running scripts after processing data</h4><p>和前面对应的还有一个 after 操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN &#123;print &quot;The data3 File Contents:&quot;&#125;</span></span><br><span class="line"><span class="string">&#123;print $0&#125;</span></span><br><span class="line"><span class="string">&gt; END &#123;print &quot;End of File&quot;&#125;&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># The data3 File Contents:</span></span><br><span class="line"><span class="comment"># Line 1</span></span><br><span class="line"><span class="comment"># Line 2</span></span><br><span class="line"><span class="comment"># Line 3</span></span><br><span class="line"><span class="comment"># End of File</span></span><br></pre></td></tr></table></figure>

<p>如果过程多了，你还可以将这个步骤写到文件中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">at script4.gawk </span><br><span class="line">BEGIN &#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;The latest list of users and selles&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot; UserID\t Shell&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;-------\t------&quot;</span></span><br><span class="line">    FS=<span class="string">&quot;:&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="variable">$1</span> <span class="string">&quot;    \t &quot;</span> <span class="variable">$7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">END &#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;This concludes the listing&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gawk -f script4.gawk  /etc/passwd</span><br><span class="line"><span class="comment"># The latest list of users and selles</span></span><br><span class="line"><span class="comment">#  UserID  Shell</span></span><br><span class="line"><span class="comment"># ------- ------</span></span><br><span class="line"><span class="comment"># nobody           /usr/bin/false</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># _oahd            /usr/bin/false</span></span><br><span class="line"><span class="comment"># This concludes the listing</span></span><br></pre></td></tr></table></figure>

<h3 id="Commanding-at-the-sed-Editor-Basics"><a href="#Commanding-at-the-sed-Editor-Basics" class="headerlink" title="Commanding at the sed Editor Basics"></a>Commanding at the sed Editor Basics</h3><p>本章简要介绍一下 sed 的常规用法</p>
<h4 id="Introducing-more-substitution-options"><a href="#Introducing-more-substitution-options" class="headerlink" title="Introducing more substitution options"></a>Introducing more substitution options</h4><h5 id="Substituting-flags"><a href="#Substituting-flags" class="headerlink" title="Substituting flags"></a>Substituting flags</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat data4.txt </span><br><span class="line"><span class="comment"># This is a test of the test script.</span></span><br><span class="line"><span class="comment"># This is the second test of the test script.</span></span><br><span class="line">sed <span class="string">&#x27;s/test/trial/&#x27;</span> data4.txt </span><br><span class="line"><span class="comment"># This is a trial of the test script.</span></span><br><span class="line"><span class="comment"># This is the second trial of the test script.</span></span><br></pre></td></tr></table></figure>

<p>默认情况下，sed 只会替换每行中第一个出现的位置，如果想要处理多个位置，需要指定 flags。格式为 <code>s/pattern/replacemnet/flags</code></p>
<p>four types of substitution flags are available:</p>
<ul>
<li>A number, indicating the pattern occurrence for which new text should be substituted</li>
<li>g, indicating that new text should be substituted for all occrurences of the existing text</li>
<li>p, indicating that the contents of the original line should be printed</li>
<li>w file, which means to write the results of the substitution to a file</li>
</ul>
<p>替换指定位置的示例，下面示例中只替换了第二个位置的 test</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/test/trial/2&#x27;</span> data4.txt </span><br><span class="line"><span class="comment"># This is a test of the trial script.</span></span><br><span class="line"><span class="comment"># This is the second test of the trial script.</span></span><br></pre></td></tr></table></figure>

<p>全部替换示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/test/trial/g&#x27;</span> data4.txt </span><br><span class="line">This is a trial of the trial script.</span><br><span class="line">This is the second trial of the trial script.</span><br></pre></td></tr></table></figure>

<p>打印符合匹配条件的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat data5.txt </span><br><span class="line"><span class="comment"># This is a test line.</span></span><br><span class="line"><span class="comment"># This is a different line.</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;s/test/trial/p&#x27;</span> data5.txt</span><br><span class="line"><span class="comment"># This is a trial line.</span></span><br></pre></td></tr></table></figure>

<p><code>-w</code> 指定 sed 结果输出到文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/test/trial/w test.txt&#x27;</span> data5.txt </span><br><span class="line"><span class="comment"># This is a trial line.</span></span><br><span class="line"><span class="comment"># This is a different line.</span></span><br><span class="line">cat test.txt </span><br><span class="line"><span class="comment"># This is a trial line.</span></span><br></pre></td></tr></table></figure>

<h5 id="Replacing-characters"><a href="#Replacing-characters" class="headerlink" title="Replacing characters"></a>Replacing characters</h5><p>Linux 系统中路径符号和 sed 中的符号是重的，也就是说，如果我要用 sed 替换路径的时候就必须用一中很累赘的写法, 比如 <code>sed &#39;s/\/bin\/bash/\/bin\/csh/&#39; /etc/passwd</code></p>
<p>PS: Mac OS 语法和这个不一样</p>
<p>为了避免这么恶心的写法，我们可以用惊叹号(exclamation point) 代替原来的分割符 <code>sed &#39;s!/bin/bash!/bin/csh!&#39; /etc/passwd</code></p>
<h4 id="Using-addresses"><a href="#Using-addresses" class="headerlink" title="Using addresses"></a>Using addresses</h4><p>默认情况下 sed 会处理所有的行，如果你只需要处理特殊的几行，你可以使用 line address. line address 有两种模式</p>
<ul>
<li>A numberic range of lines</li>
<li>A text pattern that filters out a line</li>
</ul>
<p>两种模式的格式都是一样的 <code>[address] command</code> 你可以将多个命令组合到一起</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">address &#123;</span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    command3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Addressing-the-numberic-line"><a href="#Addressing-the-numberic-line" class="headerlink" title="Addressing the numberic line"></a>Addressing the numberic line</h5><p>sed 会将 s 之前的内容当作行来处理, 下面的例子只替换第二行的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br></pre></td></tr></table></figure>

<p>替换多行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2,3s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br></pre></td></tr></table></figure>

<p>从第 n 行还是到结束</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2,$s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<h5 id="Using-text-pattern-filters"><a href="#Using-text-pattern-filters" class="headerlink" title="Using text pattern filters"></a>Using text pattern filters</h5><p>使用 pattern 处理特定的行，格式 <code>/pattern/command</code>, 你需要在 pattern 前面指定一个斜杠作为开始</p>
<p>下面的示例中我们只将 root 的 sh 改为 csh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grep root /etc/passwd</span><br><span class="line"><span class="comment"># root:*:0:0:System Administrator:/var/root:/bin/sh</span></span><br><span class="line"><span class="comment"># daemon:*:1:1:System Services:/var/root:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false</span></span><br><span class="line">sed <span class="string">&#x27;/root/s/sh/csh/&#x27;</span> /etc/passwd | grep root</span><br><span class="line"><span class="comment"># root:*:0:0:System Administrator:/var/root:/bin/csh</span></span><br><span class="line"><span class="comment"># daemon:*:1:1:System Services:/var/root:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false</span></span><br></pre></td></tr></table></figure>

<p>sed 是通过正则表达式来做内容匹配的。</p>
<h5 id="Grouping-commands"><a href="#Grouping-commands" class="headerlink" title="Grouping commands"></a>Grouping commands</h5><p>和 gawk 一样，sed 也可以在一个命令中处理多个匹配</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2&#123;</span></span><br><span class="line"><span class="string">s/fox/elephant/</span></span><br><span class="line"><span class="string">s/dog/cat/</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;3,$&#123;</span></span><br><span class="line"><span class="string">s/fox/elephant/</span></span><br><span class="line"><span class="string">s/dog/cat/</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown elephant jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<h5 id="Deleting-lines"><a href="#Deleting-lines" class="headerlink" title="Deleting lines"></a>Deleting lines</h5><p><code>d</code> 用来在输出内容中删除某一行, 如果没有指定删选内容，所有输出都会被删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line">sed <span class="string">&#x27;d&#x27;</span> data6.txt </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>指定删除的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;3d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;2,3d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;3,$d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/number 1/d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>PS: 这个删除只作用的输出，原文件保持不变</p>
<p>还有一种比较奇葩的删除方式，给两个匹配，删除会从第一个还是，第二个结束，删除内容包括当前行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;/1/,/3/d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>这里有一个坑，这种方式是匹配删除，当第一匹配时，删除开始，第二个匹配找到时，删除结束。如果文件中有多个地方能匹配到开始，则可能出现意想不到的情况. 比如在 data7 中，第 5 行也能匹配到 1 这个关键字，但是后面就没有 4 了，则会导致后面的内容都删掉. 如果我指定一个不存在的停止符，则所有内容都不显示了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat data7.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"><span class="comment"># This is line number 1 again.</span></span><br><span class="line"><span class="comment"># This is text you want to keep.</span></span><br><span class="line"><span class="comment"># This is the last line in the file.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/1/,/3/d&#x27;</span> data7.txt </span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/1/,/5/d&#x27;</span> data7.txt</span><br></pre></td></tr></table></figure>

<h5 id="Inserting-and-appending-text"><a href="#Inserting-and-appending-text" class="headerlink" title="Inserting and appending text"></a>Inserting and appending text</h5><p>sed 也允许你插入，续写内容，但是有一些特别的点</p>
<ul>
<li>The insert command(i) adds a new line before the specified line</li>
<li>The append commadn(a) adds a new line after the specified line</li>
</ul>
<p>特别的点在于，你需要新起一行写这些新加的行, 格式为</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;[address]command\</span></span><br><span class="line"><span class="string">new line&#x27;</span></span><br></pre></td></tr></table></figure>

<p>示例如下, 不过 mac 上貌似有语法错误</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;i\Test line 1&#x27;</span></span><br><span class="line"><span class="comment"># Test line 1</span></span><br><span class="line"><span class="comment"># Test Line 2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;a\Test line 1&#x27;</span></span><br><span class="line"><span class="comment"># Test Line 2</span></span><br><span class="line"><span class="comment"># Test line 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;i\</span></span><br><span class="line"><span class="string">&gt; Test Line 1&#x27;</span></span><br><span class="line"><span class="comment"># Test Line 1</span></span><br><span class="line"><span class="comment"># Test Line 2</span></span><br></pre></td></tr></table></figure>

<p>上面演示的是在全部内容之前/后添加新的行，那么怎么在特定行前后做类似的操作呢，你可以用行号指定。但是不能用 range 形式的，因为定义上，i/a 是单行操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;3i\</span></span><br><span class="line"><span class="string">This is an inserted line.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is an inserted line.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line">sed <span class="string">&#x27;3a\This is an appended line.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is an appended line.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>插入文本末尾</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;$a\</span></span><br><span class="line"><span class="string">&gt; This is a new line of text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"><span class="comment"># This is a new line of text.</span></span><br></pre></td></tr></table></figure>

<p>头部插入多行, 需要使用斜杠分割</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1i\</span></span><br><span class="line"><span class="string">&gt; This is one line of new text.\</span></span><br><span class="line"><span class="string">&gt; This is another line of new text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is one line of new text.</span></span><br><span class="line"><span class="comment"># This is another line of new text.</span></span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>如果不指定行号，他会每一行都 insert 啊，和之前的理解不一样. append 也是一样的效果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;i\head insert&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># head insert</span></span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># head insert</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># head insert</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># head insert</span></span><br><span class="line"><span class="comment"># This is line number4</span></span><br></pre></td></tr></table></figure>

<p>也能指定 range… 前面的理解果断有问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1,2a\end append&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># end append</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># end append</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<h5 id="Changing-lines"><a href="#Changing-lines" class="headerlink" title="Changing lines"></a>Changing lines</h5><p>改变行内容，用法和前面的 i/a 没什么区别</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;3c\This is a chagned line of text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is a chagned line of text.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>pattern 方式替换</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/number3/c\</span></span><br><span class="line"><span class="string">This is a changed line of text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is a changed line of text.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>pattern 替换多行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat data8.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"><span class="comment"># This is line number1 again.</span></span><br><span class="line"><span class="comment"># This is yet another line.</span></span><br><span class="line"><span class="comment"># This is the last line in the line.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/number1/c\This is a changed line of text.&#x27;</span> data8.txt</span><br><span class="line"><span class="comment"># This is a changed line of text.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"><span class="comment"># This is a changed line of text.</span></span><br><span class="line"><span class="comment"># This is yet another line.</span></span><br><span class="line"><span class="comment"># This is the last line in the line.</span></span><br></pre></td></tr></table></figure>

<p>指定行号替换的行为方式有点奇怪，他会将你指定的行中内容全部替换掉</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;2,3c\This is a new line of text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is a new line of text.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<h5 id="Transforming-characters"><a href="#Transforming-characters" class="headerlink" title="Transforming characters"></a>Transforming characters</h5><p>transform(y) 是唯 sed 支持的唯一一个用于替换单个字符的参数，格式 <code>[address]y/inchars/outchars/</code>. inchars 和 outchars 必须是等长的，不然会报错。他是做一对一替换，比如 <code>y/123/789</code> 他会用 1 代替 7， 2 代替 8 依次类推</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;y/123/789/&#x27;</span> data8.txt</span><br><span class="line"><span class="comment"># This is line number7.</span></span><br><span class="line"><span class="comment"># This is line number8.</span></span><br><span class="line"><span class="comment"># This is line number9.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"><span class="comment"># This is line number7 again.</span></span><br><span class="line"><span class="comment"># This is yet another line.</span></span><br><span class="line"><span class="comment"># This is the last line in the line.</span></span><br></pre></td></tr></table></figure>

<p>而且他是全局替换，任何出现的地方都会被换掉</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This 1 is a test of 1 try.&quot;</span> | sed <span class="string">&#x27;y/123/456/&#x27;</span></span><br><span class="line"><span class="comment"># This 4 is a test of 4 try.</span></span><br></pre></td></tr></table></figure>

<h5 id="Printing-revisited"><a href="#Printing-revisited" class="headerlink" title="Printing revisited"></a>Printing revisited</h5><p>和 p flag 类似的还有两个符号，表示如下</p>
<ul>
<li>The p command to print a text line</li>
<li>The equal sign(=) command to print line numbers</li>
<li>The l(lowercase L) command to list a line</li>
</ul>
<p>p 使用案例, -n 可以强制只打印匹配的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;this is a test&quot;</span> | sed <span class="string">&#x27;p&#x27;</span></span><br><span class="line"><span class="comment"># this is a test</span></span><br><span class="line"><span class="comment"># this is a test</span></span><br><span class="line"></span><br><span class="line">cat data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;/number3/p&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;2,3p&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br></pre></td></tr></table></figure>

<p>找到匹配的行，先打印原始值，再替换并打印。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/3/&#123;</span></span><br><span class="line"><span class="string">&gt; p</span></span><br><span class="line"><span class="string">&gt; s/line/test/p</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is test number3.</span></span><br></pre></td></tr></table></figure>

<p>equals 相关的案例，输出行号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat data1.txt </span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line">sed <span class="string">&#x27;=&#x27;</span> data1.txt </span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br></pre></td></tr></table></figure>

<p>搜索匹配的内容并打印行号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/number 4/&#123;</span></span><br><span class="line"><span class="string">&gt; =</span></span><br><span class="line"><span class="string">&gt; p</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>l - listing lines, 打印文字和特殊字符(non-printable characters). 下面的实验中，tab 符号答应失败了，可能什么设置问题把，不过结尾符 <code>$</code> 倒是么什么问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat data9.txt </span><br><span class="line"><span class="comment"># This    line    contains    tabs.</span></span><br><span class="line">sed -n <span class="string">&#x27;l&#x27;</span> data9.txt </span><br><span class="line"><span class="comment"># This    line    contains    tabs.$</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-files-with-sed"><a href="#Using-files-with-sed" class="headerlink" title="Using files with sed"></a>Using files with sed</h4><h5 id="Writing-to-a-file"><a href="#Writing-to-a-file" class="headerlink" title="Writing to a file"></a>Writing to a file</h5><p>通过 w 将匹配的内容写到文件 <code>[address]w filename</code>, 使用 -n 只在屏幕上显示匹配部分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1,2w test.txt&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line">cat test.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br></pre></td></tr></table></figure>

<p>这个技巧在筛选数据的时候格外好用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data11.txt </span><br><span class="line"><span class="comment"># Blum, R       Browncoat</span></span><br><span class="line"><span class="comment"># McGuiness, A  Alliance</span></span><br><span class="line"><span class="comment"># Bresnahan, C  Browncoat</span></span><br><span class="line"><span class="comment"># Harken, C     Alliance</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;/Browncoat/w Browncoats.txt&#x27;</span> data11.txt </span><br><span class="line">cat Browncoats.txt </span><br><span class="line"><span class="comment"># Blum, R       Browncoat</span></span><br><span class="line"><span class="comment"># Bresnahan, C  Browncoat</span></span><br></pre></td></tr></table></figure>

<h5 id="Reading-data-from-a-file"><a href="#Reading-data-from-a-file" class="headerlink" title="Reading data from a file"></a>Reading data from a file</h5><p>The read command(r) allows you to insert data contained in a separate file. format at: <code>[address]r filename</code></p>
<p>filename 可以是相对路径，也可以是绝对路径。你不能使用 range of address for the read command. you can only specify a single line number or text pattern address.</p>
<p>读取目标文件中的内容并插入到指定位置<strong>的后面</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat data12.txt </span><br><span class="line"><span class="comment"># This is an added line.</span></span><br><span class="line"><span class="comment"># This is the second added line.</span></span><br><span class="line"></span><br><span class="line">cat data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;3r data12.txt&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is an added line.</span></span><br><span class="line"><span class="comment"># This is the second added line.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>pattern 同样支持</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/number 2/r data12.txt&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is an added line.</span></span><br><span class="line"><span class="comment"># This is the second added line.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>添加到末尾</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;$r data12.txt&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"><span class="comment"># This is an added line.</span></span><br><span class="line"><span class="comment"># This is the second added line.</span></span><br></pre></td></tr></table></figure>

<p>将 read 和 delete 结合使用，我们就可以有类似于替换的效果了</p>
<p>下面例子中我们将名单用 LIST 这个单词做为占位符，将 data11.txt 中的内容替换进去</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat notice.std </span><br><span class="line"><span class="comment"># Would the following people:</span></span><br><span class="line"><span class="comment"># LIST</span></span><br><span class="line"><span class="comment"># please report to the ship&#x27;s captain.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/LIST/&#123;</span></span><br><span class="line"><span class="string">&gt; r data11.txt</span></span><br><span class="line"><span class="string">&gt; d</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> notice.std</span><br><span class="line"><span class="comment"># Would the following people:</span></span><br><span class="line"><span class="comment"># Blum, R       Browncoat</span></span><br><span class="line"><span class="comment"># McGuiness, A  Alliance</span></span><br><span class="line"><span class="comment"># Bresnahan, C  Browncoat</span></span><br><span class="line"><span class="comment"># Harken, C     Alliance</span></span><br><span class="line"><span class="comment"># please report to the ship&#x27;s captain.</span></span><br></pre></td></tr></table></figure>

<h2 id="Chapter-20-Regular-Expressions"><a href="#Chapter-20-Regular-Expressions" class="headerlink" title="Chapter 20: Regular Expressions"></a>Chapter 20: Regular Expressions</h2><h3 id="What-Are-Regular-Expressions"><a href="#What-Are-Regular-Expressions" class="headerlink" title="What Are Regular Expressions"></a>What Are Regular Expressions</h3><h4 id="A-definition"><a href="#A-definition" class="headerlink" title="A definition"></a>A definition</h4><p>A regular expression is a pattern template you define that a Linux utility users to filter text.</p>
<h4 id="Types-of-regular-expressions"><a href="#Types-of-regular-expressions" class="headerlink" title="Types of regular expressions"></a>Types of regular expressions</h4><p>Linux 系统中，一些不同的应用采用不同的正则表达式。正则表达式通过 regular expression engine 实现。Linux 世界中有两个爆款 engines:</p>
<ul>
<li>The POSIX Basic Regular Expression(BRE) engine</li>
<li>The POSIX Extened Regular Expression(ERE) engine</li>
</ul>
<p>大多数 Linux 工具都会适配 RRE，sed 除外，它的目标是尽可能快的处理，所以只识别部分 BRE。</p>
<h3 id="Defining-BRE-Patterns"><a href="#Defining-BRE-Patterns" class="headerlink" title="Defining BRE Patterns"></a>Defining BRE Patterns</h3><h4 id="Plain-text"><a href="#Plain-text" class="headerlink" title="Plain text"></a>Plain text</h4><p>搜索的关键字是目标的一部分即可</p>
<h4 id="Special-characters"><a href="#Special-characters" class="headerlink" title="Special characters"></a>Special characters</h4><p>正则可以识别的特殊字符 <code>.*[]^$&#123;&#125;\+?|()</code>, 如果你想要使用文本版的这些特殊字符，在他们前面加 backslash character()</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;The cost is $4.00&#x27;</span> | sed -n <span class="string">&#x27;/\$/p&#x27;</span></span><br><span class="line"><span class="comment"># The cost is $4.00</span></span><br></pre></td></tr></table></figure>

<h4 id="Anchor-characters"><a href="#Anchor-characters" class="headerlink" title="Anchor characters"></a>Anchor characters</h4><h5 id="Starting-at-the-beginning"><a href="#Starting-at-the-beginning" class="headerlink" title="Starting at the beginning"></a>Starting at the beginning</h5><p>caret character(^) 指代文本开头</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The book store&quot;</span> | sed -n <span class="string">&#x27;/^book/p&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Books are great&quot;</span> | sed -n <span class="string">&#x27;/^Book/p&#x27;</span></span><br><span class="line"><span class="comment"># Books are great</span></span><br></pre></td></tr></table></figure>

<p>当符号出现在非开头位置，则他会被当作普通字符处理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This ^ is a test&quot;</span> | sed -n <span class="string">&#x27;/s ^/p&#x27;</span> </span><br><span class="line"><span class="comment"># This ^ is a test</span></span><br></pre></td></tr></table></figure>

<h5 id="Looking-for-the-ending"><a href="#Looking-for-the-ending" class="headerlink" title="Looking for the ending"></a>Looking for the ending</h5><p>The dollar sign($) 指代了文本的结尾</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a good book&quot;</span> | sed -n <span class="string">&#x27;/book$/p&#x27;</span></span><br><span class="line"><span class="comment"># This is a good book</span></span><br></pre></td></tr></table></figure>

<h4 id="The-dot-character"><a href="#The-dot-character" class="headerlink" title="The dot character"></a>The dot character</h4><p>dot 用于指代除换行外的任何字符, 如果 <code>.</code> 代表的位置没有东西，则匹配失败</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data6 </span><br><span class="line"><span class="comment"># This is a test of a line.</span></span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br><span class="line"><span class="comment"># This test is at line four.</span></span><br><span class="line"><span class="comment"># at ten o&#x27;clock we&#x27;ll go home.</span></span><br><span class="line">sed -n <span class="string">&#x27;/.at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br><span class="line"><span class="comment"># This test is at line four.</span></span><br></pre></td></tr></table></figure>

<h4 id="Character-classes"><a href="#Character-classes" class="headerlink" title="Character classes"></a>Character classes</h4><p>character class 用于限定匹配的内容，使用 square brackets([]) 表示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/[ch]at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br></pre></td></tr></table></figure>

<h4 id="Negating-character-classes"><a href="#Negating-character-classes" class="headerlink" title="Negating character classes"></a>Negating character classes</h4><p>和前面的相反，是不包含的意思</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/[^ch]at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># This test is at line four.</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-ranges"><a href="#Using-ranges" class="headerlink" title="Using ranges"></a>Using ranges</h4><p><code>sed -n &#39;/^[0-9][0-9][0-9][0-9][0-9]$/p&#39; data8</code> 这个技巧也使用于字符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/[c-h]at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br></pre></td></tr></table></figure>

<p>也可以指定非连续的字符集合</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/[a-ch-m]at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I&#x27;m getting too fat&quot;</span> | sed -n <span class="string">&#x27;/[a-ch-m]at/p&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<h4 id="Special-character-classes"><a href="#Special-character-classes" class="headerlink" title="Special character classes"></a>Special character classes</h4><p>BRE Special Character classes</p>
<table>
<thead>
<tr>
<th align="left">Class</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[[:alpha:]]</td>
<td align="left">Matches any alphabetical character, either upper or lower case</td>
</tr>
<tr>
<td align="left">[[:alnum:]]</td>
<td align="left">Matches any alphanumberic character 0-9, A-Z or a-z</td>
</tr>
<tr>
<td align="left">[[:blank:]]</td>
<td align="left">Matches a space or Tab character</td>
</tr>
<tr>
<td align="left">[[:digit:]]</td>
<td align="left">Matches a numberical digit from 0-9</td>
</tr>
<tr>
<td align="left">[[:lower:]]</td>
<td align="left">Matches any lowercase alphabetical character a-z</td>
</tr>
<tr>
<td align="left">[[:print:]]</td>
<td align="left">Matches any printable character</td>
</tr>
<tr>
<td align="left">[[:punct:]]</td>
<td align="left">Matches a punctuation character</td>
</tr>
<tr>
<td align="left">[[:space:]]</td>
<td align="left">Matches any whitespace character: space, Table, NL, FF, VT CR</td>
</tr>
<tr>
<td align="left">[[:upper:]]</td>
<td align="left">Matches any uppercase alphabetical character A-Z</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abc&quot;</span> | sed -n <span class="string">&#x27;/[[:digit:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abc&quot;</span> | sed -n <span class="string">&#x27;/[[:alpha:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># abc</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abc123&quot;</span> | sed -n <span class="string">&#x27;/[[:digit:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># abc123</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is, a test&quot;</span> | sed -n <span class="string">&#x27;/[[:punct:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># This is, a test</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test&quot;</span> | sed -n <span class="string">&#x27;/[[:punct:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<h4 id="The-asterisk"><a href="#The-asterisk" class="headerlink" title="The asterisk"></a>The asterisk</h4><p>星号标识字符出现一次或 n 次</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ik&quot;</span> | sed -n <span class="string">&#x27;/ie*k/p&#x27;</span></span><br><span class="line"><span class="comment"># ik</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;iek&quot;</span> | sed -n <span class="string">&#x27;/ie*k/p&#x27;</span></span><br><span class="line"><span class="comment"># iek</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ieeeek&quot;</span> | sed -n <span class="string">&#x27;/ie*k/p&#x27;</span></span><br><span class="line"><span class="comment"># ieeeek</span></span><br></pre></td></tr></table></figure>

<p>星号也可以和 character class 结合使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;baeeeet&quot;</span> | sed -n <span class="string">&#x27;/b[ae]*t/p&#x27;</span></span><br><span class="line"><span class="comment"># baeeeet</span></span><br></pre></td></tr></table></figure>

<h3 id="Extended-Regular-Expressions"><a href="#Extended-Regular-Expressions" class="headerlink" title="Extended Regular Expressions"></a>Extended Regular Expressions</h3><p>gawk 识别 ERE pattern，ERE 新增了一些符号来扩展功能</p>
<p><strong>Caution</strong> sed 和 gawk 采用了不同的引擎，gawk 可以适配大部分的扩展功能。sed 不能，但是 sed 更快</p>
<h4 id="The-question-mark"><a href="#The-question-mark" class="headerlink" title="The question mark"></a>The question mark</h4><p>问号(?)表示出现 0 次或 1 次。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/be?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bt</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/be?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk <span class="string">&#x27;/be?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>问号也可以结合 character class 使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bt</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bat&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bot&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beaet&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;baet&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beat&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<h4 id="The-plus-sign"><a href="#The-plus-sign" class="headerlink" title="The plus sign"></a>The plus sign</h4><p>加号(+), 出现一次或多次</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk <span class="string">&#x27;/be+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/be+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/be+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>结合方括号使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bat&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;baet&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># baet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beeet&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beeet</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-braces"><a href="#Using-braces" class="headerlink" title="Using braces"></a>Using braces</h4><p>花括号表示重复多次</p>
<ul>
<li>m: The regular expression appears exactly m times</li>
<li>m,n: The regular expression appears at least m times, but no more than n times</li>
</ul>
<p><strong>Cautim</strong> gawk 默认不识别这个模式，需要加上 –re-interval 参数增加这个功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>指定出现次数的区间</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beeet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>同样适用于 character class</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bat&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beat&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beeet&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<h4 id="The-pipe-symbol"><a href="#The-pipe-symbol" class="headerlink" title="The pipe symbol"></a>The pipe symbol</h4><p>pipe symbol 可以让你实现 OR 的逻辑，只要有一个匹配，就算 match 了 <code>expr1 | expr2 | ...</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The cat is asleep&quot;</span> | gawk <span class="string">&#x27;/cat|dog/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># The cat is asleep</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The dog is asleep&quot;</span> | gawk <span class="string">&#x27;/cat|dog/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># The dog is asleep</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The sheep is asleep&quot;</span> | gawk <span class="string">&#x27;/cat|dog/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>结合 character class 使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;He has a hat&quot;</span> | gawk <span class="string">&#x27;/[ch]at|dog/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># He has a hat</span></span><br></pre></td></tr></table></figure>

<h4 id="Grouping-expressions"><a href="#Grouping-expressions" class="headerlink" title="Grouping expressions"></a>Grouping expressions</h4><p>可以使用括号(parentheses)表示 group. 这个 group 会被当成一个基本字符对待。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Sat&quot;</span> | gawk <span class="string">&#x27;/Sat(urday)?/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Sat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Saturday&quot;</span> | gawk <span class="string">&#x27;/Sat(urday)?/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Saturday</span></span><br></pre></td></tr></table></figure>

<p>group 经常和 pipe 结合使用来表示可能出现的组合</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cat&quot;</span> | gawk <span class="string">&#x27;/(c|b)a(b|t)/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># cat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cab&quot;</span> | gawk <span class="string">&#x27;/(c|b)a(b|t)/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># cab</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bat&quot;</span> | gawk <span class="string">&#x27;/(c|b)a(b|t)/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bat</span></span><br></pre></td></tr></table></figure>

<h3 id="Regular-Expressions-in-Action"><a href="#Regular-Expressions-in-Action" class="headerlink" title="Regular Expressions in Action"></a>Regular Expressions in Action</h3><p>实操，介绍一些使用案例</p>
<h4 id="Counting-directory-files"><a href="#Counting-directory-files" class="headerlink" title="Counting directory files"></a>Counting directory files</h4><p>统计环境变量中的可执行文件数量</p>
<p>步骤：echo $PATH 拿到路径，通过 <code>:</code> 分割，最后通过 <code>ls</code> 列出文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat countfiles.sh                                     </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Count number of files in you PATH</span></span><br><span class="line"></span><br><span class="line">mypath=$(<span class="built_in">echo</span> <span class="variable">$PATH</span> | sed <span class="string">&#x27;s/:/ /g&#x27;</span>)</span><br><span class="line">count=0</span><br><span class="line"><span class="keyword">for</span> directory <span class="keyword">in</span> <span class="variable">$mypath</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    check=$(ls <span class="variable">$direcotry</span>)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable">$check</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$directory</span> - <span class="variable">$count</span>&quot;</span></span><br><span class="line">    count=0</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./countfiles.sh </span><br><span class="line"><span class="comment"># /usr/local/opt/mysql@5.7/bin - 4</span></span><br><span class="line"><span class="comment"># /Users/i306454/SAPDevelop/tools/maven/bin - 4</span></span><br><span class="line"><span class="comment"># ....</span></span><br></pre></td></tr></table></figure>

<h4 id="Validating-a-phone-number"><a href="#Validating-a-phone-number" class="headerlink" title="Validating a phone number"></a>Validating a phone number</h4><p>写一个脚本匹配电话号码，样本</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">000-000-0000</span><br><span class="line">123-456-7890</span><br><span class="line">212-555-1234</span><br><span class="line">(317)555-1234</span><br><span class="line">(202) 555-9876</span><br><span class="line">33523</span><br><span class="line">1234567890</span><br><span class="line">234.123.4567</span><br></pre></td></tr></table></figure>

<p>规则：如下四种格式是合法的，其他都不合法</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(123)456-7890</span><br><span class="line">(123) 456-7890</span><br><span class="line">123-456-7890</span><br><span class="line">123.456.7890</span><br></pre></td></tr></table></figure>

<p>找规律:</p>
<ul>
<li>可能以括号开头 <code>^\(?</code></li>
<li>接下来三位数是 area codes, 第一位是非 0，1的数，后两位是 0-9的数 <code>[2-9][0-9]&#123;2&#125;</code></li>
<li>可能存在的结束括号 <code>\)?</code></li>
<li>间隔符，可以没有，可以是空格，点，横线 <code>(| |-|\.)</code> 使用 group 把它看作一个集合，使用竖线表示 or</li>
<li>三个 0-9 的整数 <code>[0-9]&#123;3&#125;</code></li>
<li>空格(虽然例子上没显示)，横线或者点号 <code>( |-|\.)</code></li>
<li>最后接四位整数作为结尾 <code>[0-9]&#123;4&#125;$</code></li>
</ul>
<p>完整表达式 <code>^\(?[2-9][0-9]&#123;2&#125;\)?(| |-|\.)[0-9]&#123;3&#125;( |-|\.)[0-9]&#123;4&#125;$</code></p>
<p>测试:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat isphone              </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Script to filter out bad phone numbers</span></span><br><span class="line"></span><br><span class="line">gawk --re-interval <span class="string">&#x27;/^\(?[2-9][0-9]&#123;2&#125;\)?(| |-|\.)[0-9]&#123;3&#125;( |-|\.)[0-9]&#123;4&#125;$/&#123;print $0&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">cat phonelist | ./isphone       </span><br><span class="line"><span class="comment"># 212-555-1234</span></span><br><span class="line"><span class="comment"># (317)555-1234</span></span><br><span class="line"><span class="comment"># (202) 555-9876</span></span><br><span class="line"><span class="comment"># 234.123.4567</span></span><br></pre></td></tr></table></figure>

<p>PS: 中间那个过来间隔符的操作我之前是没有意识到的</p>
<h4 id="Parsing-an-e-mail-address"><a href="#Parsing-an-e-mail-address" class="headerlink" title="Parsing an e-mail address"></a>Parsing an e-mail address</h4><p>验证 email 的正则表达式</p>
<ul>
<li>用户名部分，可以是任何数字，字母，下划线，横杠和加号 <code>^([a-zA-Z0-9_\-\.\+]+)@</code></li>
<li>hostname 和名字部分一样的规则 <code>([a-zA-Z0-9_\-\.\+]+)</code></li>
<li>顶级域名值只能是字母，大于2个字符，小于5个字符 <code>\.([a-zA-Z]&#123;2,5&#125;)$</code></li>
</ul>
<p>完整表达式 <code>^([a-zA-Z0-9_\-\.\+]+)@([a-zA-Z0-9_\-\.\+]+)\.([a-zA-Z]&#123;2,5&#125;)$</code></p>
<p>测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat isemail </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Script to filter out bad email</span></span><br><span class="line"></span><br><span class="line">gawk --re-interval <span class="string">&#x27;/^([a-zA-Z0-9_\-\.\+]+)@([a-zA-Z0-9_\-\.\+]+)\.([a-zA-Z]&#123;2,5&#125;)$/&#123;print $0&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rich@here.now&quot;</span> | ./isemail</span><br><span class="line"><span class="comment"># rich@here.now</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rich@here.now.&quot;</span> | ./isemail</span><br><span class="line"><span class="comment"># no match</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rich.blum@here.now&quot;</span> | ./isemail</span><br><span class="line"><span class="comment"># rich.blum@here.now</span></span><br></pre></td></tr></table></figure>

<h2 id="Advanced-sed"><a href="#Advanced-sed" class="headerlink" title="Advanced sed"></a>Advanced sed</h2><h3 id="Looking-at-Multiline-Commands"><a href="#Looking-at-Multiline-Commands" class="headerlink" title="Looking at Multiline Commands"></a>Looking at Multiline Commands</h3><p>在前面的 sed 使用过程中，你可能已经察觉到了 sed 的一个限制，他只能按行处理。当 sed 拿到一个字符流时，他会将数据按照 newline characters 做分割，每次处理一行。</p>
<p>但是实际工作你总会遇到需要处理多行的情况，比如你要替换文件中的 <code>Linux System Administrators Group</code> 关键字，但是他可能分布在两行中，这时如果你安之前的 sed 做替换就会漏掉一些内容</p>
<p>为了应对这种情况，sed 提供了三个关键字来处理这种情况</p>
<ul>
<li>N add the next line in the data stream to create a multiline group for processing</li>
<li>D delete a single line in multiline group</li>
<li>P prints a single line in a multiline group</li>
</ul>
<h4 id="Navigating-the-next-command"><a href="#Navigating-the-next-command" class="headerlink" title="Navigating the next command"></a>Navigating the next command</h4><h5 id="Using-the-single-line-next-command"><a href="#Using-the-single-line-next-command" class="headerlink" title="Using the single-line next command"></a>Using the single-line next command</h5><p>下面的示例中，我们有5行文本，1，3，5有值，2，4为空。目标是通过 sed 只移除第二行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat data1.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is a data line.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br></pre></td></tr></table></figure>

<p>错误示范，会删掉所有空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^$/d&#x27;</span> data1.txt       </span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is a data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br></pre></td></tr></table></figure>

<p>通过使用 <code>n</code> 这个关键字，可以将下一行也包括到搜索范围内</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/header/&#123;n ; d&#125;&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is a data line.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the last line</span></span><br></pre></td></tr></table></figure>

<p>PS: MacOS 不支持，在 Ubantu 上做的实验</p>
<p>简单一句话就是，n 不会和前一句做合并处理. 说实话上面的例子还是不怎么理解，可能得另外找点书补充一下</p>
<h5 id="Combining-lines-of-text"><a href="#Combining-lines-of-text" class="headerlink" title="Combining lines of text"></a>Combining lines of text</h5><p>The single-line next command moves the next line of text from the data stream into the processing space(called the pattern space) of the sed editor.</p>
<p>The multiline version of the next command(which uses a captial N) adds the next line of text to the text already in the pattern space.</p>
<p>大写的 N 可以将两行拼成一行处理，中间用换行符隔开</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/first/&#123;N; s/\n/ /&#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line. This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br></pre></td></tr></table></figure>

<p>上面的例子中，我们找到包含 first 的行，然后将下一行接上一起处理，处理的时候，将换行替换为空格</p>
<p>再举一个需要测试的数据落在两个段落中的例子</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br><span class="line"><span class="comment"># Thank you for your attendance.</span></span><br></pre></td></tr></table></figure>

<p>第一个关键字替换失败，第二个成功，因为第一个用的换行，匹配用的空格</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N;s/System Administrator/Desktop User/&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br><span class="line"><span class="comment"># Thank you for your attendance</span></span><br></pre></td></tr></table></figure>

<p>替换成功不过换行消失了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N;s/System.Administrator/Desktop User/&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br><span class="line"><span class="comment"># Thank you for your attendance.</span></span><br></pre></td></tr></table></figure>

<p>使用两个替换分别应对换行和空格的情况</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br><span class="line"><span class="comment"># Thank you for your attendance.</span></span><br></pre></td></tr></table></figure>

<p>这里还有一个小问题，由于命令是 N 开头，他会先拿下一行到 pattern space，当处理最后一行时，下一行为空，直接结束了，如果要替换的目标在最后一行就会有遗漏</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;N</span></span><br><span class="line"><span class="string">s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br></pre></td></tr></table></figure>

<p>这时你可以换一下顺序</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; N</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br></pre></td></tr></table></figure>

<p>（；￣ェ￣）简直无情，太繁琐了</p>
<h4 id="Navigating-the-multiline-delete-command"><a href="#Navigating-the-multiline-delete-command" class="headerlink" title="Navigating the multiline delete command"></a>Navigating the multiline delete command</h4><p>当使用 N 的方式做 delete 的时候，它会将匹配到的两行内容全部删掉</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;N ; /System\nAdministrator/d&#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br></pre></td></tr></table></figure>

<p>sed 提供了一个只删除第一行内容的 flag - D</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N ; /System\nAdministrator/D&#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br></pre></td></tr></table></figure>

<p>类似的技巧可以用来删除文章开头的空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat -n data1.txt</span><br><span class="line">    <span class="comment">#  1</span></span><br><span class="line">    <span class="comment">#  2    This is the header line.</span></span><br><span class="line">    <span class="comment">#  3</span></span><br><span class="line">    <span class="comment">#  4    This is a data line.</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line">    <span class="comment">#  6    This is the last line</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/^$/&#123;N;/header/D&#125;&#x27;</span> data1.txt | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3    This is a data line.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5    This is the last line</span></span><br></pre></td></tr></table></figure>

<h4 id="Navigating-the-multiline-print-command"><a href="#Navigating-the-multiline-print-command" class="headerlink" title="Navigating the multiline print command"></a>Navigating the multiline print command</h4><p>和 p 对应的还有一个 P， 用法和上面的 D 一样，如果用 p 会打印两行，而用 P 则只打印第一行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;N ; /System\nAdministrator/P&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line">sed -n <span class="string">&#x27;N ; /System\nAdministrator/p&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br></pre></td></tr></table></figure>

<h3 id="Holding-Space"><a href="#Holding-Space" class="headerlink" title="Holding Space"></a>Holding Space</h3><p>pattern space 是 sed 用于存放正在的处理文本的空间。但是这并不是存放文本的唯一的地方，还有一个叫做 hold space. 下列是五个可以操作 hold space 的命令</p>
<p>The sed Editor Hold Space Commands</p>
<table>
<thead>
<tr>
<th align="left">Command</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">h</td>
<td align="left">Copies pattern space to hold space</td>
</tr>
<tr>
<td align="left">H</td>
<td align="left">Appends pattern space to hold space</td>
</tr>
<tr>
<td align="left">g</td>
<td align="left">Copies hold space to pattern sapce</td>
</tr>
<tr>
<td align="left">G</td>
<td align="left">Appends hold space to pattern space</td>
</tr>
<tr>
<td align="left">x</td>
<td align="left">Exchanges contents of pattern and hold spaces</td>
</tr>
</tbody></table>
<p>这些命令可以让 pattern space 空出来处理其他文本。一般来说，你在通过 h/H 将 pattern space 的内容移动到 hold space 之后，都会再通过 g/G/x 将内容在放回到 pattern space 中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;/first/ &#123;h ; p ; n ; p ; g ; p &#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br></pre></td></tr></table></figure>

<p>解析上面的命令</p>
<ol>
<li>sed 通过 RE 过滤包含 first 的语句</li>
<li>匹配到目标语句后，开始执行 {} 中的内容，h 会将语句 copy 到 hold space 中</li>
<li>第一个 p 打印当前 pattern space 中内容</li>
<li>n 提取下一行内容并放到 pattern space</li>
<li>第二个 p 打印当前 pattern space 中内容, 即包含 second 的语句</li>
<li>g 将 hold space 中的内容再 copy 回去</li>
<li>第三个 p 打印当前 pattern space 中内容, 即包含 first 的语句</li>
</ol>
<h3 id="Negating-a-Command"><a href="#Negating-a-Command" class="headerlink" title="Negating a Command"></a>Negating a Command</h3><p>使用叹号(!)对操作取反</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br><span class="line">sed -n <span class="string">&#x27;/header/p&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line">sed -n <span class="string">&#x27;/header/!p&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br></pre></td></tr></table></figure>

<p>N 也有取反操作, 之前的例子</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N</span></span><br><span class="line"><span class="string">s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;$!N</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br></pre></td></tr></table></figure>

<p><code>$!N</code> 消失 最后一行不执行 N 的操作。。。</p>
<p>通过上面介绍的这些技巧，你可以利用 hold space 做文本倒序的功能</p>
<ol>
<li>Place a line in the pattern space</li>
<li>Place the line from the pattern space to the hold space</li>
<li>Put the next line of text in the pattern space</li>
<li>Append the hold space to the pattern space</li>
<li>Place everything in the pttern space into the hold space</li>
<li>Repeat step 3-5 until you’ve put all the lines in reverse oder in the hold space</li>
<li>Retrieve the lines, and print them</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat -n data2.txt</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  3    This is the second data line</span></span><br><span class="line">    <span class="comment">#  4    This is the last line</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;&#123;1!G; h; $p&#125;&#x27;</span> data2.txt | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the last line</span></span><br><span class="line">    <span class="comment">#  2    This is the second data line</span></span><br><span class="line">    <span class="comment">#  3    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  4    This is the header line.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>1!G</code> 第一行时不用将 hold space 的内容 append 过来, 不加的话会多一个空行</li>
<li><code>h</code> copy to hold space</li>
<li><code>$p</code> 最后一行的话 打印</li>
</ul>
<p>这尼玛也太精巧了把，我感觉我想不出来 （；￣ェ￣）</p>
<p>PS: 如果真要倒序，直接用 tac 即可， cat 的倒写</p>
<h3 id="Changing-the-Flow"><a href="#Changing-the-Flow" class="headerlink" title="Changing the Flow"></a>Changing the Flow</h3><p>默认情况下 sed 是从头到尾的处理的，但是他也提供了方法改变处理顺序，感觉像有点像结构化语言</p>
<h4 id="Branching"><a href="#Branching" class="headerlink" title="Branching"></a>Branching</h4><p>效果和叹号一样，只不过他是会根据 address 的标识批量操作而已</p>
<p>branch command: [address]b [label]</p>
<p>下面的例子中， sed 在做替换是根据 <code>2,3b</code> 跳过了第 2-3 行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;&#123;2,3b; s/This is/Is this/; s/line./test?/&#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># Is this the header test?</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># Is this the last test?</span></span><br></pre></td></tr></table></figure>

<p>label 的作用是设置一个跳点，本来看了第一个例子我还想说它很像 if condition 但是感觉上说他是 goto 还更恰当一点。 label 最长为 7 个字符</p>
<p>下面的例子，jump1 更像是 if, 如果 match 则跳过条件直接执行 :jump1 之后的命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;&#123;/first/b jump1; s/This is the/No jump on/</span></span><br><span class="line"><span class="string">&gt; :jump1</span></span><br><span class="line"><span class="string">&gt; s/This is the/Jump here on/&#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># No jump on header line.</span></span><br><span class="line"><span class="comment"># Jump here on first data line.</span></span><br><span class="line"><span class="comment"># No jump on second data line.</span></span><br><span class="line"><span class="comment"># No jump on last line.</span></span><br></pre></td></tr></table></figure>

<p>当 b 匹配的内容出现，则跳过第一个替换，直接执行后一个。更骚的操作是下面的这个循环替换逗号的操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This, is, a, test, to, remove, commas.&quot;</span> | sed -n <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; :start</span></span><br><span class="line"><span class="string">&gt; s/,//1p</span></span><br><span class="line"><span class="string">&gt; b start</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># This is, a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove commas.</span></span><br><span class="line"><span class="comment"># ^C</span></span><br></pre></td></tr></table></figure>

<p>这个例子大致意思我是懂得，但是不清楚为什么执行操作的时候文本一直有效，不会被冲掉吗？可能要深入了解一下 pattern space 才能直到原因。这个cmd 需要 Ctrl + C 才能强制结束, 下面是改进版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This, is, a, test, to, remove, commas.&quot;</span> | sed -n <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/,//1p</span></span><br><span class="line"><span class="string">/,/b start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># This is, a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove commas.</span></span><br></pre></td></tr></table></figure>

<h4 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h4><p>语法和 branch 很像 <code>[address]t [label]</code></p>
<p>test command provide a cheap way to perform a basic if-then statement on the text in the data stream</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line">sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; s/first/matched/</span></span><br><span class="line"><span class="string">&gt; t</span></span><br><span class="line"><span class="string">&gt; s/This is the/No match on/</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># No match on header line.</span></span><br><span class="line"><span class="comment"># This is the matched data line.</span></span><br><span class="line"><span class="comment"># No match on second data line.</span></span><br><span class="line"><span class="comment"># No match on last line.</span></span><br></pre></td></tr></table></figure>

<p>如果 t 前面的 cmd 匹配则执行，不然直接执行后一个命令。之前循环替换逗号的例子用 t 的形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This, is, a, test, to, remove, commas.&quot;</span> | sed -n <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/,//1p</span></span><br><span class="line"><span class="string">t start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># This is, a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove commas.</span></span><br></pre></td></tr></table></figure>

<h3 id="Replacing-via-a-Pattern"><a href="#Replacing-via-a-Pattern" class="headerlink" title="Replacing via a Pattern"></a>Replacing via a Pattern</h3><p>通过 sed 做精确替换还是简单的, 比如下面的例子要在 cat 外面添加双引号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The cat sleeps in his hat.&quot;</span> | sed <span class="string">&#x27;s/cat/&quot;cat&quot;/&#x27;</span></span><br><span class="line"><span class="comment"># The &quot;cat&quot; sleeps in his hat.</span></span><br></pre></td></tr></table></figure>

<p>但是如果你想要在所有 .at 外面加双引号可能有会遇到问题了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The cat sleeps in his hat.&quot;</span> | sed <span class="string">&#x27;s/.at/&quot;.at&quot;/g&#x27;</span></span><br><span class="line"><span class="comment"># The &quot;.at&quot; sleeps in his &quot;.at&quot;.</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-the-ampersand"><a href="#Using-the-ampersand" class="headerlink" title="Using the ampersand"></a>Using the ampersand</h4><p>为了解决上面的问题，sed 提供了 <code>&amp;</code> 符号指代匹配的字符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The cat sleeps in his hat.&quot;</span> | sed <span class="string">&#x27;s/.at/&quot;&amp;&quot;/g&#x27;</span></span><br><span class="line"><span class="comment"># The &quot;cat&quot; sleeps in his &quot;hat&quot;.</span></span><br></pre></td></tr></table></figure>

<h4 id="Replacing-individual-words"><a href="#Replacing-individual-words" class="headerlink" title="Replacing individual words"></a>Replacing individual words</h4><p>如果你只想替换一部分内容，说人话就是支持 group 的模式减少 typing</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This System Administractor manual&quot;</span> | sed <span class="string">&#x27;</span></span><br><span class="line"><span class="string">s/\(System\) Administractor/\1 User/&#x27;</span></span><br><span class="line"><span class="comment"># This System User manual</span></span><br></pre></td></tr></table></figure>

<ul>
<li>group 需要用反斜线</li>
<li>指代 group 用反斜线加数子</li>
</ul>
<p>下面的例子中我们用原句中的一部分代替原有部分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;That furry cat is pretty&quot;</span> | sed <span class="string">&#x27;s/furry \(.at\)/\1/&#x27;</span></span><br><span class="line"><span class="comment"># That cat is pretty</span></span><br></pre></td></tr></table></figure>

<p>这个技巧在插入值的时候很好用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1234567&quot;</span> | sed <span class="string">&#x27;&#123;                                    </span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/\(.*[0-9]\)\([0-9]\&#123;3\&#125;\)/\1,\2/</span></span><br><span class="line"><span class="string">t start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 1,234,567</span></span><br></pre></td></tr></table></figure>

<p>有两个分组</p>
<ul>
<li>.*[0-9]</li>
<li>[0-9]{3}</li>
</ul>
<p>第一次替换结果为 1234,567，第二次 1,234,567</p>
<h3 id="Placing-sed-Commands-in-Script"><a href="#Placing-sed-Commands-in-Script" class="headerlink" title="Placing sed Commands in Script"></a>Placing sed Commands in Script</h3><p>展示一些脚本中使用 sed 的技巧</p>
<h4 id="Using-wrappers"><a href="#Using-wrappers" class="headerlink" title="Using wrappers"></a>Using wrappers</h4><p>每次使用 sed 的时候现打会很累赘，你可以将他们写到脚本中并调用</p>
<p>下面的例子中，我们将之前实现的 reverse 功能通过脚本调用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat reverse.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Shell wrapper for sed editor script.</span></span><br><span class="line"><span class="comment">#           to reverse text file lines</span></span><br><span class="line">sed -n <span class="string">&#x27;&#123;1!G; h; $p&#125;&#x27;</span> <span class="variable">$1</span></span><br><span class="line"></span><br><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line"></span><br><span class="line">./reverse.sh data2.txt</span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the header line.</span></span><br></pre></td></tr></table></figure>

<h4 id="Redirecting-sed-output"><a href="#Redirecting-sed-output" class="headerlink" title="Redirecting sed output"></a>Redirecting sed output</h4><p>sed 操作后的输出可以用 $() 包裹起来作为结果引用</p>
<p>下面的例子中我们计算斐波那契额数列并用之前写的 sed 表达式为它加上逗号分割</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat fact.sh                        </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Add commas to number in factorial answer</span></span><br><span class="line"></span><br><span class="line">factorial=1</span><br><span class="line">counter=1</span><br><span class="line">number=<span class="variable">$1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$counter</span> -le <span class="variable">$number</span> ]</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    factorial=$[ <span class="variable">$factorial</span> * <span class="variable">$counter</span> ]</span><br><span class="line">    counter=$[ <span class="variable">$counter</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">result=$(<span class="built_in">echo</span> <span class="variable">$factorial</span> | sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/\(.*[0-9]\)\([0-9]\&#123;3\&#125;\)/\1,\2/</span></span><br><span class="line"><span class="string">t start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$result</span>&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">./fact.sh 20      </span><br><span class="line"><span class="comment"># The result is 2,432,902,008,176,640,000</span></span><br></pre></td></tr></table></figure>

<h3 id="Creating-sed-Utilities"><a href="#Creating-sed-Utilities" class="headerlink" title="Creating sed Utilities"></a>Creating sed Utilities</h3><p>分享一些数据处理函数</p>
<h4 id="Spacing-with-double-lines"><a href="#Spacing-with-double-lines" class="headerlink" title="Spacing with double lines"></a>Spacing with double lines</h4><p>为文本中的每一行后面新家一个空行, 如果最后一行不想加空格，可以用叹号取反</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;G&#x27;</span> data2.txt  | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5    This is the second data line.</span></span><br><span class="line">    <span class="comment">#  6</span></span><br><span class="line">    <span class="comment">#  7    This is the last line.</span></span><br><span class="line">    <span class="comment">#  8</span></span><br><span class="line"> sed <span class="string">&#x27;$!G&#x27;</span> data2.txt  | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5    This is the second data line.</span></span><br><span class="line">    <span class="comment">#  6</span></span><br><span class="line">    <span class="comment">#  7    This is the last line.</span></span><br></pre></td></tr></table></figure>

<h4 id="Spacing-files-that-may-have-blanks"><a href="#Spacing-files-that-may-have-blanks" class="headerlink" title="Spacing files that may have blanks"></a>Spacing files that may have blanks</h4><p>如果你的文件中已经存在空行了，那么用上面的技巧，你的文件中可能出现多个空行，怎么保证空行数只有一个呢</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;$!G&#x27;</span> data6.txt | cat -n</span><br><span class="line">    <span class="comment">#  1    This is line number1.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3    This is line number2.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line">    <span class="comment">#  6</span></span><br><span class="line">    <span class="comment">#  7    This is line number3.</span></span><br><span class="line">    <span class="comment">#  8</span></span><br><span class="line">    <span class="comment">#  9    This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>解决方案，现将所有空格去了，再做加空行的操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^$/d; $!G;&#x27;</span> data6.txt  | cat  -A</span><br><span class="line"><span class="comment"># This is line number 1.$</span></span><br><span class="line"><span class="comment"># $</span></span><br><span class="line"><span class="comment"># This is line number 2.$</span></span><br><span class="line"><span class="comment"># $</span></span><br><span class="line"><span class="comment"># This is line number 3.$</span></span><br><span class="line"><span class="comment"># $</span></span><br><span class="line"><span class="comment"># This is line number 4.$</span></span><br></pre></td></tr></table></figure>

<p>PS: 使用 <code>i\</code> 的语法添加空行会带有一个空格，推荐使用 <code>1G</code> 的方式</p>
<h4 id="Numbering-lines-in-a-file"><a href="#Numbering-lines-in-a-file" class="headerlink" title="Numbering lines in a file"></a>Numbering lines in a file</h4><p>19 章时我们介绍过用 <code>=</code> 显示行号的操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;=&#x27;</span> data2.txt </span><br><span class="line">1</span><br><span class="line">This is the header line.</span><br><span class="line">2</span><br><span class="line">This is the first data line.</span><br><span class="line">3</span><br><span class="line">This is the second data line.</span><br><span class="line">4</span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure>

<p>这种格式有点奇怪，更友好的方式应该时行号和字串在一行中，这里可以用 N</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;=&#x27;</span> data2.txt | sed <span class="string">&#x27;N; s/\n/ /&#x27;</span></span><br><span class="line"><span class="comment"># 1 This is the header line.</span></span><br><span class="line"><span class="comment"># 2 This is the first data line.</span></span><br><span class="line"><span class="comment"># 3 This is the second data line.</span></span><br><span class="line"><span class="comment"># 4 This is the last line.</span></span><br></pre></td></tr></table></figure>

<p>这中方式最大的好处是，没有加行额外的空格，一些其他的工具，比如 nl, cat -n 会在结果前面添加一些空格</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nl data2.txt</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  3    This is the second data line.</span></span><br><span class="line">    <span class="comment">#  4    This is the last line.</span></span><br><span class="line"></span><br><span class="line">cat -n data2.txt</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  3    This is the second data line.</span></span><br><span class="line">    <span class="comment">#  4    This is the last line.</span></span><br></pre></td></tr></table></figure>

<h4 id="Printing-last-lines"><a href="#Printing-last-lines" class="headerlink" title="Printing last lines"></a>Printing last lines</h4><p>只打印最后一行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;$p&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the last line.</span></span><br></pre></td></tr></table></figure>

<p>使用类似的技巧，你可以显示末尾几行数据，这种做法叫做 rolling window</p>
<p>rolling window 中我们结合使用 N，将整块的文本存储到 pattern space 中</p>
<p>下面的例子中我们将用 sed 显示文本最后10行的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat data7.txt</span><br><span class="line"><span class="comment"># This is line 1.</span></span><br><span class="line"><span class="comment"># This is line 2.</span></span><br><span class="line"><span class="comment"># This is line 3.</span></span><br><span class="line"><span class="comment"># This is line 4.</span></span><br><span class="line"><span class="comment"># This is line 5.</span></span><br><span class="line"><span class="comment"># This is line 6.</span></span><br><span class="line"><span class="comment"># This is line 7.</span></span><br><span class="line"><span class="comment"># This is line 8.</span></span><br><span class="line"><span class="comment"># This is line 9.</span></span><br><span class="line"><span class="comment"># This is line 10.</span></span><br><span class="line"><span class="comment"># This is line 11.</span></span><br><span class="line"><span class="comment"># This is line 12.</span></span><br><span class="line"><span class="comment"># This is line 13.</span></span><br><span class="line"><span class="comment"># This is line 14.</span></span><br><span class="line"><span class="comment"># This is line 15.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">$q; N; 11,$D</span></span><br><span class="line"><span class="string">b start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data7.txt</span><br><span class="line"><span class="comment"># This is line 6.</span></span><br><span class="line"><span class="comment"># This is line 7.</span></span><br><span class="line"><span class="comment"># This is line 8.</span></span><br><span class="line"><span class="comment"># This is line 9.</span></span><br><span class="line"><span class="comment"># This is line 10.</span></span><br><span class="line"><span class="comment"># This is line 11.</span></span><br><span class="line"><span class="comment"># This is line 12.</span></span><br><span class="line"><span class="comment"># This is line 13.</span></span><br><span class="line"><span class="comment"># This is line 14.</span></span><br><span class="line"><span class="comment"># This is line 15.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>$q</code> 退出</li>
<li><code>N</code> 将下一行 append 到 pattern space</li>
<li><code>11,$D</code> 如果当前为 10 行以后，删除第一行</li>
</ul>
<h4 id="Deleting-lines-1"><a href="#Deleting-lines-1" class="headerlink" title="Deleting lines"></a>Deleting lines</h4><p>这节将介绍一些快速移除空白行的操作</p>
<h5 id="Deleting-consecutive-blank-lines"><a href="#Deleting-consecutive-blank-lines" class="headerlink" title="Deleting consecutive blank lines"></a>Deleting consecutive blank lines</h5><p>删除多余空行，这里用了另外一种解决方案。这里的规则是，起始于任何非空行，终止于空行的内容都不会被删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat -n data8.txt   </span><br><span class="line">    <span class="comment">#  1  This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3</span></span><br><span class="line">    <span class="comment">#  4  This is the first data line.</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line">    <span class="comment">#  6  This is the second data line.</span></span><br><span class="line">    <span class="comment">#  7</span></span><br><span class="line">    <span class="comment">#  8</span></span><br><span class="line">    <span class="comment">#  9  This is the last line.</span></span><br><span class="line">    <span class="comment"># 10</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/./,/^$/!d&#x27;</span> data8.txt | cat -n</span><br><span class="line">    <span class="comment">#  1  This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3  This is the first data line.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5  This is the second data line.</span></span><br><span class="line">    <span class="comment">#  6</span></span><br><span class="line">    <span class="comment">#  7  This is the last line.</span></span><br><span class="line">    <span class="comment">#  8</span></span><br></pre></td></tr></table></figure>

<h5 id="Deleting-leading-blank-lines"><a href="#Deleting-leading-blank-lines" class="headerlink" title="Deleting leading blank lines"></a>Deleting leading blank lines</h5><p>删除开头部分的空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat -n data9.txt </span><br><span class="line">    <span class="comment">#  1</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3  This is line one.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5  This is line two.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/./,$!d&#x27;</span> data9.txt | cat -n</span><br><span class="line">    <span class="comment">#  1  This is line one.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3  This is line two.</span></span><br></pre></td></tr></table></figure>

<p>任何有内容的行开始，到结束不删除</p>
<h5 id="Deleting-trailing-blank-lines"><a href="#Deleting-trailing-blank-lines" class="headerlink" title="Deleting trailing blank lines"></a>Deleting trailing blank lines</h5><p>删除结尾部分的空行要比删除开头部分的空行麻烦一点，需要一些技巧和循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat -n data10.txt</span><br><span class="line">    <span class="comment">#  1    This is the first line.</span></span><br><span class="line">    <span class="comment">#  2    This is the second line.</span></span><br><span class="line">    <span class="comment">#  3</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">/^\n*$/&#123;$d; N; b start&#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data10.txt | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the first line.</span></span><br><span class="line">    <span class="comment">#  2    This is the second line.</span></span><br></pre></td></tr></table></figure>

<p>匹配任何只包含换行的 line, 如果是最后一行，则删除，如果不是就再次执行</p>
<h4 id="Removing-HTML-tags"><a href="#Removing-HTML-tags" class="headerlink" title="Removing HTML tags"></a>Removing HTML tags</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat data11.txt</span><br><span class="line"><span class="comment"># &lt;html&gt;</span></span><br><span class="line"><span class="comment"># &lt;head&gt;</span></span><br><span class="line"><span class="comment"># &lt;title&gt;This is the page title&lt;/title&gt;</span></span><br><span class="line"><span class="comment"># &lt;/head&gt;</span></span><br><span class="line"><span class="comment"># &lt;body&gt;</span></span><br><span class="line"><span class="comment"># &lt;p&gt;</span></span><br><span class="line"><span class="comment"># This is the &lt;b&gt;first&lt;/b&gt; line in the Web page.</span></span><br><span class="line"><span class="comment"># This should provide some &lt;i&gt;useful&lt;/i&gt;</span></span><br><span class="line"><span class="comment"># information to use in our sed script.</span></span><br><span class="line"><span class="comment"># &lt;/p&gt;</span></span><br><span class="line"><span class="comment"># &lt;/body&gt;</span></span><br><span class="line"><span class="comment"># &lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果直接使用 <code>s/&lt;.*&gt;//g</code> 会出问题，一些文本类似 <code>&lt;b&gt;abc&lt;/b&gt;</code> 也会被删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/&lt;.*&gt;//g&#x27;</span> data11.txt | cat -n </span><br><span class="line">    <span class="comment">#  1</span></span><br><span class="line">    <span class="comment">#  2   </span></span><br><span class="line">    <span class="comment">#  3    </span></span><br><span class="line">    <span class="comment">#  4   </span></span><br><span class="line">    <span class="comment">#  5   </span></span><br><span class="line">    <span class="comment">#  6    </span></span><br><span class="line">    <span class="comment">#  7     This is the  line in the Web page.</span></span><br><span class="line">    <span class="comment">#  8     This should provide some </span></span><br><span class="line">    <span class="comment">#  9     information to use in our sed script.</span></span><br><span class="line">    <span class="comment"># 10    </span></span><br><span class="line">    <span class="comment"># 11   </span></span><br><span class="line">    <span class="comment"># 12</span></span><br></pre></td></tr></table></figure>

<p>这个是由于 sed 将内嵌的 <code>&gt;</code> 识别为 <code>.*</code> 的一部分了，可以使用 <code>s/&lt;[^&gt;]*&gt;//g</code> 修复, 再结合删除空格的语法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/&lt;[^&gt;]*&gt;//g; /^$/d&#x27;</span> data11.txt             </span><br><span class="line"><span class="comment"># This is the page title</span></span><br><span class="line"><span class="comment"># This is the first line in the Web page.</span></span><br><span class="line"><span class="comment"># This should provide some useful</span></span><br><span class="line"><span class="comment"># information to use in our sed script.</span></span><br></pre></td></tr></table></figure>

<h2 id="Chapter-22-Advanced-gawk"><a href="#Chapter-22-Advanced-gawk" class="headerlink" title="Chapter 22: Advanced gawk"></a>Chapter 22: Advanced gawk</h2><h3 id="Using-Variables"><a href="#Using-Variables" class="headerlink" title="Using Variables"></a>Using Variables</h3><p>gawk 支持两种不同类型的变量</p>
<ul>
<li>Built-in variables</li>
<li>User-defined variables</li>
</ul>
<h4 id="Built-in-variables"><a href="#Built-in-variables" class="headerlink" title="Built-in variables"></a>Built-in variables</h4><p>这一节将展示 gawk 自带变量的使用办法</p>
<h5 id="The-field-and-record-separator-variables"><a href="#The-field-and-record-separator-variables" class="headerlink" title="The field and record separator variables"></a>The field and record separator variables</h5><p>The gawk Data Field and REcord Variables</p>
<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">FIELDWIDTHS</td>
<td align="left">A space-separated list of numbers defining the exact width(in spaces) of each data field</td>
</tr>
<tr>
<td align="left">FS</td>
<td align="left">Input field separator character</td>
</tr>
<tr>
<td align="left">RS</td>
<td align="left">Input record separator character</td>
</tr>
<tr>
<td align="left">OFS</td>
<td align="left">Output field separator character</td>
</tr>
<tr>
<td align="left">ORS</td>
<td align="left">Output record separator character</td>
</tr>
</tbody></table>
<p>下面的例子展示了 FS 的使用方法, 通过 FS 指定分割符，只输出每行前三组数据</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat data1</span><br><span class="line"><span class="comment"># data11,data12,data13,data14,data15</span></span><br><span class="line"><span class="comment"># data21,data22,data23,data24,data25</span></span><br><span class="line"><span class="comment"># data31,data32,data33,data34,data35</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; &#123;print $1, $2, $3&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11 data12 data13</span></span><br><span class="line"><span class="comment"># data21 data22 data23</span></span><br><span class="line"><span class="comment"># data31 data32 data33</span></span><br></pre></td></tr></table></figure>

<p>OFS 指定输出时候的分割符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;; OFS=&quot;--&quot;&#125; &#123;print $1, $2, $3&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11--data12--data13</span></span><br><span class="line"><span class="comment"># data21--data22--data23</span></span><br><span class="line"><span class="comment"># data31--data32--data33</span></span><br></pre></td></tr></table></figure>

<p>有些数据并不是用固定的分割符做刷剧划分的，而是用的位置，这个时候你就要用到 FIELDWIDTHS 了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat data1b                                                               </span><br><span class="line"><span class="comment"># 1005.3247596.37</span></span><br><span class="line"><span class="comment"># 115-2.349194.00</span></span><br><span class="line"><span class="comment"># 05810.1298100.1</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FIELDWIDTHS=&quot;3 5 2 5&quot;&#125; &#123;print $1, $2, $3 $4&#125;&#x27;</span> data1b</span><br><span class="line"><span class="comment"># 100 5.324 7596.37</span></span><br><span class="line"><span class="comment"># 115 -2.34 9194.00</span></span><br><span class="line"><span class="comment"># 058 10.12 98100.1</span></span><br></pre></td></tr></table></figure>

<p>PS: FIEDLWIDTHS 必须是常数，变量是不支持的</p>
<p>RS/ORS 用于行数据，默认的 RS 即为换行符</p>
<p>下面是一个解析电话号码的例子，我们想要解析出用户和对应的电话号码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat data2    </span><br><span class="line"><span class="comment"># Riley Mullen</span></span><br><span class="line"><span class="comment"># 123 Main Street</span></span><br><span class="line"><span class="comment"># Chicago, IL  60601</span></span><br><span class="line"><span class="comment"># (312)555-1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Frank Williams</span></span><br><span class="line"><span class="comment"># 456 Oak Street</span></span><br><span class="line"><span class="comment"># Indianapolis, IN  46201</span></span><br><span class="line"><span class="comment"># (317)555-9876</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Haley Snell</span></span><br><span class="line"><span class="comment"># 4231 Elm Street</span></span><br><span class="line"><span class="comment"># Detroit, MI 48201</span></span><br><span class="line"><span class="comment"># (313)555-4938</span></span><br></pre></td></tr></table></figure>

<p>如果我们还是用默认的换行符，则不能解析。我们可以将 <code>\n</code> 设置为字段分割符，将空行作为行分割符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;print $1, $4&#125;&#x27;</span> data2 </span><br><span class="line"><span class="comment"># Riley Mullen (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell (313)555-4938</span></span><br></pre></td></tr></table></figure>

<h5 id="Data-variables"><a href="#Data-variables" class="headerlink" title="Data variables"></a>Data variables</h5><p>More gawk Built-In Variables</p>
<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ARGC</td>
<td align="left">The number of command line parameters present</td>
</tr>
<tr>
<td align="left">ARGIND</td>
<td align="left">The index in ARGV of the current file being proecssed</td>
</tr>
<tr>
<td align="left">ARGV</td>
<td align="left">An array of command line parameters</td>
</tr>
<tr>
<td align="left">CONVFMT</td>
<td align="left">The conversion format for numbers(see the printf statement), with a default value of %.6 g</td>
</tr>
<tr>
<td align="left">ENVIRON</td>
<td align="left">An associative array of the current shell environment variables and their values</td>
</tr>
<tr>
<td align="left">FNR</td>
<td align="left">The current record number in the data file</td>
</tr>
<tr>
<td align="left">NF</td>
<td align="left">The total number of data fields in the data file</td>
</tr>
<tr>
<td align="left">NR</td>
<td align="left">The number of input records processed</td>
</tr>
</tbody></table>
<p>其他懒得打了</p>
<p>ARGC, ARGV 和之前 shell 变量概念很想，不过 ARGV 是不会将 script 统计在内的，这个有点不一样</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;print ARGC, ARGV[0], ARGV[1]&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># 2 gawk data1</span></span><br></pre></td></tr></table></figure>

<p>PS: 表达式也有点不一样，变量前不需要加 $</p>
<p>获取环境变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;                                          </span></span><br><span class="line"><span class="string">quote&gt; BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; print ENVIRON[&quot;HOME&quot;]                    </span></span><br><span class="line"><span class="string">quote&gt; print ENVIRON[&quot;PATH&quot;]                    </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># /Users/i306454</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>FNR, NF, NR 可以标记 field 的位置。 NF 可以让你在不清楚 field 数量的情况下处理最后一个 field</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;; OFS=&quot;--&quot;&#125; &#123;print $1,$NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line"><span class="comment"># _nearbyd--/usr/bin/false</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">cat /etc/passwd | tail -3                                </span><br><span class="line"><span class="comment"># _coreml:*:280:280:CoreML Services:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _trustd:*:282:282:trustd:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false</span></span><br></pre></td></tr></table></figure>

<p>FNR 表示当前 field 的序号. 下面的例子中，我们传入两个 data file, 每个文件处理完后 FNR 会重制</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125;&#123;print $1, &quot;FNR=&quot;FNR&#125;&#x27;</span> data1 data1    </span><br><span class="line"><span class="comment"># data11 FNR=1</span></span><br><span class="line"><span class="comment"># data21 FNR=2</span></span><br><span class="line"><span class="comment"># data31 FNR=3</span></span><br><span class="line"><span class="comment"># data11 FNR=1</span></span><br><span class="line"><span class="comment"># data21 FNR=2</span></span><br><span class="line"><span class="comment"># data31 FNR=3</span></span><br></pre></td></tr></table></figure>

<p>NR 则是将所有的传入数据一起统计的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125;                            </span></span><br><span class="line"><span class="string">quote&gt; &#123;print $1, &quot;FNR=&quot;FNR, &quot;NR=&quot;NR&#125;</span></span><br><span class="line"><span class="string">quote&gt; END&#123;print &quot;There were&quot;, NR, &quot;records processed&quot;&#125;&#x27;</span> data1 data1</span><br><span class="line"><span class="comment"># data11 FNR=1 NR=1</span></span><br><span class="line"><span class="comment"># data21 FNR=2 NR=2</span></span><br><span class="line"><span class="comment"># data31 FNR=3 NR=3</span></span><br><span class="line"><span class="comment"># data11 FNR=1 NR=4</span></span><br><span class="line"><span class="comment"># data21 FNR=2 NR=5</span></span><br><span class="line"><span class="comment"># data31 FNR=3 NR=6</span></span><br><span class="line"><span class="comment"># There were 6 records processed</span></span><br></pre></td></tr></table></figure>

<p>单个文件处理时 FNR 和 NR 是一致的，多个文件处理时不一样</p>
<h4 id="User-defined-variables"><a href="#User-defined-variables" class="headerlink" title="User-defined variables"></a>User-defined variables</h4><p>gawk 自第一变量不能以数字开头，大小写敏感</p>
<h5 id="Assigning-variables-in-scripts"><a href="#Assigning-variables-in-scripts" class="headerlink" title="Assigning variables in scripts"></a>Assigning variables in scripts</h5><p>使用方式了 shell 中一致, 下面例子中我们将数字，字符赋值给变量，而且支持计算</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;             </span></span><br><span class="line"><span class="string">quote&gt; BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; testing=&quot;This is a test&quot;</span></span><br><span class="line"><span class="string">quote&gt; print testing                            </span></span><br><span class="line"><span class="string">quote&gt; testing=45        </span></span><br><span class="line"><span class="string">quote&gt; print testing                            </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># This is a test</span></span><br><span class="line"><span class="comment"># 45</span></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;x=4; x=x*2+3; print x&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 11</span></span><br></pre></td></tr></table></figure>

<h5 id="Assigning-variables-on-the-command-line"><a href="#Assigning-variables-on-the-command-line" class="headerlink" title="Assigning variables on the command line"></a>Assigning variables on the command line</h5><p>支持从终端接受参数的形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat script1               </span><br><span class="line"><span class="comment"># BEGIN&#123;FS=&quot;,&quot;&#125;</span></span><br><span class="line"><span class="comment"># &#123;print $n&#125;</span></span><br><span class="line"></span><br><span class="line">gawk -f script1 n=2 data1                                      </span><br><span class="line"><span class="comment"># data12</span></span><br><span class="line"><span class="comment"># data22</span></span><br><span class="line"><span class="comment"># data32</span></span><br><span class="line">gawk -f script1 n=3 data1</span><br><span class="line"><span class="comment"># data13</span></span><br><span class="line"><span class="comment"># data23</span></span><br><span class="line"><span class="comment"># data33</span></span><br></pre></td></tr></table></figure>

<p>开起来挺好的，但是这里有一个问题，终端传入的参数，BEGIN 里面是访问不到的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat script2                    </span><br><span class="line"><span class="comment"># BEGIN&#123;print &quot;The starting value is&quot;, n; FS=&quot;,&quot;&#125;</span></span><br><span class="line"><span class="comment"># &#123;print $n&#125;</span></span><br><span class="line"></span><br><span class="line">gawk -f script2 n=3 data1</span><br><span class="line"><span class="comment"># The starting value is </span></span><br><span class="line"><span class="comment"># data13</span></span><br><span class="line"><span class="comment"># data23</span></span><br><span class="line"><span class="comment"># data33</span></span><br></pre></td></tr></table></figure>

<p>你可以用 -v 参数解决这个问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gawk -v n=3 -f script2 data1</span><br><span class="line"><span class="comment"># The starting value is 3</span></span><br><span class="line"><span class="comment"># data13</span></span><br><span class="line"><span class="comment"># data23</span></span><br><span class="line"><span class="comment"># data33</span></span><br></pre></td></tr></table></figure>

<h3 id="Working-with-Arrays"><a href="#Working-with-Arrays" class="headerlink" title="Working with Arrays"></a>Working with Arrays</h3><p>和很多其他语言一样，gawk 提供了 array 相关的功能，叫做 associative arrays. 个人感觉可以叫做 map, 行为方式是根据键拿值</p>
<h4 id="Defining-array-variables"><a href="#Defining-array-variables" class="headerlink" title="Defining array variables"></a>Defining array variables</h4><p>格式 <code>var[index] = element</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">captial[&quot;Illinois&quot;] = &quot;Springfield&quot;</span></span><br><span class="line"><span class="string">print captial[&quot;Illinois&quot;]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Springfield</span></span><br></pre></td></tr></table></figure>

<p>对数字也有效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; var[1] = 34                         </span></span><br><span class="line"><span class="string">quote&gt; var[2] = 3                          </span></span><br><span class="line"><span class="string">quote&gt; total = var[1] + var[2]</span></span><br><span class="line"><span class="string">quote&gt; print total                              </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># 37</span></span><br></pre></td></tr></table></figure>

<h4 id="Iterating-through-array-variables"><a href="#Iterating-through-array-variables" class="headerlink" title="Iterating through array variables"></a>Iterating through array variables</h4><p>gawk 中遍历 map 的语法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (var <span class="keyword">in</span> arry)</span><br><span class="line">&#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>遍历 map 的示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; var[&quot;a&quot;] = 1                        </span></span><br><span class="line"><span class="string">quote&gt; var[&quot;g&quot;] = 2</span></span><br><span class="line"><span class="string">quote&gt; var[&quot;m&quot;] = 3</span></span><br><span class="line"><span class="string">quote&gt; var[&quot;u&quot;] = 4</span></span><br><span class="line"><span class="string">quote&gt; for (test in var)            </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; print &quot;index:&quot;, test, &quot; - value:&quot;, var[test]</span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># index: u  - value: 4</span></span><br><span class="line"><span class="comment"># index: m  - value: 3</span></span><br><span class="line"><span class="comment"># index: a  - value: 1</span></span><br><span class="line"><span class="comment"># index: g  - value: 2</span></span><br></pre></td></tr></table></figure>

<p>背后的实现和 hash 一样，不保证顺序</p>
<h4 id="Deleting-array-variables"><a href="#Deleting-array-variables" class="headerlink" title="Deleting array variables"></a>Deleting array variables</h4><p>语法：delete array[index]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">var[&quot;a&quot;] = 1</span></span><br><span class="line"><span class="string">var[&quot;g&quot;] = 2</span></span><br><span class="line"><span class="string">for (test in var)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    print &quot;Index:&quot;, test, &quot; - Value:&quot;, var[test]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">delete var[&quot;g&quot;]             </span></span><br><span class="line"><span class="string">print &quot;---&quot;                              </span></span><br><span class="line"><span class="string">for (test in var)   </span></span><br><span class="line"><span class="string">    print &quot;Index:&quot;, test, &quot; - Value:&quot;, var[test]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Index: a  - Value: 1</span></span><br><span class="line"><span class="comment"># Index: g  - Value: 2</span></span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line"><span class="comment"># Index: a  - Value: 1</span></span><br></pre></td></tr></table></figure>

<p>PS: 原来他也支持单行 for 循环吗。。。</p>
<h3 id="Using-Patterns"><a href="#Using-Patterns" class="headerlink" title="Using Patterns"></a>Using Patterns</h3><p>本章介绍如何定义 pattern</p>
<h4 id="Regular-expressions"><a href="#Regular-expressions" class="headerlink" title="Regular expressions"></a>Regular expressions</h4><p>gawk 同时支持 BRE 和 ERE，正则要保证出现在 program script 之前</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; /11/&#123;print $1&#125;&#x27;</span> data1    </span><br><span class="line"><span class="comment"># data11</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; /,d/&#123;print $1&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11</span></span><br><span class="line"><span class="comment"># data21</span></span><br><span class="line"><span class="comment"># data31</span></span><br></pre></td></tr></table></figure>

<h4 id="The-matching-operator"><a href="#The-matching-operator" class="headerlink" title="The matching operator"></a>The matching operator</h4><p>gawk 使用波浪线(~)表示匹配的动作，格式 <code>$1 ~ /^data/</code>. 下面的例子中，我们适配所有出现在 $2 这个位置上的 field， 以 data2 开头的即使我们寻在的目标</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; $2 ~ /^data2/&#123;print $0&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data21,data22,data23,data24,data25</span></span><br></pre></td></tr></table></figure>

<p>这个技巧在 gawk 中经常被用到, 下面是在 passwd 文件中寻找包含 root 关键字的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gawk -F: <span class="string">&#x27;$1 ~/root/&#123;print $1, $NF&#125;&#x27;</span> /etc/passwd               </span><br><span class="line"><span class="comment"># root /bin/sh</span></span><br><span class="line"><span class="comment"># _cvmsroot /usr/bin/false</span></span><br></pre></td></tr></table></figure>

<p>这个操作还支持取反 <code>$1 !~ /expression/</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; $2 !~ /^data2/&#123;print $0&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11,data12,data13,data14,data15</span></span><br><span class="line"><span class="comment"># data31,data32,data33,data34,data35</span></span><br></pre></td></tr></table></figure>

<h4 id="Mathematical-expressions"><a href="#Mathematical-expressions" class="headerlink" title="Mathematical expressions"></a>Mathematical expressions</h4><p>gawk 还支持直接在表达式中做计算的, 下面的例子中我们统计 group 等于 0 的用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk -F: <span class="string">&#x27;$4 == 0&#123;print $1&#125;&#x27;</span> /etc/passwd           </span><br><span class="line"><span class="comment"># root</span></span><br></pre></td></tr></table></figure>

<p>支持的算数表达式</p>
<ul>
<li>x == y: Value x is equal to y</li>
<li>x &lt;= y</li>
<li>x &lt; y</li>
<li>x &gt;=y</li>
<li>x &gt; y</li>
</ul>
<p><code>==</code> 也可以用于文字表示式，但是表示的是精确匹配</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gawk -F, <span class="string">&#x27;$1 == &quot;data&quot;&#123;print $1&#125;&#x27;</span> data1  </span><br><span class="line"><span class="comment"># no match</span></span><br><span class="line">gawk -F, <span class="string">&#x27;$1 == &quot;data11&quot;&#123;print $1&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11</span></span><br></pre></td></tr></table></figure>

<h3 id="Structured-Commands"><a href="#Structured-Commands" class="headerlink" title="Structured Commands"></a>Structured Commands</h3><p>结构化脚本</p>
<h4 id="The-if-statement"><a href="#The-if-statement" class="headerlink" title="The if statement"></a>The if statement</h4><p>支持 if-then-else 语法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition)</span><br><span class="line">    statement1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一行的格式也 OK</span></span><br><span class="line"><span class="keyword">if</span> (condition) statement1</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat data4 </span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 13</span></span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 34</span></span><br><span class="line">gawk <span class="string">&#x27;&#123;if ($1 &gt; 20) print $1&#125;&#x27;</span> data4               </span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 34</span></span><br></pre></td></tr></table></figure>

<p>如果 if 有多个条件，需要用花括号包裹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;                             </span></span><br><span class="line"><span class="string">quote&gt; if ($1 &gt; 20)             </span></span><br><span class="line"><span class="string">quote&gt; &#123; </span></span><br><span class="line"><span class="string">quote&gt; x = $1 * 2                              </span></span><br><span class="line"><span class="string">quote&gt; print x                                  </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data4</span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 68</span></span><br></pre></td></tr></table></figure>

<p>带 else 的例子</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">quote&gt; if ($1 &gt; 20)             </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; x = $1 * 2                              </span></span><br><span class="line"><span class="string">quote&gt; print x                                  </span></span><br><span class="line"><span class="string">quote&gt; &#125; else </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; x = $1 / 2                              </span></span><br><span class="line"><span class="string">quote&gt; print x                                  </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#125;&#x27;</span> data4</span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 2.5</span></span><br><span class="line"><span class="comment"># 6.5</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 68</span></span><br></pre></td></tr></table></figure>

<p>也可以写在一行, 格式 <code>if (condition) statement1; else statement2</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;if ($1 &gt; 20) print $1 * 2; else print $1 /2&#125;&#x27;</span> data4</span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 2.5</span></span><br><span class="line"><span class="comment"># 6.5</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 68</span></span><br></pre></td></tr></table></figure>

<h4 id="The-while-statement"><a href="#The-while-statement" class="headerlink" title="The while statement"></a>The while statement</h4><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (condition)</span><br><span class="line">&#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat data5 </span><br><span class="line"><span class="comment"># 130 120 135</span></span><br><span class="line"><span class="comment"># 160 113 140</span></span><br><span class="line"><span class="comment"># 145 170 215</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">total = 0</span></span><br><span class="line"><span class="string">i = 1</span></span><br><span class="line"><span class="string">while (i&lt;4)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">total += $i</span></span><br><span class="line"><span class="string">i++</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">avg = total / 3</span></span><br><span class="line"><span class="string">print &quot;Average:&quot;, avg</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data5</span><br><span class="line"><span class="comment"># Average: 128.333</span></span><br><span class="line"><span class="comment"># Average: 137.667</span></span><br><span class="line"><span class="comment"># Average: 176.667</span></span><br></pre></td></tr></table></figure>

<p>支持 break，continue 打断循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">quote&gt; total = 0      </span></span><br><span class="line"><span class="string">quote&gt; i = 1   </span></span><br><span class="line"><span class="string">quote&gt; while (i&lt;4)                                  </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt;      total += $i    </span></span><br><span class="line"><span class="string">quote&gt;      if (i == 2)              </span></span><br><span class="line"><span class="string">quote&gt;           break             </span></span><br><span class="line"><span class="string">quote&gt;      i++     </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; avg = total/2                                                          </span></span><br><span class="line"><span class="string">quote&gt; print &quot;The average of the first two data is:&quot; , avg</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data5</span><br><span class="line"><span class="comment"># The average of the first two data is: 125</span></span><br><span class="line"><span class="comment"># The average of the first two data is: 136.5</span></span><br><span class="line"><span class="comment"># The average of the first two data is: 157.5</span></span><br></pre></td></tr></table></figure>

<h4 id="The-do-while-statement"><a href="#The-do-while-statement" class="headerlink" title="The do-while statement"></a>The do-while statement</h4><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    statemnets</span><br><span class="line">&#125; <span class="keyword">while</span> (condition)</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">quote&gt; total = 0      </span></span><br><span class="line"><span class="string">quote&gt; i = 1   </span></span><br><span class="line"><span class="string">quote&gt; do                          </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; total += $i    </span></span><br><span class="line"><span class="string">quote&gt; i++     </span></span><br><span class="line"><span class="string">quote&gt; &#125; while (total &lt; 150)</span></span><br><span class="line"><span class="string">quote&gt; print total &#125;&#x27;</span> data5                     </span><br><span class="line"><span class="comment"># 250</span></span><br><span class="line"><span class="comment"># 160</span></span><br><span class="line"><span class="comment"># 315</span></span><br></pre></td></tr></table></figure>

<h4 id="The-for-statement"><a href="#The-for-statement" class="headerlink" title="The for statement"></a>The for statement</h4><p>格式 <code>for( variable assignment; condition; iteration process)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">quote&gt; total = 0      </span></span><br><span class="line"><span class="string">quote&gt; for  (i=1; i&lt;4; i++)</span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; total += $i    </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; avg = total /3                                                           </span></span><br><span class="line"><span class="string">quote&gt; print &quot;Average:&quot;, avg                    </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data5</span><br><span class="line"><span class="comment"># Average: 128.333</span></span><br><span class="line"><span class="comment"># Average: 137.667</span></span><br><span class="line"><span class="comment"># Average: 176.667</span></span><br></pre></td></tr></table></figure>

<h3 id="Formatted-Printing"><a href="#Formatted-Printing" class="headerlink" title="Formatted Printing"></a>Formatted Printing</h3><p>gawk 使用 printf 格式化输出 <code>printf &quot;format string&quot;, var1, var2...</code></p>
<p>format string 是格式化输出的关键，采用的 C 语言相同的 printf 功能。格式为 <code>%[modifier]control-letter</code></p>
<p>Format Specifier Control Letters</p>
<table>
<thead>
<tr>
<th align="left">Control Letter</th>
<th align="left">Desciption</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c</td>
<td align="left">Displays a number as an ASCII character</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">Displays an integer value</td>
</tr>
<tr>
<td align="left">i</td>
<td align="left">Displays an integer value(same as d)</td>
</tr>
<tr>
<td align="left">e</td>
<td align="left">Displays a number in scientific notation</td>
</tr>
<tr>
<td align="left">f</td>
<td align="left">Displays a floating-point value</td>
</tr>
<tr>
<td align="left">g</td>
<td align="left">Displays eigher scientific notation or floating point, whichever is shorter</td>
</tr>
<tr>
<td align="left">o</td>
<td align="left">Displays an octal value</td>
</tr>
<tr>
<td align="left">s</td>
<td align="left">Displays a text string</td>
</tr>
<tr>
<td align="left">x</td>
<td align="left">Displays a hexadecimal value</td>
</tr>
<tr>
<td align="left">X</td>
<td align="left">Displays a hexadecimal value, but using capital letters for A through F</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;                                       </span></span><br><span class="line"><span class="string">quote&gt; x = 1 * 100                              </span></span><br><span class="line"><span class="string">quote&gt; printf &quot;The answer is: %e\n&quot;, x</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># The answer is: 1.000000e+02</span></span><br></pre></td></tr></table></figure>

<p>出来上面的控制符外，printf 还提供了另外三个控制项</p>
<ul>
<li>width, 控制宽度，小于设定值，给出空格补全，大于则用实际值覆盖</li>
<li>prec, </li>
<li>-(minus sign) 强制左对齐</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;print $1, $4&#125;&#x27;</span> data2</span><br><span class="line"><span class="comment"># Riley Mullen (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell (313)555-4938</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;printf &quot;%s %s \n&quot;, $1, $4&#125;&#x27;</span> data2</span><br><span class="line"><span class="comment"># Riley Mullen (312)555-1234 </span></span><br><span class="line"><span class="comment"># Frank Williams (317)555-9876 </span></span><br><span class="line"><span class="comment"># Haley Snell (313)555-4938</span></span><br></pre></td></tr></table></figure>

<p>如果用 printf 需要自己打印换行符号，这种设定当你想讲多行数据放在一行的时候就很好使</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; &#123;printf &quot;%s &quot;, $1&#125; END&#123;printf &quot;\n&quot;&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11 data21 data31</span></span><br></pre></td></tr></table></figure>

<p>下面的例子我们通过 modifier 格式化名字这个字段</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;printf &quot;%16s %s\n &quot;, $1, $4&#125;&#x27;</span> data2</span><br><span class="line"><span class="comment">#     Riley Mullen (312)555-1234</span></span><br><span class="line"><span class="comment">#    Frank Williams (317)555-9876</span></span><br><span class="line"><span class="comment">#       Haley Snell (313)555-4938</span></span><br></pre></td></tr></table></figure>

<p>默认是右对齐的，可以使用 minus sign 来左对齐</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gawk &#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;printf &quot;%-16s %s\n &quot;, $1, $4&#125;&#x27; data2Riley Mullen     (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams   (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell      (313)555-4938</span></span><br></pre></td></tr></table></figure>

<p>格式化浮点类型</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;                                                          </span></span><br><span class="line"><span class="string">quote&gt; total = 0      </span></span><br><span class="line"><span class="string">quote&gt; for (i=0; i&lt;4; i++)          </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; total += $i    </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; avg = total / 3                                                          </span></span><br><span class="line"><span class="string">quote&gt; printf &quot;Average: %5.1f\n&quot;, avg</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data5</span><br><span class="line"><span class="comment"># Average: 171.7</span></span><br><span class="line"><span class="comment"># Average: 191.0</span></span><br><span class="line"><span class="comment"># Average: 225.0</span></span><br></pre></td></tr></table></figure>

<h3 id="Built-In-Functions"><a href="#Built-In-Functions" class="headerlink" title="Built-In Functions"></a>Built-In Functions</h3><p>gawk 提供了不少的内建函数帮助你完成一些特定功能。</p>
<h4 id="Mathematical-functions"><a href="#Mathematical-functions" class="headerlink" title="Mathematical functions"></a>Mathematical functions</h4><p>The gawk Mathematical Functions</p>
<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">atan2(x, y)</td>
<td align="left">The arctangent of x/y, with x and y specified in radians</td>
</tr>
<tr>
<td align="left">cos(x)</td>
<td align="left">The cosine of x, with x specified in radians</td>
</tr>
<tr>
<td align="left">exp(x)</td>
<td align="left">The exponential of x</td>
</tr>
<tr>
<td align="left">int(x)</td>
<td align="left">The integer part of x, truncated toward 0</td>
</tr>
<tr>
<td align="left">log(x)</td>
<td align="left">The natural logarithm of x</td>
</tr>
<tr>
<td align="left">rand()</td>
<td align="left">A random floating point value larger thant 0 and less than 1</td>
</tr>
<tr>
<td align="left">sin(x)</td>
<td align="left">The sine of x, with x specified in radians</td>
</tr>
<tr>
<td align="left">sqrt(x)</td>
<td align="left">The square root of x</td>
</tr>
<tr>
<td align="left">srand(x)</td>
<td align="left">Specifies a seed value for calculating random numbers</td>
</tr>
</tbody></table>
<p>gawk 是有计算上线的，比如 exp(1000) 就会抛错</p>
<p>gawk 还提供了位运算</p>
<ul>
<li>and(v1, v2)</li>
<li>compl(val) 补全</li>
<li>lshift(val, count) 左移</li>
<li>or(v1, v2)</li>
<li>rshift(val, count)</li>
<li>xor(v1, v2) 异或</li>
</ul>
<h4 id="String-functions"><a href="#String-functions" class="headerlink" title="String functions"></a>String functions</h4><p>支持一些常规的字符操作，比如排序，截取，匹配，分割等</p>
<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">split(s, r [,a])</td>
<td align="left">This function splits s into array a using the FS character, or the regular expression r if supplied. It returns the number of fields</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;x=&quot;testing&quot;; print toupper(x); print length(x)&#125;&#x27;</span></span><br><span class="line"><span class="comment"># TESTING</span></span><br><span class="line"><span class="comment"># 7</span></span><br></pre></td></tr></table></figure>

<p>sort 比较复杂, 下面的 asort 例子中，我们将原始 map 和输出结果 test 传给 asort 然后遍历打印 test. 打印时可以看到，原来的字母 index 被替换成了数字</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">var[&quot;a&quot;] = 1</span></span><br><span class="line"><span class="string">var[&quot;g&quot;] = 2</span></span><br><span class="line"><span class="string">var[&quot;m&quot;] = 3</span></span><br><span class="line"><span class="string">var[&quot;u&quot;] = 4</span></span><br><span class="line"><span class="string">asort(var, test)</span></span><br><span class="line"><span class="string">for (i in test)</span></span><br><span class="line"><span class="string">print &quot;Index:&quot;, i, &quot; - value:&quot;, test[i]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Index: 1  - value: 1</span></span><br><span class="line"><span class="comment"># Index: 2  - value: 2</span></span><br><span class="line"><span class="comment"># Index: 3  - value: 3</span></span><br><span class="line"><span class="comment"># Index: 4  - value: 4</span></span><br></pre></td></tr></table></figure>

<p>下面是 split 的测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat data1</span><br><span class="line"><span class="comment"># data11,data12,data13,data14,data15</span></span><br><span class="line"><span class="comment"># data21,data22,data23,data24,data25</span></span><br><span class="line"><span class="comment"># data31,data32,data33,data34,data35</span></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125;&#123;</span></span><br><span class="line"><span class="string">split($0, var)</span></span><br><span class="line"><span class="string">    print var[1], var[5]                     </span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11 data15</span></span><br><span class="line"><span class="comment"># data21 data25</span></span><br><span class="line"><span class="comment"># data31 data35</span></span><br></pre></td></tr></table></figure>

<h4 id="Time-functions"><a href="#Time-functions" class="headerlink" title="Time functions"></a>Time functions</h4><table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mktime(datespec)</td>
<td align="left">Converts a date specified in the format YYYY NN DD HH MM SS[DST] into a timestamp value</td>
</tr>
<tr>
<td align="left">strftime(format[,timestamp])</td>
<td align="left">Formats either the current time of day timestamp, or timestamp if provided, into a formatted data and date, using the date() shell function format</td>
</tr>
<tr>
<td align="left">systime()</td>
<td align="left">Returns the timestamp for the current time of day</td>
</tr>
</tbody></table>
<p>时间函数在处理带时间相关的 log 文件时很有用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;        </span></span><br><span class="line"><span class="string">quote&gt; date = systime()            </span></span><br><span class="line"><span class="string">quote&gt; day = strftime(&quot;%A, %B %d, %Y&quot;, date)</span></span><br><span class="line"><span class="string">quote&gt; print day                                </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># Tuesday, June 15, 2021</span></span><br></pre></td></tr></table></figure>

<h3 id="User-Defined-Functions"><a href="#User-Defined-Functions" class="headerlink" title="User-Defined Functions"></a>User-Defined Functions</h3><h4 id="Defining-a-function"><a href="#Defining-a-function" class="headerlink" title="Defining a function"></a>Defining a function</h4><p>语法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> name([variables])</span><br><span class="line">&#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> printthird()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="variable">$3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>允许返回值 <code>return value</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> myrand(<span class="built_in">limit</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> int(<span class="built_in">limit</span> * rand())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Using-your-functions"><a href="#Using-your-functions" class="headerlink" title="Using your functions"></a>Using your functions</h4><p>当你定义一个函数的时候，它必须在最开始部分(before BEGIN).</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;      </span></span><br><span class="line"><span class="string">quote&gt; function myprint()                 </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; printf &quot;%-16s - %s\n&quot;, $1, $4                                          </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125;</span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; myprint()</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data2</span><br><span class="line"><span class="comment"># Riley Mullen     - (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams   - (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell      - (313)555-4938</span></span><br></pre></td></tr></table></figure>

<h4 id="Creating-a-function-library"><a href="#Creating-a-function-library" class="headerlink" title="Creating a function library"></a>Creating a function library</h4><ol>
<li>为自定义还是创建库</li>
<li>将 gawk 脚本也存到文件中</li>
<li>在终端同时调用两个脚本</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat funclib </span><br><span class="line"><span class="comment"># function myprint()</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     printf &quot;%-16s - %s\n&quot;, $1, $4</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># function myrand(limit)</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     return int(limit * rand())</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># function printthird()</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     print $3</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">cat script4</span><br><span class="line"><span class="comment"># BEGIN&#123; FS=&quot;\n&quot;; RS=&quot;&quot;&#125;</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     myprint()</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">gawk -f funclib -f script4 data2         </span><br><span class="line"><span class="comment"># Riley Mullen     - (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams   - (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell      - (313)555-4938</span></span><br></pre></td></tr></table></figure>

<h3 id="Working-through-a-Practical-Example"><a href="#Working-through-a-Practical-Example" class="headerlink" title="Working through a Practical Example"></a>Working through a Practical Example</h3><p>When work with data files, the key is to first group related data records together and then perform any calculations required on the related data.</p>
<p>下面是一个保龄球得分统计的例子, 每一行分别包含 名字，组名，得分 的信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat scores.txt </span><br><span class="line"><span class="comment"># Rich Blum,team1,100,115,95</span></span><br><span class="line"><span class="comment"># Barbara Blum,team1,110,115,100</span></span><br><span class="line"><span class="comment"># Christine Bresnahan,team2,120,115,118</span></span><br><span class="line"><span class="comment"># Tim Bresnahan,team2,125,112,116</span></span><br></pre></td></tr></table></figure>

<p>目标：统计每个 team 的总分以及平均分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat bowling.sh                               </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> team <span class="keyword">in</span> $(gawk -F, <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> scores.txt | uniq)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    gawk -v team=<span class="variable">$team</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">    BEGIN&#123; FS=&quot;,&quot;; total=0 &#125;</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        if ($2==team)</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            total += $3 + $4 + $5;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    END &#123;</span></span><br><span class="line"><span class="string">        avg = total/6;</span></span><br><span class="line"><span class="string">        print &quot;Total for&quot;, team, &quot;is&quot;, total, &quot;, the average is&quot;,avg</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &#x27;</span> scores.txt</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./bowling.sh </span><br><span class="line"><span class="comment"># Total for team1 is 635 , the average is 105.833</span></span><br><span class="line"><span class="comment"># Total for team2 is 706 , the average is 117.667</span></span><br></pre></td></tr></table></figure>

<p>计算方法：先遍历文件，取得所有的组名，然后再每个组名遍历一遍文件统计一次，打印一次。一开始我还以为可以一次对结果做分类统计的，如果是每次循环的话，还是很容易理解的</p>
<h2 id="Working-with-Alternative-Shells"><a href="#Working-with-Alternative-Shells" class="headerlink" title="Working with Alternative Shells"></a>Working with Alternative Shells</h2><p>介绍除 bash 外其他一些常见的 shell, 暂时不关心，pass</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/31/LSCASSB-parti-the-linux-command-line/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/31/LSCASSB-parti-the-linux-command-line/" class="post-title-link" itemprop="url">Linux命令行与shell脚本编程大全 第一章 Linux 命令行</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-31 10:04:57" itemprop="dateCreated datePublished" datetime="2021-05-31T10:04:57+08:00">2021-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Shell</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>26 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Chapter-1-Starting-with-Linux-Shells"><a href="#Chapter-1-Starting-with-Linux-Shells" class="headerlink" title="Chapter 1: Starting with Linux Shells"></a>Chapter 1: Starting with Linux Shells</h2><h3 id="What-Is-Linux"><a href="#What-Is-Linux" class="headerlink" title="What Is Linux"></a>What Is Linux</h3><p>Linux 系统主要由一下 4 部分组成</p>
<ul>
<li>The Linux kernel</li>
<li>The GUN utilities</li>
<li>A graphical desktop environment</li>
<li>Application software</li>
</ul>
<h4 id="Looking-into-the-Linux-Kernel"><a href="#Looking-into-the-Linux-Kernel" class="headerlink" title="Looking into the Linux Kernel"></a>Looking into the Linux Kernel</h4><p>Linux 系统的核心就是 kernel，它起到调度硬件软件资源的作用。</p>
<p>kernel 有四个主要的功能</p>
<ul>
<li>System memory management</li>
<li>Software program management</li>
<li>Hardware management</li>
<li>Filesystem management</li>
</ul>
<h5 id="System-Memory-management"><a href="#System-Memory-management" class="headerlink" title="System Memory management"></a>System Memory management</h5><p>下面的内容和操作系统相关，很多概念我都不是很感兴趣，可以先跳过</p>
<h2 id="Chapter-2-Getting-to-the-Shell"><a href="#Chapter-2-Getting-to-the-Shell" class="headerlink" title="Chapter 2: Getting to the Shell"></a>Chapter 2: Getting to the Shell</h2><p>终端介绍，跳过</p>
<h2 id="Chapter-3-Basic-bash-Shell-Commands"><a href="#Chapter-3-Basic-bash-Shell-Commands" class="headerlink" title="Chapter 3: Basic bash Shell Commands"></a>Chapter 3: Basic bash Shell Commands</h2><h3 id="Interacting-with-the-bash-Manual"><a href="#Interacting-with-the-bash-Manual" class="headerlink" title="Interacting with the bash Manual"></a>Interacting with the bash Manual</h3><p>man page 的结构如下</p>
<table>
<thead>
<tr>
<th align="left">Section</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Name</td>
<td align="left">Displays command name and a short description</td>
</tr>
<tr>
<td align="left">Syopsis</td>
<td align="left">Shows command syntax</td>
</tr>
<tr>
<td align="left">Configuration</td>
<td align="left">Provides configuration information</td>
</tr>
<tr>
<td align="left">Description</td>
<td align="left">Describes command generally</td>
</tr>
<tr>
<td align="left">Options</td>
<td align="left">Describes command option(s)</td>
</tr>
<tr>
<td align="left">Exit Status</td>
<td align="left">Defines command exit status indicator(s)</td>
</tr>
<tr>
<td align="left">Return Value</td>
<td align="left">describes command return value(s)</td>
</tr>
<tr>
<td align="left">Errors</td>
<td align="left">Provides command return value(s)</td>
</tr>
<tr>
<td align="left">Environment</td>
<td align="left">Describes envrionment variable(s) used</td>
</tr>
<tr>
<td align="left">Files</td>
<td align="left">Defines files used by command</td>
</tr>
<tr>
<td align="left">Versions</td>
<td align="left">Describes command version information</td>
</tr>
<tr>
<td align="left">Conforming To</td>
<td align="left">Provides standards followed</td>
</tr>
<tr>
<td align="left">Notes</td>
<td align="left">Describes additional helpful command material</td>
</tr>
<tr>
<td align="left">Bugs</td>
<td align="left">Provides the location to report found buds</td>
</tr>
<tr>
<td align="left">Example</td>
<td align="left">Shows command use examples</td>
</tr>
<tr>
<td align="left">Authors</td>
<td align="left">Provides information on command developers</td>
</tr>
<tr>
<td align="left">Copyright</td>
<td align="left">Defines command code copyright status</td>
</tr>
<tr>
<td align="left">See Also</td>
<td align="left">Refers similar available commands</td>
</tr>
</tbody></table>
<h3 id="Navigating-the-Filesystem"><a href="#Navigating-the-Filesystem" class="headerlink" title="Navigating the Filesystem"></a>Navigating the Filesystem</h3><p>常见的目录及用途</p>
<table>
<thead>
<tr>
<th align="left">Directory</th>
<th align="left">Usage</th>
</tr>
</thead>
<tbody><tr>
<td align="left">/</td>
<td align="left">root of the virtual directory, where normally, no files are placed</td>
</tr>
<tr>
<td align="left">/bin</td>
<td align="left">binary directory, where GNU user-level utilities are stored</td>
</tr>
<tr>
<td align="left">/boot</td>
<td align="left">boot directory, where boot files are stored</td>
</tr>
<tr>
<td align="left">/dev</td>
<td align="left">device directory, where Linux creates device nodes</td>
</tr>
<tr>
<td align="left">/etc</td>
<td align="left">system configuration files directory</td>
</tr>
<tr>
<td align="left">/home</td>
<td align="left">home directory, where Linux creates user directories</td>
</tr>
<tr>
<td align="left">/lib</td>
<td align="left">library directory, where system and application library files are stored</td>
</tr>
<tr>
<td align="left">/media</td>
<td align="left">media directory, a common place for mount points used for removable media</td>
</tr>
<tr>
<td align="left">/mnt</td>
<td align="left">mount directory, another common place for mount points used for removable media</td>
</tr>
<tr>
<td align="left">/opt</td>
<td align="left">optional directory, often used to store third-part software packages and data files</td>
</tr>
<tr>
<td align="left">/proc</td>
<td align="left">process directory, where current hardware and process information is stored</td>
</tr>
<tr>
<td align="left">/root</td>
<td align="left">root home directory</td>
</tr>
<tr>
<td align="left">/sbin</td>
<td align="left">system binary directory, where many GNU admin-level utilities are stored</td>
</tr>
<tr>
<td align="left">/run</td>
<td align="left">run directory, where runtime data is held during system operation</td>
</tr>
<tr>
<td align="left">/srv</td>
<td align="left">service directory, where local services stre their files</td>
</tr>
<tr>
<td align="left">/sys</td>
<td align="left">system directory, where system hardware information files are stored</td>
</tr>
<tr>
<td align="left">/tmp</td>
<td align="left">temporary directory, where temporary work files can be crated and destroyed</td>
</tr>
<tr>
<td align="left">/usr</td>
<td align="left">user binary directory, where the bulk of GUN user-level utilities and data files are stored</td>
</tr>
<tr>
<td align="left">/var</td>
<td align="left">variable directory, for files that change frequently, such as log files</td>
</tr>
</tbody></table>
<h3 id="Listing-Files-and-Directories"><a href="#Listing-Files-and-Directories" class="headerlink" title="Listing Files and Directories"></a>Listing Files and Directories</h3><h4 id="Displaying-a-basic-list"><a href="#Displaying-a-basic-list" class="headerlink" title="Displaying a basic list"></a>Displaying a basic list</h4><p>展示文件命令 <code>ls</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果终端没有配置颜色，使用 -F 区分文件和文件夹,可执行文件后会加 *</span></span><br><span class="line">ls -F</span><br><span class="line"><span class="comment"># test3b.sh*      tmp_folder/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -a 显示所有文件，包括隐藏文件</span></span><br><span class="line">ls -a</span><br><span class="line"><span class="comment"># . npm  Documents</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -R 循环显示子目录</span></span><br><span class="line">ls -F -R</span><br><span class="line"><span class="comment"># badtest*        nohup.out       search.xml      search.xml.bak  tmp_folder/</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ./tmp_folder:</span></span><br><span class="line"><span class="comment"># test1.sh*       test10b.out</span></span><br></pre></td></tr></table></figure>

<h4 id="Displaying-a-long-listing"><a href="#Displaying-a-long-listing" class="headerlink" title="Displaying a long listing"></a>Displaying a long listing</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Displaying a long list</span></span><br><span class="line">ls -l</span><br><span class="line"><span class="comment"># total 10112</span></span><br><span class="line"><span class="comment"># -rwxr--r--   1 i306454  staff      159 May 30 15:56 badtest</span></span><br><span class="line"><span class="comment"># -rw-------   1 i306454  staff      138 Jun  2 19:12 nohup.out</span></span><br></pre></td></tr></table></figure>

<p>long list 显示格式说明</p>
<ul>
<li>The file type, directory(d), regular file(-), linked file(l), character device(c) or block device(b)</li>
<li>The file permissions</li>
<li>The number of file hard links</li>
<li>The file owner username</li>
<li>The file primary group name</li>
<li>The file byte size</li>
<li>The last time file was modified</li>
<li>The filename or directory name</li>
</ul>
<p>long list 是一个比较强力的模式，你可以收集到很多信息</p>
<h4 id="Filtering-listing-output"><a href="#Filtering-listing-output" class="headerlink" title="Filtering listing output"></a>Filtering listing output</h4><p>过滤文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l bad*</span><br><span class="line"><span class="comment"># -rwxr--r--  1 i306454  staff  159 May 30 15:56 badtest</span></span><br></pre></td></tr></table></figure>

<p>可用的过滤符</p>
<ul>
<li>? 单个字符</li>
<li>* 多个字符</li>
<li>[] 多选，可以是 [ai], [a-i],[!a]</li>
</ul>
<p>使用星号的过滤方法也叫做 file globbing</p>
<h3 id="Handling-Files"><a href="#Handling-Files" class="headerlink" title="Handling Files"></a>Handling Files</h3><p>过一下常用的文件处理命令</p>
<h4 id="Creating-files"><a href="#Creating-files" class="headerlink" title="Creating files"></a>Creating files</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># touch 创建空文件</span></span><br><span class="line">touch test_one</span><br><span class="line">ls -l test_one</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  0 Jun  4 11:25 test_one</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以在不改变文件内容的情况下更新最后改动时间，这个之前倒是不知道</span></span><br><span class="line">ls -l test_one </span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  3 Jun  4 11:27 test_one</span></span><br><span class="line">touch test_one </span><br><span class="line">ls -l test_one </span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  3 Jun  4 11:29 test_one</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -a 只修改最近访问时间</span></span><br><span class="line">ls -a test_one</span><br><span class="line"><span class="comment"># 不过 Mac 不支持这个参数</span></span><br></pre></td></tr></table></figure>

<h4 id="Copying-files"><a href="#Copying-files" class="headerlink" title="Copying files"></a>Copying files</h4><p>format: <code>cp source destination</code>, copy 的文件是一个全新的文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -i 当文件已经存在时，询问是否覆盖</span></span><br><span class="line">cp -i test_one test_two </span><br><span class="line"><span class="comment"># overwrite test_two? (y/n [n]) n</span></span><br><span class="line"><span class="comment"># not overwritten</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -d 只显示文件夹，不显示文件夹内容</span></span><br><span class="line">ls -Fd tmp_folder</span><br><span class="line"><span class="comment"># tmp_folder/</span></span><br><span class="line">ls -F tmp_folder/</span><br><span class="line"><span class="comment"># test1.sh*       test10b.out...</span></span><br></pre></td></tr></table></figure>

<h4 id="Linking-files"><a href="#Linking-files" class="headerlink" title="Linking files"></a>Linking files</h4><p>Linux 中你的文件可以有一个物理主体和多个虚拟链接，这种链接即为 links。系统中有两种链接</p>
<ul>
<li>A symbolic link</li>
<li>A hard link</li>
</ul>
<p>A symbolic link is simply a physical file that points to another file somewhere in the virtual directory structure. The two symnolically linked together files do not share the same contents.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ln -s test_one  sl_test_one</span><br><span class="line">ls -l *test_one</span><br><span class="line"><span class="comment"># lrwxr-xr-x  1 i306454  staff  8 Jun  4 12:30 sl_test_one -&gt; test_one</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  3 Jun  4 11:29 test_one</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -i 显示 inode 名字</span></span><br><span class="line">ls -i *test_one</span><br><span class="line">51540816 sl_test_one    51538439 test_one</span><br></pre></td></tr></table></figure>

<p>hard link 是一个虚拟链接，你可以通过它对原文件做修改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ln test_two hl_test_two</span><br><span class="line"></span><br><span class="line">ls -il *test_two</span><br><span class="line"><span class="comment"># 51538882 -rw-r--r--  2 i306454  staff  3 Jun  4 11:38 hl_test_two</span></span><br><span class="line"><span class="comment"># 51538882 -rw-r--r--  2 i306454  staff  3 Jun  4 11:38 test_two</span></span><br></pre></td></tr></table></figure>

<p><strong>Note</strong> 创建 hard link 要求你创建的地方是同一个物理空间，如果是分开的空间，只能创建 symblic link.</p>
<p>查阅下来发现，符号链接和硬链接最主要的区别有</p>
<ul>
<li>symbolic link 和原文件有不同的 inode, hard link 和原文件相同</li>
<li>hard link 启动备份的作用，当所有指向同一个 inode 的文件都删除了文件才删除</li>
<li>symbolic link 保存原文件路径，当原文件删除了，link 的文件内容就消失了</li>
</ul>
<h4 id="Renaming-files"><a href="#Renaming-files" class="headerlink" title="Renaming files"></a>Renaming files</h4><p>Renaming files is called moving files. <code>mv</code> won’t change the inode number.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">touch file1</span><br><span class="line">mv file1 file2</span><br><span class="line">ls file*</span><br><span class="line"><span class="comment"># file2</span></span><br></pre></td></tr></table></figure>

<p><code>mv</code> 也支持整个文件夹的迁移，且不需要加任何参数</p>
<h4 id="Deleting-files"><a href="#Deleting-files" class="headerlink" title="Deleting files"></a>Deleting files</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -i file2</span><br><span class="line"><span class="comment"># remove file2?</span></span><br></pre></td></tr></table></figure>

<h3 id="Managing-Directories"><a href="#Managing-Directories" class="headerlink" title="Managing Directories"></a>Managing Directories</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mkdir New_Dir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建多级文件夹</span></span><br><span class="line">mkdir -p folder1/folder2/folder3</span><br><span class="line">ls -R folder1</span><br><span class="line"><span class="comment"># folder2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># folder1/folder2:</span></span><br><span class="line"><span class="comment"># folder3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># folder1/folder2/folder3:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rmdir 只能删除空文件夹</span></span><br><span class="line">rmdir folder1</span><br><span class="line"><span class="comment"># rmdir: folder1: Directory not empty</span></span><br><span class="line"></span><br><span class="line">rm -rf folder1</span><br></pre></td></tr></table></figure>

<h3 id="Viewing-File-Contents"><a href="#Viewing-File-Contents" class="headerlink" title="Viewing File Contents"></a>Viewing File Contents</h3><p>使用 <code>file</code> 瞥一眼文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">file folder1</span><br><span class="line"><span class="comment"># folder1: directory</span></span><br><span class="line">file file2</span><br><span class="line"><span class="comment"># file2: empty</span></span><br><span class="line">ile search.xml</span><br><span class="line"><span class="comment"># search.xml: XML 1.0 document text, UTF-8 Unicode text, with very long lines, with overstriking</span></span><br><span class="line">file badtest</span><br><span class="line"><span class="comment"># badtest: Bourne-Again shell script text executable, ASCII text</span></span><br></pre></td></tr></table></figure>

<p><code>cat</code> 全揽文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cat tree.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># -n 显示行号</span></span><br><span class="line">cat -n badtest </span><br><span class="line">    <span class="comment">#  1  #!/usr/local/bin/bash</span></span><br><span class="line">    <span class="comment">#  2  # Testing closing file descriptors</span></span><br><span class="line">    <span class="comment">#  3</span></span><br><span class="line">    <span class="comment">#  4  exec 3&gt; test17file</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line">    <span class="comment">#  6  echo &quot;This is a test line of data&quot; &gt;&amp;3</span></span><br><span class="line">    <span class="comment">#  7</span></span><br><span class="line">    <span class="comment">#  8  exec 3&gt;&amp;-</span></span><br><span class="line">    <span class="comment">#  9</span></span><br><span class="line">    <span class="comment"># 10  echo &quot;This won&#x27;t work&quot; &gt;&amp;3</span></span><br><span class="line">    <span class="comment"># 11</span></span><br><span class="line">    <span class="comment"># 12</span></span><br><span class="line">    <span class="comment"># 13</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只显示 non-blank 的行号</span></span><br><span class="line">cat -b badtest </span><br><span class="line">    <span class="comment">#  1  #!/usr/local/bin/bash</span></span><br><span class="line">    <span class="comment">#  2  # Testing closing file descriptors</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  3  exec 3&gt; test17file</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  4  echo &quot;This is a test line of data&quot; &gt;&amp;3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  5  exec 3&gt;&amp;-</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  6  echo &quot;This won&#x27;t work&quot; &gt;&amp;3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 ^I 代替 tab, Mac 不支持</span></span><br><span class="line">cat -T badtest</span><br></pre></td></tr></table></figure>

<h4 id="Using-the-more-command"><a href="#Using-the-more-command" class="headerlink" title="Using the more command"></a>Using the more command</h4><p><code>cat</code> 只能全文显示，<code>more</code> 显示一部分并让你自己选择后面的动作</p>
<h4 id="Using-the-less-command"><a href="#Using-the-less-command" class="headerlink" title="Using the less command"></a>Using the less command</h4><p>别被它的名字骗了，其实他是 more 的增强版 for phrase ‘less is more’</p>
<h4 id="Viewing-parts-of-a-file"><a href="#Viewing-parts-of-a-file" class="headerlink" title="Viewing parts of a file"></a>Viewing parts of a file</h4><p><code>tail</code> 默认只显示文件的最后 10 行，<code>-n</code> 指定显示行数 <code>tail -n 2 file</code></p>
<p><code>head</code> 默认显示开头 10 行，<code>- 5</code> 指定行数 <code>head -3 file</code>. 格式和 tail 不统一，真是干了</p>
<p>试了下，这两个命令都可以用 <code>-n 3</code> 和 <code>-3</code> 的格式，没区别</p>
<h2 id="Chapter-4-More-bash-Shell-Commands"><a href="#Chapter-4-More-bash-Shell-Commands" class="headerlink" title="Chapter 4: More bash Shell Commands"></a>Chapter 4: More bash Shell Commands</h2><h3 id="Monitoring-Programs"><a href="#Monitoring-Programs" class="headerlink" title="Monitoring Programs"></a>Monitoring Programs</h3><h4 id="Peeking-at-the-processes"><a href="#Peeking-at-the-processes" class="headerlink" title="Peeking at the processes"></a>Peeking at the processes</h4><p>Linux 系统中，用 process 表示运行着的系统。可以用 <code>ps</code>(process status) 命令查看.</p>
<p>默认情况下，只显示四个内容，process ID，terminal that they are running from, and the CUP time the process has used.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ps </span><br><span class="line">  PID TTY           TIME CMD</span><br><span class="line">  647 ttys000    0:02.15 -zsh</span><br><span class="line">12163 ttys000   11:26.77 /Users/i306454/SAPDevelop/tools/sapjvm_8/bin/java -Dlog4j.co</span><br><span class="line">12183 ttys000    0:01.12 tail -f /Users/i306454/SAPDevelop/workspace/trunk/tomcat-sfs</span><br><span class="line"> 1238 ttys001    0:09.65 /bin/zsh -l</span><br><span class="line"> 9378 ttys002    0:03.04 /bin/zsh --login -i</span><br></pre></td></tr></table></figure>

<p><code>ps</code> command 有三种类型的参数</p>
<ul>
<li>Unix style parameters</li>
<li>BSD style parameters</li>
<li>GNU long parameters</li>
</ul>
<blockquote>
<p>Unix-style parameters</p>
</blockquote>
<p>简单摘录几个, 而且书上列的只是一部分，主要记住几个常用的就行了</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-A</td>
<td align="left">Shows all processes</td>
</tr>
<tr>
<td align="left">-N</td>
<td align="left">Shows the opposite of the specified parameters</td>
</tr>
<tr>
<td align="left">-a</td>
<td align="left">Shows all processes except session headers and processes without a terminal</td>
</tr>
<tr>
<td align="left">-d</td>
<td align="left">Shows all processes except session headers</td>
</tr>
<tr>
<td align="left">-e</td>
<td align="left">Shows all processes</td>
</tr>
<tr>
<td align="left">-f</td>
<td align="left">Displays a full format listing</td>
</tr>
<tr>
<td align="left">-l</td>
<td align="left">Displays a long listing</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | head</span><br><span class="line"><span class="comment">#   UID   PID  PPID   C STIME   TTY           TIME CMD</span></span><br><span class="line"><span class="comment">#     0     1     0   0 10:09AM ??         1:23.22 /sbin/launchd</span></span><br><span class="line"><span class="comment">#     0    64     1   0 10:09AM ??         0:03.00 /usr/sbin/syslogd</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">ps -l | head</span><br><span class="line"><span class="comment"># UID   PID  PPID        F CPU PRI NI       SZ    RSS WCHAN     S             ADDR TTY           TIME CMD</span></span><br><span class="line"><span class="comment"># 501   647   646     4006   0  31  0  5457412   5200 -      S+                  0 ttys000    0:04.03 -zsh</span></span><br></pre></td></tr></table></figure>

<ul>
<li>UID: The user responsible for launching the process</li>
<li>PID: The process ID of the process</li>
<li>PPID: The PID of the parent process(if a process is start by another process)</li>
<li>C: Processor utilization over the lifetime of the process</li>
<li>STIME: The system time when the process started</li>
<li>TTY: The termnal device from which the porcess was launched</li>
<li>TIME: The cumulative CUP Time required to run the process</li>
<li>CMD: The name of the program that wat started</li>
<li>F: System flags assigned to the process by the kernel</li>
<li>S: The state of the process. O-running on proecssor; S-sleeping; R-runnable, waiting to run; Z-zombie, process terminated but parent not availale; T-process stopped;</li>
<li>PRI: The priority of the process(higher numbers mean low priority)</li>
<li>NI: The nice value, which is used for determining priorites</li>
<li>ADDR: The memory address of the process</li>
<li>SZ: Approximate amount of swap space required if the process was swapped out</li>
<li>WCHAN: Address of the kernel function where the process is sleeping</li>
</ul>
<p>其他两种我很少用，先留着把，有机会再补全</p>
<h4 id="Real-time-process-monitoring"><a href="#Real-time-process-monitoring" class="headerlink" title="Real-time process monitoring"></a>Real-time process monitoring</h4><p><code>ps</code> 只能显示一个时间点的 process 状态，如果要实时显示，需要用到 <code>top</code> 命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">top</span><br><span class="line"><span class="comment"># PID    COMMAND      %CPU TIME     #TH    #WQ  #PORT MEM    PURG   CMPRS  PGRP  PPID STATE    BOOSTS          %CPU_ME %CPU_OTHRS UID  FAULTS     COW     MSGSENT    MSGRECV   SYSBSD     SYSMACH    CSW        PAGEIN IDLEW    POWE INSTRS    CYCLES    USER</span></span><br><span class="line"><span class="comment"># 1841   com.docker.h 36.7 68:12.08 13     0    37    19G    0B     629M   1710  1830 sleeping *0[1]           0.00000 0.00000    501  202373842+ 473     569        335       85444924+  920        48973831+  17     3949456+ 59.4 469486491 786452501 i306454</span></span><br></pre></td></tr></table></figure>

<h4 id="Stopping-processes"><a href="#Stopping-processes" class="headerlink" title="Stopping processes"></a>Stopping processes</h4><p>Linux 系统中使用 signals 来和其他 process 交互。常用的 signals 列表</p>
<table>
<thead>
<tr>
<th align="left">Signal</th>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">HUP</td>
<td align="left">Hangs up</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">INT</td>
<td align="left">Interrupts</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">QUIT</td>
<td align="left">Stops running</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">KILL</td>
<td align="left">Unconditionally terminates</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">SEGV</td>
<td align="left">Produces segment violation</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">TERM</td>
<td align="left">Terminates if possible</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left">STOP</td>
<td align="left">Stops unconditionally, but doesn’t terminate</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left">TSTP</td>
<td align="left">Stops or pauses, but continues to run in background</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left">CONT</td>
<td align="left">Resumes execution after STOP or TSTP</td>
</tr>
</tbody></table>
<p><strong>The kill command</strong> 只有 process 的 owner 或者 root user 有权限杀死进程。 格式：<code>kill 3904</code></p>
<p><strong>The killall command</strong> 可以根据名字关闭多个进程 <code>killall http*</code></p>
<h3 id="Monitoring-Disk-Space"><a href="#Monitoring-Disk-Space" class="headerlink" title="Monitoring Disk Space"></a>Monitoring Disk Space</h3><h4 id="Mounting-media"><a href="#Mounting-media" class="headerlink" title="Mounting media"></a>Mounting media</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前挂在的设备</span></span><br><span class="line">mount</span><br><span class="line"><span class="comment"># /dev/disk1s1s1 on / (apfs, sealed, local, read-only, journaled)</span></span><br><span class="line"><span class="comment"># devfs on /dev (devfs, local, nobrowse)</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>显示信息：</p>
<ul>
<li>The device filename of the media</li>
<li>The mount point in the virtual directory where the media is mounted</li>
<li>The filesystem type</li>
<li>The access status of the mounted media</li>
</ul>
<p>手动挂载，你需要是 root 或者用 sudo，格式为 <code>mount -t type device directory</code>, sample <code>mount -t vfat /dev/sdb1 /media/disk</code></p>
<p>type 指定了设备的文件类型，如果你想要和 Windows 下共享这个设备，你最好使用下面这些文件类型</p>
<ul>
<li>vfat: Windows long filesystem</li>
<li>ntfs: Windows advanced filesystem used in Windows NT, XP and Vista</li>
<li>iso9660: The standard CD-ROM filesystem</li>
</ul>
<p><code>unmount [directory | device]</code> 解绑，如果解绑时有 process 还在这个设备上运行，系统会阻止你</p>
<h4 id="Using-the-df-command"><a href="#Using-the-df-command" class="headerlink" title="Using the df command"></a>Using the df command</h4><p>当你想要看看磁盘还有多少可用空间时。。。</p>
<p><code>df</code> command allows you to easily see what’s happening on all the mounted disks</p>
<p>df - display free disk space</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df -h</span><br><span class="line"><span class="comment"># Filesystem       Size   Used  Avail Capacity iused      ifree %iused  Mounted on</span></span><br><span class="line"><span class="comment"># /dev/disk1s1s1  932Gi   14Gi  749Gi     2%  553757 9767424403    0%   /</span></span><br><span class="line"><span class="comment"># devfs           190Ki  190Ki    0Bi   100%     656          0  100%   /dev</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-the-du-command"><a href="#Using-the-du-command" class="headerlink" title="Using the du command"></a>Using the du command</h4><p>df 是查看磁盘细心， du 是查看磁盘下的文件信息</p>
<p>The <code>du</code> command shows the disk usage or a specific directory(by default, the current directory)</p>
<p>du - display disk usage statistics</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 说是文件也会显示，问什么我这里看不到。。。</span></span><br><span class="line">du .</span><br><span class="line"><span class="comment"># 104     ./tmp_folder</span></span><br><span class="line"><span class="comment"># 0       ./folder1/folder2/folder3</span></span><br><span class="line"><span class="comment"># 0       ./folder1/folder2</span></span><br><span class="line"><span class="comment"># 0       ./folder1</span></span><br></pre></td></tr></table></figure>

<p>一些可选参数</p>
<ul>
<li>-c: 统计结果</li>
<li>-h: 方便阅读的结果</li>
<li>-s: Summarizes each argument</li>
</ul>
<h3 id="Working-with-Data-Files"><a href="#Working-with-Data-Files" class="headerlink" title="Working with Data Files"></a>Working with Data Files</h3><p>列出一些处理大量数据时用到的工具</p>
<h4 id="Sorting-data"><a href="#Sorting-data" class="headerlink" title="Sorting data"></a>Sorting data</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">cat file1</span><br><span class="line"><span class="comment"># one</span></span><br><span class="line"><span class="comment"># two</span></span><br><span class="line"><span class="comment"># three</span></span><br><span class="line"><span class="comment"># four</span></span><br><span class="line"><span class="comment"># five</span></span><br><span class="line">sort file1</span><br><span class="line"><span class="comment"># five</span></span><br><span class="line"><span class="comment"># four</span></span><br><span class="line"><span class="comment"># one</span></span><br><span class="line"><span class="comment"># three</span></span><br><span class="line"><span class="comment"># two</span></span><br><span class="line">cat file2</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 45</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 145</span></span><br><span class="line"><span class="comment"># 75</span></span><br><span class="line">sort file2</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 145</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 45</span></span><br><span class="line"><span class="comment"># 75</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 -n 指定数字排序</span></span><br><span class="line">sort -n file2</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 45</span></span><br><span class="line"><span class="comment"># 75</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 145</span></span><br><span class="line"></span><br><span class="line">cat file3</span><br><span class="line"><span class="comment"># Apr</span></span><br><span class="line"><span class="comment"># Aug</span></span><br><span class="line"><span class="comment"># Dec</span></span><br><span class="line"><span class="comment"># Feb</span></span><br><span class="line"><span class="comment"># Jan</span></span><br><span class="line"><span class="comment"># Jul</span></span><br><span class="line"><span class="comment"># Jun</span></span><br><span class="line"><span class="comment"># Mar</span></span><br><span class="line"><span class="comment"># May</span></span><br><span class="line"><span class="comment"># Nov</span></span><br><span class="line"><span class="comment"># Oct</span></span><br><span class="line"><span class="comment"># Sep</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按月份排序</span></span><br><span class="line">sort -M file3</span><br><span class="line"><span class="comment"># Jan</span></span><br><span class="line"><span class="comment"># Feb</span></span><br><span class="line"><span class="comment"># Mar</span></span><br><span class="line"><span class="comment"># Apr</span></span><br><span class="line"><span class="comment"># May</span></span><br><span class="line"><span class="comment"># Jun</span></span><br><span class="line"><span class="comment"># Jul</span></span><br><span class="line"><span class="comment"># Aug</span></span><br><span class="line"><span class="comment"># Sep</span></span><br><span class="line"><span class="comment"># Oct</span></span><br><span class="line"><span class="comment"># Nov</span></span><br><span class="line"><span class="comment"># Dec</span></span><br></pre></td></tr></table></figure>

<p>其他比较常见的参数</p>
<ul>
<li>-t 指定分割符</li>
<li>-k 指定排序的列</li>
<li>-r 倒序</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前文件夹下的文件倒序排列</span></span><br><span class="line">du -sh * | sort -nr</span><br><span class="line"><span class="comment">#  52K    tmp_folder</span></span><br><span class="line"><span class="comment"># 4.0K    tree.txt</span></span><br><span class="line"><span class="comment"># 4.0K    test_thr</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<h4 id="Searching-for-data"><a href="#Searching-for-data" class="headerlink" title="Searching for data"></a>Searching for data</h4><p><code>grep [options] patttern [file]</code></p>
<p>一些有趣的可选参数</p>
<ul>
<li>-v 挑选不 match 的那些</li>
<li>-n 行号</li>
<li>-o 只显示配的内容</li>
<li>-c 显示匹配的数量</li>
<li>-e 多个匹配 <code>grep -e t -e f file1</code></li>
<li>使用正则 grep [tf] file1</li>
</ul>
<h4 id="Compressing-data"><a href="#Compressing-data" class="headerlink" title="Compressing data"></a>Compressing data</h4><p>Linux 系统中的压缩工具</p>
<table>
<thead>
<tr>
<th align="left">Utility</th>
<th align="left">File Extension</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bzip2</td>
<td align="left">.bz2</td>
<td align="left">Uses the Burrows-Wheeler block sorting text compression algorith and Fuffman coding</td>
</tr>
<tr>
<td align="left">compress</td>
<td align="left">.Z</td>
<td align="left">Original Unix file compression utility; starting to fade away into obscurity</td>
</tr>
<tr>
<td align="left">gzip</td>
<td align="left">.gz</td>
<td align="left">The GUN Project’s compression utility; uses Lempel-Ziv coding</td>
</tr>
<tr>
<td align="left">zip</td>
<td align="left">.zip</td>
<td align="left">The Unix version of the PKZIP program for Windows</td>
</tr>
</tbody></table>
<p>gzip 是 Linux 中使用度最高的压缩工具，它由三部分组成</p>
<ul>
<li>gzip for compressing files</li>
<li>gzcat for displaying the contents of compressed text files</li>
<li>gunzip for uncompressing files</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gzip file1</span><br><span class="line">ls -l file1*</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  50 Jun  4 13:57 file1.gz</span></span><br><span class="line">gzip file*</span><br><span class="line"><span class="comment"># gzip: file1.gz already has .gz suffix -- unchanged</span></span><br><span class="line">ls -l file*</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  50 Jun  4 13:57 file1.gz</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  46 Jun  4 13:58 file2.gz</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  34 Jun  4 14:02 file3.gz</span></span><br></pre></td></tr></table></figure>

<h4 id="Archiving-data"><a href="#Archiving-data" class="headerlink" title="Archiving data"></a>Archiving data</h4><p>虽然 zip 挺好用，但是 Linux 上用的最多的还是 tar command. tar 本来是用来归档到 tape device 的，但是它也能用来归档到文件，后来还变得越来越受欢迎了</p>
<p><code>tar function [options] object1 object2</code></p>
<p>The tar Command Functions</p>
<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Long Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-A</td>
<td align="left">–concatenate</td>
<td align="left">Appends an existing tar archive file to another existing tar archive file</td>
</tr>
<tr>
<td align="left">-c</td>
<td align="left">–create</td>
<td align="left">Create a new tar archive file</td>
</tr>
<tr>
<td align="left">-d</td>
<td align="left">–diff</td>
<td align="left">Checks the differences between a tar archive file and the filesystem</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">–delete</td>
<td align="left">Deletes from an existing tar archive file</td>
</tr>
<tr>
<td align="left">-r</td>
<td align="left">–append</td>
<td align="left">Appends files to the end of an existing archive file</td>
</tr>
<tr>
<td align="left">-t</td>
<td align="left">–list</td>
<td align="left">Lists the contents of an existing tar archive file</td>
</tr>
<tr>
<td align="left">-u</td>
<td align="left">–update</td>
<td align="left">Appends files to an existing tar archive file that are newer than a file with the same name in the existing archive</td>
</tr>
<tr>
<td align="left">-x</td>
<td align="left">–extract</td>
<td align="left">Extract files from an existing archive file</td>
</tr>
</tbody></table>
<p>The tar Command Options</p>
<table>
<thead>
<tr>
<th align="left">Option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-C dir</td>
<td align="left">Changes to the specified directory</td>
</tr>
<tr>
<td align="left">-f file</td>
<td align="left">Output results to file(or device)</td>
</tr>
<tr>
<td align="left">-j</td>
<td align="left">Redirects output to the bzip2 command for compression</td>
</tr>
<tr>
<td align="left">-p</td>
<td align="left">Preserves all file permissions</td>
</tr>
<tr>
<td align="left">-v</td>
<td align="left">Lists files as they are processed</td>
</tr>
<tr>
<td align="left">-z</td>
<td align="left">Redirects the output to the gzip command for compression</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -c create new tar file</span></span><br><span class="line"><span class="comment"># -v list process file</span></span><br><span class="line"><span class="comment"># -f output result to file</span></span><br><span class="line">tar -cvf test.tar tmp_folder/</span><br><span class="line"><span class="comment"># a tmp_folder</span></span><br><span class="line"><span class="comment"># a tmp_folder/test11.sh</span></span><br><span class="line"><span class="comment"># a tmp_folder/test2.sh</span></span><br><span class="line"><span class="comment"># a ...</span></span><br><span class="line"></span><br><span class="line">ls <span class="built_in">test</span>*</span><br><span class="line"><span class="comment"># test.tar </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 并不会解压，只是看看</span></span><br><span class="line"><span class="comment"># -t list contents in tar</span></span><br><span class="line">tar -tf test.tar </span><br><span class="line"><span class="comment"># tmp_folder/</span></span><br><span class="line"><span class="comment"># tmp_folder/test11.sh</span></span><br><span class="line"><span class="comment"># tmp_folder/test2.sh</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -xvf test.tar </span><br><span class="line"><span class="comment"># x tmp_folder/</span></span><br><span class="line"><span class="comment"># x tmp_folder/test11.sh</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p><strong>Tip</strong> 网上下的包很多都是 <code>.tgz</code> 格式的，是 gzipped tar files 的意思，可以用 <code>tar -zxvf filename.tgz</code></p>
<h2 id="Chapter-5-Understanding-the-Shell"><a href="#Chapter-5-Understanding-the-Shell" class="headerlink" title="Chapter 5: Understanding the Shell"></a>Chapter 5: Understanding the Shell</h2><p>这章将学习一些 shell process 相关的知识，子 shell 和 父 shell 的关系等</p>
<h3 id="Exploring-Shell-Types"><a href="#Exploring-Shell-Types" class="headerlink" title="Exploring Shell Types"></a>Exploring Shell Types</h3><p>你默认启动的 shell 是配置在 <code>/etc/passwd</code> 文件中的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># root:*:0:0:System Administrator:/var/root:/bin/sh</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">ls -lF /bin/sh </span><br><span class="line"><span class="comment"># -rwxr-xr-x  1 root  wheel  120912 Jan  1  2020 /bin/sh*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他一些自带的 sh</span></span><br><span class="line">ls -lF /bin/*sh</span><br><span class="line"><span class="comment"># -r-xr-xr-x  1 root  wheel  1296704 Jan  1  2020 /bin/bash*</span></span><br><span class="line"><span class="comment"># -rwxr-xr-x  1 root  wheel  1106144 Jan  1  2020 /bin/csh*</span></span><br><span class="line"><span class="comment"># -rwxr-xr-x  1 root  wheel   277440 Jan  1  2020 /bin/dash*</span></span><br><span class="line"><span class="comment"># -r-xr-xr-x  1 root  wheel  2585424 Jan  1  2020 /bin/ksh*</span></span><br><span class="line"><span class="comment"># -rwxr-xr-x  1 root  wheel   120912 Jan  1  2020 /bin/sh*</span></span><br><span class="line"><span class="comment"># -rwxr-xr-x  1 root  wheel  1106144 Jan  1  2020 /bin/tcsh*</span></span><br><span class="line"><span class="comment"># -rwxr-xr-x  1 root  wheel  1347856 Jan  1  2020 /bin/zsh*</span></span><br></pre></td></tr></table></figure>

<h3 id="Exploring-Parent-and-Child-Shell-Relationships"><a href="#Exploring-Parent-and-Child-Shell-Relationships" class="headerlink" title="Exploring Parent and Child Shell Relationships"></a>Exploring Parent and Child Shell Relationships</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ps -f               </span><br><span class="line">  <span class="comment"># UID   PID  PPID   C STIME   TTY           TIME CMD</span></span><br><span class="line">  <span class="comment"># 501   667   665   0 10:10AM ttys000    0:03.74 -zsh</span></span><br><span class="line">  <span class="comment"># 501  1454  1433   0 10:10AM ttys001    0:00.99 /bin/zsh -l</span></span><br><span class="line">  <span class="comment"># 501  2027   637   0 10:11AM ttys002    0:00.38 /bin/zsh --login -i</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 zsh 中启动一个 bash</span></span><br><span class="line">bash</span><br><span class="line"></span><br><span class="line">ps -f</span><br><span class="line">  <span class="comment"># UID   PID  PPID   C STIME   TTY           TIME CMD</span></span><br><span class="line">  <span class="comment"># 501   667   665   0 10:10AM ttys000    0:03.74 -zsh</span></span><br><span class="line">  <span class="comment"># 501  1454  1433   0 10:10AM ttys001    0:01.04 /bin/zsh -l</span></span><br><span class="line">  <span class="comment"># 501 12146  1454   0  4:07PM ttys001    0:00.01 bash</span></span><br><span class="line">  <span class="comment"># 501  2027   637   0 10:11AM ttys002    0:00.38 /bin/zsh --login -i</span></span><br><span class="line"><span class="comment"># 可以看到新建了一个 bash process, PPID 是 /bin/zsh 的地址</span></span><br></pre></td></tr></table></figure>

<p>上面的例子中，bash 就是 zsh 的子 shell, 他会复制一部分父 shell 的环境变量，这里会导致一些小问题，第6章会介绍。子 shell 也叫 subshell. subshell 可以再建 subshell. <code>ps --forest</code> 可以显示树桩结构，不过貌似 mac 不支持</p>
<h4 id="Looking-at-process-lists"><a href="#Looking-at-process-lists" class="headerlink" title="Looking at process lists"></a>Looking at process lists</h4><p>一行运行多个 cmd, 使用 semicolon 分割 <code>pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls</code> 但是它并不是一个 process，将它用括号包裹之后，会启动 subshell 运行它 <code>(pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls)</code> 和这个语法相似的还有 <code>&#123; command; &#125;</code> 这个不会启动 subshell. 可以通过打印 <code>$BASH_SUBSHELL</code> 变量来验证</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">pwd</span> ; ls ; <span class="built_in">cd</span> /etc ; <span class="built_in">pwd</span> ; <span class="built_in">cd</span> ; <span class="built_in">pwd</span> ; ls ; <span class="built_in">echo</span> <span class="variable">$BASH_SUBSHELL</span>)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="built_in">pwd</span> ; ls ; <span class="built_in">cd</span> /etc ; <span class="built_in">pwd</span> ; <span class="built_in">cd</span> ; <span class="built_in">pwd</span> ; ls ; <span class="built_in">echo</span> <span class="variable">$BASH_SUBSHELL</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line">(<span class="built_in">pwd</span>; (<span class="built_in">echo</span> <span class="variable">$BASH_SUBSHELL</span>))</span><br><span class="line"><span class="comment"># /Users/i306454</span></span><br><span class="line"><span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<h4 id="Creatively-using-subshells"><a href="#Creatively-using-subshells" class="headerlink" title="Creatively using subshells"></a>Creatively using subshells</h4><h4 id="Investigation-background-mode"><a href="#Investigation-background-mode" class="headerlink" title="Investigation background mode"></a>Investigation background mode</h4><p><code>slepp</code> - 等待 x 秒</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &amp; 符号设置后台运行</span></span><br><span class="line">sleep 3000 &amp;</span><br><span class="line"><span class="comment"># [1] 12603</span></span><br><span class="line">ps</span><br><span class="line"><span class="comment"># 12391 ttys001    0:00.03 bash</span></span><br><span class="line"><span class="comment"># 12603 ttys001    0:00.00 sleep 3000</span></span><br></pre></td></tr></table></figure>

<h4 id="Putting-process-lists-into-the-background"><a href="#Putting-process-lists-into-the-background" class="headerlink" title="Putting process lists into the background"></a>Putting process lists into the background</h4><p>a process list is a command or series of commands executed within a subshell.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(sleep 2 ; <span class="built_in">echo</span> <span class="variable">$BASH_SUBSHELL</span> ; sleep 2)</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line">(sleep 2 ; <span class="built_in">echo</span> <span class="variable">$BASH_SUBSHELL</span> ; sleep 2) &amp;</span><br><span class="line"><span class="comment"># [2] 12658</span></span><br><span class="line">ps</span><br><span class="line"><span class="comment"># 12658 ttys001    0:00.00 bash</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [2]+  Done                    ( sleep 2; echo $BASH_SUBSHELL; sleep 2 )</span></span><br></pre></td></tr></table></figure>

<p>background 运行脚本 not have your terminal tied up with subshell’s I/O</p>
<p>sleep 和 echo 的 sample 只是示范，工作中，你可能会后台执行 tar <code>(tar -cf Rich.tar /home/rich ; tar -cf My.tar /home/christine)&amp;</code></p>
<h4 id="Looking-at-co-processing"><a href="#Looking-at-co-processing" class="headerlink" title="Looking at co-processing"></a>Looking at co-processing</h4><p>Co-processing does two thins at the same time. coproc 会起一个后台的 job 运行对应的命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">coproc sleep 10</span><br><span class="line"><span class="comment"># [2] 12746</span></span><br><span class="line"><span class="built_in">jobs</span> </span><br><span class="line"><span class="comment"># [1]-  Running                 sleep 3000 &amp;</span></span><br><span class="line"><span class="comment"># [2]+  Done                    coproc COPROC sleep 10</span></span><br></pre></td></tr></table></figure>

<p>默认的 coproc 起的 job 名字为 COPRO, 你也可以指定名字, curly bracket({) 换括号后面要接空格，语法规定。一般用默认的名字就行，只有当你需要和他们通信时，才会特别的取一个名字</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">coproc My_Job &#123; sleep 10; &#125;</span><br><span class="line"><span class="comment"># [2] 12848</span></span><br><span class="line"><span class="built_in">jobs</span></span><br><span class="line"><span class="comment"># [2]+  Running                 coproc My_Job &#123; sleep 10; &#125; &amp;</span></span><br></pre></td></tr></table></figure>

<p>后面还跟了一个 <code>ps --forest</code> 的实验，没法做 ╮(￣▽￣””)╭</p>
<p>Just remember taht spawning a subshell can be <strong>expensive and slow</strong>. Creating nested subshells is even more so!</p>
<h3 id="Understanding-Shell-Built-In-Commands"><a href="#Understanding-Shell-Built-In-Commands" class="headerlink" title="Understanding Shell Built-In Commands"></a>Understanding Shell Built-In Commands</h3><p>Built-in commands and non-built-in commands</p>
<h4 id="Looking-at-external-commands"><a href="#Looking-at-external-commands" class="headerlink" title="Looking at external commands"></a>Looking at external commands</h4><p>external command 也被叫做 filesystem command, 是在 bash shell 之外的，通常放在 /bin, /usr/bin, /sbin 或者 /usr/sbin</p>
<p><code>ps</code> 就是一个 external 的 command</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> ps </span><br><span class="line"><span class="comment"># /bin/ps</span></span><br><span class="line"><span class="built_in">type</span> -a ps </span><br><span class="line"><span class="comment"># ps is /bin/ps</span></span><br></pre></td></tr></table></figure>

<p>每当 external command 执行时，都会创建一个 child process, 这种行为叫做 forking.</p>
<h4 id="Looking-at-built-in-comands"><a href="#Looking-at-built-in-comands" class="headerlink" title="Looking at built-in comands"></a>Looking at built-in comands</h4><p>Built-in commands 不需要 child process 就能执行。他们是 shell 工具集的一部分。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> <span class="built_in">exit</span></span><br><span class="line"><span class="comment"># exit is a shell builtin</span></span><br><span class="line"><span class="built_in">type</span> <span class="built_in">cd</span></span><br><span class="line"><span class="comment"># cd is a shell builtin</span></span><br></pre></td></tr></table></figure>

<p>他们不需要 fork 或者运行文件，所以他们更快，效率更高。</p>
<p>有些 cmd 有两个版本，which 只会显示 external command</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> -a <span class="built_in">echo</span> </span><br><span class="line"><span class="comment"># echo is a shell builtin</span></span><br><span class="line"><span class="comment"># echo is /bin/echo</span></span><br><span class="line"><span class="built_in">which</span> <span class="built_in">echo</span> </span><br><span class="line"><span class="comment"># /bin/echo</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-the-history-command"><a href="#Using-the-history-command" class="headerlink" title="Using the history command"></a>Using the history command</h4><p>显示 cmd 的历史记录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span> </span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  <span class="comment">#  42  code test19</span></span><br><span class="line">  <span class="comment">#  43  ./test19</span></span><br><span class="line">  <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p><strong>Tip</strong> 设置环境变量 HISTSIZE 改变数量上限</p>
<p>使用 <code>!!</code> 执行上一条命令, bash 的历史记录会存在 <code>.bash_history</code> 文件中，当前 shell 的历史存在内存中，退出后存到文件中，通过 <code>history -a</code> 强制立刻写入文件</p>
<h4 id="Using-command-aliases"><a href="#Using-command-aliases" class="headerlink" title="Using command aliases"></a>Using command aliases</h4><p>为了简化输入，有了别名(alias)。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示自带的别名</span></span><br><span class="line"><span class="built_in">alias</span> -p</span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> li=<span class="string">&#x27;ls -li&#x27;</span></span><br><span class="line">li</span><br><span class="line"><span class="comment"># total 8</span></span><br><span class="line"><span class="comment">#  5091820 drwx------@  3 i306454  staff    96 Aug 20  2020 Applications</span></span><br></pre></td></tr></table></figure>

<h2 id="Using-Linux-Environment-Variables"><a href="#Using-Linux-Environment-Variables" class="headerlink" title="Using Linux Environment Variables"></a>Using Linux Environment Variables</h2><p>Environment variables are set in lots of places on the Linux system, and you should know where these places are.</p>
<p>这章将介绍环境变量存储的位置，怎么创建自己的环境变量，还介绍怎么使用 variable arrays.</p>
<h3 id="Exploring-Environment-Variables"><a href="#Exploring-Environment-Variables" class="headerlink" title="Exploring Environment Variables"></a>Exploring Environment Variables</h3><p>bash shell 使用 environment variable 存储 shell session 和 工作环境相关的信息。环境变量分两种</p>
<ul>
<li>Gloabl variables</li>
<li>Local variables</li>
</ul>
<h4 id="Looing-at-global-environment-variables"><a href="#Looing-at-global-environment-variables" class="headerlink" title="Looing at global environment variables"></a>Looing at global environment variables</h4><p>Gloabl variables 是所有 shell 都可见的，Local variables 是当前 shell 才可见的。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 gloabl variables</span></span><br><span class="line">printenv</span><br><span class="line"><span class="comment"># SHELL=/bin/zsh</span></span><br><span class="line"><span class="comment"># LSCOLORS=Gxfxcxdxbxegedabagacad</span></span><br><span class="line"><span class="comment"># PIPENV_VENV_IN_PROJECT=1</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出单个变量</span></span><br><span class="line">printenv HOME</span><br><span class="line"><span class="comment"># /Users/i306454</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># env 貌似不能输出单个变量</span></span><br><span class="line">env HOME</span><br><span class="line"><span class="comment"># env: HOME: No such file or directory</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以用 echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$HOME</span></span><br><span class="line"><span class="comment"># /Users/i306454</span></span><br></pre></td></tr></table></figure>

<h4 id="Looing-at-local-environment-variables"><a href="#Looing-at-local-environment-variables" class="headerlink" title="Looing at local environment variables"></a>Looing at local environment variables</h4><p>Linux 默认为每个 shell 定义基本的 local variables, 当然你也可以自定。系统中并没有输出本地变量的命令，但是有 set 可以输出 global + local</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="comment"># &#x27;!&#x27;=0</span></span><br><span class="line"><span class="comment"># &#x27;#&#x27;=0</span></span><br><span class="line"><span class="comment"># &#x27;$&#x27;=13377</span></span><br></pre></td></tr></table></figure>

<p>env vs printenv vs set:</p>
<ul>
<li>set = global + local + user-defined variables, result is sorted</li>
<li>env has additional functionality that printenv not have</li>
</ul>
<h3 id="Setting-User-Defined-Variables"><a href="#Setting-User-Defined-Variables" class="headerlink" title="Setting User-Defined Variables"></a>Setting User-Defined Variables</h3><h4 id="Setting-local-user-defined-variables"><a href="#Setting-local-user-defined-variables" class="headerlink" title="Setting local user-defined variables"></a>Setting local user-defined variables</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"></span><br><span class="line">my_var=Hello</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment"># Hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含空格的，需要用单/双引号包裹</span></span><br><span class="line">my_var=Hello world</span><br><span class="line"><span class="comment"># bash: world: command not found</span></span><br><span class="line">my_var=<span class="string">&#x27;Hello world&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment"># Hello world</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新启一个 bash, 访问不到之前定义的 local variable</span></span><br><span class="line">bash</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>user-defined local varibale 使用小写，global 的使用大写。Linux 中的变量是区分大小写的。</p>
<h4 id="Setting-global-environment-variables"><a href="#Setting-global-environment-variables" class="headerlink" title="Setting global environment variables"></a>Setting global environment variables</h4><p>创建 gloabl variable 的方法：先创建一个 local variable，然后 export 成一个 global environment</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_var=<span class="string">&quot;I am Gloabl now&quot;</span></span><br><span class="line"><span class="built_in">export</span> my_var</span><br><span class="line">bash</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment"># I am Gloabl now</span></span><br></pre></td></tr></table></figure>

<p>但是，在 child shell 中修改 global variable 并<strong>不会</strong>影响到 parent shell 中的值，这个好神奇, 即使用 export 在 subshell 中修改也不行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">my_var=<span class="string">&quot;Null&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment"># Null</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment"># I am Gloabl now</span></span><br><span class="line"></span><br><span class="line">bash </span><br><span class="line"><span class="built_in">export</span> my_var=<span class="string">&quot;Null&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment"># Null</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment"># I am Gloabl now</span></span><br></pre></td></tr></table></figure>

<h4 id="Removing-Environment-Variables"><a href="#Removing-Environment-Variables" class="headerlink" title="Removing Environment Variables"></a>Removing Environment Variables</h4><p>使用 <code>unset</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment"># I am Gloabl now</span></span><br><span class="line"><span class="built_in">unset</span> my_var</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$my_var</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><strong>Tip</strong> 当你向对变量做什么的时候，不需要加 $, 当你想要用变量做什么的时候，需要加 $. printenv 除外。</p>
<p>和之前的规则一样，当你在 subshell 中 unset 一个 global variable 时，这个 unset 只在 subshell 中生效，parent shell 中变量还是存在的</p>
<h4 id="Uncovering-Default-Shell-Environment-Variables"><a href="#Uncovering-Default-Shell-Environment-Variables" class="headerlink" title="Uncovering Default Shell Environment Variables"></a>Uncovering Default Shell Environment Variables</h4><p>Bash shell 除了自己定义一些环境变量外，还从 Unix Bourne shell 那边继承了一下变量过来。</p>
<p>The bash Shell Bourne Variables</p>
<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CDPATH</td>
<td align="left">A colon-separated list of directories used as a search path for the cd command</td>
</tr>
<tr>
<td align="left">HOME</td>
<td align="left">The current user’s home directory</td>
</tr>
<tr>
<td align="left">IFS</td>
<td align="left">A list of characters that separate fields used by the shell to split text strings</td>
</tr>
<tr>
<td align="left">MAIL</td>
<td align="left">The filename fo the current user’s mailbox(The bash shell checks this file for new mail.)</td>
</tr>
<tr>
<td align="left">MAILPATH</td>
<td align="left">A colon-separated list of multiple filenames for the current user’s mailbox(The bash shell checks each file in this list for new mail.)</td>
</tr>
<tr>
<td align="left">OPTARG</td>
<td align="left">The value of the last option argument processed by the getopt command</td>
</tr>
<tr>
<td align="left">OPTIND</td>
<td align="left">The index value of the last option argument processed by the getopt command</td>
</tr>
<tr>
<td align="left">PATH</td>
<td align="left">A colon-separated list of directories where shell looks for commands</td>
</tr>
<tr>
<td align="left">PS1</td>
<td align="left">The primary shell command line interface prompt string</td>
</tr>
<tr>
<td align="left">PS2</td>
<td align="left">The sceondary shell command line interface prompt string</td>
</tr>
</tbody></table>
<p>除了这些，bash shell 还提供了一些自定义的变量, 太长了，不列了。</p>
<h3 id="Setting-the-PATH-Environment-Variable"><a href="#Setting-the-PATH-Environment-Variable" class="headerlink" title="Setting the PATH Environment Variable"></a>Setting the PATH Environment Variable</h3><p>当你在终端输入一个 external command 时，系统就会根据 PATH 中的路径找命令. 路径用冒号分割。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加路径</span></span><br><span class="line">PATH=<span class="variable">$PATH</span>:/home/jack/Scripts</span><br></pre></td></tr></table></figure>

<p><strong>Tips</strong> 如果 subshell 中也要用到新加的路劲，你就要 export 它。有一个技巧是，可以在 PATH 中添加当前路径 <code>PATH=$PATH:.</code></p>
<h4 id="Locating-System-Environment-Variables"><a href="#Locating-System-Environment-Variables" class="headerlink" title="Locating System Environment Variables"></a>Locating System Environment Variables</h4><p>前面我们介绍了如何使用这些变量，那么怎么将他们做持久化呢。当你启动一个 shell 的时候，系统会到 setup file or environment files 里面去加载这些变量。</p>
<p>你可以通过三种方式启动一个 bash shell:</p>
<ul>
<li>As a default login shell at login time</li>
<li>As an interactive shell that is started by spawning a subshell</li>
<li>As a non-inactive shell to run a script</li>
</ul>
<h4 id="Understanding-the-login-shell-process"><a href="#Understanding-the-login-shell-process" class="headerlink" title="Understanding the login shell process"></a>Understanding the login shell process</h4><p>当你登陆系统的时候，bash shell 开启了一个 login shell. login shell 会从一下五个文件中加载配置：</p>
<ul>
<li>/etc/profile</li>
<li>$HOME/.bash_profile</li>
<li>$HOME/.bashrc</li>
<li>$HOME/.bash_login</li>
<li>$HOME/.profile</li>
</ul>
<p><code>/etc/profile</code> 是所有用户登陆时都会执行的文件，其他的几个就是用户可以自定一的。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/profile</span><br><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line"><span class="built_in">export</span> PAGER=less</span><br><span class="line"><span class="built_in">export</span> PS1=<span class="string">&#x27;\h:\w\$ &#x27;</span></span><br><span class="line"><span class="built_in">umask</span> 022</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> script <span class="keyword">in</span> /etc/profile.d/*.sh ; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ -r <span class="variable">$script</span> ] ; <span class="keyword">then</span></span><br><span class="line">                . <span class="variable">$script</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>脚本中循环处理 profile.d 文件夹下的内容，这个文件夹是专门用来放一下 application-specific startup file taht is executed by the shell when you log in.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -lF /etc/profile.d/</span><br><span class="line"><span class="comment"># total 8</span></span><br><span class="line"><span class="comment"># -rw-r--r--    1 root     root           295 May 30  2020 color_prompt</span></span><br><span class="line"><span class="comment"># -rw-r--r--    1 root     root            61 May 30  2020 locale.sh</span></span><br></pre></td></tr></table></figure>

<p>自定义位置文件加载顺序如下，第一个被找到后，其他的就不加载了</p>
<ul>
<li>$HOME/.bash_profile</li>
<li>$HOME/.bash_login</li>
<li>$HOME/.profile</li>
</ul>
<p><code>.bashrc</code> 不在其中，因为它会在其他 process 中被调用</p>
<h4 id="Understanding-the-interactive-shell-process"><a href="#Understanding-the-interactive-shell-process" class="headerlink" title="Understanding the interactive shell process"></a>Understanding the interactive shell process</h4><p>当你在终端输入 bash 时，你会启动一个 interactive shell. 当你启动 interactive shell 的时候，它不会加载 /etc/profile 中的内容。它只会 check .bashrc 中的配置。</p>
<p>.bashrc 做两件事</p>
<ol>
<li>check for a common bashrc file in /etc directory</li>
<li>provides a place for user to enter personal command alias + provide script functions</li>
</ol>
<h4 id="Understanding-the-non-interactive-shell-process"><a href="#Understanding-the-non-interactive-shell-process" class="headerlink" title="Understanding the non-interactive shell process"></a>Understanding the non-interactive shell process</h4><p>没遇到过使用场景，先 pass</p>
<h4 id="Making-environment-variables-persistent"><a href="#Making-environment-variables-persistent" class="headerlink" title="Making environment variables persistent"></a>Making environment variables persistent</h4><p>将自定义的变量存在 $HOME/.bashrc 是一个极好的习惯</p>
<h3 id="Learning-about-Variable-Arrays"><a href="#Learning-about-Variable-Arrays" class="headerlink" title="Learning about Variable Arrays"></a>Learning about Variable Arrays</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义数组 </span></span><br><span class="line">mytest=(one two three four five)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$mytest</span></span><br><span class="line"><span class="comment"># one</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;mytest[2]&#125;</span></span><br><span class="line"><span class="comment"># three</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;mytest[*]&#125;</span></span><br><span class="line"><span class="comment"># one two three four five</span></span><br><span class="line"></span><br><span class="line">mytest[2]=seven</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;mytest[*]&#125;</span></span><br><span class="line">one two seven four five</span><br></pre></td></tr></table></figure>

<p>可以通过 unset 移除某个元素，但是移除之后，print 不会显示，但是它位置还是占着的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> mytest[2]</span><br><span class="line"><span class="variable">$&#123;mytest[*]&#125;</span></span><br><span class="line"><span class="comment"># one two seven four five</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;mytest[2]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;mytest[3]&#125;</span></span><br><span class="line"><span class="comment"># four</span></span><br><span class="line"><span class="built_in">unset</span> mytest</span><br><span class="line">bash-5.1$ <span class="built_in">echo</span> <span class="variable">$&#123;mytest[*]&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有时候 arrays 的使用挺复杂的，一般我们不再脚本中使用它，而且兼容性也不是很好。</p>
<h2 id="Understanding-Linux-File-Permissions"><a href="#Understanding-Linux-File-Permissions" class="headerlink" title="Understanding Linux File Permissions"></a>Understanding Linux File Permissions</h2><h3 id="Linux-Security"><a href="#Linux-Security" class="headerlink" title="Linux Security"></a>Linux Security</h3><p>Linux 系统的 security 核心是 account 这个概念。每个访问的用户都有一个唯一的账户，权限就是根据账户设置的。下面将介绍一些账户相关的文件和工具包。</p>
<h4 id="The-etc-passwd-file"><a href="#The-etc-passwd-file" class="headerlink" title="The /etc/passwd file"></a>The /etc/passwd file</h4><p>/etc/passed 文件中存储这一些 UID 相关的信息，root 是管理员账户，有固定的 UID 0.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line"><span class="comment"># root:*:0:0:System Administrator:/var/root:/bin/sh</span></span><br><span class="line"><span class="comment"># daemon:*:1:1:System Services:/var/root:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _uucp:*:4:4:Unix to Unix Copy Protocol:/var/spool/uucp:/usr/sbin/uucico</span></span><br></pre></td></tr></table></figure>

<p>系统还会为一些非用户的 process 创建 account，这些叫做 system accounts.</p>
<p>All services that run in background mode need to be logged in to the Linux system under a system user account.</p>
<p>Linux 将 500 以下的 UID 预留给了 system accounts.</p>
<p>passwd 文件中的信息包括</p>
<ul>
<li>The login name</li>
<li>The password for the user</li>
<li>The numberical UID of the user account</li>
<li>The numberical group ID(GID) of the user account</li>
<li>A text description of the user account(called the comment field)</li>
<li>The location of the HOME directory for the user</li>
<li>The default shell for the user</li>
</ul>
<p>password 字段为 x, 以前放置的还是加密后的 pwd 后来为了安全统一放到 /etc/shadow 下面去了</p>
<h4 id="The-etc-shadow-file"><a href="#The-etc-shadow-file" class="headerlink" title="The /etc/shadow file"></a>The /etc/shadow file</h4><p>只有 root user 可以访问 shadow 文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker bash 中的内容</span></span><br><span class="line">cat /etc/shadow</span><br><span class="line"><span class="comment"># root:!::0:::::</span></span><br><span class="line"><span class="comment"># bin:!::0:::::</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 书上的例子</span></span><br><span class="line"><span class="comment"># rich:$1$.FfcK0ns$f1UgiyHQ25wrB/hykCn020:11627:0:99999:7:::</span></span><br></pre></td></tr></table></figure>

<p>shadow 中的信息包括</p>
<ul>
<li>The login name corresponding to the login name in the /etc/passwd file</li>
<li>The encrypted password</li>
<li>The number of days since January 1, 1970, that the password was last changed</li>
<li>The minimun number of days before the password can be changed</li>
<li>The number of days before the password must be changed</li>
<li>The number of days before the password expiration that the user is warned to change the password</li>
<li>The number of days after a password expires before the account will be disabled</li>
<li>The date(stored as the number of days since January 1, 1970) since the user account was disabled</li>
<li>A filed reserved for feature use</li>
</ul>
<h4 id="Adding-a-new-user"><a href="#Adding-a-new-user" class="headerlink" title="Adding a new user"></a>Adding a new user</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 useradd 的默认配置</span></span><br><span class="line">useradd -D</span><br><span class="line"><span class="comment"># GROUP=100</span></span><br><span class="line"><span class="comment"># HOME=/home</span></span><br><span class="line"><span class="comment"># INACTIVE=-1</span></span><br><span class="line"><span class="comment"># EXPIRE=</span></span><br><span class="line"><span class="comment"># SHELL=/bin/sh</span></span><br><span class="line"><span class="comment"># SKEL=/etc/skel</span></span><br><span class="line"><span class="comment"># CREATE_MAIL_SPOOL=no</span></span><br></pre></td></tr></table></figure>

<p>当你在 useradd 的时候没有指定任何参数的时候，就会按照这个 default 的配置添加新用户。default 包含以下信息</p>
<ul>
<li>The user is added to a common group with group ID 100</li>
<li>The new user has a HOME account created in the directory /home/loginname</li>
<li>The account can’t be disabled when the password expires</li>
<li>The new account can’t be set to expire at a set date</li>
<li>The new account users the bin sh as the default shell</li>
<li>The system copies the contents of the /etc/skl directory to the user’s HOME directory</li>
<li>The system creates a file in the mail directory for the user account to receive mail</li>
</ul>
<p>倒数第二个 item 说的是，在创建用户的时候，admin 可以预先设置一个模版</p>
<p>默认情况下，useradd 并不会为用户创建 HOME 目录，需要添加 <code>-m</code> 参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc/skel</span><br><span class="line"><span class="comment"># total 16</span></span><br><span class="line"><span class="comment"># drwxr-xr-x+ 2 root root 4096 Aug 11  2017 Desktop</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 root root 8980 Apr 20  2016 examples.desktop</span></span><br><span class="line"></span><br><span class="line">useradd -m I306454</span><br><span class="line">ls -l /home</span><br><span class="line"><span class="comment"># total 28</span></span><br><span class="line"><span class="comment"># drwxr-xr-x+  5 fuser    fuser     4096 Aug 11  2017 fuser</span></span><br><span class="line"><span class="comment"># drwxr-xr-x+  4 I306454  I306454   4096 Jun  5 14:48 I306454</span></span><br><span class="line">ls -lF /home/I306454/</span><br><span class="line"><span class="comment"># total 16</span></span><br><span class="line"><span class="comment"># drwxr-xr-x+ 2 I306454 I306454 4096 Aug 11  2017 Desktop/</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 I306454 I306454 8980 Apr 20  2016 examples.desktop</span></span><br></pre></td></tr></table></figure>

<p>The useradd Command Line Parameters</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-c comment</td>
<td align="left">Adds text to the new user’s comment field</td>
</tr>
<tr>
<td align="left">-d home_dir</td>
<td align="left">Specifies a different name for the HOME directory other than the login name</td>
</tr>
<tr>
<td align="left">-e expire_date</td>
<td align="left">Specifies a date, in YYYY-MM-DD format, when the account will expire</td>
</tr>
<tr>
<td align="left">-f inactive_days</td>
<td align="left">Specifies the number of days after a password expires when the account will be disabled. A value of 0 disables the accunt as soon as the password expires; a value of -1 disables this feature</td>
</tr>
<tr>
<td align="left">-g initial_group</td>
<td align="left">Specifies the group name or GID of the user’s login group</td>
</tr>
<tr>
<td align="left">-G group</td>
<td align="left">Specifies one or more supplementary groups the user belongs to</td>
</tr>
<tr>
<td align="left">-k</td>
<td align="left">Gopies the /etc/skel directory contents into the user’s HOME directory(must use -m as well)</td>
</tr>
<tr>
<td align="left">-m</td>
<td align="left">Create the user’s HOME directory</td>
</tr>
<tr>
<td align="left">-M</td>
<td align="left">Doesn’t create a user’s HOME directory(user if the default setting is to create one)</td>
</tr>
<tr>
<td align="left">-n</td>
<td align="left">Create a new group using the same name as the user’s login name</td>
</tr>
<tr>
<td align="left">-r</td>
<td align="left">Creates a system account</td>
</tr>
<tr>
<td align="left">-p passwd</td>
<td align="left">Specifies a default password for the user account</td>
</tr>
<tr>
<td align="left">-s shell</td>
<td align="left">Specifies the default login shell</td>
</tr>
<tr>
<td align="left">-u</td>
<td align="left">Specifies a unique UID for the account</td>
</tr>
</tbody></table>
<p>如果你有很多默认配置需要修改，那么你可以通过 <code>useradd -D</code> 修改这些默认配置</p>
<h4 id="Removing-a-user"><a href="#Removing-a-user" class="headerlink" title="Removing a user"></a>Removing a user</h4><p><code>userdel I306454</code> 默认情况下并不会删除对应用户的 HOME 目录。你需要添加 <code>-r</code> 参数达到这个效果</p>
<h4 id="Modifying-a-user"><a href="#Modifying-a-user" class="headerlink" title="Modifying a user"></a>Modifying a user</h4><p>Linux 提供了一些不同的工具包来修改用户信息</p>
<p>User account Modification Utilities</p>
<table>
<thead>
<tr>
<th align="left">Command</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">usermod</td>
<td align="left">Edits user accout fields, as well as specifying primary and seconday group membership</td>
</tr>
<tr>
<td align="left">passwd</td>
<td align="left">Changes the password for an existing user</td>
</tr>
<tr>
<td align="left">chpassed</td>
<td align="left">Reads a file of login name and password pairs, and updates the passwords</td>
</tr>
<tr>
<td align="left">chage</td>
<td align="left">Chagnes the password’s expiration date</td>
</tr>
<tr>
<td align="left">chfn</td>
<td align="left">Changes the user account’s comment information</td>
</tr>
<tr>
<td align="left">chsh</td>
<td align="left">Changes the user account’s default shell</td>
</tr>
</tbody></table>
<p>感觉 <code>usermod</code> 已经具备了所有账户相关的基本操作了</p>
<p>后面有这些 cmd 的用法简介，但是我暂时用不到，先不摘录了</p>
<h3 id="Using-Linux-Groups"><a href="#Using-Linux-Groups" class="headerlink" title="Using Linux Groups"></a>Using Linux Groups</h3><p>Group 可以以群的单位管理权限，每个 group 都有特定的 GID</p>
<h4 id="The-etc-group-file"><a href="#The-etc-group-file" class="headerlink" title="The /etc/group file"></a>The /etc/group file</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/group</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># jenkins:x:58116:</span></span><br><span class="line"><span class="comment"># mfe:x:58117:</span></span><br><span class="line"><span class="comment"># I306454:x:58118:</span></span><br></pre></td></tr></table></figure>

<ul>
<li>The gorup name</li>
<li>The group password</li>
<li>The GID</li>
<li>The list of user accounts that belong to the group</li>
</ul>
<p>你可以通过 usermod 命令添加用户进组</p>
<h4 id="Creating-new-groups"><a href="#Creating-new-groups" class="headerlink" title="Creating new groups"></a>Creating new groups</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">groupadd shared</span><br><span class="line">tail /etc/group</span><br><span class="line"><span class="comment"># I306454:x:58118:</span></span><br><span class="line"><span class="comment"># shared:x:58119:</span></span><br><span class="line"></span><br><span class="line">usermod -G shared I306454</span><br><span class="line">tail /etc/group</span><br><span class="line"><span class="comment"># shared:x:58119:I306454</span></span><br></pre></td></tr></table></figure>

<p>PS: 如果你改变用户组时，用户已经 login， 该用户需要重新 login 使之生效</p>
<p>PPS: 如果你用 -g 新组会代替旧组，如果 -G 则是多个组并存</p>
<h4 id="Modifying-groups"><a href="#Modifying-groups" class="headerlink" title="Modifying groups"></a>Modifying groups</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupmod -n sharing shared</span><br><span class="line">tail /etc/group</span><br><span class="line"><span class="comment"># sharing:x:58119:I306454</span></span><br></pre></td></tr></table></figure>

<h3 id="Decoding-File-Permissions"><a href="#Decoding-File-Permissions" class="headerlink" title="Decoding File Permissions"></a>Decoding File Permissions</h3><h4 id="Using-file-permission-symbols"><a href="#Using-file-permission-symbols" class="headerlink" title="Using file permission symbols"></a>Using file permission symbols</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -l </span><br><span class="line"><span class="comment"># total 10192</span></span><br><span class="line"><span class="comment"># -rwxr--r--   1 i306454  staff      159 May 30 15:56 badtest</span></span><br><span class="line"><span class="comment"># -rw-r--r--   1 i306454  staff       24 Jun  4 13:57 file1</span></span><br></pre></td></tr></table></figure>

<p><code>-rwxr--r--</code> 即为文件的权限信息</p>
<p>第一个字符表示文件类型</p>
<ul>
<li><ul>
<li>for files</li>
</ul>
</li>
<li>d for directories</li>
<li>l for links</li>
<li>c for character devices</li>
<li>b for block devices</li>
<li>n for network devices</li>
</ul>
<p>后面的字符都是权限</p>
<ul>
<li>r for read permission</li>
<li>w for write permission</li>
<li>x for execute permission</li>
<li><ul>
<li>denied</li>
</ul>
</li>
</ul>
<p>权限三个一组，分别代表 owner/group/everyone, owner 和 group 分别在 ls -l 后面有写出来</p>
<h4 id="Default-file-permissions"><a href="#Default-file-permissions" class="headerlink" title="Default file permissions"></a>Default file permissions</h4><p>umask 设置了所有文件和目录的默认权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">touch ttt</span><br><span class="line">ls -l ttt</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  0 Jun  5 15:43 ttt</span></span><br><span class="line"><span class="built_in">umask</span> </span><br><span class="line"><span class="comment"># 0022</span></span><br></pre></td></tr></table></figure>

<p>umask 结果的第一位表示 sticky bit, 后三位是权限的 octal mode 表示</p>
<table>
<thead>
<tr>
<th align="left">Permissions</th>
<th align="left">Binary</th>
<th align="left">Octal</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">—</td>
<td align="left">000</td>
<td align="left">0</td>
<td align="left">No permissions</td>
</tr>
<tr>
<td align="left">–x</td>
<td align="left">001</td>
<td align="left">1</td>
<td align="left">Execute-only permission</td>
</tr>
<tr>
<td align="left">-w-</td>
<td align="left">010</td>
<td align="left">2</td>
<td align="left">Write-only permission</td>
</tr>
<tr>
<td align="left">-wx</td>
<td align="left">011</td>
<td align="left">3</td>
<td align="left">Write and execute permissions</td>
</tr>
<tr>
<td align="left">r–</td>
<td align="left">100</td>
<td align="left">4</td>
<td align="left">Read-only permission</td>
</tr>
<tr>
<td align="left">r-x</td>
<td align="left">101</td>
<td align="left">5</td>
<td align="left">Read and execute permissions</td>
</tr>
<tr>
<td align="left">rw-</td>
<td align="left">110</td>
<td align="left">6</td>
<td align="left">Read and write permissions</td>
</tr>
<tr>
<td align="left">rwx</td>
<td align="left">111</td>
<td align="left">7</td>
<td align="left">Read, write and execute permissions</td>
</tr>
</tbody></table>
<p>文件的 full 权限是 666，文件夹是 777. umask 可以理解为在这个 full 权限的基础上减去一个值。</p>
<p>之前我们 touch 的文件 <code>rw-r--r--</code> 是 644 = 666 - 022</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -ld newdir</span><br><span class="line"><span class="comment"># drwxr-xr-x  2 i306454  staff  64 Jun  5 15:56 newdir</span></span><br></pre></td></tr></table></figure>

<p><code>drwxr-xr-x</code> 755 = 777 - 022</p>
<h3 id="Changing-Security-Settings"><a href="#Changing-Security-Settings" class="headerlink" title="Changing Security Settings"></a>Changing Security Settings</h3><p><code>chmod options mode file</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls -l ttt</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  0 Jun  5 15:43 ttt</span></span><br><span class="line">chmod 760 ttt</span><br><span class="line">ls -l ttt</span><br><span class="line"><span class="comment"># -rwxrw----  1 i306454  staff  0 Jun  5 15:43 ttt</span></span><br></pre></td></tr></table></figure>

<p>除了数字表示，你也可以用字母表示</p>
<p>[ugoa…][+-=][rwxXstugo…]</p>
<ul>
<li><p>u for the user</p>
</li>
<li><p>g for the group</p>
</li>
<li><p>o for others(everyone else)</p>
</li>
<li><p>a for all of the above</p>
</li>
<li><ul>
<li>add perm</li>
</ul>
</li>
<li><ul>
<li>subtract perm</li>
</ul>
</li>
<li><p>= set perm</p>
</li>
<li><p>X assigns execute permissions only if the object is a directory or if it already has execute permissions</p>
</li>
<li><p>s sets the UID or GID on execution</p>
</li>
<li><p>t saves program text</p>
</li>
<li><p>u sets the permissions to the owner’s permission</p>
</li>
<li><p>g sets the permissions to the group’s permission</p>
</li>
<li><p>o sets the permissions to the other’s permission</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chmod o+r ttt</span><br><span class="line">ls -l ttt</span><br><span class="line"><span class="comment"># -rwxrw-r--  1 i306454  staff  0 Jun  5 15:43 ttt</span></span><br><span class="line"></span><br><span class="line">chmod u-x ttt</span><br><span class="line">ls -l ttt</span><br><span class="line"><span class="comment"># -rw-rw-r--  1 i306454  staff  0 Jun  5 15:43 ttt</span></span><br></pre></td></tr></table></figure>

<h4 id="Changing-ownership"><a href="#Changing-ownership" class="headerlink" title="Changing ownership"></a>Changing ownership</h4><p>改变文件 owner，比如离开组织的时候，做交接。使用 <code>chown options owner[.group] file</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只改 owner</span></span><br><span class="line">chown dan newfile</span><br><span class="line"><span class="comment"># 同时改变 owner 和 group</span></span><br><span class="line">chown dan.shared newfile</span><br><span class="line"><span class="comment"># 只改 group</span></span><br><span class="line">chown .shared newfile</span><br></pre></td></tr></table></figure>

<p>PS: 只有 root 可以改变文件的 owner, 任何 user 可以将文件组改变，重要这个user 是改变前后组的成员</p>
<h3 id="Sharing-Files"><a href="#Sharing-Files" class="headerlink" title="Sharing Files"></a>Sharing Files</h3><p>这个场景没用到过，以后再说</p>
<h2 id="Chapter-8-Managing-Filesystems"><a href="#Chapter-8-Managing-Filesystems" class="headerlink" title="Chapter 8: Managing Filesystems"></a>Chapter 8: Managing Filesystems</h2><p>这章的内容我大致浏览了一下，作为了解即可。他介绍了很多系统类型，ext3 什么的以前见过，但是不明所以，刚好可以学习一下。</p>
<h3 id="Exploring-Linux-Filesystems"><a href="#Exploring-Linux-Filesystems" class="headerlink" title="Exploring Linux Filesystems"></a>Exploring Linux Filesystems</h3><p>filesystem: 用于存储文件，管理存储设备</p>
<h4 id="Understanding-the-basic-Linux-filesystems"><a href="#Understanding-the-basic-Linux-filesystems" class="headerlink" title="Understanding the basic Linux filesystems"></a>Understanding the basic Linux filesystems</h4><p>最原始的 Linux 文件系统间的的仿造了 Unix 文件系统，下面我们会介绍这个文件系统的发现过程</p>
<ul>
<li>ext(extended filesystem) + inode(track info about files in directory) </li>
<li>ext 系统中文件最大只能 2G。 ext2 是 ext 的升级版，最大文件到 32G. 其他的特性就不举例了</li>
<li>Journaling filesystems, 貌似叫日志系统，算是文件更新到 inode 前的临时文件</li>
<li>ext3, 2001年加入 kernel</li>
<li>ext4, 2008年加入 kernel</li>
<li>Reiser filesystem, in 2001, Hans Reiser created the first journaling filesystem for Linux, call ReiserFS.</li>
<li>Journaled File System(JFS) 可能是最老的 journaling filesystem, IBM 1990 年开发</li>
</ul>
<p>其他暂时不看了。。。</p>
<h2 id="Chapter-9-Installing-Software"><a href="#Chapter-9-Installing-Software" class="headerlink" title="Chapter 9: Installing Software"></a>Chapter 9: Installing Software</h2><h2 id="Chapter-10-Working-with-Editors"><a href="#Chapter-10-Working-with-Editors" class="headerlink" title="Chapter 10: Working with Editors"></a>Chapter 10: Working with Editors</h2><p>第 9，10 章也没啥好看的，说的是软件安装和编辑器，跳过</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/24/LSCASSB-partii-shell-scripting-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/24/LSCASSB-partii-shell-scripting-basics/" class="post-title-link" itemprop="url">Linux命令行与shell脚本编程大全 第二章 Shell 脚本基础知识</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-24 11:04:47" itemprop="dateCreated datePublished" datetime="2021-05-24T11:04:47+08:00">2021-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Shell</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>62k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>56 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Linux命令行与shell脚本编程大全 3rd 第二部分命令实验记录</p>
<h2 id="Chapter-11-Basic-Script-building"><a href="#Chapter-11-Basic-Script-building" class="headerlink" title="Chapter 11: Basic Script building"></a>Chapter 11: Basic Script building</h2><h3 id="Using-Multiple-Commands"><a href="#Using-Multiple-Commands" class="headerlink" title="Using Multiple Commands"></a>Using Multiple Commands</h3><p>使用分号分隔命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">date ; who</span><br><span class="line"><span class="comment"># Mon May 24 12:36:11 CST 2021</span></span><br><span class="line"><span class="comment"># i306454  console  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys003  May 24 11:33</span></span><br></pre></td></tr></table></figure>

<h3 id="Creating-a-Script-File"><a href="#Creating-a-Script-File" class="headerlink" title="Creating a Script File"></a>Creating a Script File</h3><ol>
<li>新建文件 mysh.sh</li>
<li>填入内容</li>
<li>设置环境</li>
<li>运行</li>
</ol>
<blockquote>
<p>However, the fi rst line of a shell script fi le is a special case, and the pound sign followed by the exclamation point tells the shell what shell to run the script under<br>Shell script 的第一行表示你想要用哪个 Shell 运行你的脚本</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># This scri displays the date and who&#x27;s logged on</span></span><br><span class="line">date</span><br><span class="line">who</span><br></pre></td></tr></table></figure>

<p>尝试运行 <code>mysh.sh</code>，运行失败 <code>bash: mysh.sh: command not found</code></p>
<p>这是你有两种选择</p>
<ol>
<li>将包含脚本的目录添加到 PATH 中，eg: <code>export PATH=$PATH:path_to_folder</code></li>
<li>使用相对或绝对路径调用脚本, eg: <code>./mysh.sh</code></li>
</ol>
<p>PS: 发现直接用 <code>sh mysh.sh</code> 即可，还省去了赋权的操作</p>
<p>这里直接使用相对路径调用 <code>./mysh.sh</code>, 运行失败 <code>bash: ./mysh.sh: Permission denied</code>。通过 <code>ls -l mysh.sh</code> 查看权限, 发现并没有权限，然后赋权,再次尝试，运行成功。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls -l mysh.sh </span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  70 May 24 12:40 mysh.sh</span></span><br><span class="line"></span><br><span class="line">chmod u+x mysh.sh </span><br><span class="line">./mysh.sh </span><br><span class="line"><span class="comment"># Mon May 24 13:11:37 CST 2021</span></span><br><span class="line"><span class="comment"># i306454  console  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 24 11:18</span></span><br></pre></td></tr></table></figure>

<h3 id="Displaying-Messages"><a href="#Displaying-Messages" class="headerlink" title="Displaying Messages"></a>Displaying Messages</h3><p>使用 <code>echo</code> 打印信息</p>
<ul>
<li>当输出内容中没有什么特殊符号时，可以直接在 echo 后面接你要的内容</li>
<li>当输出内容中包含单/双引号时，需要将 echo 的内容包含在 双/单引号中</li>
<li>默认 echo 是会换行的，使用 <code>echo -n xxx</code> 取消换行</li>
</ul>
<h3 id="Using-Variables"><a href="#Using-Variables" class="headerlink" title="Using Variables"></a>Using Variables</h3><p><code>set</code>: 打印当前环境的所有环境变量, 输出内容包括 PATH，HOME 等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="comment"># ANT_HOME=/Users/i306454/SAPDevelop/tools/apache-ant-1.8.4</span></span><br><span class="line"><span class="comment"># BASH=/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># BASHOPTS=checkwinsize:cmdhist:complete_fullquote:expand_aliases:extquote:force_fignore:globasciiranges:hostcomplete:interactive_comments:progcomp:promptvars:sourcepath</span></span><br><span class="line"><span class="comment"># BASH_ALIASES=()</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>在你的 sh 脚本中，可以调用这些变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;User info for userid <span class="variable">$USER</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> UID: <span class="variable">$UID</span></span><br><span class="line"><span class="built_in">echo</span> HOME: <span class="variable">$HOME</span></span><br><span class="line"></span><br><span class="line">sh test_var.sh </span><br><span class="line"><span class="comment"># User info for userid i306454</span></span><br><span class="line"><span class="comment"># UID: 501</span></span><br><span class="line"><span class="comment"># HOME: /Users/i306454</span></span><br></pre></td></tr></table></figure>

<p>当你在输出语句中想要打印 <code>$</code> 这个特殊字符时，只需要在前面加斜杠</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This book cost <span class="variable">$15</span>&quot;</span></span><br><span class="line"><span class="comment"># This book cost 5</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This book cost \$15&quot;</span></span><br><span class="line"><span class="comment"># This book cost $15</span></span><br></pre></td></tr></table></figure>

<p>PS: <code>$&#123;variable&#125;</code> 也是合法的，这种声明起到强调变量名的作用</p>
<p>变量名限制：最多 20 个字符，可以是英文，数组或者下划线，区分大小写。使用等号链接，中间<strong>不允许</strong>有空格</p>
<blockquote>
<p>Command substitution</p>
</blockquote>
<p>你可以通过一下方式将 cmd 输出的值赋给你的变量</p>
<ol>
<li><code>`</code> 反引号符(backtick character)</li>
<li><code>$()</code> 表达式</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tdate=`date`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tdate</span></span><br><span class="line"><span class="comment"># Mon May 24 15:46:51 CST 2021</span></span><br><span class="line">tdate2=$(date)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tdate2</span></span><br><span class="line"><span class="comment"># Mon May 24 15:47:39 CST 2021</span></span><br></pre></td></tr></table></figure>

<p>这只是初级用法，更骚的操作是将输出定制之后用作后续命令的输出，比如下面这个例子，将文件夹下的所有目录写进 log 文件，并用时间戳做后缀 <code>today=$(date +%y%m%d); ls -al /usr/bin &gt; log.$today</code></p>
<p><strong>Caution:</strong> Command substitution creates what’s called a subshell to run the enclosed command. A subshell is a separate child shell generated from the shell that’s running the script. Because of that, any variables you create in the script aren’t available to the subshell command.</p>
<p>Command substitution 这种使用方法会创建一个子 shell 计算变量值，子 shell 运行的时候是看不到你外面的 shell 中定义的变量的</p>
<h3 id="Redirecting-Input-and-Output"><a href="#Redirecting-Input-and-Output" class="headerlink" title="Redirecting Input and Output"></a>Redirecting Input and Output</h3><blockquote>
<p>Output redirection</p>
</blockquote>
<p>可以使用大于号(greater-than symbol)将输出导入文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">date &gt; test6</span><br><span class="line">ls -l test6</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  29 May 24 18:31 test6</span></span><br><span class="line">cat test6</span><br><span class="line"><span class="comment"># Mon May 24 18:31:40 CST 2021</span></span><br></pre></td></tr></table></figure>

<p>如果文件已经存在，则覆盖原有内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">who &gt; test6</span><br><span class="line">cat test6</span><br><span class="line"><span class="comment"># i306454  console  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys003  May 24 18:00</span></span><br></pre></td></tr></table></figure>

<p>使用两个大于号(double greater-than symbol)来做 append 操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date &gt;&gt; test6</span><br><span class="line">cat test6</span><br><span class="line"><span class="comment"># i306454  console  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys003  May 24 18:00 </span></span><br><span class="line"><span class="comment"># Mon May 24 18:35:12 CST 2021</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Input redirection</p>
</blockquote>
<p>使用小于号(less-htan symbol)将文件中的内容导入输入流 <code>command &lt; inputfile</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wc &lt; test6</span><br><span class="line"><span class="comment">#    4      21     125</span></span><br><span class="line"><span class="comment"># wc: show lines, words and bytes of input</span></span><br></pre></td></tr></table></figure>

<p>除了从文件导入，从命令行直接导入多行也是可行的，术语叫做 <code>inline input redirection</code>。这个之前在之前阿里云 setup 环境的时候操作过的。使用两个小于号(&lt;&lt;) + 起止描述符实现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wc &lt;&lt; EOF</span><br><span class="line">&gt; <span class="built_in">test</span> String 1</span><br><span class="line">&gt; <span class="built_in">test</span> String 2</span><br><span class="line">&gt; <span class="built_in">test</span> String 3</span><br><span class="line">&gt; EOF</span><br><span class="line"><span class="comment"># 3       9      42</span></span><br></pre></td></tr></table></figure>

<h3 id="Pipes"><a href="#Pipes" class="headerlink" title="Pipes"></a>Pipes</h3><p>使用方式 <code>command1 | command2</code></p>
<blockquote>
<p>Don’t think of piping as running two commands back to back. The Linux system actually runs both commands at the same time, linking them together internally in the system. As the fi rst command produces output, it’s sent immediately to the second command. No inter-mediate fi les or buffer areas are used to transfer the data.<br>pipe 中的命令是同时执行的，变量传递不涉及到中间变量</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls </span><br><span class="line"><span class="comment"># input.txt       mysh.sh         output.txt      test_echo.sh</span></span><br><span class="line"><span class="comment"># log.210524      out.txt         test6           test_var.sh</span></span><br><span class="line">ls | sort</span><br><span class="line"><span class="comment"># input.txt</span></span><br><span class="line"><span class="comment"># log.210524</span></span><br><span class="line"><span class="comment"># mysh.sh</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>pipe 可以无限级联 <code>cmd1 | cmd2 | cmd3 | ...</code></p>
<h3 id="Performing-Math"><a href="#Performing-Math" class="headerlink" title="Performing Math"></a>Performing Math</h3><p>Bash 中提供了两种方式进行计算</p>
<blockquote>
<p>The expr command</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expr 1 + 5</span><br><span class="line"><span class="comment"># 6</span></span><br></pre></td></tr></table></figure>

<p>expr 支持常规算数运行 + 与或非 + 正则 + 字符串操作等</p>
<p>这个 expr 表达式有点尴尬，他的一些常规运算是要加反斜杠的，简直无情</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">expr 1 * 6</span><br><span class="line"><span class="comment"># expr: syntax error</span></span><br><span class="line">expr 1 \* 6</span><br><span class="line"><span class="comment"># 6</span></span><br></pre></td></tr></table></figure>

<p>这个还算好的，如果在 sh 文件中调用，表达式就更操蛋了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line">var1=10</span><br><span class="line">var2=20</span><br><span class="line">var3=$(expr <span class="variable">$var2</span> / <span class="variable">$var1</span>)</span><br><span class="line"><span class="built_in">echo</span> The result is <span class="variable">$var3</span></span><br><span class="line"></span><br><span class="line">sh test_expr.sh </span><br><span class="line"><span class="comment"># The result is 2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using brackets</p>
</blockquote>
<p>Bash 中保留 <code>expr</code> 是为了兼容 Bourne shell,同时它提供了一种更简便的计算方式，<code>$[ operation ]</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var1=$[1 + 5]</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line">var2=$[ <span class="variable">$var1</span> * 2 ]</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var2</span></span><br><span class="line"><span class="comment"># 12</span></span><br></pre></td></tr></table></figure>

<p>方括号表达式可以自动完成计算符号的识别，不需要用反斜杠做转义符，唯一的缺陷是，他只能做整数运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var1=100</span><br><span class="line">var2=45</span><br><span class="line">var3=$[<span class="variable">$var1</span>/<span class="variable">$var2</span>]</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var3</span></span><br><span class="line"><span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>A floating-point solution</p>
</blockquote>
<p>bc: bash calculation, 他可以识别一下内容</p>
<ul>
<li>Number(integer + floating point)</li>
<li>Variables(simple variables + arrays)</li>
<li>Comments(# or /* … */)</li>
<li>Expressions</li>
<li>Programming statements(such as if-then statements)</li>
<li>Functions</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bc</span><br><span class="line">bc 1.06</span><br><span class="line">Copyright 1991-1994, 1997, 1998, 2000 Free Software Foundation, Inc.</span><br><span class="line">This is free software with ABSOLUTELY NO WARRANTY.</span><br><span class="line">For details <span class="built_in">type</span> `warranty<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">12 * 5.4</span></span><br><span class="line"><span class="string">64.8</span></span><br><span class="line"><span class="string">3.156 * (3 + 5)</span></span><br><span class="line"><span class="string">25.248</span></span><br><span class="line"><span class="string">quit</span></span><br></pre></td></tr></table></figure>

<p>可以通过 scale 关键字指定精确位, 默认 scale 为 0, <code>-q</code> 用于跳过命令文字说明</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bc -q </span><br><span class="line">3.44 / 5</span><br><span class="line">0</span><br><span class="line">scale=4</span><br><span class="line">3.44 / 5</span><br><span class="line">.6880</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>如前述，bc 可以识别变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bc -q</span><br><span class="line">var1=10</span><br><span class="line">var1 * 4</span><br><span class="line">40</span><br><span class="line">var2 = var1 / 5</span><br><span class="line"><span class="built_in">print</span> var2</span><br><span class="line">2</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>你可以通过 Command substitution，在 sh 脚本中调用 bc, 形式为 <code>variable=$(echo &quot;options; expression&quot; | bc)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat test9</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># var1=$(echo &quot;scale=4; 3.44/5&quot; | bc)</span></span><br><span class="line"><span class="comment"># echo This answer is $var1</span></span><br><span class="line"></span><br><span class="line">sh test9</span><br><span class="line"><span class="comment"># This answer is .6880</span></span><br></pre></td></tr></table></figure>

<p>脚本中定义的变量也可以使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat test10</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># var1=100</span></span><br><span class="line"><span class="comment"># var2=45</span></span><br><span class="line"><span class="comment"># var3=$(echo &quot;scale=4; $var1 / $var2&quot; | bc)</span></span><br><span class="line"><span class="comment"># echo The answer for this is $var3bash-5.1$ </span></span><br><span class="line">sh test10</span><br><span class="line"><span class="comment"># The answer for this is 2.2222</span></span><br></pre></td></tr></table></figure>

<p>当遇到很长的计算表达式时，可以用 &lt;&lt; 将他们串起来</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test12</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># var1=10.46</span></span><br><span class="line"><span class="comment"># var2=43.67</span></span><br><span class="line"><span class="comment"># var3=33.2</span></span><br><span class="line"><span class="comment"># var4=71</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># var5=$(bc &lt;&lt; EOF</span></span><br><span class="line"><span class="comment"># scale = 4</span></span><br><span class="line"><span class="comment"># a1 = ($var1 * $var2)</span></span><br><span class="line"><span class="comment"># b1 = ($var3 * $var4)</span></span><br><span class="line"><span class="comment"># a1 + b1</span></span><br><span class="line"><span class="comment"># EOF</span></span><br><span class="line"><span class="comment"># )</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo The final answer for this mess is $var5</span></span><br><span class="line">sh test12</span><br><span class="line"><span class="comment"># The final answer for this mess is 2813.9882</span></span><br></pre></td></tr></table></figure>

<p>PS: 在上面的脚本中我们用了 Command substitution 所以中间的变量前面都是要加 <code>$</code> 的，当终端调用 <code>bc</code> 时就不需要了</p>
<h3 id="Exiting-the-Script"><a href="#Exiting-the-Script" class="headerlink" title="Exiting the Script"></a>Exiting the Script</h3><p>There’s a more elegant way of completing things available to us. 每个命令结束时，系统都会分配一个 0-255 之间的整数给他</p>
<blockquote>
<p>Checking the exit status</p>
</blockquote>
<p>Linux 使用 <code>$?</code> 表示上一条命令的执行状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">date</span><br><span class="line"><span class="comment"># Mon May 24 19:47:29 CST 2021</span></span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 0</span></span><br></pre></td></tr></table></figure>

<p>运行正常，返回 0。如果有问题，则返回一个非零</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">asd</span><br><span class="line"><span class="comment"># bash: asd: command not found</span></span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 127</span></span><br></pre></td></tr></table></figure>

<p>常见错误码表</p>
<table>
<thead>
<tr>
<th align="left">Code</th>
<th align="left">Desc</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">Success</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">General unknown error</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Misuse of shell command</td>
</tr>
<tr>
<td align="left">126</td>
<td align="left">The cmd can’t execute</td>
</tr>
<tr>
<td align="left">127</td>
<td align="left">Cmd not found</td>
</tr>
<tr>
<td align="left">128</td>
<td align="left">Invalid exit argument</td>
</tr>
<tr>
<td align="left">128+x</td>
<td align="left">Fatal err with Linux singal x</td>
</tr>
<tr>
<td align="left">130</td>
<td align="left">Cmd terminated with Ctrl+C</td>
</tr>
<tr>
<td align="left">255</td>
<td align="left">Exit status out of range</td>
</tr>
</tbody></table>
<blockquote>
<p>The exit command</p>
</blockquote>
<p>exit 关键字让你可以定制脚本的返回值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test13</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing the exit status</span></span><br><span class="line"><span class="comment"># var1=10</span></span><br><span class="line"><span class="comment"># var2=20</span></span><br><span class="line"><span class="comment"># var3=$[$var1 + $var2]</span></span><br><span class="line"><span class="comment"># echo The answer is $var3</span></span><br><span class="line"><span class="comment"># exit 5</span></span><br><span class="line"></span><br><span class="line">chmod u+x test13</span><br><span class="line">./test13</span><br><span class="line"><span class="comment"># The answer is 30</span></span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 5</span></span><br></pre></td></tr></table></figure>

<p>PS: 这里看出来差别了，如果我直接用 sh test13 执行的话，结果是 0</p>
<p>这里需要指出的是，exit code 最大为 255 如果超出了，系统会自己做修正</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat test14</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # exit code more than 255</span></span><br><span class="line"><span class="comment"># var=300</span></span><br><span class="line"><span class="comment"># exit $var</span></span><br><span class="line"></span><br><span class="line">chmod u+x test14</span><br><span class="line">./test14</span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 44</span></span><br></pre></td></tr></table></figure>

<h2 id="Chapter-12-Using-Structured-Commands"><a href="#Chapter-12-Using-Structured-Commands" class="headerlink" title="Chapter 12: Using Structured Commands"></a>Chapter 12: Using Structured Commands</h2><p>本章内容主要包括 loigc flow control 部分</p>
<blockquote>
<p>Working with the if-then Statement</p>
</blockquote>
<p>if-then 是最基本的控制方式，format 如下, 判断依据是 command 的 exit code, 如果是 0 则表示 success，其他的则为 fail.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">command</span></span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">command</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>positive sample 如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test1.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing the if statement</span></span><br><span class="line"><span class="comment"># if pwd</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;It worked&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">chmod u+x test1.sh </span><br><span class="line">./test1.sh</span><br><span class="line"><span class="comment"># /Users/i306454/gitStore/hexo</span></span><br><span class="line"><span class="comment"># It worked</span></span><br></pre></td></tr></table></figure>

<p>negative sample 如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test2.sh </span><br><span class="line"><span class="comment"># # #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # # testing a bad command</span></span><br><span class="line"><span class="comment"># if IamNotACommand</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;It worked&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"><span class="comment"># echo &quot;We are outside the if statement&quot;</span></span><br><span class="line">chmod u+x test2.sh</span><br><span class="line">./test2.sh </span><br><span class="line"><span class="comment"># ./test2.sh: line 3: IamNotACommand: command not found</span></span><br><span class="line"><span class="comment"># We are outside the if statement</span></span><br></pre></td></tr></table></figure>

<p>PS: <code>if-then</code> 可以改一下 format，将 if-then 写在一行，看上去更贴近其他语言的表现形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">command</span>; <span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>then 中可以写代码段，如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat test3.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing multiple commands in the then section</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># testuser=MySQL</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if grep $testuser /etc/passwd</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;This is my first command&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;This is my second command&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;I can even put in other commands beside echo:&quot;</span></span><br><span class="line"><span class="comment">#     ls -a /home/$testuser/.b*</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test3.sh </span><br><span class="line"><span class="comment"># _mysql:*:74:74:MySQL Server:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># This is my first command</span></span><br><span class="line"><span class="comment"># This is my second command</span></span><br><span class="line"><span class="comment"># I can even put in other commands beside echo:</span></span><br><span class="line"><span class="comment"># ls: /home/MySQL/.b*: No such file or directory</span></span><br></pre></td></tr></table></figure>

<p>PS：由于是 mac 系统，有点出入，但是目的还是达到了。顺便测了一下缩进，将 echo 的缩进去了一样 work</p>
<blockquote>
<p>Exploring the if-then-else Statement</p>
</blockquote>
<p>格式如下, </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">command</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>改进 test3.sh 如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing multiple commands in the then section</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># testuser=NoSuchUser</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if grep $testuser /etc/passwd</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;This is my first command&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;This is my second command&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;I can even put in other commands beside echo:&quot;</span></span><br><span class="line"><span class="comment">#     ls -a /home/$testuser/.b*</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The user $testuser does not exist on this system.&quot;</span></span><br><span class="line"><span class="comment">#     echo</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test4.sh </span><br><span class="line"><span class="comment"># The user NoSuchUser does not exist on this system.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Nesting if</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> command1</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">elif</span> command2</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    more commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>写脚本检测帐户是否存在，然后检测用户文件夹是否存在</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test5.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing nested ifs - use elif</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># testuser=NoSuchUser</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if grep $testuser /etc/passwd</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The user $testuser exists on this system&quot;</span></span><br><span class="line"><span class="comment"># elif ls -d /home/$testuser</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The user $testuser does not exist on this system&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;However, $testuset has directory.&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">chmod u+x test5.sh </span><br><span class="line">./test5.sh </span><br><span class="line"><span class="comment"># ls: /home/NoSuchUser: No such file or directory</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips</strong>: Keep in mind that, with an elif statement, any else statements immediately following it are for that elif code block. They are not part of a preceding if-then statement code block.(elif 之后紧跟的 else 是一对的，它不属于前面的 if-then)</p>
<p>多个 elif 串连的形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> command1</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 1</span><br><span class="line"><span class="keyword">elif</span> command2</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 2</span><br><span class="line"><span class="keyword">elif</span> command3</span><br><span class="line"><span class="keyword">then</span>    </span><br><span class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 3</span><br><span class="line"><span class="keyword">elif</span> command4</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 4</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Trying the test Command</p>
</blockquote>
<p>if-then 条件判断只支持 exit code，为了使它更通用，Linux 提供了 test 工具集，如果 test 判定结果为 TRUE 则返回 0 否则非 0，格式为 <code>test condition</code>, 将它和 if-then 结合，格式如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> condition</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>如果没有写 condition，则默认为非 0 返回值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test6.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the test command</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if test</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;No expression return a True&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;No expression return a False&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test6.sh </span><br><span class="line"><span class="comment"># No expression return a False</span></span><br></pre></td></tr></table></figure>

<p>将测试条件替换为变量，输出 True 的语句</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test6.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the test command</span></span><br><span class="line"><span class="comment"># my_variable=&quot;Full&quot;</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if my_variable</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The $my_variable expression return a True&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The $my_variable expression return a False&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test6.sh </span><br><span class="line"><span class="comment"># The Full expression return a False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># replace my_variable=&quot;&quot;</span></span><br><span class="line">./test6.sh </span><br><span class="line"><span class="comment"># The  expression return a False</span></span><br></pre></td></tr></table></figure>

<p>测试条件还可以简写成如下形式</p>
<p>Be careful; you <strong>must have a space</strong> after the first bracket and a space before the last bracket, or you’ll get an error message.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ condition ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>test condition 可以测试如下三种情景</p>
<ul>
<li>Numeric comparisons</li>
<li>String comparisons</li>
<li>File comparisions</li>
</ul>
<blockquote>
<p>Using numeric comparisons</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Comparison</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">n1 -eq n2</td>
<td align="left">Check if n1 is equal to n2</td>
</tr>
<tr>
<td align="left">n1 -ge n2</td>
<td align="left">Check if n1 greater than or equal to n2</td>
</tr>
<tr>
<td align="left">n1 -gt n2</td>
<td align="left">Check if n1 is greater than n2</td>
</tr>
<tr>
<td align="left">n1 -le n2</td>
<td align="left">Check if n1 is less than or equal to n2</td>
</tr>
<tr>
<td align="left">n1 -lt n2</td>
<td align="left">Check if n1 less than n2</td>
</tr>
<tr>
<td align="left">n1 -ne n2</td>
<td align="left">Check if n1 is not equal to n2</td>
</tr>
</tbody></table>
<p>test condition 对变量也是有效的，示例如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat numeric_test.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Using numeric test eveluations</span></span><br><span class="line"><span class="comment"># value1=10</span></span><br><span class="line"><span class="comment"># value2=11</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $value1 -gt 5 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The test value $value1 is greater than 5&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $value1 -eq $value2 ]</span></span><br><span class="line"><span class="comment"># then echo &quot;The values are equal&quot;</span></span><br><span class="line"><span class="comment"># else </span></span><br><span class="line"><span class="comment">#     echo &quot;The values are different&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./numeric_test.sh </span><br><span class="line"><span class="comment"># The test value 10 is greater than 5</span></span><br><span class="line"><span class="comment"># The values are different</span></span><br></pre></td></tr></table></figure>

<p>但是 test condition 有个缺陷，它不能测试浮点型数据</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">value1=5.55</span><br><span class="line">[ <span class="variable">$value1</span> -gt 5 ]; <span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># bash: [: 5.55: integer expression expected</span></span><br><span class="line"><span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<p><strong>Caution:</strong> Remember that the only numbers the bash shell can handle are integers.</p>
<blockquote>
<p>Using string comparisons</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Comparison</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">str1 = str2</td>
<td align="left">Check if str1 is the same as string str2</td>
</tr>
<tr>
<td align="left">str1 != str2</td>
<td align="left">Check if str1 is not the same as string str2</td>
</tr>
<tr>
<td align="left">str1 &lt; str2</td>
<td align="left">Check if str1 is less than str2</td>
</tr>
<tr>
<td align="left">str1 &gt; str2</td>
<td align="left">Check if str1 is greater than string str2</td>
</tr>
<tr>
<td align="left">-n str1</td>
<td align="left">Check if str1 has a length greater than zero</td>
</tr>
<tr>
<td align="left">-z str1</td>
<td align="left">Check if str1 has a length of zero</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test8.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing string equality</span></span><br><span class="line"><span class="comment"># testuser=baduser</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $USER != $testuser ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;This is $testuser&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;Welcome $testuser&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test8.sh </span><br><span class="line"><span class="comment"># This is baduser</span></span><br></pre></td></tr></table></figure>

<p>在处理 <code>&lt;</code> 和 <code>&gt;</code> 时，shell 会有一些很奇怪的注意点</p>
<ul>
<li><code>&lt;</code> 和 <code>&gt;</code> 必须使用转义符号，不然系统会把他们当作流操作</li>
<li><code>&lt;</code> 和 <code>&gt;</code> 的用法和 sort 中的用法时不一致的</li>
</ul>
<p>针对第一点的测试，测试中，比较符号被当成了流操作符，新生产了一个 hockey 文件。这个操作 exit code 是 0 所以执行了 true 的 loop. 你需要将条件语句改为 <code>if [ $val1 \&gt; $val2 ]</code> 才能生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat badtest.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # mis-using string comparisons</span></span><br><span class="line"><span class="comment"># val1=baseball</span></span><br><span class="line"><span class="comment"># val2=hockey</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $val1 &gt; $val2 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;$val1 is greater than $val2&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;$val1 is less than $val2&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">/badtest.sh </span><br><span class="line"><span class="comment"># baseball is greater than hockey</span></span><br><span class="line">ls</span><br><span class="line"><span class="comment"># badtest.sh      hockey</span></span><br></pre></td></tr></table></figure>

<p>针对第二点，sort 和 test 对 string 的比较是相反的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat test9b.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing string sort order</span></span><br><span class="line"><span class="comment"># val1=Testing</span></span><br><span class="line"><span class="comment"># val2=testing</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $val1 \&gt; $val2 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;$val1 is greater than $val2&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;$val1 is less than $val2&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test9b.sh </span><br><span class="line">Testing is less than testing</span><br><span class="line"></span><br><span class="line">sort &lt;&lt; EOF</span><br><span class="line">&gt; Testing</span><br><span class="line">&gt; testing</span><br><span class="line">&gt; EOF</span><br><span class="line">Testing</span><br><span class="line">testing</span><br></pre></td></tr></table></figure>

<p>PS: 这里和书本上有出入，我在 MacOS 里测试两者是一致的，大写要小于小些，可能 Ubantu 上不一样把，有机会可以测一测</p>
<p><strong>Note:</strong> The test command and test expressions use the standard mathematical comparison symbols for string compari-sons and text codes for numerical comparisons. This is a subtle feature that many programmers manage to get reversed. If you use the mathematical comparison symbols for numeric values, the shell interprets them as string values and may not produce the correct results.</p>
<p>test condition 的处理模式是 数字 + test codes(-eq); string + 运算符(&lt;/&gt;/=)，刚好是交叉的，便于记忆</p>
<p>对 <code>-n</code> 和 <code>-z</code> 进行测试，undefined 的变量默认长度为 0</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat test10.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing string length</span></span><br><span class="line"><span class="comment"># val1=testing</span></span><br><span class="line"><span class="comment"># val2=&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ -n $val1 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val1&#x27; is not empty&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val1&#x27; is empty&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ -z $val2 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val2&#x27; is empty&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val2&#x27; is not empty&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ -z $val3 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val3&#x27; is empty&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val3&#x27; is not empty&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test10.sh </span><br><span class="line"><span class="comment"># The string &#x27;testing&#x27; is not empty</span></span><br><span class="line"><span class="comment"># The string &#x27;&#x27; is empty</span></span><br><span class="line"><span class="comment"># The string &#x27;&#x27; is empty</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using file comparisons</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Comparison</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-d file</td>
<td align="left">Check if file exists and is a directory</td>
</tr>
<tr>
<td align="left">-e file</td>
<td align="left">Check if file or directory exists</td>
</tr>
<tr>
<td align="left">-f file</td>
<td align="left">Check if file exists and is a file</td>
</tr>
<tr>
<td align="left">-r file</td>
<td align="left">Check if file exists and is readable</td>
</tr>
<tr>
<td align="left">-s file</td>
<td align="left">Check if file exists and is not empty</td>
</tr>
<tr>
<td align="left">-w file</td>
<td align="left">Check if file exists and is writable</td>
</tr>
<tr>
<td align="left">-x file</td>
<td align="left">Check if file exists and is executable</td>
</tr>
<tr>
<td align="left">-O file</td>
<td align="left">Check if file exists and is owned by the current user</td>
</tr>
<tr>
<td align="left">-G file</td>
<td align="left">Check if file exists and the default group is the same as the current user</td>
</tr>
<tr>
<td align="left">file1 -nt file2</td>
<td align="left">Check if file1 is newer than file2</td>
</tr>
<tr>
<td align="left">file1 -ot file2</td>
<td align="left">Check if file1 is older than file2</td>
</tr>
</tbody></table>
<p>测试范例如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mkdir test_folder</span><br><span class="line">[ -d test_folder ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ -e test_folder ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ -e xxx ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line"></span><br><span class="line">chmod u+xrw test_file.sh </span><br><span class="line">ls -l test_file.sh </span><br><span class="line"><span class="comment"># -rwxr--r--  1 i306454  staff  190 May 25 17:51 test_file.sh</span></span><br><span class="line">[ -r test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ -w test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ -x test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line"></span><br><span class="line">chmod u-rxw test_file.sh </span><br><span class="line">ls -l test_file.sh </span><br><span class="line"><span class="comment"># ----r--r--  1 i306454  staff  190 May 25 17:51 test_file.sh</span></span><br><span class="line">[ -r test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line">[ -w test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line">[ -x test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line"></span><br><span class="line">touch tmp_file</span><br><span class="line">[ -s tmp_file ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line"><span class="built_in">echo</span> new line &gt;&gt; tmp_file </span><br><span class="line">[ -s tmp_file ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line"></span><br><span class="line">ls -l</span><br><span class="line"><span class="comment"># total 8</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  9 May 25 17:59 tmp_file</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  0 May 25 18:01 tmp_file2</span></span><br><span class="line">[ tmp_file2 -nt tmp_file ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ tmp_file -nt tmp_file2 ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line">[ tmp_file -ot tmp_file2 ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ tmp_file2 -ot tmp_file ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br></pre></td></tr></table></figure>

<h3 id="Considering-Compound-Testing"><a href="#Considering-Compound-Testing" class="headerlink" title="Considering Compound Testing"></a>Considering Compound Testing</h3><p>组合条件</p>
<ul>
<li>[ condition1 ] &amp;&amp; [  condition2 ]</li>
<li>[ condition1 ] || [  condition2 ]</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ -f tmp_file ] &amp;&amp; [ -d <span class="variable">$HOME</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br></pre></td></tr></table></figure>

<h3 id="Working-with-Advanced-if-then-Features"><a href="#Working-with-Advanced-if-then-Features" class="headerlink" title="Working with Advanced if-then Features"></a>Working with Advanced if-then Features</h3><p>if-then 的增强模式</p>
<ul>
<li>Double parentheses for mathematical expressions(双括号)</li>
<li>Double square brackets for advanced string handling functions(双方括号)</li>
</ul>
<blockquote>
<p>Using double parentheses</p>
</blockquote>
<p>创括号是针对算数运算的</p>
<p>test command 只提供了简单的算术运算，双括号提供的算力更强，效果和其他语言类似，格式 <code>(( expression ))</code>. 除了 test 支持的运算，它还支持如下运算</p>
<table>
<thead>
<tr>
<th align="left">Comparison</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">val++</td>
<td align="left">Post-incremnet</td>
</tr>
<tr>
<td align="left">val–</td>
<td align="left">Post-decrement</td>
</tr>
<tr>
<td align="left">++val</td>
<td align="left">Pre-increment</td>
</tr>
<tr>
<td align="left">–val</td>
<td align="left">Pre-decrement</td>
</tr>
<tr>
<td align="left">!</td>
<td align="left">Logical negation</td>
</tr>
<tr>
<td align="left">~</td>
<td align="left">Bitwise negation</td>
</tr>
<tr>
<td align="left">**</td>
<td align="left">Exponentiation</td>
</tr>
<tr>
<td align="left">&lt;&lt;</td>
<td align="left">Left bitwise shift</td>
</tr>
<tr>
<td align="left">&gt;&gt;</td>
<td align="left">Right bitwise shift</td>
</tr>
<tr>
<td align="left">&amp;</td>
<td align="left">Bitwise Boolean AND</td>
</tr>
<tr>
<td align="left">|</td>
<td align="left">Bitwise Boolean OR</td>
</tr>
<tr>
<td align="left">&amp;&amp;</td>
<td align="left">Logical AND</td>
</tr>
<tr>
<td align="left">||</td>
<td align="left">Logical OR</td>
</tr>
</tbody></table>
<p>测试范例如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ** 次方操作</span></span><br><span class="line">(( <span class="variable">$val1</span>**2 &gt; 90 )) &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using double bracket</p>
</blockquote>
<p>双方括号是针对字符运算的，格式为 <code>[[ expression ]]</code>. 除了 test 相同的计算外，他还额外提供了<strong>正则</strong>的支持</p>
<p><strong>Note:</strong> bash 是支持双方括号的，但是其他 shell 就不一定了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[ <span class="variable">$USER</span> == i* ]] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br></pre></td></tr></table></figure>

<p>PS: 双等(==)表示 string 符合 pattern，直接用等号也是可以的</p>
<h3 id="Considering-the-case-Command"><a href="#Considering-the-case-Command" class="headerlink" title="Considering the case Command"></a>Considering the case Command</h3><p>对应 Java 中的 switch-case 语法, 格式如下. 当内容和 pattern 匹配时，就会执行对应的语句</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> variable <span class="keyword">in</span></span><br><span class="line">pattern1 | pattern2) command1;;</span><br><span class="line">pattern3) command2;;</span><br><span class="line">*) default commands;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat test26.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # using the case command</span></span><br><span class="line"><span class="comment"># case $USER in </span></span><br><span class="line"><span class="comment"># rich | barbara)</span></span><br><span class="line"><span class="comment">#     echo &quot;Welcome $USER&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;Please enjoy your visit&quot;;;</span></span><br><span class="line"><span class="comment"># i306454)</span></span><br><span class="line"><span class="comment">#     echo &quot;Special testing account&quot;;;</span></span><br><span class="line"><span class="comment"># jessica)</span></span><br><span class="line"><span class="comment">#     echo &quot;Do not forget to log off when you&#x27;re done&quot;;;</span></span><br><span class="line"><span class="comment"># *)</span></span><br><span class="line"><span class="comment">#     echo &quot;Sorry, you are not allowed here&quot;;;</span></span><br><span class="line"><span class="comment"># esac</span></span><br><span class="line">./test26.sh </span><br><span class="line"><span class="comment"># Special testing account</span></span><br></pre></td></tr></table></figure>

<h3 id="Issues"><a href="#Issues" class="headerlink" title="Issues"></a>Issues</h3><p><strong>Issue1:</strong> 写脚本的时候，发现一个很奇怪的问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 未赋值的变脸 -n 会返回 true ?!</span></span><br><span class="line">[ -n <span class="variable">$ret23</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line"><span class="comment"># 经多方查证，需要加引号</span></span><br><span class="line">[ -n <span class="string">&quot;<span class="variable">$ret23</span>&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里就体现出增强型的好处了</span></span><br><span class="line">[[ -n <span class="variable">$ret23</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br></pre></td></tr></table></figure>

<p>以后可以的话都用增强型把，容错率更高</p>
<h2 id="More-Structured-Commands"><a href="#More-Structured-Commands" class="headerlink" title="More Structured Commands"></a>More Structured Commands</h2><p>这章介绍了其他一些流程控制的关键词</p>
<h3 id="The-for-Command"><a href="#The-for-Command" class="headerlink" title="The for Command"></a>The for Command</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> list</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>PS: for 和 do 也可以写一起(for var in list; do)，和 if-then 那样</p>
<blockquote>
<p>Reading values in a list</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test1.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # basic for command</span></span><br><span class="line"><span class="comment"># for test in a b c d e</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo The character is $test</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test1.sh </span><br><span class="line"><span class="comment"># The character is a</span></span><br><span class="line"><span class="comment"># The character is b</span></span><br><span class="line"><span class="comment"># The character is c</span></span><br><span class="line"><span class="comment"># The character is d</span></span><br><span class="line"><span class="comment"># The character is e</span></span><br></pre></td></tr></table></figure>

<p>当 for 结束后变量还会存在</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat test1b.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the for variable after the looping</span></span><br><span class="line"><span class="comment"># for test in a b c d e</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo The character is $test</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo The last character is $test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># test=Connecticut</span></span><br><span class="line"><span class="comment"># echo &quot;Wait, now we&#x27;re visiting $test&quot;</span></span><br><span class="line">./test1b.sh </span><br><span class="line"><span class="comment"># The character is a</span></span><br><span class="line"><span class="comment"># The character is b</span></span><br><span class="line"><span class="comment"># The character is c</span></span><br><span class="line"><span class="comment"># The character is d</span></span><br><span class="line"><span class="comment"># The character is e</span></span><br><span class="line"><span class="comment"># The last character is e</span></span><br><span class="line"><span class="comment"># Wait, now we&#x27;re visiting Connecticut</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading complex values in a list</p>
</blockquote>
<p>当 list 中包含一些标点时，结果可能就不是预期的那样了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat badtest1.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # another example of how not to use the for command</span></span><br><span class="line"><span class="comment"># for test in I don&#x27;t know if this&#x27;ll work, append some thing more?</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo The character is $test</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./badtest1.sh </span><br><span class="line"><span class="comment"># The character is I</span></span><br><span class="line"><span class="comment"># The character is dont know if thisll</span></span><br><span class="line"><span class="comment"># The character is work,</span></span><br><span class="line"><span class="comment"># The character is append</span></span><br><span class="line"><span class="comment"># The character is some</span></span><br><span class="line"><span class="comment"># The character is thing</span></span><br><span class="line"><span class="comment"># The character is more?</span></span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<ol>
<li>给引号加转义符(for test in I don&#39;t know if this&#39;ll work, append some thing more?)</li>
<li>将 string 用双引号包裹(for test in I don”‘“t know if this”‘“ll work, append some thing more?)</li>
</ol>
<p><code>for</code> 默认使用空格做分割，如果想要连词，你需要将对一个的词用双引号包裹起来</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat badtest2.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # another example of how not to use the for command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for test in Nevada New Hampshire New Mexico New York North Carolina</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Now going to $test&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./badtest2.sh </span><br><span class="line"><span class="comment"># Now going to Nevada</span></span><br><span class="line"><span class="comment"># Now going to New</span></span><br><span class="line"><span class="comment"># Now going to Hampshire</span></span><br><span class="line"><span class="comment"># Now going to New</span></span><br><span class="line"><span class="comment"># Now going to Mexico</span></span><br><span class="line"><span class="comment"># Now going to New</span></span><br><span class="line"><span class="comment"># Now going to York</span></span><br><span class="line"><span class="comment"># Now going to North</span></span><br><span class="line"><span class="comment"># Now going to Carolina</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update to: for test in Nevada &quot;New Hampshire&quot; &quot;New Mexico&quot; &quot;New York&quot;</span></span><br><span class="line">./badtest2.sh </span><br><span class="line"><span class="comment"># Now going to Nevada</span></span><br><span class="line"><span class="comment"># Now going to New Hampshire</span></span><br><span class="line"><span class="comment"># Now going to New Mexico</span></span><br><span class="line"><span class="comment"># Now going to New York</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading a list from a variable</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat test4.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # using a variable to hold the list</span></span><br><span class="line"><span class="comment"># list=&quot;Alabama Alaska Arizona Arkansas Colorado&quot;</span></span><br><span class="line"><span class="comment"># list=$list&quot; Connecticut&quot;</span></span><br><span class="line"><span class="comment"># for state in $list</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Have you ever visited $state?&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test4.sh </span><br><span class="line"><span class="comment"># Have you ever visited Alabama?</span></span><br><span class="line"><span class="comment"># Have you ever visited Alaska?</span></span><br><span class="line"><span class="comment"># Have you ever visited Arizona?</span></span><br><span class="line"><span class="comment"># Have you ever visited Arkansas?</span></span><br><span class="line"><span class="comment"># Have you ever visited Colorado?</span></span><br><span class="line"><span class="comment"># Have you ever visited Connecticut?</span></span><br></pre></td></tr></table></figure>

<p>PS: <code>list=$list&quot; Connecticut&quot;</code> 是 shell 中 append 字符串的常见操作</p>
<blockquote>
<p>Reading values from a command</p>
</blockquote>
<p>结合其他命令，计算出 list 的值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> a b c &gt; states</span><br><span class="line">cat test5.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # reading values from a file</span></span><br><span class="line"><span class="comment"># file=states</span></span><br><span class="line"><span class="comment"># for state in $(cat $file)</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Visit beautiful $state&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test5.sh </span><br><span class="line"><span class="comment"># Visit beautiful a</span></span><br><span class="line"><span class="comment"># Visit beautiful b</span></span><br><span class="line"><span class="comment"># Visit beautiful c</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Changing the field separator</p>
</blockquote>
<p>有一个特殊的环境变量叫做 IFS(internal field separator). 他可以作为分割 field 的依据。默认的分割符有</p>
<ul>
<li>A space</li>
<li>A tab</li>
<li>A newline</li>
</ul>
<p>如果你想要将换行作为分割符，你可以使用 <code>IFS=$&#39;\n&#39;</code></p>
<p><strong>Caution:</strong> 定制 IFS 之后一定要还原</p>
<p>测试环节：如何打印当前 IFS 的值？</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$IFS</span>&quot;</span> | hexdump</span><br><span class="line"><span class="comment"># 0000000 20 09 0a</span></span><br><span class="line"><span class="comment"># 0000003</span></span><br><span class="line"><span class="built_in">printf</span> %q <span class="string">&quot;<span class="variable">$IFS</span>&quot;</span></span><br><span class="line"><span class="comment"># &#x27; \t\n&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>Caution:</strong> 变量和引号之间的关系：</p>
<ul>
<li>单引号，所见即所得。写什么即是什么</li>
<li>双引号，中间的变量会做计算</li>
<li>没符号，用于连续的内容，如果内容中带空格，需要加双引号</li>
</ul>
<p>脚本中 <code>IFS.OLD=$IFS</code> 的赋值语句经常会抛异常 <code>./test_csv.sh: line 3: IFS.OLD=: command not found</code> 但是写成 <code>IFS_OLD</code> 的话就可以运行，可能是点号的形式会变成其他一些什么调用也说不定。以后为了稳定，还是用下划线的形式把 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IFS_OLD=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">&lt;use the new IFS value <span class="keyword">in</span> code&gt;</span><br><span class="line">IFS=<span class="variable">$IFS_OLD</span></span><br></pre></td></tr></table></figure>

<p>其他定制分割符 <code>IFS=:</code>, 或者多分割符 <code>IFS=$&#39;\n&#39;:;&quot;</code></p>
<blockquote>
<p>Reading a directory using wildcards</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat test6.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # iterate through all the files in a directory</span></span><br><span class="line"><span class="comment"># for file in /Users/i306454/tmp/*</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     if [ -d &quot;$file&quot; ]</span></span><br><span class="line"><span class="comment">#     then </span></span><br><span class="line"><span class="comment">#         echo &quot;$file is a directory&quot;</span></span><br><span class="line"><span class="comment">#     elif [ -f &quot;$file&quot; ]</span></span><br><span class="line"><span class="comment">#     then</span></span><br><span class="line"><span class="comment">#         echo &quot;$file is a file&quot;</span></span><br><span class="line"><span class="comment">#     fi</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test6.sh </span><br><span class="line"><span class="comment"># /Users/i306454/tmp/backup is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/bash_test is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/csv is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/dfile is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/ifenduser.sh is a file</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/plantuml is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/sh is a directory</span></span><br></pre></td></tr></table></figure>

<p>PS: 在这个例子中有一个很有意思的点，在 test 中，将变量 file 使用双引号包裹起来了。这是因为 Linux 中带空格的文件或文件夹是合法的，如果没有引号，解析就会出错</p>
<p><strong>Caution:</strong> It’s always a good idea to test each file or directory before trying to process it.</p>
<h3 id="The-C-Style-for-command"><a href="#The-C-Style-for-command" class="headerlink" title="The C-Style for command"></a>The C-Style for command</h3><p>C 语言中 for 循环如下</p>
<blockquote>
<p>The C language for command</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The next number is %d\n&quot;</span>, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>bash 中也提供了类似的功能, 语法为 <code>for (( variable assignment; condition; iteration process ))</code> 例子：<code>for(( a=1; a&lt;10; a++ ))</code></p>
<p>限制：</p>
<ul>
<li>The assignment of the variable value can contain space</li>
<li>The variable in the condition isn’t preceded with a dollar sign</li>
<li>The equation for the iteration process doesn’t use the expr command format</li>
</ul>
<p>这种用法，对我倒是很亲切，但是和之前用过的那些变量赋值之类的语句确实有一些语法差异的。这个语句中各种缩进，空格都不作限制</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test8.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the C-style for loop</span></span><br><span class="line"><span class="comment"># for ((i=1; i&lt;= 3; i++))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;The next number is $i&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test8.sh </span><br><span class="line"><span class="comment"># The next number is 1</span></span><br><span class="line"><span class="comment"># The next number is 2</span></span><br><span class="line"><span class="comment"># The next number is 3</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using multiple variables</p>
</blockquote>
<p>for 中包含多个参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test9.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the C-style for loop</span></span><br><span class="line"><span class="comment"># for ((a=1, b=10; a&lt;= 3; a++, b--))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo $a - $b</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test9.sh </span><br><span class="line"><span class="comment"># 1 - 10</span></span><br><span class="line"><span class="comment"># 2 - 9</span></span><br><span class="line"><span class="comment"># 3 - 8</span></span><br></pre></td></tr></table></figure>

<h3 id="The-while-Command"><a href="#The-while-Command" class="headerlink" title="The while Command"></a>The while Command</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">test</span> <span class="built_in">command</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    other commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test10.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # while command test</span></span><br><span class="line"><span class="comment"># var1=3</span></span><br><span class="line"><span class="comment"># while [ $var1 -gt 0 ]</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo $var1</span></span><br><span class="line"><span class="comment">#     var1=$[ $var1 - 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test10.sh </span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using multiple test commands</p>
</blockquote>
<p>while 判断的时候可以接多个条件，但是只有最后一个条件的 exit code 起决定作用。就算第一个条件我直接改为 <code>cmd</code> 每次都抛错，循环照常进行</p>
<p>还有，每个条件要新起一行, 当然用分号隔开也是可以的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test11.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing a multicommand while loop</span></span><br><span class="line"><span class="comment"># var1=3</span></span><br><span class="line"><span class="comment"># while echo $var1</span></span><br><span class="line"><span class="comment">#     [ $var1 -gt 0 ]</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;This is inside the loop&quot;</span></span><br><span class="line"><span class="comment">#     var1=$[ $var1 - 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test11.sh </span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># This is inside the loop</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># This is inside the loop</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># This is inside the loop</span></span><br><span class="line"><span class="comment"># 0</span></span><br></pre></td></tr></table></figure>

<h3 id="The-until-Command"><a href="#The-until-Command" class="headerlink" title="The until Command"></a>The until Command</h3><p>语意上和 while 相反，但是用法一致</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">until <span class="built_in">test</span> commands</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    other commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test12 </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # using the until command</span></span><br><span class="line"><span class="comment"># var1=100</span></span><br><span class="line"><span class="comment"># until [ $var1 -eq 0 ]</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo $var1</span></span><br><span class="line"><span class="comment">#     var1=$[ $var1 - 25 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test12 </span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 75</span></span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 25</span></span><br></pre></td></tr></table></figure>

<h3 id="Nesting-Loops"><a href="#Nesting-Loops" class="headerlink" title="Nesting Loops"></a>Nesting Loops</h3><p>循环嵌套，很常见</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat test14             </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # nesting for loops</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;=3; a++))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Starting loop $a:&quot;</span></span><br><span class="line"><span class="comment">#     for (( b=1; b&lt;=3; b++ ))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         echo &quot;    Inside loop: $b&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test14</span><br><span class="line"><span class="comment"># Starting loop 1:</span></span><br><span class="line"><span class="comment">#     Inside loop: 1</span></span><br><span class="line"><span class="comment">#     Inside loop: 2</span></span><br><span class="line"><span class="comment">#     Inside loop: 3</span></span><br><span class="line"><span class="comment"># Starting loop 2:</span></span><br><span class="line"><span class="comment">#     Inside loop: 1</span></span><br><span class="line"><span class="comment">#     Inside loop: 2</span></span><br><span class="line"><span class="comment">#     Inside loop: 3</span></span><br><span class="line"><span class="comment"># Starting loop 3:</span></span><br><span class="line"><span class="comment">#     Inside loop: 1</span></span><br><span class="line"><span class="comment">#     Inside loop: 2</span></span><br><span class="line"><span class="comment">#     Inside loop: 3</span></span><br></pre></td></tr></table></figure>

<p>while + for 的例子。树上的例子 for 中 边界条件是 <code>$var2&lt;3;</code> 和之前表现的语法不一样，试了一下，有无 <code>$</code> 都是可以的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat test14</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # nesting for loops</span></span><br><span class="line"><span class="comment"># var1=3</span></span><br><span class="line"><span class="comment"># while [ $var1 -ge 0 ]</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Outer loop: $var1&quot;</span></span><br><span class="line"><span class="comment">#     for (( var2=1; var2&lt;3; var2++))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         var3=$[ $var1*$var2 ]</span></span><br><span class="line"><span class="comment">#         echo &quot;    Inner loop: $var1 * $var2 = $var3&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment">#     var1=$[ $var1 - 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test14</span><br><span class="line"><span class="comment"># Outer loop: 3</span></span><br><span class="line"><span class="comment">#     Inner loop: 3 * 1 = 3</span></span><br><span class="line"><span class="comment">#     Inner loop: 3 * 2 = 6</span></span><br><span class="line"><span class="comment"># Outer loop: 2</span></span><br><span class="line"><span class="comment">#     Inner loop: 2 * 1 = 2</span></span><br><span class="line"><span class="comment">#     Inner loop: 2 * 2 = 4</span></span><br><span class="line"><span class="comment"># Outer loop: 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 1 * 1 = 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 1 * 2 = 2</span></span><br><span class="line"><span class="comment"># Outer loop: 0</span></span><br><span class="line"><span class="comment">#     Inner loop: 0 * 1 = 0</span></span><br><span class="line"><span class="comment">#     Inner loop: 0 * 2 = 0</span></span><br></pre></td></tr></table></figure>

<h3 id="Looping-on-File-Data"><a href="#Looping-on-File-Data" class="headerlink" title="Looping on File Data"></a>Looping on File Data</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4128235/what-is-the-exact-meaning-of-ifs-n">Stackoverflow</a> 上看到一篇解释 IFS=$’\n’ 的帖子，挺好。一句话就是 <code>$&#39;...&#39;</code> 的语法可以表示转义符</p>
<p>通常来说，你会需要遍历文件中的内容，这需要两个知识点</p>
<ol>
<li>Using nested loops</li>
<li>Changing the IFS environment variable</li>
</ol>
<p>通过设置 IFS 你可以在包含空格的情况下处理一行内容. 下面是处理 <code>/etc/passwd</code> 文件是案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat test1</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # changing the IFS value</span></span><br><span class="line"><span class="comment"># IFS.OLD=$IFS</span></span><br><span class="line"><span class="comment"># IFS=$&#x27;\n&#x27;</span></span><br><span class="line"><span class="comment"># for entry in $(cat /etc/passwd)</span></span><br><span class="line"><span class="comment"># do </span></span><br><span class="line"><span class="comment">#     echo &quot;Values in $entry -&quot;</span></span><br><span class="line"><span class="comment">#     IFS=:</span></span><br><span class="line"><span class="comment">#     for value in $entry</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         echo &quot;    $value&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test1</span><br><span class="line"><span class="comment"># Values in _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment">#     _oahd</span></span><br><span class="line"><span class="comment">#     badtest1.sh</span></span><br><span class="line"><span class="comment">#     badtest2.sh</span></span><br><span class="line"><span class="comment">#     test1</span></span><br><span class="line"><span class="comment">#     test12</span></span><br><span class="line"><span class="comment">#     test14</span></span><br><span class="line"><span class="comment">#     test15</span></span><br><span class="line"><span class="comment">#     441</span></span><br><span class="line"><span class="comment">#     441</span></span><br><span class="line"><span class="comment">#     OAH Daemon</span></span><br><span class="line"><span class="comment">#     /var/empty</span></span><br><span class="line"><span class="comment">#     /usr/bin/false</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<h3 id="Controlling-the-loop"><a href="#Controlling-the-loop" class="headerlink" title="Controlling the loop"></a>Controlling the loop</h3><p>通过 break, continue 控制流程</p>
<blockquote>
<p>The break command</p>
</blockquote>
<p>打断单层循环, 这个语法适用于任何循环语句，比如 for, while, until 等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat test17</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Breaking out of a for loop</span></span><br><span class="line"><span class="comment"># for var1 in 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     if [ $var1 -eq 3 ]</span></span><br><span class="line"><span class="comment">#     then</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line"><span class="comment">#     fi</span></span><br><span class="line"><span class="comment">#     echo &quot;Iteration number: $var1&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"><span class="comment"># echo &quot;The for loop is completed&quot;</span></span><br><span class="line">./test17</span><br><span class="line"><span class="comment"># Iteration number: 1</span></span><br><span class="line"><span class="comment"># Iteration number: 2</span></span><br><span class="line"><span class="comment"># The for loop is completed</span></span><br></pre></td></tr></table></figure>

<p>打断内层循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat test19</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Breaking out of an inner loop</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;4; a++ ))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Outer loop: $a&quot;</span></span><br><span class="line"><span class="comment">#     for (( b=1; b&lt;4; b++ ))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         if [ $b -eq 2 ]</span></span><br><span class="line"><span class="comment">#         then</span></span><br><span class="line"><span class="comment">#             break</span></span><br><span class="line"><span class="comment">#         fi</span></span><br><span class="line"><span class="comment">#         echo &quot;    Inner loop: $b&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test19</span><br><span class="line"><span class="comment"># Outer loop: 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 1</span></span><br><span class="line"><span class="comment"># Outer loop: 2</span></span><br><span class="line"><span class="comment">#     Inner loop: 1</span></span><br><span class="line"><span class="comment"># Outer loop: 3</span></span><br><span class="line"><span class="comment">#     Inner loop: 1</span></span><br></pre></td></tr></table></figure>

<p>在内部循环执行过程中，打断外层循环，这个特性倒是很新颖，Java 中没见过 Haha</p>
<p><code>break n</code> 默认是 1，打断当前的循环，设置成 2 就是打断外面一层直接退出。下面例子中，我们通过在 inner for 中 break 2 直接退出了外层 for 循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat test20 </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Breaking out of an outer loop</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;4; a++ ))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Outer loop: $a&quot;</span></span><br><span class="line"><span class="comment">#     for (( b=1; b&lt;4; b++ ))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         if [ $b -gt 2 ]</span></span><br><span class="line"><span class="comment">#         then</span></span><br><span class="line"><span class="comment">#             break 2</span></span><br><span class="line"><span class="comment">#         fi</span></span><br><span class="line"><span class="comment">#         echo &quot;    Inner loop: $b&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test20</span><br><span class="line"><span class="comment"># Outer loop: 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The continue command</p>
</blockquote>
<p>提前结束循环，继续下一次循环. 下面例子中，当当前变量 3 &lt; x &lt; 8 时跳过打印. 前面介绍的循环体都适用，如 for, while 和 until</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test21 </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Using the continue command</span></span><br><span class="line"><span class="comment"># for (( var1=1; var1&lt;10; var1++ ))</span></span><br><span class="line"><span class="comment"># do </span></span><br><span class="line"><span class="comment">#     if [ $var1 -gt 3 ] &amp;&amp; [ $var1 -lt 8 ]</span></span><br><span class="line"><span class="comment">#     then</span></span><br><span class="line"><span class="comment">#         continue</span></span><br><span class="line"><span class="comment">#     fi</span></span><br><span class="line"><span class="comment">#     echo &quot;Iteration number: $var1&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test21 </span><br><span class="line"><span class="comment"># Iteration number: 1</span></span><br><span class="line"><span class="comment"># Iteration number: 2</span></span><br><span class="line"><span class="comment"># Iteration number: 3</span></span><br><span class="line"><span class="comment"># Iteration number: 8</span></span><br><span class="line"><span class="comment"># Iteration number: 9</span></span><br></pre></td></tr></table></figure>

<p>和 break 一样，continue 也支持 <code>continue n</code> 来跳过循环。测试用例中，当外层变量值 2 &lt; x &lt; 4 时，跳过打印</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat test22</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Continuing an outer loop</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;=5; a++ ))</span></span><br><span class="line"><span class="comment"># do </span></span><br><span class="line"><span class="comment">#     echo &quot;Iteration $a:&quot;</span></span><br><span class="line"><span class="comment">#     for (( b=1; b&lt;3; b++))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         if [ $a -gt 2 ] &amp;&amp; [ $a -lt 4 ]</span></span><br><span class="line"><span class="comment">#         then</span></span><br><span class="line"><span class="comment">#             continue 2</span></span><br><span class="line"><span class="comment">#         fi</span></span><br><span class="line"><span class="comment">#         var3=$[ $a * $b ]</span></span><br><span class="line"><span class="comment">#         echo &quot;    The result of $a * $b is $var3&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test22</span><br><span class="line"><span class="comment"># Iteration 1:</span></span><br><span class="line"><span class="comment">#     The result of 1 * 1 is 1</span></span><br><span class="line"><span class="comment">#     The result of 1 * 2 is 2</span></span><br><span class="line"><span class="comment"># Iteration 2:</span></span><br><span class="line"><span class="comment">#     The result of 2 * 1 is 2</span></span><br><span class="line"><span class="comment">#     The result of 2 * 2 is 4</span></span><br><span class="line"><span class="comment"># Iteration 3:</span></span><br><span class="line"><span class="comment"># Iteration 4:</span></span><br><span class="line"><span class="comment">#     The result of 4 * 1 is 4</span></span><br><span class="line"><span class="comment">#     The result of 4 * 2 is 8</span></span><br><span class="line"><span class="comment"># Iteration 5:</span></span><br><span class="line"><span class="comment">#     The result of 5 * 1 is 5</span></span><br><span class="line"><span class="comment">#     The result of 5 * 2 is 10</span></span><br></pre></td></tr></table></figure>

<h3 id="Processing-the-Output-of-a-Loop"><a href="#Processing-the-Output-of-a-Loop" class="headerlink" title="Processing the Output of a Loop"></a>Processing the Output of a Loop</h3><p><code>for</code> 中打印的语句可以在 <code>done</code> 后面接文件操作符一起导入，还有这种功能。。。那我之前写脚本用的 printf 不是显得有点呆</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test23</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # redirecting the for output to a file</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;=5; a++ ))</span></span><br><span class="line"><span class="comment"># do </span></span><br><span class="line"><span class="comment">#     echo &quot;The number is $a&quot;</span></span><br><span class="line"><span class="comment"># done &gt; test23.txt</span></span><br><span class="line">cat test23.txt </span><br><span class="line"><span class="comment"># The number is 1</span></span><br><span class="line"><span class="comment"># The number is 2</span></span><br><span class="line"><span class="comment"># The number is 3</span></span><br><span class="line"><span class="comment"># The number is 4</span></span><br><span class="line"><span class="comment"># The number is 5</span></span><br></pre></td></tr></table></figure>

<p>PS: 试了一下，<code>echo -n</code> 也是 OK 的</p>
<p>同理，<code>done</code> 后面还可以接其他的命令, 这个扩展很赞</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test24</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # piping a loop to another command</span></span><br><span class="line"><span class="comment"># for state in &quot;North Dakota&quot; Connecticut Illinois Alabama Tennessee</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;$state is the next place to go&quot;</span></span><br><span class="line"><span class="comment"># done | sort</span></span><br><span class="line"><span class="comment"># echo &quot;This completes our travels&quot;</span></span><br><span class="line">./test24</span><br><span class="line"><span class="comment"># Alabama is the next place to go</span></span><br><span class="line"><span class="comment"># Connecticut is the next place to go</span></span><br><span class="line"><span class="comment"># Illinois is the next place to go</span></span><br><span class="line"><span class="comment"># North Dakota is the next place to go</span></span><br><span class="line"><span class="comment"># Tennessee is the next place to go</span></span><br><span class="line"><span class="comment"># This completes our travels</span></span><br></pre></td></tr></table></figure>

<h3 id="Practical-Examples"><a href="#Practical-Examples" class="headerlink" title="Practical Examples"></a>Practical Examples</h3><p>一些实用的脚本范例</p>
<blockquote>
<p>Finding executable files</p>
</blockquote>
<p>通过遍历 PATH 中的路径，统计处你可以运行的 commands 列表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat test25</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Finding file in the PATH</span></span><br><span class="line"><span class="comment"># IFS.OLD=$IFS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># IFS=:</span></span><br><span class="line"><span class="comment"># for folder in $PATH</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;$folder:&quot;</span></span><br><span class="line"><span class="comment">#     for file in $folder/*</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         if [ -x $file ]</span></span><br><span class="line"><span class="comment">#         then</span></span><br><span class="line"><span class="comment">#             echo &quot;    $file&quot;</span></span><br><span class="line"><span class="comment">#         fi</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># IFS=$IFS.OLD</span></span><br><span class="line">./test25 | more</span><br><span class="line"><span class="comment"># /Users/i306454/.jenv/bin:</span></span><br><span class="line"><span class="comment"># /usr/local/sbin:</span></span><br><span class="line"><span class="comment">#     /usr/local/sbin/unbound</span></span><br><span class="line"><span class="comment">#     ....</span></span><br></pre></td></tr></table></figure>

<p>PS: 这个 <code>more</code> 就用的很灵性！！</p>
<blockquote>
<p>Creating multiple user accounts</p>
</blockquote>
<p>将需要创建的新用户写到文件中，并通过脚本解析文件，批量创建</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Process new user accounts</span></span><br><span class="line"></span><br><span class="line">input=<span class="string">&quot;users.csv&quot;</span></span><br><span class="line"><span class="keyword">while</span> IFS=<span class="string">&#x27;,&#x27;</span> <span class="built_in">read</span> -r userid name</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;adding <span class="variable">$userid</span>&quot;</span></span><br><span class="line">    useradd -c <span class="string">&quot;<span class="variable">$name</span>&quot;</span> -m <span class="variable">$userid</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="string">&quot;<span class="variable">$input</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Chapter-14-Handling-User-Input"><a href="#Chapter-14-Handling-User-Input" class="headerlink" title="Chapter 14: Handling User Input"></a>Chapter 14: Handling User Input</h2><p>这章主要讲如何在脚本中做交互</p>
<h3 id="Passing-Parameters"><a href="#Passing-Parameters" class="headerlink" title="Passing Parameters"></a>Passing Parameters</h3><blockquote>
<p>Reading parameters</p>
</blockquote>
<p>bash 会将传入的所有变量都赋给 positional parameters. 这些位置变量以 <code>$</code> 开头，<code>$0</code> 为脚本名称，<code>$1</code> 为第一个参数，以此类推</p>
<p>根据传入参数计算斐波那契额终值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test1</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Using one command line parameter</span></span><br><span class="line"><span class="comment"># factorial=1</span></span><br><span class="line"><span class="comment"># for (( number=1; number&lt;=$1; number++ ))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     factorial=$[ $factorial * $number ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"><span class="comment"># echo The factorial of $1 is $factorial</span></span><br><span class="line">./test1 5</span><br><span class="line"><span class="comment"># The factorial of 5 is 120</span></span><br></pre></td></tr></table></figure>

<p>多参数调用案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test2</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing two command line parameters</span></span><br><span class="line"><span class="comment"># total=$[ $1 * $2 ]</span></span><br><span class="line"><span class="comment"># echo The first parameter is $1</span></span><br><span class="line"><span class="comment"># echo The first parameter is $2</span></span><br><span class="line"><span class="comment"># echo The total value is $total</span></span><br><span class="line"></span><br><span class="line">./test2 2 5</span><br><span class="line"><span class="comment"># The first parameter is 2</span></span><br><span class="line"><span class="comment"># The first parameter is 5</span></span><br><span class="line"><span class="comment"># The total value is 10</span></span><br></pre></td></tr></table></figure>

<p>字符串作为参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat test3</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing string parameters</span></span><br><span class="line"><span class="comment"># echo Hello $1, glad to meet you</span></span><br><span class="line"></span><br><span class="line">bash-5.1$ ./test3 jack</span><br><span class="line"><span class="comment"># Hello jack, glad to meet you</span></span><br></pre></td></tr></table></figure>

<p>如果字符串之间有空格，需要用引号包裹起来</p>
<p>当参数数量超过 <strong>9</strong> 个的时候，你需要用花括号来调用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">at ./test4</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # handling lots of parameters</span></span><br><span class="line"><span class="comment"># total=$[ $&#123;10&#125; * $&#123;11&#125; ]</span></span><br><span class="line"><span class="comment"># echo The tenth parameter is $&#123;10&#125;</span></span><br><span class="line"><span class="comment"># echo The eleventh parameter is $&#123;11&#125;</span></span><br><span class="line"><span class="comment"># echo The total is $total</span></span><br><span class="line">./test4 1 2 3 4 5 6 7 8 9 10 11 12</span><br><span class="line"><span class="comment"># The tenth parameter is 10</span></span><br><span class="line"><span class="comment"># The eleventh parameter is 11</span></span><br><span class="line"><span class="comment"># The total is 110</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading the script name</p>
</blockquote>
<p>`$0 代表了脚本文件的名字</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test5</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the $0 parameter</span></span><br><span class="line"><span class="comment"># echo the zero parameter is set to: $0</span></span><br><span class="line"></span><br><span class="line">bash test5</span><br><span class="line"><span class="comment"># the zero parameter is set to: test5</span></span><br><span class="line">./test5</span><br><span class="line"><span class="comment"># the zero parameter is set to: ./test5</span></span><br><span class="line">bash /Users/i306454/tmp/bash_test/test5</span><br><span class="line"><span class="comment"># the zero parameter is set to: /Users/i306454/tmp/bash_test/test5</span></span><br></pre></td></tr></table></figure>

<p>不一样的调用方式，得到的第 0 参数值会不一样，如果像统一得到文件名，可以使用 basename 命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat test5b</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Using basename with the $0 parameter</span></span><br><span class="line"><span class="comment"># name=$(basename $0)</span></span><br><span class="line"><span class="comment"># echo the zero parameter is set to: $name</span></span><br><span class="line"></span><br><span class="line">bash-5.1$ ./test5b</span><br><span class="line"><span class="comment"># the zero parameter is set to: test5b</span></span><br><span class="line">sh test5b</span><br><span class="line"><span class="comment"># the zero parameter is set to: test5b</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Testing parameters</p>
</blockquote>
<p>当脚本中需要用到参数，但是参数没有给，则脚本会抛异常，但是我们可以更优雅的处理这种情况</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test7 </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing parameters before use</span></span><br><span class="line"><span class="comment"># if [ -n &quot;$1&quot; ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo Hello $1, glad to meet you.</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;Sorry, you did not identity yourself.&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"></span><br><span class="line">./test7 jack</span><br><span class="line"><span class="comment"># Hello jack, glad to meet you.</span></span><br><span class="line">./test7</span><br><span class="line"><span class="comment"># Sorry, you did not identity yourself.</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Special-Parameter-Variables"><a href="#Using-Special-Parameter-Variables" class="headerlink" title="Using Special Parameter Variables"></a>Using Special Parameter Variables</h3><blockquote>
<p>Counting parameters</p>
</blockquote>
<p><code>$#</code> 用于统计参数数量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test8</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Getting the number of parameters</span></span><br><span class="line"><span class="comment"># echo There were $# parameters supplied.</span></span><br><span class="line">./test8</span><br><span class="line"><span class="comment"># There were 0 parameters supplied.</span></span><br><span class="line">./test8 123</span><br><span class="line"><span class="comment"># There were 1 parameters supplied.</span></span><br><span class="line">./test8 1 2 3</span><br><span class="line"><span class="comment"># There were 3 parameters supplied.</span></span><br><span class="line">./test8 <span class="string">&quot;jack zheng&quot;</span></span><br><span class="line"><span class="comment"># There were 1 parameters supplied.</span></span><br></pre></td></tr></table></figure>

<p>根据上面的特性我们可以试着发散一下思路，尝试拿到最后一个参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat badtest1</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing grabbing last parameter</span></span><br><span class="line"><span class="comment"># echo The last parameter was $&#123;$#&#125;</span></span><br><span class="line">./badtest1 1 2 3</span><br><span class="line"><span class="comment"># The last parameter was 13965</span></span><br></pre></td></tr></table></figure>

<p>尝试失败，语法上来说，花括号中间是不允许有 <code>$</code> 符号的，你可以用叹号表达上面的意思</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing grabbing last parameter</span></span><br><span class="line"><span class="comment"># echo The last parameter was $&#123;!#&#125;</span></span><br><span class="line"></span><br><span class="line">./badtest1 1 2 3</span><br><span class="line"><span class="comment"># The last parameter was 3</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Grabbing all the data</p>
</blockquote>
<p>你可以使用 <code>$*</code> 或者 <code>$@</code> 拿到所有的参数，区别如下</p>
<ul>
<li><code>$*</code> 会将所有的参数当作一个变量对待</li>
<li><code>$@</code> 会将所有的参数当作类似数组那种概念，分开对待。也就是说，你可以在 for 中循环处理</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test11</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing $* and $@</span></span><br><span class="line"><span class="comment"># echo</span></span><br><span class="line"><span class="comment"># echo &quot;Using the \$* method: $*&quot;</span></span><br><span class="line"><span class="comment"># echo &quot;Using the \$@ method: $@&quot;</span></span><br><span class="line"></span><br><span class="line">./test11 a b c d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using the $* method: a b c d</span></span><br><span class="line"><span class="comment"># Using the $@ method: a b c d</span></span><br></pre></td></tr></table></figure>

<p>看上去没区别。。。这里需要结合 for 来观察</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat test12</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing $* and $@</span></span><br><span class="line"><span class="comment"># echo</span></span><br><span class="line"><span class="comment"># count=1</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># for param in &quot;$*&quot;</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;\$* Parameter #$count = $param&quot;</span></span><br><span class="line"><span class="comment">#     count=$[ $count + 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># echo</span></span><br><span class="line"><span class="comment"># count=1</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># for param in &quot;$@&quot;</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;\$@ Parameter #$count = $param&quot;</span></span><br><span class="line"><span class="comment">#     count=$[ $count + 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test12 a b c d</span><br><span class="line"></span><br><span class="line"><span class="comment"># $* Parameter #1 = a b c d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $@ Parameter #1 = a</span></span><br><span class="line"><span class="comment"># $@ Parameter #2 = b</span></span><br><span class="line"><span class="comment"># $@ Parameter #3 = c</span></span><br><span class="line"><span class="comment"># $@ Parameter #4 = d</span></span><br></pre></td></tr></table></figure>

<h3 id="Being-Shify"><a href="#Being-Shify" class="headerlink" title="Being Shify"></a>Being Shify</h3><p>我们可以通过 <code>shift</code> 关键字将参数左移，默认左移一位.</p>
<p>PS: note that the value for variable <code>$0</code>, the program name, remains unchanged</p>
<p>PPS: Be careful when working with the shift command. When a parameter is shifted out, its value is lost and can’t be recovered.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test13</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Demostrating the shift command</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span> = <span class="variable">$1</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test13 a b c d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Parameter #1 = a</span></span><br><span class="line"><span class="comment"># Parameter #2 = b</span></span><br><span class="line"><span class="comment"># Parameter #3 = c</span></span><br><span class="line"><span class="comment"># Parameter #4 = d</span></span><br></pre></td></tr></table></figure>

<p>移动多个位置测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test14</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Demostrating a multi-position shift</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The original parameters: $*&quot;</span></span><br><span class="line"><span class="built_in">shift</span> 2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The changed parameters: $*&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Here is the new first parameter: <span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test14 1 2 3 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># The original parameters: 1 2 3 4</span></span><br><span class="line"><span class="comment"># The changed parameters: 3 4</span></span><br><span class="line"><span class="comment"># Here is the new first parameter: 3</span></span><br></pre></td></tr></table></figure>

<h3 id="Working-with-Options"><a href="#Working-with-Options" class="headerlink" title="Working with Options"></a>Working with Options</h3><p>介绍三种添加 Options 的方法，Options 顾名思义，就是命令中的可选参数。</p>
<blockquote>
<p>Finding your options</p>
</blockquote>
<p><strong>单个依次处理法：</strong> 可以使用 case + shift 的语法识别 options。将预先设置的 Options 添加在 case 的过滤列表中，然后遍历 <code>$1</code> 识别它</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat test15</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Extracting command line options as parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> </span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span>;;</span><br><span class="line">        -b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option&quot;</span>;;</span><br><span class="line">        -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span>;;</span><br><span class="line">         *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test15 -a -b -c -d asd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># -d is not an option</span></span><br><span class="line"><span class="comment"># asd is not an option</span></span><br></pre></td></tr></table></figure>

<p><strong>Options parameters 分开处理法：</strong> 我们可以认为的在两种参数中间添加一个分割符，比如 <code>--</code> 作为 options 的结束和 parameter 的开始. 在脚本中现实的识别并处理它。</p>
<p>PS: 突然意识到 <code>$0</code> 是不算在 <code>$*</code> 和 <code>$@</code> 中的</p>
<p>下面的例子中，如果没有 <code>--</code>，则所有参数都在第一个 do-while 中处理了。加了之后会在两个 loop 中处理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">cat test16</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Extracting options and parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span>;;</span><br><span class="line">        -b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option&quot;</span>;;</span><br><span class="line">        -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span>;;</span><br><span class="line">        --) <span class="built_in">shift</span></span><br><span class="line">            <span class="built_in">break</span>;;</span><br><span class="line">         *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test16 -c -a -b test1 test2 test3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option</span></span><br><span class="line"><span class="comment"># test1 is not an option</span></span><br><span class="line"><span class="comment"># test2 is not an option</span></span><br><span class="line"><span class="comment"># test3 is not an option</span></span><br><span class="line"></span><br><span class="line">./test16 -c -a -b -- test1 test2 test3</span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option</span></span><br><span class="line"><span class="comment"># Parameter #1: test1</span></span><br><span class="line"><span class="comment"># Parameter #2: test2</span></span><br><span class="line"><span class="comment"># Parameter #3: test3</span></span><br></pre></td></tr></table></figure>

<p><strong>带值的 options 处理：</strong> 有些命令中 options 是带值的，比如 <code>./testing.sh -a test1 -b -c -d test2</code>。这是我们就需要在脚本中识别可选参对应的值</p>
<p>下面的例子中 <code>-b test1</code> 是一个带值的可选参数，我们在 识别到 <code>-b</code> 后立即拿到 <code>$2</code> 即为对应的值</p>
<p>PS: 但是怎么看，bash 中添加可选参数都很麻烦啊，如果是可选参数带多个值呢，那不是还得加逻辑。。。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat test17</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Extracting command line options and values</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span>;;</span><br><span class="line">        -b) param=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Found the -b option, with parameter value <span class="variable">$param</span>&quot;</span></span><br><span class="line">            <span class="built_in">shift</span> ;;</span><br><span class="line">        -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span>;;</span><br><span class="line">        --) <span class="built_in">shift</span></span><br><span class="line">            <span class="built_in">break</span>;;</span><br><span class="line">         *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test17 -a -b test1 -d </span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with parameter value test1</span></span><br><span class="line"><span class="comment"># -d is not an option</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using the getopt command</p>
</blockquote>
<p>介绍 <code>getopt</code> 工具函数，方便处理传入的参数</p>
<p><strong>Looking at the command format</strong> <code>getopt</code> 可以接受一系列的 options 和 parameters 并以正确的格式返回, 语法如下 <code>getopt optstring parameters</code></p>
<p><strong>Tips</strong> getopt 还有一个增强版 getopts, 后面章节会介绍</p>
<p>测试 getopt, b 后面添加了冒号表示它是带值的可选参数. 如果输入的命令带有未定义的参数，则会给出错误信息。如果想要忽略错误信息，则需要 getopt 带 -q 参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getopt ab:<span class="built_in">cd</span> -a -b test1 -<span class="built_in">cd</span> test2 test3</span><br><span class="line"><span class="comment">#  -a -b test1 -c -d -- test2 test3</span></span><br><span class="line"></span><br><span class="line">getopt ab:<span class="built_in">cd</span> -a -b test1 -cde test2 test3</span><br><span class="line"><span class="comment"># getopt: illegal option -- e</span></span><br><span class="line"><span class="comment">#  -a -b test1 -c -d -- test2 test3</span></span><br><span class="line"></span><br><span class="line">getopt -q  ab:<span class="built_in">cd</span> -a -b test1 -cde test2 test3</span><br><span class="line"><span class="comment">#  -a -b &#x27;test1&#x27; -c -d -- &#x27;test2&#x27; &#x27;test3&#x27;</span></span><br></pre></td></tr></table></figure>

<p>PS: MacOS 的 bash 是不支持 -q 参数的！使用 docker 绕过了这个限制 诶嘿 ╮(￣▽￣””)╭</p>
<p><strong>Using getopt in your scripts</strong> 这里有一个小技巧，我们需要将 getopt 和 set 配和使用 <code>set -- $(getopt -q ab:cd &quot;$@&quot;)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Extracting command line options and values with getopt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">set</span> -- $(getopt ab:<span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>)</span><br><span class="line"><span class="comment"># 为了兼容 Mac version bash, 将参数去掉了</span></span><br><span class="line"><span class="comment"># set -- $(getopt -q ab:cd &quot;$@&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span>;;</span><br><span class="line">        -b) param=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Found the -b option, with parameter value <span class="variable">$param</span>&quot;</span></span><br><span class="line">            <span class="built_in">shift</span> ;;</span><br><span class="line">        -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span>;;</span><br><span class="line">        --) <span class="built_in">shift</span></span><br><span class="line">            <span class="built_in">break</span>;;</span><br><span class="line">         *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test18 -ac</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"></span><br><span class="line">./test18 -a -b test1 -<span class="built_in">cd</span> test2 test3 test4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with parameter value test1</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># -d is not an option</span></span><br><span class="line"><span class="comment"># Parameter #1: test2</span></span><br><span class="line"><span class="comment"># Parameter #2: test3</span></span><br><span class="line"><span class="comment"># Parameter #3: test4</span></span><br><span class="line"></span><br><span class="line">./test18 -a -b test1 -<span class="built_in">cd</span> <span class="string">&quot;test2 test3&quot;</span> test4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with parameter value test1</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># -d is not an option</span></span><br><span class="line"><span class="comment"># Parameter #1: test2</span></span><br><span class="line"><span class="comment"># Parameter #2: test3</span></span><br><span class="line"><span class="comment"># Parameter #3: test4</span></span><br></pre></td></tr></table></figure>

<p>PS: 最后一个例子中可以看到 getopt 并不能很好的处理字符串， “test2 test3” 被分开解析了。幸运的是，我们有办法解决这个问题</p>
<blockquote>
<p>Advancing to getopts</p>
</blockquote>
<p><code>getopts</code> 是 <code>getopt</code> 的增强版本，格式如下 <code>getopts optstring variable</code>, optstring 以冒号开始</p>
<p>如下所示，<code>getopts</code> </p>
<ul>
<li>自动为我们将每个参数封装到 opt 变量中</li>
<li>删选的时候省区了 <code>-</code></li>
<li>提供了内置的 <code>$OPTARG</code> 代表可选参数的值</li>
<li>将为定义的参数类型用问好替换</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat test19</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Simple demostration of the getopts command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> :ab:c opt</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$opt</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span> ;;</span><br><span class="line">        b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option, with value <span class="variable">$OPTARG</span>&quot;</span> ;;</span><br><span class="line">        c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span> ;;</span><br><span class="line">        *) <span class="built_in">echo</span> <span class="string">&quot;Unknown option: <span class="variable">$opt</span>&quot;</span> ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test19 -ab test1 -c </span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with value test1</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"></span><br><span class="line">./test19 -b <span class="string">&quot;test1 test2&quot;</span> -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -b option, with value test1 test2</span></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"></span><br><span class="line">./test19 -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Unknown option: ?</span></span><br></pre></td></tr></table></figure>

<p><code>getopts</code> 还内置了一个 OPTIND 变量，可以在处理每个参数的时候自动 +1. OPTIND 变量初始值为 1，如果要取 params 部分，则 shift $[ $OPTIND - 1 ]</p>
<p>下面例子中, </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">cat test20</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Processing options $ paramters with getopts</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> start index: <span class="string">&quot;<span class="variable">$OPTIND</span>&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> :ab:<span class="built_in">cd</span> opt</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$opt</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span> ;;</span><br><span class="line">        b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option, with value <span class="variable">$OPTARG</span>&quot;</span> ;;</span><br><span class="line">        c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span> ;;</span><br><span class="line">        d) <span class="built_in">echo</span> <span class="string">&quot;Found the -d option&quot;</span> ;;</span><br><span class="line">        *) <span class="built_in">echo</span> <span class="string">&quot;Unknown option: <span class="variable">$opt</span>&quot;</span> ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">echo</span> changing index: <span class="string">&quot;<span class="variable">$OPTIND</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> opt index: <span class="string">&quot;<span class="variable">$OPTIND</span>&quot;</span></span><br><span class="line"><span class="built_in">shift</span> $[ <span class="variable">$OPTIND</span> -1 ]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter <span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test20 -a -b test1 -d test2 test3 test4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with value test1</span></span><br><span class="line"><span class="comment"># Found the -d option</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># opt index: 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parameter 1: test2</span></span><br><span class="line"><span class="comment"># Parameter 2: test3</span></span><br><span class="line"><span class="comment"># Parameter 3: test4</span></span><br></pre></td></tr></table></figure>

<h3 id="Standardizing-Options"><a href="#Standardizing-Options" class="headerlink" title="Standardizing Options"></a>Standardizing Options</h3><p>介绍 shell 中参数表示的 comman sense</p>
<table>
<thead>
<tr>
<th align="center">Option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-a</td>
<td align="left">Shows all objects</td>
</tr>
<tr>
<td align="center">-c</td>
<td align="left">Produces a count</td>
</tr>
<tr>
<td align="center">-d</td>
<td align="left">Specifies a directory</td>
</tr>
<tr>
<td align="center">-e</td>
<td align="left">Expands an object</td>
</tr>
<tr>
<td align="center">-f</td>
<td align="left">Specifies a file to read data from</td>
</tr>
<tr>
<td align="center">-h</td>
<td align="left">Displays a help message for the command</td>
</tr>
<tr>
<td align="center">-i</td>
<td align="left">Ignores text case</td>
</tr>
<tr>
<td align="center">-l</td>
<td align="left">Produces a long format version of the output</td>
</tr>
<tr>
<td align="center">-n</td>
<td align="left">Uses a non-interactive(batch) mode</td>
</tr>
<tr>
<td align="center">-o</td>
<td align="left">Specifies an output file to redirect all output</td>
</tr>
<tr>
<td align="center">-q</td>
<td align="left">Run in quiet mode</td>
</tr>
<tr>
<td align="center">-r</td>
<td align="left">Processes directories and files recursively</td>
</tr>
<tr>
<td align="center">-s</td>
<td align="left">Runs in silent mode</td>
</tr>
<tr>
<td align="center">-v</td>
<td align="left">Produces verbose output</td>
</tr>
<tr>
<td align="center">-x</td>
<td align="left">Excludes an object</td>
</tr>
<tr>
<td align="center">-y</td>
<td align="left">Answers yes to all questions</td>
</tr>
</tbody></table>
<h3 id="Getting-User-Input"><a href="#Getting-User-Input" class="headerlink" title="Getting User Input"></a>Getting User Input</h3><p>bash 提供了 read 方法来作为用户输入</p>
<blockquote>
<p>Reading basics</p>
</blockquote>
<p><code>read</code> 可以从键盘或文件中获取输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test21</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the read command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Enter your name: &quot;</span></span><br><span class="line"><span class="built_in">read</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello <span class="variable">$name</span>, welcome to my program.&quot;</span></span><br><span class="line"></span><br><span class="line">./test21 </span><br><span class="line"><span class="comment"># Enter your name: jack</span></span><br><span class="line"><span class="comment"># Hello jack, welcome to my program.</span></span><br><span class="line"></span><br><span class="line">./test21</span><br><span class="line"><span class="comment"># Enter your name: jack zheng</span></span><br><span class="line"><span class="comment"># Hello jack zheng, welcome to my program.</span></span><br></pre></td></tr></table></figure>

<p>上面的例子中，cmd 会将所有的输入看作一个变量处理</p>
<p>带用户提示的输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test22</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the read -p option</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please enter your age: &quot;</span> age</span><br><span class="line">days=$[ <span class="variable">$age</span> * 365 ]</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;That makes you over <span class="variable">$days</span> days old! &quot;</span></span><br><span class="line"></span><br><span class="line">./test22</span><br><span class="line"><span class="comment"># Please enter your age: 5</span></span><br><span class="line"><span class="comment"># That makes you over 1825 days old!</span></span><br></pre></td></tr></table></figure>

<p>和第一个实验对照，cmd 也可以将所有输入当作 list 处理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat test23</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the read command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter your name: &quot;</span> first last</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Checking data for <span class="variable">$last</span>, <span class="variable">$first</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test23</span><br><span class="line"><span class="comment"># Enter your name: jack zheng</span></span><br><span class="line"><span class="comment"># Checking data for zheng, jack</span></span><br></pre></td></tr></table></figure>

<p>如果你没有为 read 指定变量，bash 会自动将这个值赋给环境变量 $REPLY</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test24</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the REPLY Environment variable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter your name: &quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello <span class="variable">$REPLY</span>, welcome to my program.&quot;</span></span><br><span class="line"></span><br><span class="line">./test24 </span><br><span class="line"><span class="comment"># Enter your name: jack zheng</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hello jack zheng, welcome to my program.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Timing out</p>
</blockquote>
<p>默认情况下 read 会一直阻塞在那里，等待用户输入，但是我们也可以设置一个等待时间</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test25</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Timing the data entry</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">read</span> -t 5 -p <span class="string">&quot;Please enter your name: &quot;</span> name</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Hello <span class="variable">$name</span>, welcome to my script&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Sorry, too slow! &quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">./test25</span><br><span class="line"><span class="comment"># Please enter your name: </span></span><br><span class="line"><span class="comment"># Sorry, too slow! </span></span><br><span class="line">./test25</span><br><span class="line"><span class="comment"># Please enter your name: jack</span></span><br><span class="line"><span class="comment"># Hello jack, welcome to my script</span></span><br></pre></td></tr></table></figure>

<p>read 还可以指定输入的长度, 设定好长度后，你输入对应长度的内容，他立马就执行下去了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat test26</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Getting just one character of input</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -n1 -p <span class="string">&quot;Do you want to continue [Y/N]? &quot;</span> answer</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$answer</span> <span class="keyword">in</span></span><br><span class="line">Y | y)  <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;fine, continue on...&quot;</span> ;;</span><br><span class="line">N | n) <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">echo</span> OK, goodbye</span><br><span class="line">        <span class="built_in">exit</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the script&quot;</span></span><br><span class="line"></span><br><span class="line">./test26</span><br><span class="line"><span class="comment"># Do you want to continue [Y/N]? y</span></span><br><span class="line"><span class="comment"># fine, continue on...</span></span><br><span class="line"><span class="comment"># This is the end of the script</span></span><br><span class="line"></span><br><span class="line">./test26</span><br><span class="line"><span class="comment"># Do you want to continue [Y/N]? n</span></span><br><span class="line"><span class="comment"># OK, goodbye</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading with no display</p>
</blockquote>
<p>在输入一些敏感信息时，你不希望他显示在屏幕上，可以用 -s 参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test27</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># hiding input data from the monitor</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -s -p <span class="string">&quot;Enter your password: &quot;</span> pass</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Is you password really <span class="variable">$pass</span>? &quot;</span></span><br><span class="line"></span><br><span class="line">./test27</span><br><span class="line"><span class="comment"># Enter your password: </span></span><br><span class="line"><span class="comment"># Is you password really jack?</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading from a file</p>
</blockquote>
<p>Linux 系统中，可以通过 read 命令从文件中按行读取。当读完后，返回非 0</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat test28</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Reading data from a file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line">cat <span class="built_in">test</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Line <span class="variable">$count</span>: <span class="variable">$line</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Finished process the file&quot;</span></span><br><span class="line"></span><br><span class="line">cat <span class="built_in">test</span></span><br><span class="line"><span class="comment"># line 1</span></span><br><span class="line"><span class="comment"># line 2</span></span><br><span class="line">./test28</span><br><span class="line">Line 1: line 1</span><br><span class="line">Line 2: line 2</span><br><span class="line">Finished process the file</span><br></pre></td></tr></table></figure>

<p>PS: 如果文件的末行没有换行，则最后一行并不会被处理</p>
<h2 id="Presenting-Data"><a href="#Presenting-Data" class="headerlink" title="Presenting Data"></a>Presenting Data</h2><p>这章主要向你展示更多的输出流处理技巧</p>
<h3 id="Understanding-Input-and-Output"><a href="#Understanding-Input-and-Output" class="headerlink" title="Understanding Input and Output"></a>Understanding Input and Output</h3><p>现在为止，我们主要采取两种输出流展示方式</p>
<ul>
<li>终端屏显</li>
<li>重定向到文件</li>
</ul>
<p>目前为止我们只能将全部内容一起输出到文件或屏幕，在下面的小节中，我们将尝试将内容分开处理</p>
<blockquote>
<p>Standard file descriptors</p>
</blockquote>
<p>Linux 系统通过 file descriptor 来指代每一个文件对象，这个 decriptor 是一个唯一的非负的整数。每个进程同一时间允许至多 9 个打开的文件。bash 中将 0，1 和 2 用于特定的用途</p>
<table>
<thead>
<tr>
<th align="center">File descriptor</th>
<th align="center">Abbreviation</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">STDIN</td>
<td align="center">Standard input</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">STDOUT</td>
<td align="center">Standard output</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">STDERR</td>
<td align="center">Standard error</td>
</tr>
</tbody></table>
<p><strong>STDIN</strong> 标准输入，比如终端的键盘输入和 <code>&lt;</code> 的文件输入. 很多 bash 命令接收 STDIN 的输入，比如 cat， 如果你没有指定文件，他就会接收键盘输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat </span><br><span class="line">thi</span><br><span class="line">thi</span><br><span class="line">this</span><br><span class="line">this</span><br></pre></td></tr></table></figure>

<p><strong>STDOUT</strong> shell 的标准输出就是 terminal monitor.</p>
<p><strong>STDERR</strong> 当运行命令出异常了，可以使用这个 descriptor 导流</p>
<h3 id="Redirecting-errors"><a href="#Redirecting-errors" class="headerlink" title="Redirecting errors"></a>Redirecting errors</h3><blockquote>
<p>Redirecting error only</p>
</blockquote>
<p>像前面表哥所示，STDERR 的文件描述符是 2，你可以在 redirection symbol 前加上这个标识符来指定导向</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -al badfile 2&gt; test4</span><br><span class="line">cat test4</span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br></pre></td></tr></table></figure>

<p>下面的例子中，badfile 不存在，所以错误信息写入 test5 中，test4 存在，所以在屏幕上显示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -al test4 badfile 2&gt; test5</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  0 May 29 14:07 test4</span></span><br><span class="line">cat test5</span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Redirecting errors and data</p>
</blockquote>
<p>如果你想将正常和异常的信息都输出到文件，你需要指定两个输出</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ls </span><br><span class="line"><span class="comment"># test5</span></span><br><span class="line">ls -al test5 badfile 2&gt; test6 1&gt; test7</span><br><span class="line">ls</span><br><span class="line"><span class="comment"># test5   test6   test7</span></span><br><span class="line">cat test6</span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br><span class="line">cat test7</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  39 May 29 14:08 test5</span></span><br></pre></td></tr></table></figure>

<p>如果你想将这两种信息都导入一个文件，bash 提供了一个特殊的 redirection symbol 来做这个事情 <code>&amp;&gt;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -al test5 badfile &amp;&gt; test8</span><br><span class="line">cat test8</span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  39 May 29 14:08 test5</span></span><br></pre></td></tr></table></figure>

<h3 id="Redirecting-Output-in-Scripts"><a href="#Redirecting-Output-in-Scripts" class="headerlink" title="Redirecting Output in Scripts"></a>Redirecting Output in Scripts</h3><p>通过 STDOUT 和 STDERR 你可以将输出导入任何 file discriptors. 有两种方式可以重定向输出</p>
<ul>
<li>Temporarily redirecting each line</li>
<li>Permanently redirecting all comands in the script</li>
</ul>
<blockquote>
<p>Temorary redirections</p>
</blockquote>
<p>这段文字的描述有点蹩脚，还是直接用案例说明把。假如你想将你的 echo 内容输出到 STDERR 指定的流中，需要怎么做？这种用法就是打印自己的 err log 啊, 可以使用 <code>&gt;&amp;2</code> 的格式</p>
<p>下面的例子中，test8 中指定第一个 echo 通过 STDERR 输出，第二个 STDOUT 输出。当直接调用时，由于两个输出默认都是打在公屏上的，所以没什么区别，但是当我指定 err 输出到 test9 时，区别就出现了。只有错误信息导到 test9 了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test8</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing STDERR messages</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is an error&quot;</span> &gt;&amp;2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is normal output&quot;</span></span><br><span class="line"></span><br><span class="line">./test8</span><br><span class="line">This is an error</span><br><span class="line">This is normal output</span><br><span class="line"></span><br><span class="line">./test8 2&gt; test9</span><br><span class="line"><span class="comment"># This is normal output</span></span><br><span class="line">cat test9</span><br><span class="line"><span class="comment"># This is an error</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Permanent redirections</p>
</blockquote>
<p>上面的情况适合少量打 log 的情况。如果你有好多 err 需要重新导向，你可以这么做</p>
<p>exec 会启动一个新的 shell，下例中新启动的 shell 会将 STDOUT 的内容都发送的 testout 文件中去</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test10</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting all output to a file</span></span><br><span class="line"><span class="built_in">exec</span> 1&gt;testout</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test of redirecting all output&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;from a script to another file.&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Without having to redirect every individual line&quot;</span></span><br><span class="line"></span><br><span class="line">./test10</span><br><span class="line">cat testout</span><br><span class="line"><span class="comment"># This is a test of redirecting all output</span></span><br><span class="line"><span class="comment"># from a script to another file.</span></span><br><span class="line"><span class="comment"># Without having to redirect every individual line</span></span><br></pre></td></tr></table></figure>

<p>你可以在程序中间做这样的操作. 下面的例子中，我们在开头部分指定 err 输出到 testerror 文件，接着打印两个普通输出。再指定普通输出，输出到文件，最后指定 err 输出到 err 文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat test11</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting output to different locations</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 2&gt; testerror</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the start of the script&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;now redirecting all output to another location&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 1&gt;testout</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This output should go to the testout file&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;but this should go to the testerror file&quot;</span> &gt;&amp;2</span><br><span class="line"></span><br><span class="line">./test11</span><br><span class="line"><span class="comment"># This is the start of the script</span></span><br><span class="line"><span class="comment"># now redirecting all output to another location</span></span><br><span class="line">cat testout</span><br><span class="line"><span class="comment"># This output should go to the testout file</span></span><br><span class="line">cat testerror</span><br><span class="line"><span class="comment"># but this should go to the testerror file</span></span><br></pre></td></tr></table></figure>

<p>当你改变了 STDOUT 或者 STDERR 后，要再改回来就不是那么容易了，如果你需要切换这些流，需要用到一些技巧，这些将在后面的 Creating Your Own Redirection 章节讲到</p>
<h3 id="Redirecting-Input-in-Scripts"><a href="#Redirecting-Input-in-Scripts" class="headerlink" title="Redirecting Input in Scripts"></a>Redirecting Input in Scripts</h3><p>和输出流一样，我们可以通过定向符号操纵输入流 <code>exec 0&lt; testfile</code></p>
<p>下面的例子中，我们以文件中的命令代替键盘输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat test12</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting file input</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 0&lt; test12</span><br><span class="line">count=1</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line </span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Line #<span class="variable">$count</span>: <span class="variable">$line</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test12</span><br><span class="line"><span class="comment"># Line #1: #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Line #2: # Redirecting file input</span></span><br><span class="line"><span class="comment"># Line #3: </span></span><br><span class="line"><span class="comment"># Line #4: exec 0&lt; test12</span></span><br><span class="line"><span class="comment"># Line #5: count=1</span></span><br><span class="line"><span class="comment"># Line #6: </span></span><br><span class="line"><span class="comment"># Line #7: while read line</span></span><br><span class="line"><span class="comment"># Line #8: do</span></span><br><span class="line"><span class="comment"># Line #9: echo &quot;Line #$count: $line&quot;</span></span><br><span class="line"><span class="comment"># Line #10: count=$[ $count + 1 ]</span></span><br><span class="line"><span class="comment"># Line #11: done</span></span><br><span class="line"><span class="comment"># Line #12:</span></span><br></pre></td></tr></table></figure>

<h3 id="Creating-Your-Own-Redirection"><a href="#Creating-Your-Own-Redirection" class="headerlink" title="Creating Your Own Redirection"></a>Creating Your Own Redirection</h3><p>shell 中最多只能有 9 个 file descriptor， 我们已经用了 0，1，2.下面我们将使用 3-8 自定义我们自己的 file descriptor.</p>
<blockquote>
<p>Creating output file descriptors</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test13</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using an alternative file descriptor</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test13out</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This should display on the monitor&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;and this should stored in the file&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Then this should be back on the monitor&quot;</span></span><br><span class="line"></span><br><span class="line">./test13</span><br><span class="line"><span class="comment"># This should display on the monitor</span></span><br><span class="line"><span class="comment"># Then this should be back on the monitor</span></span><br><span class="line">cat test13out </span><br><span class="line"><span class="comment"># and this should stored in the file</span></span><br></pre></td></tr></table></figure>

<p>这个概念听起来有点复杂，但是其实很直接了当的，用法也和前面的默认文件描述符是一致的。</p>
<blockquote>
<p>Redirecting file descriptors</p>
</blockquote>
<p>下面的例子中我们会做重定向的切换。开始时，我们用 3 号 descriptor 代替 1 的位置。就是所有的 echo 都会输入到 3 号中，之后，我们还原，echo 就又输出到屏幕了。这个其实只用到了一个语法 <code>3&gt;&amp;1</code>，这个语句就是用 3 代替 1， 还原的时候顺序翻一下即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat test14</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using STDOUT, then coming back to it</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;1</span><br><span class="line"><span class="built_in">exec</span> 1&gt;test14out</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This should store in the output file&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;along with this lien&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 1&gt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Now things should be back to normal&quot;</span></span><br><span class="line"></span><br><span class="line">./test14</span><br><span class="line"><span class="comment"># Now things should be back to normal</span></span><br><span class="line">cat test14out</span><br><span class="line"><span class="comment"># This should store in the output file</span></span><br><span class="line"><span class="comment"># along with this lien</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Creating input file descriptors</p>
</blockquote>
<p>和输出流一样，输入流也可以用上面的这个技巧。下面的例子中，我们先用 6 号代替原始的 0 号键盘输入，做完操作后将它还原</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat test15</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting input file descriptors</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&amp;0</span><br><span class="line"><span class="built_in">exec</span> 0&lt; testfile</span><br><span class="line"></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Line #<span class="variable">$count</span>: <span class="variable">$line</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$ount</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 0&lt;&amp;6</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Are you done now? &quot;</span> answer</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$answer</span> <span class="keyword">in</span></span><br><span class="line">Y | y) <span class="built_in">echo</span> <span class="string">&quot;Goodbye&quot;</span> ;;</span><br><span class="line">N | n) <span class="built_in">echo</span> <span class="string">&quot;Sorry, this is the end.&quot;</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">./test15</span><br><span class="line"><span class="comment"># Line #1: line 1</span></span><br><span class="line"><span class="comment"># Line #1: line 2</span></span><br><span class="line"><span class="comment"># Line #1: line 3</span></span><br><span class="line"><span class="comment"># Are you done now? y</span></span><br><span class="line"><span class="comment"># Goodbye</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Creating a read/write file descriptor</p>
</blockquote>
<p>感觉这个例子有点。。。鸡肋。虽然实用性不高，但是挺有趣</p>
<p>下面的例子中，我们会将 3 同时设置为输入输出描述符。先读取一行，再输入一行。读取一行后，位置定位到第二行开头，这个时候写我们自己的内容，他会覆盖之前的内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat test16</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting input/output file descriptor</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&lt;&gt; testfile</span><br><span class="line"><span class="built_in">read</span> line &lt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Read: <span class="variable">$line</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line">cat testfile </span><br><span class="line"><span class="comment"># This is the first line.</span></span><br><span class="line"><span class="comment"># This is the second line.</span></span><br><span class="line"><span class="comment"># This is the third line.</span></span><br><span class="line"></span><br><span class="line">./test16</span><br><span class="line"><span class="comment"># Read: This is the first line.</span></span><br><span class="line"></span><br><span class="line">cat testfile</span><br><span class="line"><span class="comment"># This is the first line.</span></span><br><span class="line"><span class="comment"># This is a test line</span></span><br><span class="line"><span class="comment"># ine.</span></span><br><span class="line"><span class="comment"># This is the third line.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Closing file descriptors</p>
</blockquote>
<p>新创建的 file descriptors 都会在脚本结束时自动关闭。但是如果你想在接本结束前手动关闭，需要做什么？</p>
<p>关闭的格式如下 <code>exec 3&gt;&amp;-</code>, 下面的实验中我们将 3 号指向文件，输出内容，再关闭它，再试着输出内容。可以看到，关闭后再输出会抛异常</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat badtest</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing closing file descriptors</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test17file</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line of data&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This won&#x27;t work&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line">./badtest</span><br><span class="line"><span class="comment"># ./badtest: line 10: 3: Bad file descriptor</span></span><br><span class="line">cat test17file</span><br><span class="line"><span class="comment"># This is a test line of data</span></span><br></pre></td></tr></table></figure>

<p>除此之外还有一个更重要的细节需要注意，如果你在一个脚本中，关闭后再使用同一个 file descriptor 的话。它会将之前写的内容覆盖掉</p>
<p>下面实验中，我们先用 3 号描述符将信息写入文件，关闭后 cat 输出，再打开它写东西。最后发现之前写的被覆盖了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test17</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing closing file descriptors</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test17file</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line of data&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line"></span><br><span class="line">cat test17file</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test17file</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This&#x27;ll be bad&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line">./test17</span><br><span class="line"><span class="comment"># This is a test line of data</span></span><br><span class="line">cat test17file </span><br><span class="line"><span class="comment"># This&#x27;ll be bad</span></span><br></pre></td></tr></table></figure>

<h3 id="Listing-Open-File-Descriptors"><a href="#Listing-Open-File-Descriptors" class="headerlink" title="Listing Open File Descriptors"></a>Listing Open File Descriptors</h3><p><code>lsof</code> 可以列出整个系统所有发开的 file descriptor, 这个在权限方面有些争议。MacOS 也有这个命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> lsof</span><br><span class="line"><span class="comment"># /usr/sbin/lsof</span></span><br></pre></td></tr></table></figure>

<p>显示当前进程的文件描述符使用情况</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lsof -a -p $$ -d 0,1,2</span><br><span class="line"><span class="comment"># COMMAND   PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span></span><br><span class="line"><span class="comment"># bash    35349 i306454    0u   CHR   16,1 0t937569  667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    35349 i306454    1u   CHR   16,1 0t937569  667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    35349 i306454    2u   CHR   16,1 0t937569  667 /dev/ttys001</span></span><br></pre></td></tr></table></figure>

<p>lsof 输出说明</p>
<table>
<thead>
<tr>
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">COMMAND</td>
<td align="left">The first nine characters of the name of the command in the process</td>
</tr>
<tr>
<td align="left">PID</td>
<td align="left">The process ID of the process</td>
</tr>
<tr>
<td align="left">USER</td>
<td align="left">The login name of the user who owns the process</td>
</tr>
<tr>
<td align="left">FD</td>
<td align="left">The file descriptor number and access type. r-read, w-write, u-read/write</td>
</tr>
<tr>
<td align="left">TYPE</td>
<td align="left">The type of file. CHR-character, BLK-block, DIR-directory, REG-regular file</td>
</tr>
<tr>
<td align="left">DEVICE</td>
<td align="left">The device numbers(major and minor) of the device</td>
</tr>
<tr>
<td align="left">SIZE</td>
<td align="left">If available, the size of the file</td>
</tr>
<tr>
<td align="left">NODE</td>
<td align="left">The node number of the local file</td>
</tr>
<tr>
<td align="left">NAME</td>
<td align="left">The name of the file</td>
</tr>
</tbody></table>
<p>作为对比，下面是一个文件中的 file descriptor 的信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test18</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing lsof with file descriptors</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test18file1</span><br><span class="line"><span class="built_in">exec</span> 6&gt; test18file2</span><br><span class="line"><span class="built_in">exec</span> 7&lt; testfile</span><br><span class="line"></span><br><span class="line">lsof -a -p $$ -d 0,1,2,3,6,7</span><br><span class="line"></span><br><span class="line">./test18</span><br><span class="line"><span class="comment"># COMMAND   PID    USER   FD   TYPE DEVICE SIZE/OFF     NODE NAME</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    0u   CHR   16,1 0t937995      667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    1u   CHR   16,1 0t937995      667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    2u   CHR   16,1 0t937995      667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    3w   REG    1,5        0 51179042 /Users/i306454/tmp/bash_test/test18file1</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    6w   REG    1,5        0 51179043 /Users/i306454/tmp/bash_test/test18file2</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    7r   REG    1,5       73 51174255 /Users/i306454/tmp/bash_test/testfile</span></span><br></pre></td></tr></table></figure>

<h3 id="Suppressing-Command-Output"><a href="#Suppressing-Command-Output" class="headerlink" title="Suppressing Command Output"></a>Suppressing Command Output</h3><p>有些时候，你并不想看到任何异常输出，比如后台运行的时候。这时你可以将 STDERR 的内容输出到 null file 中去，位置是 /dev/null</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls -al &gt; /dev/null</span><br><span class="line"><span class="comment"># cat /dev/null</span></span><br><span class="line"></span><br><span class="line">ls -al badfile test16 2&gt; /dev/null</span><br><span class="line"><span class="comment"># -rwxr--r--  1 i306454  staff  151 May 30 15:12 test16</span></span><br></pre></td></tr></table></figure>

<p>你也可以将输入指定到 null file. 这样做可以快速清空一个文件，算是 rm + touch 的简化版</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat testfile</span><br><span class="line"><span class="comment"># This is the first line.</span></span><br><span class="line"><span class="comment"># This is a test line</span></span><br><span class="line"><span class="comment"># ine.</span></span><br><span class="line"><span class="comment"># This is the third line.</span></span><br><span class="line"></span><br><span class="line">cat /dev/null &gt; testfile</span><br><span class="line">cat testfile</span><br></pre></td></tr></table></figure>

<h3 id="Using-Temporary-Files"><a href="#Using-Temporary-Files" class="headerlink" title="Using Temporary Files"></a>Using Temporary Files</h3><p>Linux 系统预留了 <code>/tmp</code> 文件夹放置临时文件, 设置提供了专用命令 <code>mktemp</code> 来创建临时文件，这个命令创建的文件在 umask 上给创建者所有权限，其他人则没有权限</p>
<blockquote>
<p>Creating a local temporary file</p>
</blockquote>
<p>零时文件名字中的末尾的大写 X 会被替换成随机数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mktemp testing.XXXXXX</span><br><span class="line">ls testing*</span><br><span class="line"><span class="comment"># testing.I3p5pe</span></span><br></pre></td></tr></table></figure>

<p>实验脚本中，我们创建一个临时文件并写入内容，然后关闭流，并 cat 一下。最后移除文件。把异常信息丢掉不显示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat test19</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Creating and using a temp file</span></span><br><span class="line"></span><br><span class="line">tempfile=$(mktemp test19.XXXXXX)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt;<span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This script writes to temp file <span class="variable">$tempfile</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the first line&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the second line&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the third line&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Done creating temp file. the contents are:&quot;</span></span><br><span class="line">cat <span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line">rm -f <span class="variable">$tempfile</span> 2&gt; /dev/null</span><br><span class="line"></span><br><span class="line">./test19</span><br><span class="line"><span class="comment"># This script writes to temp file test19.ksgCft</span></span><br><span class="line"><span class="comment"># Done creating temp file. the contents are:</span></span><br><span class="line"><span class="comment"># This is the first line</span></span><br><span class="line"><span class="comment"># This is the second line</span></span><br><span class="line"><span class="comment"># This is the third line</span></span><br><span class="line">ls test19*</span><br><span class="line"><span class="comment"># test19</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Creating a temporary file in /tmp</p>
</blockquote>
<p>前面的临时文件都是创建在当前文件夹下的，下面介绍在 tmp 文件夹下的创建办法，其实就是加一个 -t 的参数。。。结果和书上有区别，并该是 MacOS 定制过</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mktemp -t test.XXXXXX</span><br><span class="line"><span class="comment"># /var/folders/yr/8yr4mzlj1x34tf4m9c_wh2_h0000gn/T/test.XXXXXX.enBtwKYB</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test20</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Creating a temp file in /tmp</span></span><br><span class="line"></span><br><span class="line">tempfile=$(mktemp tmp.XXXXXX)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test file.&quot;</span> &gt; <span class="variable">$tempfile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the second line of the test.&quot;</span> &gt;&gt; <span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The temp file is located at: <span class="variable">$tempfile</span>&quot;</span></span><br><span class="line">cat <span class="variable">$tempfile</span></span><br><span class="line">rm -f <span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line">./test20</span><br><span class="line"><span class="comment"># The temp file is located at: tmp.OldzdO</span></span><br><span class="line"><span class="comment"># This is a test file.</span></span><br><span class="line"><span class="comment"># This is the second line of the test.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Creating a temporary directory</p>
</blockquote>
<p>-d 创建临时文件夹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat test21</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using a temporary directory</span></span><br><span class="line"></span><br><span class="line">tempdir=$(mktemp -d dir.XXXXXX)</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$tempdir</span></span><br><span class="line">tempfile1=$(mktemp temp.XXXXXX)</span><br><span class="line">tempfile2=$(mktemp temp.XXXXXX)</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 7&gt; <span class="variable">$tempfile1</span></span><br><span class="line"><span class="built_in">exec</span> 8&gt; <span class="variable">$tempfile2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Sending data to directory <span class="variable">$tempdir</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line of data for <span class="variable">$tempfile1</span>&quot;</span> &gt;&amp;7</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line of data for <span class="variable">$tempfile2</span>&quot;</span> &gt;&amp;8</span><br><span class="line"></span><br><span class="line">./test21</span><br><span class="line"><span class="comment"># Sending data to directory dir.hE8Hbr</span></span><br><span class="line"></span><br><span class="line">ls -l dir*</span><br><span class="line"><span class="comment"># total 16</span></span><br><span class="line"><span class="comment"># -rw-------  1 i306454  staff  44 May 30 16:53 temp.2V4FAk</span></span><br><span class="line"><span class="comment"># -rw-------  1 i306454  staff  44 May 30 16:53 temp.59JjLm</span></span><br><span class="line"></span><br><span class="line">cat dir.hE8Hbr/temp.2V4FAk </span><br><span class="line"><span class="comment"># This is a test line of data for temp.2V4FAk</span></span><br><span class="line">cat dir.hE8Hbr/temp.59JjLm </span><br><span class="line"><span class="comment"># This is a test line of data for temp.59JjLm</span></span><br></pre></td></tr></table></figure>

<h3 id="Logging-Messages"><a href="#Logging-Messages" class="headerlink" title="Logging Messages"></a>Logging Messages</h3><p>有时你可能想一个流即打印到屏幕上，也输出到文件中，这个时候，你可以使用 tee</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">date | tee testfile </span><br><span class="line"><span class="comment"># Sun May 30 16:58:30 CST 2021</span></span><br><span class="line">cat testfile </span><br><span class="line"><span class="comment"># Sun May 30 16:58:30 CST 2021</span></span><br></pre></td></tr></table></figure>

<p>注意，tee 默认会覆盖原有内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">who | tee testfile</span><br><span class="line"><span class="comment"># i306454  console  May 27 15:12 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 27 16:21 </span></span><br><span class="line">cat testfile </span><br><span class="line"><span class="comment"># i306454  console  May 27 15:12 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 27 16:21</span></span><br></pre></td></tr></table></figure>

<p>之前 date 的内容被覆盖了，你可以用 -a 做 append 操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date | tee -a testfile</span><br><span class="line"><span class="comment"># Sun May 30 17:00:41 CST 2021</span></span><br><span class="line">cat testfile </span><br><span class="line"><span class="comment"># i306454  console  May 27 15:12 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 27 16:21 </span></span><br><span class="line"><span class="comment"># Sun May 30 17:00:41 CST 2021</span></span><br></pre></td></tr></table></figure>

<p>实操</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test22</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using the tee command for logging</span></span><br><span class="line"></span><br><span class="line">tempfile=test22file</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the start of the test&quot;</span> | tee <span class="variable">$tempfile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the second of the test&quot;</span> | tee -a <span class="variable">$tempfile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the test&quot;</span> | tee -a <span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line">./test22</span><br><span class="line"><span class="comment"># This is the start of the test</span></span><br><span class="line"><span class="comment"># This is the second of the test</span></span><br><span class="line"><span class="comment"># This is the end of the test</span></span><br><span class="line">cat test22file </span><br><span class="line"><span class="comment"># This is the start of the test</span></span><br><span class="line"><span class="comment"># This is the second of the test</span></span><br><span class="line"><span class="comment"># This is the end of the test</span></span><br></pre></td></tr></table></figure>

<h3 id="Practical-Example"><a href="#Practical-Example" class="headerlink" title="Practical Example"></a>Practical Example</h3><p>解析一个 csv 文件，将其中的内容重组成一个 SQL 文件用作 import</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- cat members.csv  --&gt;</span><br><span class="line">Blum,Richard,123 Main St.,Chicago,IL,60601</span><br><span class="line">Blum,Barbara,123 Main St.,Chicago,IL,60601</span><br><span class="line">Bresnahan,Christine,456 Oak Ave.,Columbus,OH,43201</span><br><span class="line">Bresnahan,Timothy,456 Oak Ave.,Columbus,OH,43201bash-5.1$ .&#x2F;test23</span><br></pre></td></tr></table></figure>

<p>主要语法说明</p>
<ul>
<li>done &lt; ${1}: 将命令行中给的文件做输入</li>
<li>read lname…: 以逗号为分割，每个字段给个名字，方便后面调用</li>
<li>cat &gt;&gt; $outfile &lt;&lt; EOF: cat 会拿到一行的内容，并对这些内容做替换放到 outfile 中去. 这个用法和 tee myfile &lt;&lt; EOF.. 有异曲同工之妙</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test23</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Read file and create INSERT statements for MySQL</span></span><br><span class="line"></span><br><span class="line">outfile=<span class="string">&#x27;members.sql&#x27;</span></span><br><span class="line">IFS=<span class="string">&#x27;,&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> lname fname address city state zip</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    cat &gt;&gt; <span class="variable">$outfile</span> &lt;&lt; EOF</span><br><span class="line">    INSERT INTO members (lname, fname, address, city, state, zip) VALUES (<span class="string">&#x27;$lanme&#x27;</span>, <span class="string">&#x27;$fname&#x27;</span>, <span class="string">&#x27;$address&#x27;</span>, <span class="string">&#x27;$city&#x27;</span>, <span class="string">&#x27;$state&#x27;</span>, <span class="string">&#x27;$zip&#x27;</span>);</span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$&#123;1&#125;</span></span><br><span class="line"></span><br><span class="line">./test23 members.csv </span><br><span class="line">cat members.sql </span><br><span class="line">    INSERT INTO members (lname, fname, address, city, state, zip) VALUES (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Richard&#x27;</span>, <span class="string">&#x27;123 Main St.&#x27;</span>, <span class="string">&#x27;Chicago&#x27;</span>, <span class="string">&#x27;IL&#x27;</span>, <span class="string">&#x27;60601&#x27;</span>);</span><br><span class="line">    INSERT INTO members (lname, fname, address, city, state, zip) VALUES (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Barbara&#x27;</span>, <span class="string">&#x27;123 Main St.&#x27;</span>, <span class="string">&#x27;Chicago&#x27;</span>, <span class="string">&#x27;IL&#x27;</span>, <span class="string">&#x27;60601&#x27;</span>);</span><br><span class="line">    INSERT INTO members (lname, fname, address, city, state, zip) VALUES (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Christine&#x27;</span>, <span class="string">&#x27;456 Oak Ave.&#x27;</span>, <span class="string">&#x27;Columbus&#x27;</span>, <span class="string">&#x27;OH&#x27;</span>, <span class="string">&#x27;43201&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Script-Control"><a href="#Script-Control" class="headerlink" title="Script Control"></a>Script Control</h2><h3 id="Handling-Signals"><a href="#Handling-Signals" class="headerlink" title="Handling Signals"></a>Handling Signals</h3><table>
<thead>
<tr>
<th align="left">Signal</th>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">SIGHUP</td>
<td align="left">Hangs up</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">SIGINT</td>
<td align="left">Interrupts</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">SIGQUIT</td>
<td align="left">Stops running</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">SIGKILL</td>
<td align="left">Unconditionally terminates</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">SIGSEGV</td>
<td align="left">Produces segment violation</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">SIGTERM</td>
<td align="left">Terminates if possible</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left">SIGSTOP</td>
<td align="left">Stops unconditionally, but doesn’t terminate</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left">SIGTSTP</td>
<td align="left">Stops or pauses, but continues to run in background</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left">SIGCONT</td>
<td align="left">Resumes execution after STOP or TSTP</td>
</tr>
</tbody></table>
<p>默认情况下，bash shell 会忽略 QUIT 和 TERM 这两个信息，但是可以识别 HUP 和 INT。</p>
<blockquote>
<p>Generating signals</p>
</blockquote>
<p>通过键盘操作你可以产生两种信号</p>
<p><strong>Interrupting a process</strong> <code>Ctrl + C</code> 可以生成 SIGINT 信号并把它发送到任何终端正在执行的进程中</p>
<p><strong>Pausing a process</strong> <code>Ctrl + Z</code> 停止一个进程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sleep 100</span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line"><span class="comment"># [1]+  Stopped                 sleep 100</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line"><span class="comment"># There are stopped jobs.</span></span><br></pre></td></tr></table></figure>

<p>当有 stop 的进程是，你是不能退出 bash 的可以用 ps 查看. 对应的 job 的 S(status) 为 T。你可以使用 kill 杀死它</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ps -l </span><br><span class="line"><span class="comment">#   UID   PID  PPID        F CPU PRI NI       SZ    RSS WCHAN     S             ADDR TTY           TIME CMD</span></span><br><span class="line"><span class="comment">#   ...</span></span><br><span class="line"><span class="comment">#   501 17153 12576     4006   0  31  0  4268408    672 -      T                   0 ttys001    0:00.00 sleep 100</span></span><br><span class="line"><span class="comment">#   ...</span></span><br><span class="line"><span class="built_in">kill</span> -9 17153</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Trapping signals</p>
</blockquote>
<p>脚本中我们可以指定需要忽略的 signal, 格式为 <code>trap command signals</code>。</p>
<p>下面的示例中，我们在脚本中指定忽略 <code>Ctrl + C</code> 发出的 SIGINT 信号，运行过程中即使按下组合键脚本继续运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cat test1.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing signal trapping</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27; Sorry! I have trapped Ctrl-C&#x27;&quot;</span> SIGINT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> This is a <span class="built_in">test</span> script</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the test script&quot;</span></span><br><span class="line"></span><br><span class="line">./test1.sh </span><br><span class="line"><span class="comment"># This is a test script</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># ^C Sorry! I have trapped Ctrl-C</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># Loop #6</span></span><br><span class="line"><span class="comment"># Loop #7</span></span><br><span class="line"><span class="comment"># Loop #8</span></span><br><span class="line"><span class="comment"># Loop #9</span></span><br><span class="line"><span class="comment"># Loop #10</span></span><br><span class="line"><span class="comment"># ^C Sorry! I have trapped Ctrl-C</span></span><br><span class="line"><span class="comment"># This is the end of the test script</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Trapping a script exit</p>
</blockquote>
<p>trap 命令还可以做到，当脚本结束时执行命令的效果，即使是通过 Ctrl + C 结束也会被出发。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat test2.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Trapping the script exit</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo Goodbye...&quot;</span> EXIT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the test script&quot;</span></span><br><span class="line"></span><br><span class="line">./test2.sh </span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^CGoodbye...</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Modifying or removing a trap</p>
</blockquote>
<p>下面示例中展示了如何修改 trap 的动作。我们先定义当遇到 SIGINT 时 echo 的内容。当 5 秒循环后修改 echo 的内容。通过触发 SIGINT 查看改动是否生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cat test3.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Modifying a set trap</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27;Sorry... Ctrl-C is trapped.&#x27;&quot;</span> SIGINT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27; I modified the trap!&#x27;&quot;</span> SIGINT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test3.sh </span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^CSorry... Ctrl-C is trapped.</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># ^CSorry... Ctrl-C is trapped.</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^C I modified the trap!</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># ^C I modified the trap!</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br></pre></td></tr></table></figure>

<p>你也可以通过 <code>trap -- SIGINT</code> 移除定义的 trap</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">cat test3b.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Modifying a set trap</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27;Sorry... Ctrl-C is trapped.&#x27;&quot;</span> SIGINT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> -- SIGINT</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I just removed the trap&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test3b.sh </span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^CSorry... Ctrl-C is trapped.</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># I just removed the trap</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^C</span></span><br></pre></td></tr></table></figure>

<p><strong>Tip</strong> 上面的去除也可以用单横线 <code>trap - SIGINT</code></p>
<h3 id="Running-scripts-in-Background-Mode"><a href="#Running-scripts-in-Background-Mode" class="headerlink" title="Running scripts in Background Mode"></a>Running scripts in Background Mode</h3><p>试想一下下面的情形，如果你的脚本需要执行比较长的时间，如果你在终端运行了它，那么你就没有终端可用了。你可以使用 background 的模式跑类似的脚本，<code>ps</code> 显示那些 process 很多都是后台运行的</p>
<blockquote>
<p>Running in the background</p>
</blockquote>
<p>想要后台运行脚本是很简单的，只需要在调用脚本时后面接一个 ampersand symbol <code>&amp;</code> 即可</p>
<p>下面程序中，我们声明了一个计时器，并在后台运行。运行时他会给出 PID 信息。当脚本执行结束时会打印 done 的信息</p>
<p>PS: bash 测试的时候要我会车才会打印，zsh 自动打印</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test4.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test running in the background</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">./test4.sh &amp;</span><br><span class="line"><span class="comment"># [1] 16253</span></span><br><span class="line"><span class="comment"># [1]  + 16360 done       ./test4.sh</span></span><br></pre></td></tr></table></figure>

<p>当使用 background mode 的时候，他还是用的 STDOUT 和 STDERR</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat test5.sh                                 </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test running in the background with output</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Start the test script&quot;</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test script is complete&quot;</span></span><br><span class="line"></span><br><span class="line">./test5.sh &amp;</span><br><span class="line"><span class="comment"># [1] 16474</span></span><br><span class="line"><span class="comment"># bash-5.1$ Start the test script</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># Test script is complete</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [1]+  Done                    ./test5.sh</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Running multiple background jobs</p>
</blockquote>
<p>如果你想启动多个 background job 只需要终端运行多个 <code>xx.sh &amp;</code> 即可。每次系统多会分配一个 job id 和 process id 给后台进程，可以通过 ps 查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">./test5.sh &amp;</span><br><span class="line">./test5.sh &amp;</span><br><span class="line">ps                  </span><br><span class="line"><span class="comment">#   PID TTY           TIME CMD</span></span><br><span class="line"><span class="comment">#  8019 ttys000    0:04.39 /bin/zsh --login -i</span></span><br><span class="line"><span class="comment">#  1479 ttys001    0:01.61 /bin/zsh -l</span></span><br><span class="line"><span class="comment"># 16661 ttys001    0:00.01 /usr/local/bin/bash ./test5.sh</span></span><br><span class="line"><span class="comment"># 16681 ttys001    0:00.01 /usr/local/bin/bash ./test5.sh</span></span><br><span class="line"><span class="comment"># 16700 ttys001    0:00.00 sleep 1</span></span><br><span class="line"><span class="comment"># 16702 ttys001    0:00.00 sleep 1</span></span><br><span class="line"><span class="comment">#  3202 ttys002    0:04.87 -zsh</span></span><br><span class="line"><span class="comment">#  9415 ttys003    0:01.10 -zsh</span></span><br></pre></td></tr></table></figure>

<h3 id="Running-Scripts-without-a-Hang-Up"><a href="#Running-Scripts-without-a-Hang-Up" class="headerlink" title="Running Scripts without a Hang-Up"></a>Running Scripts without a Hang-Up</h3><p>通过 <code>nohup</code> 命令，你可以让脚本始终在后台运行，即使关闭终端也行</p>
<p><code>nohup</code> 会将 script 和 STDOUT， STDERR 解绑。自动将输出绑定到 nohup.out 文件。如果你在一个文件夹下启动多个 nohup process, 他们的输出会混在一起</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">nohup ./test1.sh &amp;</span><br><span class="line">cat nohup.out </span><br><span class="line"><span class="comment"># This is a test script</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># Loop #6</span></span><br><span class="line"><span class="comment"># Loop #7</span></span><br><span class="line"><span class="comment"># Loop #8</span></span><br><span class="line"><span class="comment"># Loop #9</span></span><br><span class="line"><span class="comment"># Loop #10</span></span><br><span class="line"><span class="comment"># This is the end of the test script</span></span><br><span class="line"><span class="comment"># [1]+  Done                    nohup ./test1.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="Controlling-the-Job"><a href="#Controlling-the-Job" class="headerlink" title="Controlling the Job"></a>Controlling the Job</h3><p>job control 即 开始/通知/kill/重启 jobs 的动作</p>
<blockquote>
<p>Viewing jobs</p>
</blockquote>
<p><code>jobs</code> cmd 让你可以查看 shell 正在运行的 jobs</p>
<p>下面的例子中，我们启动一个计时器脚本。第一次运行，中间通过 Ctrl + Z stop 它。第二次采用后台运行。然后通过 jobs 命令观察这两个 job 的状态。jobs -l 可以显示 PID</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cat test10.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test job control</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># $$ to display the PID of process running this script</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Script Process ID: $$&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;End of script...&quot;</span></span><br><span class="line"></span><br><span class="line">./test10.sh </span><br><span class="line"><span class="comment"># Script Process ID: 17179</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line"><span class="comment"># [1]+  Stopped                 ./test10.sh</span></span><br><span class="line">./test10.sh &gt; test10.out &amp;</span><br><span class="line"><span class="comment"># [2] 17192</span></span><br><span class="line"><span class="built_in">jobs</span> </span><br><span class="line"><span class="comment"># [1]+  Stopped                 ./test10.sh</span></span><br><span class="line"><span class="comment"># [2]-  Running                 ./test10.sh &gt; test10.out &amp;</span></span><br><span class="line"><span class="built_in">jobs</span> -l </span><br><span class="line"><span class="comment"># [1]+ 17179 Suspended: 18           ./test10.sh</span></span><br><span class="line"><span class="comment"># [2]- 17192 Done                    ./test10.sh &gt; test10.out</span></span><br></pre></td></tr></table></figure>

<p>jobs 命令的可选参数</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-l</td>
<td align="left">List the PID of the process along with the job number</td>
</tr>
<tr>
<td align="left">-n</td>
<td align="left">Lists only jobs that have changed their status since the last notification from the shell</td>
</tr>
<tr>
<td align="left">-p</td>
<td align="left">Lists only the PIDs of the jobs</td>
</tr>
<tr>
<td align="left">-r</td>
<td align="left">Lists only the running jobs</td>
</tr>
<tr>
<td align="left">-s</td>
<td align="left">Lists only stopped jobs</td>
</tr>
</tbody></table>
<p>jobs 列出的信息可以看到加号和减号。<code>+</code> 表示 default job. <code>-</code> 表示即将变成 default job 的 job。同一时间，只有一个带 加号 的 job 和一个带 减号 的 job。</p>
<p>下面实验中，我们启动三个后台脚本并观察 jobs 状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">./test10.sh &gt; test10a.out &amp;</span><br><span class="line"><span class="comment"># [1] 17444</span></span><br><span class="line">./test10.sh &gt; test10b.out &amp;</span><br><span class="line"><span class="comment"># [2] 17448</span></span><br><span class="line">./test10.sh &gt; test10c.out &amp;</span><br><span class="line"><span class="comment"># [3] 17456</span></span><br><span class="line"><span class="built_in">jobs</span> -l </span><br><span class="line"><span class="comment"># [1]  17444 Running                 ./test10.sh &gt; test10a.out &amp;</span></span><br><span class="line"><span class="comment"># [2]- 17448 Running                 ./test10.sh &gt; test10b.out &amp;</span></span><br><span class="line"><span class="comment"># [3]+ 17456 Running                 ./test10.sh &gt; test10c.out &amp;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 杀死进程</span></span><br><span class="line"><span class="built_in">kill</span> 17444</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Restarting stopped jobs</p>
</blockquote>
<p>通过 bash 的 job control 你可以重新启动停止的脚本，启动方式有 background 和 foreground 两种，后者会接管终端</p>
<p>当有多个 script 停止时，可以使用 bg + num 的方式启动对应的脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat test11.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test job control</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;End of script...&quot;</span></span><br><span class="line"></span><br><span class="line">./test11.sh </span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line"><span class="comment"># [1]+  Stopped                 ./test11.sh</span></span><br><span class="line">./test11.sh </span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line"><span class="comment"># [2]+  Stopped                 ./test11.sh</span></span><br><span class="line"><span class="built_in">jobs</span> -l</span><br><span class="line"><span class="comment"># [1]- 17657 Suspended: 18           ./test11.sh</span></span><br><span class="line"><span class="comment"># [2]+ 17659 Suspended: 18           ./test11.sh</span></span><br><span class="line"><span class="built_in">bg</span> 2</span><br><span class="line"><span class="comment"># [2]+ ./test11.sh &amp;</span></span><br><span class="line"><span class="comment"># End of script...</span></span><br></pre></td></tr></table></figure>

<p><code>bg</code> 和 <code>fg</code> 的最主要的区别。如果用 bg, 你还可以在当前终端运行命令，如果是 fg 你需要等命令全部执行完了才能继续运行</p>
<h3 id="Being-Nice"><a href="#Being-Nice" class="headerlink" title="Being Nice"></a>Being Nice</h3><p>Linux 系统中各 process 都有优先级，从 -20 到 19 不等。 shell 启动的 process 默认都是 0。19 是最低优先级的。可以通过 Nice guys finish last 方便记忆</p>
<blockquote>
<p>Using the nice command</p>
</blockquote>
<p>当需要指定优先级时，可以通过使用 <code>nice</code> 命令指定优先级等级</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MacOS 不支持 cmd column</span></span><br><span class="line">nice -n 10 ./test4.sh &gt; test4.out &amp;</span><br><span class="line"><span class="comment"># [2] 18051</span></span><br><span class="line"><span class="comment"># [1]   Done                    nice -n 10 ./test4.sh &gt; test4.out</span></span><br><span class="line">ps -p 18051 -o pid,ppid,ni</span><br><span class="line"><span class="comment">#   PID  PPID NI</span></span><br><span class="line"><span class="comment"># 18051 16881 10</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using the renice command</p>
</blockquote>
<p>当 process 运行是，可以通过 <code>renice</code> 调整优先级</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./test11.sh &amp;</span><br><span class="line"><span class="comment"># [1] 18154</span></span><br><span class="line">ps -p 18154 -o pid,ni</span><br><span class="line"><span class="comment">#   PID NI</span></span><br><span class="line"><span class="comment"># 18154  0</span></span><br><span class="line">renice -n 10 -p 18154</span><br><span class="line">ps -p 18154 -o pid,ni</span><br><span class="line"><span class="comment">#   PID NI</span></span><br><span class="line"><span class="comment"># 18154 10</span></span><br></pre></td></tr></table></figure>

<p>和 nice 一样，renice 也有以下限制</p>
<ul>
<li>只能 renice 你自己 own 的 processes</li>
<li>renice 只能将优先级调低</li>
<li>root 用户可以用 renice 调整到任何等级</li>
</ul>
<h3 id="Running-Like-Clockwork"><a href="#Running-Like-Clockwork" class="headerlink" title="Running Like Clockwork"></a>Running Like Clockwork</h3><p>这章我们将会使用 <code>at</code> 和 <code>corn</code> 命令让我们的脚本定时运行</p>
<blockquote>
<p>Scheduling a job using the at command</p>
</blockquote>
<p><code>at</code> 让你可以定时的在系统中运行脚本，大多数 Linux 系统会在启动时开启一个 atd 的守进程，定时 check 并运行目标路径(/var/spool/at) 下的脚本</p>
<blockquote>
<p>Understanding the at command format</p>
</blockquote>
<p><code>at</code> 的基本格式很简单 <code>at [-f filename] time</code>. at 可以识别多种时间格式</p>
<ul>
<li>A standard hour and minute, such as 10:15</li>
<li>An AM/PM indicator, such as 10:15PM</li>
<li>A specific named time, such as now, noon, midnight or teatime(4PM)</li>
</ul>
<p>同时你可以指定特定格式的日期</p>
<ul>
<li>A standard date format, such as MMDDYY, MM/DD/YY, or DD.MM.YY</li>
<li>A text date, such as Jul 4 or Dec 25, with or withour the year</li>
<li>A time increment:<ul>
<li>Now + 25 minutes</li>
<li>10:15PM tomorrow</li>
<li>10:15 + 7 days</li>
</ul>
</li>
</ul>
<p>当使用 at 命令的时候，对应的 job 提交到 job queue 中。系统中有 26 种 job 可选，队列名字为字母大小写的 a-z</p>
<p><strong>Note</strong> 以前还有一个 batch 命令可以让你在 low useage 状态下运行 script，现在它只是通过调用 at + b queue 完成的定时脚本。队列的字母顺序越靠后，优先级越低。默认 job 优先级为 a</p>
<blockquote>
<p>Retrieving job output</p>
</blockquote>
<p>Linux 系统中，当 job 运行时是没有监测的地方的。系统会将内容记录到邮件中并发送给联系人</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test13.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test using at command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This script ran at <span class="subst">$(date +%B%d,%T)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> sleep 5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the script&#x27;s end&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">at -f test13.sh now</span><br><span class="line"><span class="comment"># job 1 at Thu Jun  3 12:27:19 2021</span></span><br></pre></td></tr></table></figure>

<p>如果你系统没有配置邮箱，那就收不到邮件了，你可以直接指定输入到文件</p>
<p>PS: 这个实验失败，运行后我并没有看到 out 文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test13b.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test using at command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This script ran at <span class="subst">$(date +%B%d,%T)</span>&quot;</span> &gt; test13b.out</span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; test13b.out</span><br><span class="line"><span class="built_in">echo</span> sleep 5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the script&#x27;s end&quot;</span> &gt;&gt; test13b.out</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查了一下 at 并没有 -M 这个可选参数啊。。</span></span><br><span class="line">at -M -f test13b.sh now </span><br><span class="line"><span class="comment"># job 3 at Thu Jun  3 12:34:11 2021</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Listing pending jobs</p>
</blockquote>
<p>显示所有 pendng 的 job, 我还以为也是用 jobs 呢，忙乎了半天</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">atq</span><br><span class="line"><span class="comment"># 1       Thu Jun  3 12:27:00 2021</span></span><br><span class="line"><span class="comment"># 4       Thu Jun  3 12:35:00 2021</span></span><br><span class="line"><span class="comment"># 5       Thu Jun  3 12:35:00 2021</span></span><br><span class="line"><span class="comment"># 2       Thu Jun  3 12:32:00 2021</span></span><br><span class="line"><span class="comment"># 3       Thu Jun  3 12:34:00 2021</span></span><br><span class="line"><span class="comment"># 6       Thu Jun  3 16:00:00 2021</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Removing jobs</p>
</blockquote>
<p>删除 at queue 中的 job</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">atrm 1</span><br><span class="line">atq</span><br><span class="line"><span class="comment"># 4       Thu Jun  3 12:35:00 2021</span></span><br><span class="line"><span class="comment"># 5       Thu Jun  3 12:35:00 2021</span></span><br><span class="line"><span class="comment"># 2       Thu Jun  3 12:32:00 2021</span></span><br><span class="line"><span class="comment"># 3       Thu Jun  3 12:34:00 2021</span></span><br><span class="line"><span class="comment"># 6       Thu Jun  3 16:00:00 2021</span></span><br></pre></td></tr></table></figure>

<p>Mac 是不是有什么特殊设置啊， 之前启动的 at job 都 block 了</p>
<h4 id="Scheduling-regular-scripts"><a href="#Scheduling-regular-scripts" class="headerlink" title="Scheduling regular scripts"></a>Scheduling regular scripts</h4><p>at 只能配置一次性 job, 如果要配置可重复的 job，可以用 cron. cron 在后台运行，他会检查 cron tables 看哪些 job 需要运行</p>
<h5 id="Looking-at-the-cron-table"><a href="#Looking-at-the-cron-table" class="headerlink" title="Looking at the cron table"></a>Looking at the cron table</h5><p>cron job 的语法：<code>min hour dayofmonth month dayofweek command</code> 示例如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># * 表示 每 的意思</span></span><br><span class="line"><span class="comment"># 下面的定时为 每天 10:15 </span></span><br><span class="line">15 10 * * * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个周一的 16:15</span></span><br><span class="line">15 16 * * 1 <span class="built_in">command</span></span><br><span class="line"><span class="comment"># dayofweek 也可以是三个字母的表示 mon, tue, wed, thu, fri, sat, sun</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个月的第一天 12:00</span></span><br><span class="line">00 12 1 * * <span class="built_in">command</span></span><br><span class="line"><span class="comment"># dayofmonth 为 1-31</span></span><br></pre></td></tr></table></figure>

<p><strong>Note</strong> 怎么设置每月最后天 run 的 job? 可以通过检查明天是不是第一天解决这个问题，示例：<code>00 12 * * * if [</code>date +%d -d tomorrow<code>= 01 ] ;  then ; command</code> 解释：每天中午检查一下明天是不是下个月的第一天，如果是则执行 command</p>
<p>cron job 必须指出脚本的全路径 <code>15 10 * * * /home/rich/test4.sh &gt; test4out</code></p>
<h5 id="Building-the-cron-table"><a href="#Building-the-cron-table" class="headerlink" title="Building the cron table"></a>Building the cron table</h5><p>显示当前用户的 cron job</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br><span class="line"><span class="comment"># crontab: no crontab for i306454</span></span><br></pre></td></tr></table></figure>

<h5 id="View-cron-directories"><a href="#View-cron-directories" class="headerlink" title="View cron directories"></a>View cron directories</h5><p>mac 下没有这些配置，先跳过</p>
<h3 id="Starting-scripts-with-a-new-shell"><a href="#Starting-scripts-with-a-new-shell" class="headerlink" title="Starting scripts with a new shell"></a>Starting scripts with a new shell</h3><p>书中说的是 set shell features, 所以下面这一段讲的是配置问题</p>
<p>启动 shell 时配置文件加载顺序如下，当前面的被发现时，后面的就会被忽略</p>
<ul>
<li>$HOME/.bash_profile</li>
<li>$HOME/.bash_login</li>
<li>$HOME/.profile</li>
</ul>
<p>这里用的是 runs the <code>.bashrc</code> 所以感觉 rc 文件更像是添加什么新功能的感觉(主管臆测，就我本人，感觉什么东西都塞到 rc 中了，也能 work)</p>
<p>每次 bash shell 启动时都会运行 <code>.bashrc</code> 中的内容</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/18/Hexo-bugs-investigation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/18/Hexo-bugs-investigation/" class="post-title-link" itemprop="url">Hexo bug 记录</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-18 10:41:25" itemprop="dateCreated datePublished" datetime="2021-05-18T10:41:25+08:00">2021-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Hexo/" itemprop="url" rel="index">
                    <span itemprop="name">Hexo</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>408</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="navigation-side-bar-issue"><a href="#navigation-side-bar-issue" class="headerlink" title="navigation side bar issue"></a>navigation side bar issue</h2><p>发现一个 Hexo 的 bug. 使用版本</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hexo version </span><br><span class="line">INFO  Validating config</span><br><span class="line">hexo: 5.0.0</span><br><span class="line">hexo-cli: 4.1.0</span><br><span class="line">os: Darwin 20.4.0 darwin x64</span><br><span class="line">node: 15.10.0</span><br><span class="line">v8: 8.6.395.17-node.25</span><br><span class="line">uv: 1.41.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">brotli: 1.0.9</span><br><span class="line">ares: 1.17.1</span><br><span class="line">modules: 88</span><br><span class="line">nghttp2: 1.42.0</span><br><span class="line">napi: 7</span><br><span class="line">llhttp: 2.1.3</span><br><span class="line">openssl: 1.1.1j</span><br><span class="line">cldr: 38.1</span><br><span class="line">icu: 68.2</span><br><span class="line">tz: 2020d</span><br><span class="line">unicode: 13.0</span><br></pre></td></tr></table></figure>

<p>问题描述：</p>
<p>Outline 中的中文导航会失败，英文的可以正常工作</p>
<p><img src="outline.png" alt="Outline display issue"></p>
<p>怎么修还不清楚，简单搜索了一下并没有查到解决方案，有机会的话可以看看 Hexo 源码再提一个 fix 的 PR ╮(￣▽￣””)╭</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/17/LSSC-shell-something-out/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/17/LSSC-shell-something-out/" class="post-title-link" itemprop="url">牛刀小试</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-17 19:27:05" itemprop="dateCreated datePublished" datetime="2021-05-17T19:27:05+08:00">2021-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Shell</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>Man</strong> 帮助文档操作方式</p>
<ul>
<li>ctrl + F或者 Page Down：向下翻页</li>
<li>ctrl + B或者 Page Up：向上翻页</li>
<li>gg到第一行</li>
<li>GG到最后一行</li>
<li>/start：能在整手册中搜索start相关字符，使用n查找下一个，使用N查找上一个</li>
<li>j，k与vi中一样使用，j向下一行，k向上一行</li>
<li>d下翻半页</li>
<li>u上翻半页</li>
<li>h获取man使用帮助</li>
<li>q退出man</li>
</ul>
<h2 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h2><p>以下实验均基于 bas</p>
<ul>
<li>提示符 <code>$</code> 表示普通用户， <code>#</code> 表示 root 用户</li>
<li>shebang: shell 文件首部的，以 <code>#!</code> 开头指定 shell 版本的语句</li>
<li>两种运行方式，终端对话框运行 or 运行脚本文件 <code>bash /path/to/file.script.sh</code></li>
<li>历史记录存储在 <code>.bash_history</code> 文件中</li>
<li>两个 cmd 可以写在同一行，但是需要用 <code>;</code> 隔开， <code>echo a ; echo b</code> 等价于 <code>echo a \n echo b</code></li>
</ul>
<blockquote>
<p>什么是 login shell<br>A login shell is the shell which you get just after logging in to a machine. However, if you open up a shell while logged in to a graphical environment (such as GNOME, KDE, and so on), then it is not a login shell.</p>
</blockquote>
<h2 id="Printing-in-the-terminal"><a href="#Printing-in-the-terminal" class="headerlink" title="Printing in the terminal"></a>Printing in the terminal</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印，自带结尾换行效果</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Welcome to Bash&quot;</span></span><br><span class="line"><span class="comment"># Welcome to Bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不带引号也可以</span></span><br><span class="line"><span class="built_in">echo</span> Welcome to Bash</span><br><span class="line"><span class="comment"># Welcome to Bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单引号也可以</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;text in quotes&#x27;</span></span><br><span class="line"><span class="comment"># text in quotes</span></span><br></pre></td></tr></table></figure>

<p>从上面效果看，都能打印，而且结果都一致，但是这几种使用方式还是有区别的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &quot; 中不能以 ！ 结尾, 在 bash 中 ！有特殊含义，表示前一个</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hi !&quot;</span></span><br><span class="line"><span class="comment"># bash: !&quot;: event not found</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用之前命令测试</span></span><br><span class="line"><span class="built_in">echo</span> aaa</span><br><span class="line"><span class="comment"># aaa</span></span><br><span class="line">!<span class="built_in">echo</span></span><br><span class="line"><span class="comment"># echo aaa</span></span><br><span class="line"><span class="comment"># aaa</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 但是如果 ！ 后面接空格则正常</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hi ! &quot;</span></span><br><span class="line"><span class="comment"># hi !</span></span><br></pre></td></tr></table></figure>

<p>echo 的几种用法的副作用：</p>
<ol>
<li>光杆 echo, 后面不能接 <code>;</code> 不然命令断裂了</li>
<li>单引号 echo, 变量复制不起作用</li>
</ol>
<p>echo 的其他用法：</p>
<ol>
<li><code>echo -n &quot;hi&quot;</code> 使用 <code>-n</code> 取出换行</li>
<li><code>echo -e &quot;1\t2\t3&quot;</code> 使用 <code>-e</code> 打印转义符</li>
</ol>
<p>echo 输出变色：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># \e[1;31m 设置字体为红色, \e[0m 重制</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31m This is red text \e[0m&quot;</span></span><br><span class="line"><span class="comment"># This is red text</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># \e[1;42m 设置背景为绿色, \e[0m 重制</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\e[1;42m Green Background \e[0m&quot;</span></span><br><span class="line"><span class="comment"># Green Background</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 混合使用也是 OK 的</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\e[1;42m\e[1;31m Green Background \e[0m&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># printf 和 C 语言中用法一致，默认不带换行</span></span><br><span class="line">bash-3.2$ <span class="built_in">printf</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line">hello worldbash-3.2$</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印示例</span></span><br><span class="line"><span class="built_in">printf</span>  <span class="string">&quot;%-5s %-10s %-4s\n&quot;</span> No Name  Mark</span><br><span class="line"><span class="built_in">printf</span>  <span class="string">&quot;%-5s %-10s %-4.2f\n&quot;</span> 1 Sarath 80.3456</span><br><span class="line"><span class="built_in">printf</span>  <span class="string">&quot;%-5s %-10s %-4.2f\n&quot;</span> 2 James 90.9989</span><br><span class="line"><span class="built_in">printf</span>  <span class="string">&quot;%-5s %-10s %-4.2f\n&quot;</span> 3 Jeff 77.564</span><br><span class="line"><span class="comment"># No    Name       Mark</span></span><br><span class="line"><span class="comment"># 1     Sarath     80.35</span></span><br><span class="line"><span class="comment"># 2     James      91.00</span></span><br><span class="line"><span class="comment"># 3     Jeff       77.56</span></span><br></pre></td></tr></table></figure>

<p>PS: -5, 左对齐，占 5 个位置</p>
<h2 id="Session-3-Playing-with-variables-and-environment-variables"><a href="#Session-3-Playing-with-variables-and-environment-variables" class="headerlink" title="Session 3 Playing with variables and environment variables"></a>Session 3 Playing with variables and environment variables</h2><p>赋值语句 <code>var=value</code>，需要注意的是，<code>var = value</code> 是不对的，后者是等于运算。如果 value 中间没有空格，则直接写，不然需要用引号包裹。当使用 echo 或者 prinf 输出变量时，需要用<strong>双引号</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">name=jack</span><br><span class="line">echo $name # or `echo $&#123;name&#125;`</span><br><span class="line"><span class="meta">#</span><span class="bash"> jack</span></span><br><span class="line"></span><br><span class="line">name2 = jaack</span><br><span class="line"><span class="meta">#</span><span class="bash"> zsh: <span class="built_in">command</span> not found: name2</span></span><br><span class="line"></span><br><span class="line">name=&quot;jack zheng&quot;</span><br><span class="line">echo $&#123;name&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> jack zheng</span></span><br><span class="line"></span><br><span class="line">name=&#x27;jack zheng&#x27;</span><br><span class="line">echo $&#123;name&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> jack zheng</span></span><br><span class="line"></span><br><span class="line">fruit=apple</span><br><span class="line">count=5 </span><br><span class="line">echo &quot;We have $count $&#123;fruit&#125;(s)&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> We have 5 apple(s)</span></span><br><span class="line">echo &#x27;We have $count $&#123;fruit&#125;(s)&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> We have <span class="variable">$count</span> <span class="variable">$&#123;fruit&#125;</span>(s)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 输出变量长度</span></span><br><span class="line">length=$&#123;#name&#125;</span><br><span class="line">echo $length</span><br><span class="line"><span class="meta">#</span><span class="bash"> 10 - it<span class="string">&#x27;s the length of &#x27;</span>jack zheng<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示当前的 shell 种类</span></span><br><span class="line">echo $SHELL # or `echo $0`</span><br><span class="line"><span class="meta">#</span><span class="bash"> /bin/zsh</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果运行 script 的用户不是 root，打印提示信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意点：</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   1. 书上的例子首字母写错了</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   2. <span class="keyword">if</span> [ 之间都有空格的，不然会抛语法错误</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   3. root user 的 UID 为 0</span></span><br><span class="line">if [ $UID -ne 0 ]; then</span><br><span class="line">    echo Non root user. Please run as root.</span><br><span class="line">else</span><br><span class="line">    echo Root user</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改提示符内容</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以通过修改 .bashrc 中的 PS1 变量来达到该效果，不过我本地用的 zsh 和书上说的略有不同，就不是试了</span></span><br></pre></td></tr></table></figure>

<h2 id="Function-to-prepend-to-environmnet-variables"><a href="#Function-to-prepend-to-environmnet-variables" class="headerlink" title="Function to prepend to environmnet variables"></a>Function to prepend to environmnet variables</h2><p>假设我们安装了新的应用到 <code>/opt/myapp</code>，这个应用包含 <code>bin</code> 和 <code>lib</code> 目录。为了使他生效，我们需要做如下设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/opt/myapp/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/opt/myapp/lib;<span class="variable">$LD_LIBRARY_PATH</span></span><br></pre></td></tr></table></figure>

<p>如果想简化上面的设置的话，我们可以在 <code>.bashrc</code> 里自定义一些函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">prepend</span></span>() &#123; [ -d <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ] &amp;&amp; <span class="built_in">eval</span> <span class="variable">$1</span>=\&quot;<span class="variable">$2</span><span class="string">&#x27;:&#x27;</span>\$<span class="variable">$1</span>\&quot; &amp;&amp; <span class="built_in">export</span> <span class="variable">$1</span>; &#125;</span><br><span class="line"><span class="comment"># $1=\&quot;$2&#x27;:&#x27;\$$1\&quot; 人话说就是 PATH=&quot;New_Path:$PATH&quot;</span></span><br><span class="line"><span class="comment"># 可以通过 echo $1=\&quot;$2&#x27;:&#x27;\$$1\&quot; 测试</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 之前的命令可以简化为</span></span><br><span class="line">prepend PATH /opt/myapp/bin</span><br><span class="line">prepend LD_LIBRARY_PATH /opt/myapp/lib</span><br></pre></td></tr></table></figure>

<p>但是上面的脚本有瑕疵，当原始 PATH 为 null 时，新生成的 PATH 就会以 <code>:</code> 结果，我们可以改进如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">prepend</span></span>() &#123; [ -d <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ] &amp;&amp; <span class="built_in">eval</span> <span class="variable">$1</span>=\&quot;<span class="variable">$2</span>\$\&#123;<span class="variable">$1</span>:+<span class="string">&#x27;:&#x27;</span>\$<span class="variable">$1</span>\&#125;\&quot; &amp;&amp; <span class="built_in">export</span> <span class="variable">$1</span> ; &#125;</span><br></pre></td></tr></table></figure>

<p>PS: shell 中定义变量的格式 <code>$&#123;parameter:+expression&#125;</code></p>
<h2 id="上例中语法解释"><a href="#上例中语法解释" class="headerlink" title="上例中语法解释"></a>上例中语法解释</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如何定义函数？</span></span><br><span class="line"><span class="comment"># 格式如下，写在 .zshrc 中，source 一下即可调用</span></span><br><span class="line"><span class="function"><span class="title">demoFun</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;This is a function...&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">demoFun   </span><br><span class="line"><span class="comment"># This is a function...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何取得调用时传入的参数？</span></span><br><span class="line"><span class="comment"># 当位数超过 10 时需要用 $&#123;n&#125; 获取参数</span></span><br><span class="line"><span class="comment"># 其他特殊字符表示含义：</span></span><br><span class="line"><span class="comment">#   * $#: 传入参数的个数</span></span><br><span class="line"><span class="comment">#   * $*: 以一个字符串显示所有参数</span></span><br><span class="line"><span class="comment">#   * $@: 同上，但是需要加引号</span></span><br><span class="line"><span class="comment">#   * $$: 脚本运行的当前进程 ID</span></span><br><span class="line"><span class="comment">#   * $!: 后台运行的最后一个进程的 ID</span></span><br><span class="line"><span class="comment">#   * $?: 显示最后命令的退出状态，0 表示没错误，其他值表示有错误</span></span><br><span class="line"><span class="function"><span class="title">funWithParam</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第一个参数为 <span class="variable">$1</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第二个参数为 <span class="variable">$2</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第十个参数为 <span class="variable">$10</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第十个参数为 <span class="variable">$&#123;10&#125;</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第十一个参数为 <span class="variable">$&#123;11&#125;</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;参数总数有 <span class="variable">$#</span> 个!&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;作为一个字符串输出所有参数 $* !&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">funWithParam 1 2 3 4 5 6 7 8 9 34 73</span><br><span class="line"><span class="comment"># 第一个参数为 1 !</span></span><br><span class="line"><span class="comment"># 第二个参数为 2 !</span></span><br><span class="line"><span class="comment"># 第十个参数为 34 !</span></span><br><span class="line"><span class="comment"># 第十个参数为 34 !</span></span><br><span class="line"><span class="comment"># 第十一个参数为 73 !</span></span><br><span class="line"><span class="comment"># 参数总数有 11 个!</span></span><br><span class="line"><span class="comment"># 作为一个字符串输出所有参数 1 2 3 4 5 6 7 8 9 34 73 !</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [] 什么意思？</span></span><br><span class="line"><span class="comment"># shell 中方括号和 Test 等价</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -d 什么意思？</span></span><br><span class="line"><span class="comment"># -d filename 表示是否为目录，但是总感觉用在这里词不达意</span></span><br><span class="line"><span class="comment"># 类似的还有 -eq，判等</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># eval 什么意思？</span></span><br><span class="line"><span class="comment"># eval 如果后面直接跟命令，直接运行，如果命令中包含变量，则计算变量后运行</span></span><br><span class="line"><span class="built_in">set</span> 11 22 33 44</span><br><span class="line"><span class="comment"># 假设我们不知道参数长度，可以如下输出最后一个参数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$#</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\$<span class="variable">$#</span>&quot;</span></span><br><span class="line"><span class="comment"># $4</span></span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">echo</span> <span class="string">&quot;\$<span class="variable">$#</span>&quot;</span></span><br><span class="line"><span class="comment"># 44</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改后的 \$\&#123;$1:+&#x27;:&#x27;\$$1\&#125; 是什么意思？</span></span><br><span class="line"><span class="comment"># :+ 表示覆盖缺省值</span></span><br><span class="line"><span class="comment"># 只有当var不是空的时候才替换成string, 若var为空时则不替换或者说是替换成变量var的值,即空值</span></span><br><span class="line">COMPANY=<span class="string">&quot;Nightlight Inc.&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;COMPANY:+Company has been overridden&#125;</span>&quot;</span></span><br><span class="line"><span class="comment"># Company has been overridden</span></span><br><span class="line">COMPANY=</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;COMPANY:+Company has been overridden&#125;</span>&quot;</span></span><br><span class="line"><span class="comment"># 打印空行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &amp;&amp; 什么意思</span></span><br><span class="line"><span class="comment"># 逻辑与，前面条件成立才能执行后面的逻辑</span></span><br></pre></td></tr></table></figure>

<h2 id="Math-with-the-shell"><a href="#Math-with-the-shell" class="headerlink" title="Math with the shell"></a>Math with the shell</h2><p>体验下来就一个感觉，bash 下的计算略微繁琐</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 准备变量</span></span><br><span class="line">no1=4; no2=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 let 关键字</span></span><br><span class="line"><span class="comment"># 整个表达式没有空格，不然报错！！！</span></span><br><span class="line"><span class="built_in">let</span> result=no1+no2</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line"><span class="comment"># 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持自增/减</span></span><br><span class="line"><span class="built_in">let</span> no1++ <span class="comment"># 也支持写成 no1+=1</span></span><br><span class="line"><span class="built_in">let</span> no2-- <span class="comment"># 也支持写成 no2-=1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$no1</span> <span class="variable">$no2</span></span><br><span class="line"><span class="comment"># 6 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 和 let 功能相同的还有 []</span></span><br><span class="line">result=$[ no1 + no2 ]   <span class="comment"># 等号两边不能有空格，中括号中间无所谓</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方括号中间的变量可以带 $，不影响结果</span></span><br><span class="line">result=$[ <span class="variable">$no1</span> + 100 ]</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line"><span class="comment"># 106</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 相同的功能还有 (()), 用法和 [] 一致</span></span><br><span class="line">result=$(( <span class="variable">$no1</span> + <span class="number">50</span> ))</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line"><span class="comment"># 56</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 相同功能的还有 expr</span></span><br><span class="line">result=`expr <span class="variable">$no1</span> + 4`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 但是它们貌似都只能做整数计算</span></span><br><span class="line"><span class="built_in">let</span> result=3+4.0</span><br><span class="line"><span class="comment"># bash: let: result=3+4.0: syntax error: invalid arithmetic operator (error token is &quot;.0&quot;)</span></span><br><span class="line">result=$[expr <span class="variable">$no1</span> + 4.0]</span><br><span class="line"><span class="comment"># bash: expr 6 + 4.0: syntax error in expression (error token is &quot;6 + 4.0&quot;)</span></span><br><span class="line">bash-3.2$ result=$((expr <span class="variable">$no1</span> + <span class="number">4.0</span>))</span><br><span class="line"><span class="comment"># bash: expr 6 + 4.0: syntax error in expression (error token is &quot;6 + 4.0&quot;)</span></span><br><span class="line">result=`expr <span class="variable">$no1</span> + 4.0`</span><br><span class="line"><span class="comment"># expr: not a decimal number: &#x27;4.0&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如果想要有精度的计算，可以使用 <code>bc</code>, bc 是basic calculator/bench calculator的简称。其语法类似于C语言，支持加减乘除还有更多复杂的运算。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; bc</span><br><span class="line">1+2</span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;4 * 0.56&quot;</span> | bc</span><br><span class="line"><span class="comment"># 2.24</span></span><br><span class="line"></span><br><span class="line">result=`<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$no</span> * 1.5&quot;</span> | bc`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line"><span class="comment"># 81.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以指定精确的位数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;scale=2;3/8&quot;</span> | bc</span><br><span class="line"><span class="comment"># .37</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以做进制转化, 而且必须先设置 obase 在设置 ibase</span></span><br><span class="line">no=100</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;obase=2;<span class="variable">$no</span>&quot;</span> | bc</span><br><span class="line"><span class="comment"># 1100100</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;obase=10;ibase=2;1100100&quot;</span> | bc</span><br><span class="line">100</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo 也可以达到进制转化的效果，不过只能转成 10 进制</span></span><br><span class="line"><span class="built_in">echo</span> $[8<span class="comment">#11] # 效果等同与 $((8#11))</span></span><br><span class="line"><span class="comment"># 11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bash 中也有自带的函数，比如次方和开方</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;10^2&quot;</span> | bc</span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sqrt(100)&quot;</span> | bc</span><br><span class="line"><span class="comment"># 10</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>man page 说明如下:<br>There are four special variables, scale, ibase, obase, and last. scale defines how some operations use digits after the decimal point. The default value of scale is 0.<br>ibase and obase define the conversion base for input and output numbers. The default for both input and output is base 10.<br>last (an extension) is a variable that has the value of the last printed number. These will be discussed in further detail where appropriate.<br>All of these variables may have values assigned to them as well as used in expressions.</p>
</blockquote>
<h2 id="Playing-with-file-descriptors-and-redirection"><a href="#Playing-with-file-descriptors-and-redirection" class="headerlink" title="Playing with file descriptors and redirection"></a>Playing with file descriptors and redirection</h2><p>文件描述符：</p>
<ul>
<li>0: stdin</li>
<li>1: stdout</li>
<li>2: stderr</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基操，输入到文件，如果原来有值，会覆盖</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a sample text 1&quot;</span> &gt; tmp.txt</span><br><span class="line">ls</span><br><span class="line"><span class="comment"># tmp.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># append 内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a sample text 2&quot;</span> &gt;&gt; tmp.txt</span><br><span class="line">cat tmp.txt</span><br><span class="line"><span class="comment"># This is a sample text 1</span></span><br><span class="line"><span class="comment"># This is a sample text 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重定向错误信息</span></span><br><span class="line">ls +</span><br><span class="line"><span class="comment"># ls: +: No such file or directory</span></span><br><span class="line"><span class="comment"># 打印命令返回值，非 0 都是失败</span></span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试将 err 导入文件</span></span><br><span class="line">ls + &gt; out.txt</span><br><span class="line"><span class="comment"># ls: +: No such file or directory</span></span><br><span class="line">cat out.txt</span><br><span class="line"><span class="comment"># 无内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stderr 标识符 2，所以 2&gt; 表示把错误信息导入到某个流处理的意思</span></span><br><span class="line">ls + 2&gt; out.txt</span><br><span class="line">cat out.txt </span><br><span class="line"><span class="comment"># ls: +: No such file or directory</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以分别指定流出口</span></span><br><span class="line">cmd 2&gt;stderr.txt 1&gt;stdout.txt</span><br><span class="line">cat stderr.txt </span><br><span class="line"><span class="comment"># bash: cmd: command not found</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将标准输出和错误信息一起写入文件</span></span><br><span class="line">cmd &gt; out.txt 2&gt;&amp;1</span><br><span class="line"><span class="comment"># 他还有一个简写方式</span></span><br><span class="line">cmd &amp;&gt; out.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试 /dev/null</span></span><br><span class="line"><span class="comment"># 这个测试感觉上不怎么贴切，但是，它用来生产 err 的方式还是很可以的</span></span><br><span class="line"><span class="comment"># 测试描述：生产三个文件，将其中一个权限变为 000, cat 这三个文件就会抛异常</span></span><br><span class="line"><span class="built_in">echo</span> a1 &gt; a1; cp a1 a2; cp a1 a3; chmod 000 a1;</span><br><span class="line">cat a* 2&gt; err.txt</span><br><span class="line"><span class="comment"># a1</span></span><br><span class="line"><span class="comment"># a1</span></span><br><span class="line">cat err.txt</span><br><span class="line"><span class="comment"># cat: a1: Permission denied</span></span><br><span class="line"><span class="comment"># 将 err 导向 /dev/null 则没有输出</span></span><br><span class="line">cmd 2&gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># tee 将输出写入文件的同时，给一份到 stdout</span></span><br><span class="line"><span class="comment"># 默认情况下 tee 会覆盖原文件，用 tee -a 可以达到 append 的效果</span></span><br><span class="line">cat a* | tee out.txt | cat -n</span><br><span class="line"><span class="comment"># cat: a1: Permission denied</span></span><br><span class="line"><span class="comment">#      1    a1</span></span><br><span class="line"><span class="comment">#      2    a1</span></span><br><span class="line">cat out.txt</span><br><span class="line"><span class="comment"># a1</span></span><br><span class="line"><span class="comment"># a1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tee 后接多个 file，内容都是重复的</span></span><br><span class="line"><span class="built_in">echo</span> aaa | tee f1 f2</span><br><span class="line">cat f1 f2</span><br><span class="line"><span class="comment"># aaa</span></span><br><span class="line"><span class="comment"># aaa</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># `-` 代表标准输入, </span></span><br><span class="line"><span class="built_in">echo</span> who is this | tee -</span><br><span class="line"><span class="comment"># who is this</span></span><br></pre></td></tr></table></figure>

<p><code>&gt;</code> Vs <code>&gt;&gt;</code>: 前者是覆盖，后者是续接</p>
<blockquote>
<p>./dev/null is a special device file where any data received by the file is discarded. The null device is often known as a black hole as all the data that goes into it is lost forever.<br>/dev/null 是一个特殊的设备，可以将它看作一个黑洞，所有进去的东西都没了 </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 终端多行输入</span></span><br><span class="line">cat &lt;&lt; EOF &gt; log.txt</span><br><span class="line">LOG FILE HEADER</span><br><span class="line">This is a <span class="built_in">test</span> <span class="built_in">log</span> file</span><br><span class="line">Function: System statistics</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat log.txt</span><br><span class="line"><span class="comment"># LOG FILE HEADER</span></span><br><span class="line"><span class="comment"># This is a test log file</span></span><br><span class="line"><span class="comment"># Function: System statistics</span></span><br></pre></td></tr></table></figure>

<p>自定义文件描述符</p>
<p>可用模式：Read mode, Write with truncate mode, Write with append mode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># `&lt;` 用于将文件导向 stdin</span></span><br><span class="line"><span class="built_in">echo</span> this is a <span class="built_in">test</span> line &gt; input.txt</span><br><span class="line"><span class="built_in">exec</span> 3&lt;input.txt</span><br><span class="line">cat &lt;&amp;3</span><br><span class="line"><span class="comment"># this is a test line</span></span><br><span class="line">cat &lt;&amp;3</span><br><span class="line"><span class="comment"># 没有输出，这种方式不能复用，需要重新赋值</span></span><br></pre></td></tr></table></figure>

<p>为写操作自定义文件描述符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec</span> 4&gt; output.txt</span><br><span class="line"><span class="built_in">echo</span> newline &gt;&amp;4</span><br><span class="line">cat output.txt</span><br><span class="line"><span class="comment"># newline</span></span><br><span class="line"><span class="comment"># 书上说这种方式再次调用会覆盖的才对，我这边测试是以 append 方式附加的</span></span><br><span class="line"><span class="built_in">echo</span> aaa &gt;&amp;4</span><br><span class="line">cat output.txt</span><br><span class="line"><span class="comment"># newline</span></span><br><span class="line"><span class="comment"># aaa</span></span><br></pre></td></tr></table></figure>

<p>为 append 模式的 write 定义文件描述符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec</span> 5&gt;&gt;out.txt</span><br><span class="line"><span class="built_in">echo</span> appended line &gt;&amp;5</span><br><span class="line">cat out.txt</span><br><span class="line"><span class="comment"># appended line</span></span><br><span class="line"><span class="built_in">echo</span> appended line2 &gt;&amp;5</span><br><span class="line">cat out.txt</span><br><span class="line"><span class="comment"># appended line</span></span><br><span class="line"><span class="comment"># appended line2</span></span><br></pre></td></tr></table></figure>

<p>PS: <code>&gt;&gt;</code> 自带会车，如果不想要，需要用可以用 <code>echo -n</code> 或者 <code>printf &quot;%s&quot; &quot;$(value)&quot;</code></p>
<h2 id="Arrays-and-associative-arrays"><a href="#Arrays-and-associative-arrays" class="headerlink" title="Arrays and associative arrays"></a>Arrays and associative arrays</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数组声明及调用</span></span><br><span class="line">array_var=(1 2 3 4 5 6)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;array_var[0]&#125;</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 输出全部</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;array_var[*]&#125;</span>  <span class="comment"># or echo $&#123;array_var[@]&#125;</span></span><br><span class="line"><span class="comment"># 1 2 3 4 5 6</span></span><br><span class="line"><span class="comment"># 打印长度</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#array_var[*]&#125;</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出 index 下标</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!array_var[*]&#125;</span> <span class="comment"># or echo $&#123;!array_var[@]&#125;</span></span><br><span class="line"><span class="comment"># 0 1 2 3 4 5</span></span><br></pre></td></tr></table></figure>

<p>Associative arrays: 关系型数组，普通数组只能存整形，但是关系型数组可以存储混合的，任何 text 格式的数据。这种数据类型是在 Bash 4.0 引入的</p>
<p>Mac 升级 Bash 版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前版本</span></span><br><span class="line">bash --version</span><br><span class="line"><span class="comment"># GNU bash, version 3.2.57(1)-release (x86_64-apple-darwin20)</span></span><br><span class="line"><span class="comment"># Copyright (C) 2007 Free Software Foundation, Inc.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 小八卦：Bash 在 3.2 后的版本改了协议，开始使用 GPLv3 许可，Apple 不想支持，所以 Mac 上默认 Bash 只到 3.2 为止</span></span><br><span class="line"><span class="comment"># 新的 Bash 有很强的 tab 补全，值得期待</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看以安装 bash 路径</span></span><br><span class="line"><span class="built_in">which</span> bash</span><br><span class="line"><span class="comment"># /bin/bash</span></span><br><span class="line"></span><br><span class="line">brew install bash</span><br><span class="line"><span class="comment"># Updating Homebrew...</span></span><br><span class="line"><span class="comment"># ==&gt; Downloading https://mirrors.ustc.edu.cn/homebrew-bottles/bash-5.1.8.big_sur.bottle.tar.gz</span></span><br><span class="line"><span class="comment"># ######################################################################## 100.0%</span></span><br><span class="line"><span class="comment"># ==&gt; Pouring bash-5.1.8.big_sur.bottle.tar.gz</span></span><br><span class="line"><span class="comment"># /usr/local/Cellar/bash/5.1.8: 157 files, 10.9MB</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">which</span> bash</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/bash</span><br><span class="line"></span><br><span class="line">bash --version</span><br><span class="line"><span class="comment"># GNU bash, version 5.1.8(1)-release (x86_64-apple-darwin20.3.0)</span></span><br><span class="line"><span class="comment"># Copyright (C) 2020 Free Software Foundation, Inc.</span></span><br><span class="line"><span class="comment"># License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is free software; you are free to change and redistribute it.</span></span><br><span class="line"><span class="comment"># There is NO WARRANTY, to the extent permitted by law.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装结束</span></span><br></pre></td></tr></table></figure>

<p>Associative arrays 使用案例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -A fruits_value</span><br><span class="line">fruits_value=([apple]=<span class="string">&#x27;100 dollars&#x27;</span> [orange]=<span class="string">&#x27;150 dollars&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Apple costs <span class="variable">$&#123;fruits_value[apple]&#125;</span>&quot;</span></span><br><span class="line"><span class="comment"># Apple costs 100 dollars</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出下标，或者索引更贴切</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!fruits_value[*]&#125;</span></span><br><span class="line"><span class="comment"># orange apple</span></span><br></pre></td></tr></table></figure>

<p>PS: 感觉被骗了，这 TM 叫数组？！！命名就是字典嘛</p>
<h2 id="Visiting-aliases"><a href="#Visiting-aliases" class="headerlink" title="Visiting aliases"></a>Visiting aliases</h2><p>alias: 将很长的命令用一个简写来代替， 声明形式 <code>alias new_command=&#39;command sequence&#39;</code>, 例如 <code>alias install=&#39;sudo apt-get install&#39;</code></p>
<p>终端声明的 alias 是零时的，重启终端后失效，可以将其写入 rc 文件 <code>echo &#39;alias cmd=&quot;command seq&quot;&#39; &gt;&gt; ~/.bashrc</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示所有可用的别名</span></span><br><span class="line"><span class="built_in">alias</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新定义 rm 行为，删除文件时将它备份</span></span><br><span class="line"><span class="comment"># 测试失败。。。</span></span><br><span class="line"><span class="built_in">alias</span> rm=<span class="string">&#x27;cp $@ ~/backup &amp;&amp; rm $@&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这应该就是持续失败的原因，参数为止调换了</span></span><br><span class="line"><span class="comment"># 搜了下好像每有类似的问题，难道我系统坏了？？ 在 docker 容器中可以重现这个错误</span></span><br><span class="line"><span class="built_in">alias</span> mycp=<span class="string">&#x27;echo &quot;cp $@ ~/backup&quot;&#x27;</span></span><br><span class="line">mycp aaa.txt</span><br><span class="line"><span class="comment"># cp  ~/backup aaa.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 经过多方查证，作者这里的脚本写的有问题。按官方的原画，alias 是不支持传入参数的(补贴切)</span></span><br><span class="line"><span class="comment"># 这里可以用函数代替，在 alias 里面定义函数格式和外面不一样</span></span><br><span class="line"><span class="built_in">alias</span> mycp=<span class="string">&#x27;function _mycp() &#123; echo &quot;aaa $@ bbb&quot;; &#125;;_mycp&#x27;</span></span><br><span class="line">mycp xxx</span><br><span class="line"><span class="comment"># aaa xxx bbb</span></span><br><span class="line"><span class="built_in">alias</span> mycp=<span class="string">&#x27;function _mycp() &#123; echo &quot;aaa $1 bbb $2 ccc&quot;; &#125;;_mycp&#x27;</span></span><br><span class="line">mycp xxx yyy</span><br><span class="line"><span class="comment"># aaa xxx bbb yyy ccc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PS: 另外，如果只需要在末尾添加参数的话，alias 还是可以做到的</span></span><br><span class="line"><span class="built_in">alias</span> myls=<span class="string">&#x27;ls -al $@&#x27;</span> <span class="comment"># 或者 alias myls=&#x27;ls -al&#x27;</span></span><br><span class="line">myls ~/backup</span><br><span class="line"><span class="comment"># total 0</span></span><br><span class="line"><span class="comment"># drwxr-xr-x   2 i306454  staff    64 May 20 20:25 .</span></span><br><span class="line"><span class="comment"># drwxr-xr-x+ 76 i306454  staff  2432 May 21 13:05 ..</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 宗上所属，定制的 rm 应该写成如下形式</span></span><br><span class="line"><span class="built_in">alias</span> rm=<span class="string">&#x27;function _rm() &#123; cp $@ ~/backup &amp;&amp; rm $@;  &#125;; _rm&#x27;</span></span><br><span class="line">rm java_error_in_idea_12605.log</span><br><span class="line">ls ./backup</span><br><span class="line"><span class="comment"># java_error_in_idea_12605.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># disable alias, 前面加一个反斜杠</span></span><br><span class="line">\<span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示定义的 alias</span></span><br><span class="line"><span class="built_in">alias</span> rm</span><br><span class="line"><span class="comment"># alias rm=&#x27;cp $@ ~/backup &amp;&amp; rm $@&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line"><span class="built_in">unalias</span> rm</span><br><span class="line"><span class="built_in">alias</span> rm</span><br><span class="line"><span class="comment"># bash: alias: rm: not found</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/bash/manual/html_node/Aliases.html">Gun - Alias</a></li>
</ul>
<blockquote>
<p>There is no mechanism for using arguments in the replacement text, as in csh. If arguments are needed, a shell function should be used (see Shell Functions).</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/17/Java-base64-encode-and-decode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/17/Java-base64-encode-and-decode/" class="post-title-link" itemprop="url">Java 中实现 base64 编码/解码</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-17 18:56:05" itemprop="dateCreated datePublished" datetime="2021-05-17T18:56:05+08:00">2021-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>466</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Java util 包中自带了 base 64 的编码/解码方法，示例如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Base64Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String origin = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        String encodeRet = Base64.getEncoder().encodeToString(origin.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;Encode result: &quot;</span> + encodeRet);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Decode result: &quot;</span> + <span class="keyword">new</span> String(Base64.getDecoder().decode(encodeRet)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encode result: SGVsbG9Xb3JsZA==</span></span><br><span class="line"><span class="comment">// Decode result: HelloWorld</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/17/Shell-customized-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/17/Shell-customized-command/" class="post-title-link" itemprop="url">定制 Shell 脚本</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-17 12:24:54" itemprop="dateCreated datePublished" datetime="2021-05-17T12:24:54+08:00">2021-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Shell</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="定制-git-pull"><a href="#定制-git-pull" class="headerlink" title="定制 git pull"></a>定制 git pull</h2><p>git pull 算是开发时经常用到的一个命令了，但是更新代码之后，时常会遇到最新版本的代码不 work 的情况。由此，打算对 pull 命令做一个优化，每次 pull 的时候，将当前 repo 的信息写到历史记录中，类似 <code>.zsh_history</code> 的功能。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> git &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;\$@: &quot;</span> <span class="variable">$@</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;\$1: &quot;</span> <span class="variable">$1</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;\$2: &quot;</span> <span class="variable">$2</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="built_in">command</span> git <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> git &#123;</span><br><span class="line">  <span class="comment"># use wild card match, so use </span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;pull&quot;</span> &amp;&amp; <span class="string">&quot;<span class="variable">$@</span>&quot;</span> != *<span class="string">&quot;--help&quot;</span>* ]]; <span class="keyword">then</span></span><br><span class="line">    updateinfo=$(<span class="built_in">command</span> git pull | grep Updating)</span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="variable">$updateinfo</span> ]]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Skip recording pull history...&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Recording pull history...&quot;</span></span><br><span class="line">      <span class="comment"># write process date time</span></span><br><span class="line">      <span class="built_in">printf</span> <span class="string">&quot;%s  &quot;</span> <span class="string">&quot;<span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span>&quot;</span> &gt;&gt; ~/.git_pull.history</span><br><span class="line">      <span class="comment"># write current version for recover</span></span><br><span class="line">      <span class="built_in">printf</span> <span class="string">&quot;%s  &quot;</span> <span class="string">&quot;<span class="variable">$updateinfo</span>&quot;</span>  &gt;&gt; ~/.git_pull.history</span><br><span class="line">      <span class="comment"># write repo name</span></span><br><span class="line">      <span class="built_in">printf</span> <span class="string">&quot;%s\n&quot;</span> <span class="string">&quot;<span class="subst">$(command git config --get remote.origin.url | cut -d &#x27;/&#x27; -f 2)</span>&quot;</span>  &gt;&gt; ~/.git_pull.history</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">command</span> git <span class="string">&quot;<span class="variable">$@</span>&quot;</span>    <span class="comment"># command 用于调用外部命令</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PS: 为了重复测试脚本，可以使用 <code>git reset --hard xxx</code> 回退版本，再次测试 pull</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3538774/is-it-possible-to-override-git-command-by-git-alias">Stackoverflow</a></li>
</ul>
<h2 id="过滤文件"><a href="#过滤文件" class="headerlink" title="过滤文件"></a>过滤文件</h2><p>任务描述：</p>
<p>有一个 git repo 存储了所有的测试文件(java 格式)，已知需要筛选的文件列表，筛选出所有文件中包含 ‘DB’ (忽略大小写)的文件。并列出包含关键字的列，以便人工删选。</p>
<p>原始文件名列表格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">results</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">testcase</span> <span class="attr">external_id</span>=<span class="string">&#x27;PLT#-123456950&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>p<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">notes</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">testcase</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">results</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用编辑器的快捷功能将 <code>#-</code> 去掉</p>
<p>PS: 查询一下 sed, awk 和内置的字符串处理方式</p>
<p>repo 中文件名格式如下：PLT123457725UTF8ExportTemplateUserRecordWithUTF8UserImportAndShownCorrectEncoding</p>
<p>使用 find + grep 删选哪些文件包含 db 操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find . -iname &#x27;PLT123457726*.java&#x27; -exec grep -i &quot;dbUtil\|DB&quot; &#123;&#125; \;</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;Priorities.P1&quot;</span>, <span class="string">&quot;DBType.Oracle&quot;</span>, <span class="string">&quot;all&quot;</span>, <span class="string">&quot;TestType.Regression&quot;</span>, <span class="string">&quot;systemUltra&quot;</span>, <span class="string">&quot;systemv12&quot;</span>,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> String ssn = dbUtil.getSingleUserFieldValueByUserIdFromSMUserInfoTable(PLT123457670, SSN);</span></span><br><span class="line"></span><br><span class="line">find . -iname &#x27;PLT123457726*.java&#x27; -exec grep -i &quot;dbUtil\|db&quot; &#123;&#125; \; | grep -v &#x27;DBType&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> String ssn = dbUtil.getSingleUserFieldValueByUserIdFromSMUserInfoTable(PLT123457670, SSN);</span></span><br></pre></td></tr></table></figure>

<p>将文件中的 case name 删选出来 <code>grep -E -o &#39;PLT.*[0-9]+&#39; bulk.xml &gt;&gt; bulk2.xml</code></p>
<p>遍历每一行，做 query</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">file=&quot;./bulk2.xml&quot;</span><br><span class="line">while IFS= read line</span><br><span class="line"></span><br><span class="line">do</span><br><span class="line">    echo &quot;------------- start -------------&quot;</span><br><span class="line">    # write file name to file</span><br><span class="line">    find . -iname &quot;$line*.java&quot; -exec basename &#123;&#125; \;</span><br><span class="line">    echo &#x27;------------- match start -------------&#x27;</span><br><span class="line">    # write matched line to file</span><br><span class="line">    find . -iname &quot;$line*.java&quot; -exec grep -i &quot;dbUtil\|db&quot; &#123;&#125; \; | grep -v &quot;DBType&quot;</span><br><span class="line">    echo &#x27;------------- match end -------------&#x27;</span><br><span class="line">done &lt;&quot;$file&quot;</span><br></pre></td></tr></table></figure>

<p>PS: 由于技术手段的缺失，很多函数我都不清楚怎么调用，对 shell 还是很不熟悉，需要更多的实践练习</p>
<h2 id="ZSH-history-实现机制"><a href="#ZSH-history-实现机制" class="headerlink" title="ZSH history 实现机制"></a>ZSH history 实现机制</h2><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul>
<li>shell 文件里面写 <code>echo -n &#39;,&#39;</code> 会把 <code>-n</code> 也写进去？</li>
<li>因为每次执行都会扫一遍 repo，所以想能不能建立一个 name-context map 到内存然后扫描</li>
<li>以上面的 idea 为基础，能不能实时监测 shell 运行时的内存消耗</li>
<li>read/write to file in shell</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/11/Quick-start-cucumber/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/11/Quick-start-cucumber/" class="post-title-link" itemprop="url">Cucumber 弹射起步</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-11 15:39:11" itemprop="dateCreated datePublished" datetime="2021-05-11T15:39:11+08:00">2021-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/%E5%BC%B9%E5%B0%84%E8%B5%B7%E6%AD%A5/" itemprop="url" rel="index">
                    <span itemprop="name">弹射起步</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Scenario-Outline"><a href="#Scenario-Outline" class="headerlink" title="Scenario Outline"></a>Scenario Outline</h2><p>通过这个关键字，我们可以进行一组数据的测试，共能上类似于 TestNG 的 dataProvider</p>
<p>Scenario Outline 需要和 Examples 搭配使用，写了前者，IDEA 会给提示的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Feature: user creation related tests</span><br><span class="line"></span><br><span class="line">  Scenario Outline: Negative scenario, create user should be fail if field miss in body</span><br><span class="line">    When call REST API to create user and field miss &lt;fieldName&gt; in body</span><br><span class="line">    Then user should create failure, err msg contains &lt;fieldInMsg&gt; show in response</span><br><span class="line">    Examples:</span><br><span class="line">      | fieldName           | fieldInMsg           |</span><br><span class="line">      | provisionerId       | Provisioner ID       |</span><br><span class="line">      | provisionerName     | Provisioner name     |</span><br><span class="line">      | provisionerPassword | Provisioner password |</span><br><span class="line">      | provisionerEmail    | Provisioner email    |</span><br></pre></td></tr></table></figure>

<p>对应的 Java 代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateUserImpl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@When(&quot;call REST API to create user and field miss &#123;&#125; in body&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callRESTAPIToCreateProvisionerAndFieldMissFieldNameInBody</span><span class="params">(String fieldName)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;fileName: &quot;</span> + fieldName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Then(&quot;user should create failure, err msg contains &#123;&#125; show in response&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">provisionerShouldCreateFailureErrMsgContainsFieldInMsgShowInResponse</span><span class="params">(String fieldInMsg)</span> </span>&#123;</span><br><span class="line">        String errMsg = fieldInMsg + <span class="string">&quot;can not be null.&quot;</span>;</span><br><span class="line">        System.out.println(errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个 scenario 会运行 4 遍，每一行测试一次</p>
<h2 id="DataTable"><a href="#DataTable" class="headerlink" title="DataTable"></a>DataTable</h2><p>和上面的概念很类似的还有一个叫 DataTable 的概念，他的作用是在一个 Step 中创建多组数据</p>
<p>格式上的区别：DataTable 是不需要 table header 的， 而且不需要 Examples 关键字，在 annotation 里面也不需要占位符</p>
<figure class="highlight feature"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Scenario</span>: Show my fruits</span><br><span class="line">    <span class="keyword">When</span> I have kinds of fruits</span><br><span class="line">        |<span class="string"> Apple     </span>|</span><br><span class="line">        |<span class="string"> Banana    </span>|</span><br><span class="line">    <span class="keyword">Then</span> show them</span><br></pre></td></tr></table></figure>

<p>java 实现代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@When(&quot;I have kinds of fruits&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">iHaveKindsOfFruits</span><span class="params">(DataTable dataTable)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = dataTable.asList();</span><br><span class="line">    System.out.println(Arrays.toString(list.toArray()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Then(&quot;show them&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showThem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/11/What-is-POSIX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/11/What-is-POSIX/" class="post-title-link" itemprop="url">What is POSIX</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-11 11:34:46" itemprop="dateCreated datePublished" datetime="2021-05-11T11:34:46+08:00">2021-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/What/" itemprop="url" rel="index">
                    <span itemprop="name">What</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>498</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>从知乎上扒来的通俗解释，我觉得很形象</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POSIX是Unix的标准。当年最早的Unix，源代码流传出去了，加上早期的Unix不够完善，于是之后出现了好些独立开发的与Unix基本兼容但又不完全兼容的OS，通称Unix-like OS。局面非常混乱，为了提高兼容性和应用程序的可移植性，标准化Unix-like OS，提出了大家都应该遵守的POSIX标准。后来，Unix这个名字成为了商标，只有花钱进行POSIX标准兼容性测试并通过了的OS，才能称为Unix，其余的OS，最多称为Unix-like OS或者*nix OS。Windows从WinNT开始就有兼容POSIX的考虑。这是因为当年在要求严格的领域，Unix地位比Windows高。为了把Unix用户拉到Windows阵营，搞的。现在情况当然有变化，与当年大不相同了。现在最新的Win10对 Linux/POSIX 支持好，则是因为Linux已经统治了廉价服务器市场。为了提高Windows的竞争力搞的。</span><br><span class="line"></span><br><span class="line">作者：匿名用户</span><br><span class="line">链接：https://www.zhihu.com/question/21048638/answer/148137115</span><br><span class="line">来源：知乎</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/11/Regex-test-in-terminal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2021/05/11/Regex-test-in-terminal/" class="post-title-link" itemprop="url">Regex test in terminal</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-11 11:03:55" itemprop="dateCreated datePublished" datetime="2021-05-11T11:03:55+08:00">2021-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-16 18:29:28" itemprop="dateModified" datetime="2022-08-16T18:29:28+08:00">2022-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/regex/" itemprop="url" rel="index">
                    <span itemprop="name">regex</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>终端如何测试一个正则表达式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;aaabbbccc&#x27;</span> | grep -E bc       <span class="comment"># bc 会被标红</span></span><br><span class="line"><span class="comment"># aaabbbccc</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;aaabbbccc&#x27;</span> | grep -E -o bc    <span class="comment"># 只输出匹配的字段</span></span><br><span class="line"><span class="comment"># bc</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;a1b a2b acb&#x27;</span> | grep -E -o <span class="string">&#x27;a[^0-9]b&#x27;</span>      <span class="comment"># 当方括号中有 ^ 时，表示除外的意思</span></span><br><span class="line"><span class="comment"># acb</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;a1b a2b acb&#x27;</span> | grep -G <span class="string">&#x27;a\w+&#x27;</span>     <span class="comment"># 使用 basic regex 匹配的时候没有适配的结果</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;a1b a2b acb&#x27;</span> | grep -G <span class="string">&#x27;a\w\+&#x27;</span>    <span class="comment"># 需要在 &#x27;+&#x27; 的前面也添加转义符才能生效</span></span><br></pre></td></tr></table></figure>

<h2 id="BRE-ERE"><a href="#BRE-ERE" class="headerlink" title="BRE ERE"></a>BRE ERE</h2><p><code>man grep</code> 可以看到它支持的一些可选正则模式, 这几种模式有什么区别？</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-E, --extended-regexp     PATTERN is an extended regular expression (ERE)</span><br><span class="line">-G, --basic-regexp        PATTERN is a basic regular expression (BRE)</span><br><span class="line">-P, --perl-regexp         PATTERN is a Perl regular expression</span><br><span class="line">-e, --regexp=PATTERN      use PATTERN for matching</span><br></pre></td></tr></table></figure>

<blockquote>
<p>In GNU sed, the only difference between basic and extended regular expressions is in the behavior of a few special characters: ‘?’, ‘+’, parentheses(‘()’), braces(‘{}’), and ‘|’.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Type</th>
<th align="center">Desc</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BRE</td>
<td align="center">character like () {} + ? | need use escape character</td>
</tr>
<tr>
<td align="center">ERE</td>
<td align="center">no need to use escape caharcter before + ? ( ) { } |</td>
</tr>
<tr>
<td align="center">PRE</td>
<td align="center">same as ERE, and add other func</td>
</tr>
</tbody></table>
<p>BRE、ERE可以使用 POSIX 字符集来操作</p>
<p>使用支持<br>grep<br>支持BRE,通过参数控制,默认BRE, -P开启PRE, -E开启ERE</p>
<p>sed<br>支持BRE,默认BRE,-r开启ERE</p>
<p>awk<br>支持ERE,默认ERE。</p>
<h2 id="其他一些知识点"><a href="#其他一些知识点" class="headerlink" title="其他一些知识点"></a>其他一些知识点</h2><p>元字符(Metacharacter), 指SHELL直译器或正则表达式（regex）引擎等计算机程序中具有特殊意义的字符。</p>
<p>在 POSIX 扩展正则表达式里,定义了14个元字符,它们被作为一般的字符使用时,必须要通过 “转义”（前面加一个反斜杠”&quot;）来去除他们本身的特殊意义,这些元字符包括：</p>
<p>开和闭方括号：”[“和”]”<br>反斜线：”&quot;<br>脱字符：”^”<br>美元符号：”$”<br>句号/点：”.”<br>竖线/管道符：”|”<br>问号：”?”<br>星号：”*”<br>加号：”+”<br>开和闭 花括号：”{“和”}”<br>开和闭 小括号：”(“和”)”</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hexo/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/hexo/">1</a><span class="space">&hellip;</span><a class="page-number" href="/hexo/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/hexo/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/hexo/page/23/">23</a><a class="extend next" rel="next" href="/hexo/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jack Zheng"
      src="/hexo/images/jack.jpg">
  <p class="site-author-name" itemprop="name">Jack Zheng</p>
  <div class="site-description" itemprop="description">我是张江搬砖小码农, 知识搬运工</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hexo/archives/">
        
          <span class="site-state-item-count">225</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hexo/categories/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/hexo/tags/">
          
        <span class="site-state-item-count">203</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Zheng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">1.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">16:52</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v5.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/hexo/lib/anime.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.ui.min.js"></script>

<script src="/hexo/js/utils.js"></script>

<script src="/hexo/js/motion.js"></script>


<script src="/hexo/js/schemes/muse.js"></script>


<script src="/hexo/js/next-boot.js"></script>




  




  
<script src="/hexo/js/local-search.js"></script>














  

  


</body>
</html>
