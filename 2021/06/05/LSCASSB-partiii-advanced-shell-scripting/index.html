<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/hexo/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hexo/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hexo/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/hexo/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="UgODgWVmvTsdD--vjodDR3tPUZRWM3i7JpHzbYejxUM">

<link rel="stylesheet" href="/hexo/css/main.css">


<link rel="stylesheet" href="/hexo/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hexo/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Creating FunctionsBasic Script FunctionsCreating a function方式一： 123function name &amp;#123;    commands&amp;#125;  方式二： 123name() &amp;#123;    commands&amp;#125;  Using functionsfunction 不一定要写在开头，但是你使用之前，他的定义必须已经声明了">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux命令行与shell脚本编程大全 第三章 Shell 高级用法">
<meta property="og:url" content="https://jack-zheng.github.io/hexo/2021/06/05/LSCASSB-partiii-advanced-shell-scripting/index.html">
<meta property="og:site_name" content="Jackpot">
<meta property="og:description" content="Creating FunctionsBasic Script FunctionsCreating a function方式一： 123function name &amp;#123;    commands&amp;#125;  方式二： 123name() &amp;#123;    commands&amp;#125;  Using functionsfunction 不一定要写在开头，但是你使用之前，他的定义必须已经声明了">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-06-05T08:38:52.000Z">
<meta property="article:modified_time" content="2021-10-15T06:46:22.005Z">
<meta property="article:author" content="Jack Zheng">
<meta property="article:tag" content="Linux命令行与shell脚本编程大全 3rd">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jack-zheng.github.io/hexo/2021/06/05/LSCASSB-partiii-advanced-shell-scripting/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Linux命令行与shell脚本编程大全 第三章 Shell 高级用法 | Jackpot</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/hexo/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jackpot</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-tags">

    <a href="/hexo/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/hexo/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hexo/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/jack-zheng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/06/05/LSCASSB-partiii-advanced-shell-scripting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux命令行与shell脚本编程大全 第三章 Shell 高级用法
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-05 16:38:52" itemprop="dateCreated datePublished" datetime="2021-06-05T16:38:52+08:00">2021-06-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-10-15 14:46:22" itemprop="dateModified" datetime="2021-10-15T14:46:22+08:00">2021-10-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Shell</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>64k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>58 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Creating-Functions"><a href="#Creating-Functions" class="headerlink" title="Creating Functions"></a>Creating Functions</h2><h3 id="Basic-Script-Functions"><a href="#Basic-Script-Functions" class="headerlink" title="Basic Script Functions"></a>Basic Script Functions</h3><h4 id="Creating-a-function"><a href="#Creating-a-function" class="headerlink" title="Creating a function"></a>Creating a function</h4><p>方式一：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> name &#123;</span><br><span class="line">    commands</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">name</span></span>() &#123;</span><br><span class="line">    commands</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Using-functions"><a href="#Using-functions" class="headerlink" title="Using functions"></a>Using functions</h4><p>function 不一定要写在开头，但是你使用之前，他的定义必须已经声明了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat test1</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using a function in a script</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;This is an example of a function&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 4 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    func1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the loop&quot;</span></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Now this is the end of the script&quot;</span></span><br><span class="line"></span><br><span class="line">./test1</span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># This is the end of the loop</span></span><br><span class="line"><span class="comment"># This is an example of a function</span></span><br><span class="line"><span class="comment"># Now this is the end of the script</span></span><br></pre></td></tr></table></figure>

<h3 id="Returning-a-Value"><a href="#Returning-a-Value" class="headerlink" title="Returning a Value"></a>Returning a Value</h3><p>bash shell 会在函数结束后给他一个返回值</p>
<h4 id="The-default-exit-status"><a href="#The-default-exit-status" class="headerlink" title="The default exit status"></a>The default exit status</h4><p>默认情况下，exit status 是函数中最后一个命令的返回值，可以使用 <code>$?</code> 查看</p>
<p>下面实验中，我们在 func1 中 ls 一个不存在的文件，并打印 exit code</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">cat test4</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># testing the exit status of a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Trying to display a non-existent file&quot;</span></span><br><span class="line">    ls -l badfile</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;testing the function&quot;</span></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The exit status is: $?&quot;</span></span><br><span class="line"></span><br><span class="line">./test4 </span><br><span class="line"><span class="comment"># testing the function</span></span><br><span class="line"><span class="comment"># Trying to display a non-existent file</span></span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br><span class="line"><span class="comment"># The exit status is: 1</span></span><br><span class="line"></span><br><span class="line">cat test4b</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># testing the exit status of a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    ls -l badfile</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Trying to display a non-existent file&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;testing the function&quot;</span></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The exit status is: $?&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./test4b</span><br><span class="line"><span class="comment"># testing the function</span></span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br><span class="line"><span class="comment"># Trying to display a non-existent file</span></span><br><span class="line"><span class="comment"># The exit status is: 0</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-the-return-command"><a href="#Using-the-return-command" class="headerlink" title="Using the return command"></a>Using the return command</h4><p>你也可以用 return 关键子在函数末尾给他返回一个整数最 exit code</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test5</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using the return command in a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> db1 &#123;</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Enter a value: &quot;</span> value</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;doubling the value&quot;</span></span><br><span class="line">    <span class="built_in">return</span> $[ <span class="variable">$value</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">db1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The new value is $?&quot;</span></span><br><span class="line"></span><br><span class="line">./test5</span><br><span class="line"><span class="comment"># Enter a value: 10</span></span><br><span class="line"><span class="comment"># doubling the value</span></span><br><span class="line"><span class="comment"># The new value is 20</span></span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<ul>
<li>记得在 function 执行完成后立刻取值备用</li>
<li>exit code 返回只能在 0-255 之间</li>
</ul>
<h4 id="Using-function-output"><a href="#Using-function-output" class="headerlink" title="Using function output"></a>Using function output</h4><p>你也可以将返回值包装在输出里面，通过 <code>result=$(db1)</code> 的形式拿到。和之前调用系统函数一个套路</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test5b</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using the return command in a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> db1 &#123;</span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Enter a value: &quot;</span> value</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$value</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=$(db1)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The new value is <span class="variable">$result</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test5b</span><br><span class="line"><span class="comment"># Enter a value: 20</span></span><br><span class="line"><span class="comment"># The new value is 40</span></span><br></pre></td></tr></table></figure>

<p><strong>Caution</strong> 如果函数中有多个 echo 他会将所有的 echo 内容合在一起作为 return 的值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat freturn.sh</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># multiple echo sentence in function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> multiecho &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;return 1&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;return 2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">./freturn.sh</span><br><span class="line"><span class="comment"># return 1</span></span><br><span class="line"><span class="comment"># return 2</span></span><br></pre></td></tr></table></figure>

<p><strong>Question</strong> 如果我把 echo 和 return 结合使用，他会拿什么当返回值？？？</p>
<p>结论：return 会被忽略</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat ./returnwithecho.sh</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># multiple echo sentence and return in function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> multiecho &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;return 1&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;return 2&quot;</span></span><br><span class="line">  <span class="built_in">return</span> 55</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">./freturn.sh</span><br><span class="line"><span class="comment"># return 1</span></span><br><span class="line"><span class="comment"># return 2</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Variables-in-Functions"><a href="#Using-Variables-in-Functions" class="headerlink" title="Using Variables in Functions"></a>Using Variables in Functions</h3><h4 id="Passing-parameters-to-a-function"><a href="#Passing-parameters-to-a-function" class="headerlink" title="Passing parameters to a function"></a>Passing parameters to a function</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cat test6</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># passing parameters to a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> addem &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ] || [ <span class="variable">$#</span> -gt 2 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -1</span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$#</span> -eq 1 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> $[ <span class="variable">$1</span> + <span class="variable">$1</span> ]</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> $[ <span class="variable">$1</span> + <span class="variable">$2</span> ]</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Adding 10 and 15: &quot;</span></span><br><span class="line">value=$(addem 10 15)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$value</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Let&#x27;s try adding just one number: &quot;</span></span><br><span class="line">value=$(addem 10)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$value</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Now trying adding no numbers: &quot;</span></span><br><span class="line">value=$(addem)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$value</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Finally, try adding three numbers: &quot;</span></span><br><span class="line">value=$(addem 10 15 20)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$value</span></span><br><span class="line"></span><br><span class="line">./test6</span><br><span class="line"><span class="comment"># Adding 10 and 15: 25</span></span><br><span class="line"><span class="comment"># Let&#x27;s try adding just one number: 20</span></span><br><span class="line"><span class="comment"># Now trying adding no numbers: -1</span></span><br><span class="line"><span class="comment"># Finally, try adding three numbers: -1</span></span><br></pre></td></tr></table></figure>

<p>但是脚本文件中的参数并不会默认的应用到你定义的 function 中去，你需要显示的指定才能使他生效</p>
<p>下面实验中，当我们运行脚本是没有给参数，则直接运行了 else 的路径，如果给了参数，这个参数也不会传递给 badfunc1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat badtest1</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Trying to access script parameters inside a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> badfunc1 &#123;</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 2 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    value=$(badfunc1)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$value</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: badtest1 a b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">./badtest1</span><br><span class="line"><span class="comment"># Usage: badtest1 a b</span></span><br><span class="line">./badtest1 10 15</span><br><span class="line"><span class="comment"># ./badtest1: line 5: *  : syntax error: operand expected (error token is &quot;*  &quot;)</span></span><br><span class="line"><span class="comment"># The result is</span></span><br></pre></td></tr></table></figure>

<p>如果要修复上面的脚本，你可以直接在实现中指定 <code>value=$(badfunc1 $1 $2)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat test7</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Trying to access script parameters inside a function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func7 &#123;</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 2 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    value=$(func7 <span class="variable">$1</span> <span class="variable">$2</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$value</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: badtest1 a b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">./test7</span><br><span class="line"><span class="comment"># Usage: badtest1 a b</span></span><br><span class="line">./test7 10 15</span><br><span class="line"><span class="comment"># The result is 150</span></span><br></pre></td></tr></table></figure>

<h4 id="Handling-variables-in-a-function"><a href="#Handling-variables-in-a-function" class="headerlink" title="Handling variables in a function"></a>Handling variables in a function</h4><p>Functions 使用两种类型的变量</p>
<ul>
<li>Global</li>
<li>Local</li>
</ul>
<p>Global 变量是在 script 中任何地方都可以访问的变量。在主程序中定义的 global 变量，function 中可以访问到。function 中定义的 global 变量，主程序也能访问到。一般来说你在脚本中定义的变量都是 global 的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test8</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using a global variable to pass a value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> db1 &#123;</span><br><span class="line">    value=$[ <span class="variable">$value</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter a value: &quot;</span> value</span><br><span class="line">db1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The new value is: <span class="variable">$value</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test8</span><br><span class="line"><span class="comment"># Enter a value: 10</span></span><br><span class="line"><span class="comment"># The new value is: 20</span></span><br></pre></td></tr></table></figure>

<p>如果你在 script 和 function 中都用到了同名的变量，就可能导致赋值出问题，是你的程序难以排错</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat badtest2</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Demonstrating a db use of variables</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    temp=$[ <span class="variable">$value</span> + 5 ]</span><br><span class="line">    result=$[ <span class="variable">$temp</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">temp=4</span><br><span class="line">value=6</span><br><span class="line"></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$result</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$temp</span> -gt <span class="variable">$value</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;temp is larger&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;temp is smaller&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">./badtest2</span><br><span class="line"><span class="comment"># The result is 22</span></span><br><span class="line"><span class="comment"># temp is larger</span></span><br></pre></td></tr></table></figure>

<p>我们可以使用 local variables 避免这种问题，格式如下 <code>local temp</code>. 他让你的变量只在 function 中生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat test9</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Demonstrating the local keyword</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> func1 &#123;</span><br><span class="line">    <span class="built_in">local</span> temp=$[ <span class="variable">$value</span> + 5 ]</span><br><span class="line">    result=$[ <span class="variable">$temp</span> * 2 ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">temp=4</span><br><span class="line">value=6</span><br><span class="line"></span><br><span class="line">func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$result</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$temp</span> -gt <span class="variable">$value</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;temp is larger&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;temp is smaller&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./test9</span><br><span class="line"><span class="comment"># The result is 22</span></span><br><span class="line"><span class="comment"># temp is smaller</span></span><br></pre></td></tr></table></figure>

<h3 id="Array-Variables-and-Functions"><a href="#Array-Variables-and-Functions" class="headerlink" title="Array Variables and Functions"></a>Array Variables and Functions</h3><h4 id="Passing-arrays-to-functions"><a href="#Passing-arrays-to-functions" class="headerlink" title="Passing arrays to functions"></a>Passing arrays to functions</h4><p>函数处理数组的方式有点特别，如果你传给函数一个数组，他默认只会取第一个元素作为参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat badtest3</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Trying to pass an array variable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> testit &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The parameters are: <span class="variable">$@</span>&quot;</span></span><br><span class="line">    thisarray=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The received array is <span class="variable">$&#123;thisarray[*]&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myarray=(1 2 3 4 5)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The original array is: <span class="variable">$&#123;myarray[*]&#125;</span>&quot;</span></span><br><span class="line">testit  <span class="variable">$myarray</span></span><br><span class="line"></span><br><span class="line">./badtest3</span><br><span class="line"><span class="comment"># The original array is: 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># The parameters are: 1</span></span><br><span class="line"><span class="comment"># The received array is 1</span></span><br></pre></td></tr></table></figure>

<p>你可以将数组 disassemble 之后传给函数，在使用时在 reassemble 即可. 书上给的例子不能运行，网上找了一个可用的表达式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test10</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># array variable to function test</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> testit &#123;</span><br><span class="line">    <span class="built_in">local</span> newarray</span><br><span class="line">    <span class="comment"># 原始表达式为 newarray=(;&#x27;echo &quot;$@&quot;&#x27;)</span></span><br><span class="line">    newarray=($(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>))</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The new array value is <span class="variable">$&#123;newarray[*]&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myarray=(1 2 3 4 5)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The original array is: <span class="variable">$&#123;myarray[*]&#125;</span>&quot;</span></span><br><span class="line">testit  <span class="variable">$&#123;myarray[*]&#125;</span></span><br><span class="line"></span><br><span class="line">./test10</span><br><span class="line"><span class="comment"># The original array is: 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># The new array value is 1 2 3 4 5</span></span><br></pre></td></tr></table></figure>

<h4 id="Return-arrays-from-functions"><a href="#Return-arrays-from-functions" class="headerlink" title="Return arrays from functions"></a>Return arrays from functions</h4><p>函数返回一个数组用了同样的技巧，函数中一个一个的 echo 值，接收方需要 reassemble 它们</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat test12</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># returning an array value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> arraydblr &#123;</span><br><span class="line">    <span class="built_in">local</span> origarray</span><br><span class="line">    <span class="built_in">local</span> newarray</span><br><span class="line">    <span class="built_in">local</span> elements</span><br><span class="line">    <span class="built_in">local</span> i</span><br><span class="line">    origarray=($(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>))</span><br><span class="line">    newarray=($(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>))</span><br><span class="line">    elements=$[ <span class="variable">$#</span> - 1 ]</span><br><span class="line">    <span class="keyword">for</span> (( i=0; i&lt;= <span class="variable">$elements</span>; i++ ))</span><br><span class="line">    &#123;</span><br><span class="line">        newarray[<span class="variable">$i</span>]=$[ <span class="variable">$&#123;origarray[$i]&#125;</span> * 2 ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;newarray[*]&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myarray=(1 2 3 4 5)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The original array is: <span class="variable">$&#123;myarray[*]&#125;</span>&quot;</span></span><br><span class="line">arg1=$(<span class="built_in">echo</span> <span class="variable">$&#123;myarray[*]&#125;</span>)</span><br><span class="line">result=($(arraydblr <span class="variable">$arg1</span>))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The new array is: <span class="variable">$&#123;result[*]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test12</span><br><span class="line"><span class="comment"># The original array is: 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># The new array is: 2 4 6 8 10</span></span><br></pre></td></tr></table></figure>

<h3 id="Function-Recursion"><a href="#Function-Recursion" class="headerlink" title="Function Recursion"></a>Function Recursion</h3><p>local function variable 提供 self-containment 功能。他使得函数可以实现 recursively 的效果</p>
<p>实现斐波那契数列</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat test13</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using recursion</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> factorial &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> -eq 1 ]</span><br><span class="line">    <span class="keyword">then</span> </span><br><span class="line">        <span class="built_in">echo</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">local</span> temp=$[ <span class="variable">$1</span> - 1 ]</span><br><span class="line">        <span class="built_in">local</span> result=$(factorial <span class="variable">$temp</span>)</span><br><span class="line">        <span class="built_in">echo</span> $[ <span class="variable">$result</span> * <span class="variable">$1</span> ]</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter value: &quot;</span> value</span><br><span class="line">result=$(factorial <span class="variable">$value</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The factorial of <span class="variable">$value</span> is: <span class="variable">$result</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test13</span><br><span class="line"><span class="comment"># Enter value: 5</span></span><br><span class="line"><span class="comment"># The factorial of 5 is: 120</span></span><br></pre></td></tr></table></figure>

<h3 id="Creating-a-Library"><a href="#Creating-a-Library" class="headerlink" title="Creating a Library"></a>Creating a Library</h3><p>建立自己的函数库，实现脚本文件中的可复用。简单来说，就是将所有的函数都写在文件中。在其他脚本文件中，通过 <code>. path/to/myfuncs</code> 的语法引入自己的库文件即可。这个点号是 <code>source</code> 的快捷方式叫做 dot operator.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cat myfuncs </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># my script functions</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> addem &#123;</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$1</span> + <span class="variable">$2</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> multem &#123;</span><br><span class="line">    <span class="built_in">echo</span> $[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> divem &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$2</span> -ne 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> $[ <span class="variable">$1</span> / <span class="variable">$2</span> ]</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cat test14</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># using functions defined in a library file</span></span><br><span class="line">. ./myfuncs</span><br><span class="line"></span><br><span class="line">value1=10</span><br><span class="line">value2=5</span><br><span class="line">result1=$(addem <span class="variable">$value1</span> <span class="variable">$value2</span>)</span><br><span class="line">result2=$(multem <span class="variable">$value1</span> <span class="variable">$value2</span>)</span><br><span class="line">result3=$(divem <span class="variable">$value1</span> <span class="variable">$value2</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result of adding them is: <span class="variable">$result1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result of multiplying them is: <span class="variable">$result2</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result of dividing them is: <span class="variable">$result3</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test14</span><br><span class="line"><span class="comment"># The result of adding them is: 15</span></span><br><span class="line"><span class="comment"># The result of multiplying them is: 50</span></span><br><span class="line"><span class="comment"># The result of dividing them is: 2</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Functions-on-the-Command-Line"><a href="#Using-Functions-on-the-Command-Line" class="headerlink" title="Using Functions on the Command Line"></a>Using Functions on the Command Line</h3><h4 id="Creating-functions-on-the-command-line"><a href="#Creating-functions-on-the-command-line" class="headerlink" title="Creating functions on the command line"></a>Creating functions on the command line</h4><p>方式一：终端一行定义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> doubleit &#123; <span class="built_in">read</span> -p <span class="string">&quot;Enter value:&quot;</span> value; <span class="built_in">echo</span> $[ <span class="variable">$value</span> * 2 ]; &#125;</span><br><span class="line">doubleit</span><br><span class="line"><span class="comment"># Enter value:3</span></span><br><span class="line">6</span><br></pre></td></tr></table></figure>

<p>方式二：多行定义，in this way, no need of semicolon</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> multem &#123;</span><br><span class="line">&gt; <span class="built_in">echo</span> $[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line">&gt; &#125;</span><br><span class="line">multem 2 5</span><br><span class="line"><span class="comment"># 10</span></span><br></pre></td></tr></table></figure>

<p><strong>Caution</strong> 如果你终端定义函数的时候和系统自带的函数重名了，那么这个函数会覆盖系统函数。</p>
<h4 id="Defining-functions-in-the-bashrc-file"><a href="#Defining-functions-in-the-bashrc-file" class="headerlink" title="Defining functions in the .bashrc file"></a>Defining functions in the .bashrc file</h4><p>上面的这个方式，当终端退出时，函数就丢失了，你可以将函数写入 .bashrc 文件或使用 source 函数库的方式达到复用的效果。而且最方便的事，如果你将他们通过 bashrc 引入，你在写脚本的时候就不需要 source 了，直接可以调用</p>
<h3 id="Following-a-Practical-Example"><a href="#Following-a-Practical-Example" class="headerlink" title="Following a Practical Example"></a>Following a Practical Example</h3><p>这章展示如何使用开源 shell 工具包</p>
<ol>
<li><code>wget ftp://ftp.gnu.org/gnu/shtool/shtool-2.0.8.tar.gz</code> 下载实验包并 <code>tar -zxvf shtool-2.0.8.tar.gz</code> 解压</li>
<li>cd 到解压后的文件夹，<code>./configure</code> + <code>make</code>, 当然你也可以用 <code>make test</code> 测试一下构建</li>
<li><code>make install</code> 安装库文件</li>
</ol>
<p>shtool 包含了一系列的工具集，可以使用 <code>shtool [options] [fucntion [options] [args]]</code> 来查看</p>
<p>The shtool Library Functions</p>
<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">platform</td>
<td align="left">Displays the platform identity</td>
</tr>
<tr>
<td align="left">Prop</td>
<td align="left">Dispalys an animated progress propeller</td>
</tr>
</tbody></table>
<p>只列出用到的几个</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat test16</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"></span><br><span class="line">shtool platform</span><br><span class="line"></span><br><span class="line">./test16</span><br><span class="line"><span class="comment"># Mac OS X 11.4 (iX86)</span></span><br></pre></td></tr></table></figure>

<p>带进度条的显示 <code>ls -al /usr/bin | shtool prop -p &quot;waiting...&quot;</code> 太快了，看不出效果</p>
<h2 id="Chapter-18-Writing-Scripts-for-Graphical-Desktops"><a href="#Chapter-18-Writing-Scripts-for-Graphical-Desktops" class="headerlink" title="Chapter 18: Writing Scripts for Graphical Desktops"></a>Chapter 18: Writing Scripts for Graphical Desktops</h2><p>和我这次看书的目标不符，跳过</p>
<h2 id="Chapter-19-Introducing-sed-and-gawk"><a href="#Chapter-19-Introducing-sed-and-gawk" class="headerlink" title="Chapter 19: Introducing sed and gawk"></a>Chapter 19: Introducing sed and gawk</h2><p>实际工作中，很多工作都是文字处理相关的。使用 shell 自带工具处理文字会显得很笨拙。这时候就要用到 sed 和 gawk 了。</p>
<h3 id="Manipulating-Text"><a href="#Manipulating-Text" class="headerlink" title="Manipulating Text"></a>Manipulating Text</h3><p>Mac 自带的 sed 工具和书上的是不一样的，好像做了很多裁剪，很多 flag 是不支持的，可以通过 brew 重新装一个</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">brew install gnu-sed</span><br><span class="line"><span class="comment"># 会给出添加 PATH 的提示，按照提示添加到配置文件中(.zshrc)</span></span><br><span class="line">brew info gnu-sed</span><br><span class="line"><span class="comment"># ==&gt; Caveats</span></span><br><span class="line"><span class="comment"># GNU &quot;sed&quot; has been installed as &quot;gsed&quot;.</span></span><br><span class="line"><span class="comment"># If you need to use it as &quot;sed&quot;, you can add a &quot;gnubin&quot; directory</span></span><br><span class="line"><span class="comment"># to your PATH from your bashrc like:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     PATH=&quot;/usr/local/opt/gnu-sed/libexec/gnubin:$PATH&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="Getting-to-know-the-sed-editor"><a href="#Getting-to-know-the-sed-editor" class="headerlink" title="Getting to know the sed editor"></a>Getting to know the sed editor</h4><p>sed 是一个流处理编辑器(stream editor)，你可以设定一系列的规则，然后通过这个流编辑器处理他。</p>
<p>sed 可以做如下事情</p>
<ol>
<li>Reads one data line at a time from the input</li>
<li>Matches that data with the supplied editor commands</li>
<li>Changes data in the stream as specified in the commands</li>
<li>Outputs the new data to STDOUT</li>
</ol>
<p>按行依次处理文件直到所有内容处理完毕结束，格式 <code>sed options script file</code></p>
<p>The sed Command Options</p>
<table>
<thead>
<tr>
<th align="left">Option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-e script</td>
<td align="left">Adds commands specified in the script to the commands run while processing the input</td>
</tr>
<tr>
<td align="left">-f file</td>
<td align="left">Adds the commands specified in the file to the commands run while processing the input</td>
</tr>
<tr>
<td align="left">-n</td>
<td align="left">Doesn’t produce output for each command, but waits for the print command</td>
</tr>
</tbody></table>
<h4 id="Defining-an-editor-command-int-the-command-line"><a href="#Defining-an-editor-command-int-the-command-line" class="headerlink" title="Defining an editor command int the command line"></a>Defining an editor command int the command line</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test&quot;</span> | sed <span class="string">&#x27;s/test/big test/&#x27;</span></span><br><span class="line"><span class="comment"># This is a big test</span></span><br></pre></td></tr></table></figure>

<p><code>s</code> 表示替换(substitutes), 他会用后一个字符串替换前一个. 下面是替换文件内容的例子. sed 只会在输出内容中做修改，原文件还是保持原样</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line">sed <span class="string">&#x27;s/dog/cat/&#x27;</span> data1.txt </span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-mulitple-editor-commands-int-the-command-line"><a href="#Using-mulitple-editor-commands-int-the-command-line" class="headerlink" title="Using mulitple editor commands int the command line"></a>Using mulitple editor commands int the command line</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/brown/green/; s/dog/cat/&#x27;</span> data1.txt </span><br><span class="line"><span class="comment"># The quick green fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green fox jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<p>如果不想写在一行，可以写在多行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&gt; s/brown/green/</span></span><br><span class="line"><span class="string">&gt; s/fox/elephant/</span></span><br><span class="line"><span class="string">&gt; s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<h4 id="Reading-editor-commands-from-a-file"><a href="#Reading-editor-commands-from-a-file" class="headerlink" title="Reading editor commands from a file"></a>Reading editor commands from a file</h4><p>如果命令太多，也可以将他们放到文件中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat script1.sed </span><br><span class="line"><span class="comment"># s/brown/green/</span></span><br><span class="line"><span class="comment"># s/fox/elephant/</span></span><br><span class="line"><span class="comment"># s/dog/cat/</span></span><br><span class="line">sed -f script1.sed data1.txt </span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick green elephant jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<p>为了便于区分 shell 文件和 sed 条件，我们将 sed 条件文件存储为 <code>.sed</code> 结尾</p>
<h4 id="Getting-to-know-the-gawk-program"><a href="#Getting-to-know-the-gawk-program" class="headerlink" title="Getting to know the gawk program"></a>Getting to know the gawk program</h4><p>sed 让你动态改变文件内容，但是还是有局限性。gawk 提供一个更程序化的方式来处理文本信息. 这个工具包默认是没有的一般需要自己手动安装。gawk 是 GNU 版本的 awk, 通过它你可以</p>
<ul>
<li>Define variables to store data</li>
<li>Use arithmetic and string operatiors to perate on data</li>
<li>Use structured programming concepts, such as if-then statements and loops, to add logic to your data processing</li>
<li>Generate formatted reports by extracting data elements within the data file and repositioning them in another order or format</li>
</ul>
<p>第四点经常用来批量处理数据使之更具可读性，典型应用就是处理 log 文件。</p>
<h4 id="Visiting-the-gawk-command-format"><a href="#Visiting-the-gawk-command-format" class="headerlink" title="Visiting the gawk command format"></a>Visiting the gawk command format</h4><p>格式 <code>gawk options program file</code></p>
<p>The gawk Options</p>
<table>
<thead>
<tr>
<th align="left">Option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-F fs</td>
<td align="left">Specifies a file separator for delineating data fields in a line</td>
</tr>
<tr>
<td align="left">-f file</td>
<td align="left">Specifies a file name to read the program from</td>
</tr>
<tr>
<td align="left">-v var=value</td>
<td align="left">Defines a variable and default value used in the gawk program</td>
</tr>
<tr>
<td align="left">-mf N</td>
<td align="left">Specifies the maximum number of fields to process in the data file</td>
</tr>
<tr>
<td align="left">-mr N</td>
<td align="left">Specifies the maximum record size in the data file</td>
</tr>
<tr>
<td align="left">-W keyword</td>
<td align="left">Specifies the compatibility mode or warning level of gawk</td>
</tr>
</tbody></table>
<p>gawk 最大的优势是可以用编程的手段，将数据重新格式化输出</p>
<h4 id="Reading-the-program-script-from-the-command-line"><a href="#Reading-the-program-script-from-the-command-line" class="headerlink" title="Reading the program script from the command line"></a>Reading the program script from the command line</h4><p>格式 <code>gawk &#39;&#123; commands &#125;&#39;</code> 比如 <code>gawk &#39;&#123;print &quot;Hello World!&quot;&#125;&#39;</code> 这个 demo 命令并没有做什么文字处理，只是简单的接收标准输入然后打印 Hello World. 使用 Ctrl + D 结束对话</p>
<p>gawk 最主要的功能是提供操作文本中数据的功能，默认情况下，gawk 会提取如下变量</p>
<ul>
<li>$0 represents the entire line of text</li>
<li>$1 represents the first data field in the line of text</li>
<li>$2 represents the second data field in the line of text</li>
<li>$n represents the nth data field in the line of text</li>
</ul>
<p>gawk 会根据命令中提供的分割符做行的分割，下面是 gawk 读取文件并显示第一行的示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt </span><br><span class="line"><span class="comment"># One line of test text.</span></span><br><span class="line"><span class="comment"># Two lines of test text.</span></span><br><span class="line"><span class="comment"># Three lines of test text.</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;&#123; print $1 &#125;&#x27;</span> data2.txt </span><br><span class="line"><span class="comment"># One</span></span><br><span class="line"><span class="comment"># Two</span></span><br><span class="line"><span class="comment"># Three</span></span><br></pre></td></tr></table></figure>

<p>可以用 <code>-F</code> 指定分割符，比如你要处理 /etc/passwd 这个文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd | tail -3</span><br><span class="line"><span class="comment"># _coreml:*:280:280:CoreML Services:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _trustd:*:282:282:trustd:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false</span></span><br><span class="line"></span><br><span class="line">gawk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> /etc/passwd | tail -3 </span><br><span class="line"><span class="comment"># _coreml</span></span><br><span class="line"><span class="comment"># _trustd</span></span><br><span class="line"><span class="comment"># _oahd</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-multiple-commands-in-the-program-script"><a href="#Using-multiple-commands-in-the-program-script" class="headerlink" title="Using multiple commands in the program script"></a>Using multiple commands in the program script</h4><p>使用分号分割 gawk 中想要运行的多个命令, 下面的命令会替换第四个 field 并打印整行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;My name is Rich&quot;</span> | gawk <span class="string">&#x27;&#123;$4=&quot;Christine&quot;;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># My name is Christine</span></span><br></pre></td></tr></table></figure>

<p>多行表示也是 OK 的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; $4=&quot;Christine&quot;</span></span><br><span class="line"><span class="string">&gt; print $0</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line">my name is Rich</span><br><span class="line">my name is Christine</span><br></pre></td></tr></table></figure>

<h4 id="Reading-the-program-from-a-file"><a href="#Reading-the-program-from-a-file" class="headerlink" title="Reading the program from a file"></a>Reading the program from a file</h4><p>和 sed 一样，gawk 也支持从文件读取命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat script2.gawk </span><br><span class="line"><span class="comment"># &#123;print $1 &quot;&#x27;s hoe directory is &quot; $6&#125;</span></span><br><span class="line">gawk -F: -f script2.gawk /etc/passwd | tail -3</span><br><span class="line"><span class="comment"># _coreml&#x27;s hoe directory is /var/empty</span></span><br><span class="line"><span class="comment"># _trustd&#x27;s hoe directory is /var/empty</span></span><br><span class="line"><span class="comment"># _oahd&#x27;s hoe directory is /var/empty</span></span><br></pre></td></tr></table></figure>

<p>gawk 文件中包含多个命令的示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat script3.gawk </span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     text = &quot;&#x27;s home directory is &quot;</span></span><br><span class="line"><span class="comment">#     print $1 text $6</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">gawk -F: -f script3.gawk /etc/passwd | tail -3</span><br><span class="line"><span class="comment"># _coreml&#x27;s home directory is /var/empty</span></span><br><span class="line"><span class="comment"># _trustd&#x27;s home directory is /var/empty</span></span><br><span class="line"><span class="comment"># _oahd&#x27;s home directory is /var/empty</span></span><br></pre></td></tr></table></figure>

<h4 id="Running-scripts-before-processing-data"><a href="#Running-scripts-before-processing-data" class="headerlink" title="Running scripts before processing data"></a>Running scripts before processing data</h4><p>gawk 提供了 BEGIN 关键字在处理文本前做一些操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN &#123;print &quot;Hello World!&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Hello World!</span></span><br></pre></td></tr></table></figure>

<p>BEGIN 处理文本的示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data3.txt </span><br><span class="line"><span class="comment"># Line 1</span></span><br><span class="line"><span class="comment"># Line 2</span></span><br><span class="line"><span class="comment"># Line 3</span></span><br><span class="line">gawk <span class="string">&#x27;BEGIN &#123;print &quot;The data3 File Contents: &quot;&#125;</span></span><br><span class="line"><span class="string">&gt; &#123;print $0&#125;&#x27;</span> data3.txt</span><br><span class="line">The data3 File Contents: </span><br><span class="line"><span class="comment"># Line 1</span></span><br><span class="line"><span class="comment"># Line 2</span></span><br><span class="line"><span class="comment"># Line 3</span></span><br></pre></td></tr></table></figure>

<h4 id="Running-scripts-after-processing-data"><a href="#Running-scripts-after-processing-data" class="headerlink" title="Running scripts after processing data"></a>Running scripts after processing data</h4><p>和前面对应的还有一个 after 操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN &#123;print &quot;The data3 File Contents:&quot;&#125;</span></span><br><span class="line"><span class="string">&#123;print $0&#125;</span></span><br><span class="line"><span class="string">&gt; END &#123;print &quot;End of File&quot;&#125;&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># The data3 File Contents:</span></span><br><span class="line"><span class="comment"># Line 1</span></span><br><span class="line"><span class="comment"># Line 2</span></span><br><span class="line"><span class="comment"># Line 3</span></span><br><span class="line"><span class="comment"># End of File</span></span><br></pre></td></tr></table></figure>

<p>如果过程多了，你还可以将这个步骤写到文件中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">at script4.gawk </span><br><span class="line">BEGIN &#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;The latest list of users and selles&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot; UserID\t Shell&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;-------\t------&quot;</span></span><br><span class="line">    FS=<span class="string">&quot;:&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="variable">$1</span> <span class="string">&quot;    \t &quot;</span> <span class="variable">$7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">END &#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;This concludes the listing&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gawk -f script4.gawk  /etc/passwd</span><br><span class="line"><span class="comment"># The latest list of users and selles</span></span><br><span class="line"><span class="comment">#  UserID  Shell</span></span><br><span class="line"><span class="comment"># ------- ------</span></span><br><span class="line"><span class="comment"># nobody           /usr/bin/false</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># _oahd            /usr/bin/false</span></span><br><span class="line"><span class="comment"># This concludes the listing</span></span><br></pre></td></tr></table></figure>

<h3 id="Commanding-at-the-sed-Editor-Basics"><a href="#Commanding-at-the-sed-Editor-Basics" class="headerlink" title="Commanding at the sed Editor Basics"></a>Commanding at the sed Editor Basics</h3><p>本章简要介绍一下 sed 的常规用法</p>
<h4 id="Introducing-more-substitution-options"><a href="#Introducing-more-substitution-options" class="headerlink" title="Introducing more substitution options"></a>Introducing more substitution options</h4><h5 id="Substituting-flags"><a href="#Substituting-flags" class="headerlink" title="Substituting flags"></a>Substituting flags</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat data4.txt </span><br><span class="line"><span class="comment"># This is a test of the test script.</span></span><br><span class="line"><span class="comment"># This is the second test of the test script.</span></span><br><span class="line">sed <span class="string">&#x27;s/test/trial/&#x27;</span> data4.txt </span><br><span class="line"><span class="comment"># This is a trial of the test script.</span></span><br><span class="line"><span class="comment"># This is the second trial of the test script.</span></span><br></pre></td></tr></table></figure>

<p>默认情况下，sed 只会替换每行中第一个出现的位置，如果想要处理多个位置，需要指定 flags。格式为 <code>s/pattern/replacemnet/flags</code></p>
<p>four types of substitution flags are available:</p>
<ul>
<li>A number, indicating the pattern occurrence for which new text should be substituted</li>
<li>g, indicating that new text should be substituted for all occrurences of the existing text</li>
<li>p, indicating that the contents of the original line should be printed</li>
<li>w file, which means to write the results of the substitution to a file</li>
</ul>
<p>替换指定位置的示例，下面示例中只替换了第二个位置的 test</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/test/trial/2&#x27;</span> data4.txt </span><br><span class="line"><span class="comment"># This is a test of the trial script.</span></span><br><span class="line"><span class="comment"># This is the second test of the trial script.</span></span><br></pre></td></tr></table></figure>

<p>全部替换示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/test/trial/g&#x27;</span> data4.txt </span><br><span class="line">This is a trial of the trial script.</span><br><span class="line">This is the second trial of the trial script.</span><br></pre></td></tr></table></figure>

<p>打印符合匹配条件的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat data5.txt </span><br><span class="line"><span class="comment"># This is a test line.</span></span><br><span class="line"><span class="comment"># This is a different line.</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;s/test/trial/p&#x27;</span> data5.txt</span><br><span class="line"><span class="comment"># This is a trial line.</span></span><br></pre></td></tr></table></figure>

<p><code>-w</code> 指定 sed 结果输出到文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/test/trial/w test.txt&#x27;</span> data5.txt </span><br><span class="line"><span class="comment"># This is a trial line.</span></span><br><span class="line"><span class="comment"># This is a different line.</span></span><br><span class="line">cat test.txt </span><br><span class="line"><span class="comment"># This is a trial line.</span></span><br></pre></td></tr></table></figure>

<h5 id="Replacing-characters"><a href="#Replacing-characters" class="headerlink" title="Replacing characters"></a>Replacing characters</h5><p>Linux 系统中路径符号和 sed 中的符号是重的，也就是说，如果我要用 sed 替换路径的时候就必须用一中很累赘的写法, 比如 <code>sed &#39;s/\/bin\/bash/\/bin\/csh/&#39; /etc/passwd</code></p>
<p>PS: Mac OS 语法和这个不一样</p>
<p>为了避免这么恶心的写法，我们可以用惊叹号(exclamation point) 代替原来的分割符 <code>sed &#39;s!/bin/bash!/bin/csh!&#39; /etc/passwd</code></p>
<h4 id="Using-addresses"><a href="#Using-addresses" class="headerlink" title="Using addresses"></a>Using addresses</h4><p>默认情况下 sed 会处理所有的行，如果你只需要处理特殊的几行，你可以使用 line address. line address 有两种模式</p>
<ul>
<li>A numberic range of lines</li>
<li>A text pattern that filters out a line</li>
</ul>
<p>两种模式的格式都是一样的 <code>[address] command</code> 你可以将多个命令组合到一起</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">address &#123;</span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    command3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Addressing-the-numberic-line"><a href="#Addressing-the-numberic-line" class="headerlink" title="Addressing the numberic line"></a>Addressing the numberic line</h5><p>sed 会将 s 之前的内容当作行来处理, 下面的例子只替换第二行的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br></pre></td></tr></table></figure>

<p>替换多行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2,3s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br></pre></td></tr></table></figure>

<p>从第 n 行还是到结束</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2,$s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<h5 id="Using-text-pattern-filters"><a href="#Using-text-pattern-filters" class="headerlink" title="Using text pattern filters"></a>Using text pattern filters</h5><p>使用 pattern 处理特定的行，格式 <code>/pattern/command</code>, 你需要在 pattern 前面指定一个斜杠作为开始</p>
<p>下面的示例中我们只将 root 的 sh 改为 csh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grep root /etc/passwd</span><br><span class="line"><span class="comment"># root:*:0:0:System Administrator:/var/root:/bin/sh</span></span><br><span class="line"><span class="comment"># daemon:*:1:1:System Services:/var/root:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false</span></span><br><span class="line">sed <span class="string">&#x27;/root/s/sh/csh/&#x27;</span> /etc/passwd | grep root</span><br><span class="line"><span class="comment"># root:*:0:0:System Administrator:/var/root:/bin/csh</span></span><br><span class="line"><span class="comment"># daemon:*:1:1:System Services:/var/root:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false</span></span><br></pre></td></tr></table></figure>

<p>sed 是通过正则表达式来做内容匹配的。</p>
<h5 id="Grouping-commands"><a href="#Grouping-commands" class="headerlink" title="Grouping commands"></a>Grouping commands</h5><p>和 gawk 一样，sed 也可以在一个命令中处理多个匹配</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;2&#123;</span></span><br><span class="line"><span class="string">s/fox/elephant/</span></span><br><span class="line"><span class="string">s/dog/cat/</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;3,$&#123;</span></span><br><span class="line"><span class="string">s/fox/elephant/</span></span><br><span class="line"><span class="string">s/dog/cat/</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown elephant jumps over the lazy cat.</span></span><br><span class="line"><span class="comment"># The quick brown elephant jumps over the lazy cat.</span></span><br></pre></td></tr></table></figure>

<h5 id="Deleting-lines"><a href="#Deleting-lines" class="headerlink" title="Deleting lines"></a>Deleting lines</h5><p><code>d</code> 用来在输出内容中删除某一行, 如果没有指定删选内容，所有输出都会被删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line">sed <span class="string">&#x27;d&#x27;</span> data6.txt </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>指定删除的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;3d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;2,3d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;3,$d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/number 1/d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>PS: 这个删除只作用的输出，原文件保持不变</p>
<p>还有一种比较奇葩的删除方式，给两个匹配，删除会从第一个还是，第二个结束，删除内容包括当前行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;/1/,/3/d&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>这里有一个坑，这种方式是匹配删除，当第一匹配时，删除开始，第二个匹配找到时，删除结束。如果文件中有多个地方能匹配到开始，则可能出现意想不到的情况. 比如在 data7 中，第 5 行也能匹配到 1 这个关键字，但是后面就没有 4 了，则会导致后面的内容都删掉. 如果我指定一个不存在的停止符，则所有内容都不显示了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat data7.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"><span class="comment"># This is line number 1 again.</span></span><br><span class="line"><span class="comment"># This is text you want to keep.</span></span><br><span class="line"><span class="comment"># This is the last line in the file.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/1/,/3/d&#x27;</span> data7.txt </span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/1/,/5/d&#x27;</span> data7.txt</span><br></pre></td></tr></table></figure>

<h5 id="Inserting-and-appending-text"><a href="#Inserting-and-appending-text" class="headerlink" title="Inserting and appending text"></a>Inserting and appending text</h5><p>sed 也允许你插入，续写内容，但是有一些特别的点</p>
<ul>
<li>The insert command(i) adds a new line before the specified line</li>
<li>The append commadn(a) adds a new line after the specified line</li>
</ul>
<p>特别的点在于，你需要新起一行写这些新加的行, 格式为</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;[address]command\</span></span><br><span class="line"><span class="string">new line&#x27;</span></span><br></pre></td></tr></table></figure>

<p>示例如下, 不过 mac 上貌似有语法错误</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;i\Test line 1&#x27;</span></span><br><span class="line"><span class="comment"># Test line 1</span></span><br><span class="line"><span class="comment"># Test Line 2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;a\Test line 1&#x27;</span></span><br><span class="line"><span class="comment"># Test Line 2</span></span><br><span class="line"><span class="comment"># Test line 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;i\</span></span><br><span class="line"><span class="string">&gt; Test Line 1&#x27;</span></span><br><span class="line"><span class="comment"># Test Line 1</span></span><br><span class="line"><span class="comment"># Test Line 2</span></span><br></pre></td></tr></table></figure>

<p>上面演示的是在全部内容之前/后添加新的行，那么怎么在特定行前后做类似的操作呢，你可以用行号指定。但是不能用 range 形式的，因为定义上，i/a 是单行操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;3i\</span></span><br><span class="line"><span class="string">This is an inserted line.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is an inserted line.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line">sed <span class="string">&#x27;3a\This is an appended line.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is an appended line.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>插入文本末尾</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;$a\</span></span><br><span class="line"><span class="string">&gt; This is a new line of text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"><span class="comment"># This is a new line of text.</span></span><br></pre></td></tr></table></figure>

<p>头部插入多行, 需要使用斜杠分割</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1i\</span></span><br><span class="line"><span class="string">&gt; This is one line of new text.\</span></span><br><span class="line"><span class="string">&gt; This is another line of new text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is one line of new text.</span></span><br><span class="line"><span class="comment"># This is another line of new text.</span></span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>如果不指定行号，他会每一行都 insert 啊，和之前的理解不一样. append 也是一样的效果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;i\head insert&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># head insert</span></span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># head insert</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># head insert</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># head insert</span></span><br><span class="line"><span class="comment"># This is line number4</span></span><br></pre></td></tr></table></figure>

<p>也能指定 range… 前面的理解果断有问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1,2a\end append&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># end append</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># end append</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<h5 id="Changing-lines"><a href="#Changing-lines" class="headerlink" title="Changing lines"></a>Changing lines</h5><p>改变行内容，用法和前面的 i/a 没什么区别</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;3c\This is a chagned line of text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is a chagned line of text.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>pattern 方式替换</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/number3/c\</span></span><br><span class="line"><span class="string">This is a changed line of text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is a changed line of text.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>pattern 替换多行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat data8.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"><span class="comment"># This is line number1 again.</span></span><br><span class="line"><span class="comment"># This is yet another line.</span></span><br><span class="line"><span class="comment"># This is the last line in the line.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/number1/c\This is a changed line of text.&#x27;</span> data8.txt</span><br><span class="line"><span class="comment"># This is a changed line of text.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"><span class="comment"># This is a changed line of text.</span></span><br><span class="line"><span class="comment"># This is yet another line.</span></span><br><span class="line"><span class="comment"># This is the last line in the line.</span></span><br></pre></td></tr></table></figure>

<p>指定行号替换的行为方式有点奇怪，他会将你指定的行中内容全部替换掉</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;2,3c\This is a new line of text.&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is a new line of text.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br></pre></td></tr></table></figure>

<h5 id="Transforming-characters"><a href="#Transforming-characters" class="headerlink" title="Transforming characters"></a>Transforming characters</h5><p>transform(y) 是唯 sed 支持的唯一一个用于替换单个字符的参数，格式 <code>[address]y/inchars/outchars/</code>. inchars 和 outchars 必须是等长的，不然会报错。他是做一对一替换，比如 <code>y/123/789</code> 他会用 1 代替 7， 2 代替 8 依次类推</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;y/123/789/&#x27;</span> data8.txt</span><br><span class="line"><span class="comment"># This is line number7.</span></span><br><span class="line"><span class="comment"># This is line number8.</span></span><br><span class="line"><span class="comment"># This is line number9.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"><span class="comment"># This is line number7 again.</span></span><br><span class="line"><span class="comment"># This is yet another line.</span></span><br><span class="line"><span class="comment"># This is the last line in the line.</span></span><br></pre></td></tr></table></figure>

<p>而且他是全局替换，任何出现的地方都会被换掉</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This 1 is a test of 1 try.&quot;</span> | sed <span class="string">&#x27;y/123/456/&#x27;</span></span><br><span class="line"><span class="comment"># This 4 is a test of 4 try.</span></span><br></pre></td></tr></table></figure>

<h5 id="Printing-revisited"><a href="#Printing-revisited" class="headerlink" title="Printing revisited"></a>Printing revisited</h5><p>和 p flag 类似的还有两个符号，表示如下</p>
<ul>
<li>The p command to print a text line</li>
<li>The equal sign(=) command to print line numbers</li>
<li>The l(lowercase L) command to list a line</li>
</ul>
<p>p 使用案例, -n 可以强制只打印匹配的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;this is a test&quot;</span> | sed <span class="string">&#x27;p&#x27;</span></span><br><span class="line"><span class="comment"># this is a test</span></span><br><span class="line"><span class="comment"># this is a test</span></span><br><span class="line"></span><br><span class="line">cat data6.txt</span><br><span class="line"><span class="comment"># This is line number1.</span></span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is line number4.</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;/number3/p&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;2,3p&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number2.</span></span><br><span class="line"><span class="comment"># This is line number3.</span></span><br></pre></td></tr></table></figure>

<p>找到匹配的行，先打印原始值，再替换并打印。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/3/&#123;</span></span><br><span class="line"><span class="string">&gt; p</span></span><br><span class="line"><span class="string">&gt; s/line/test/p</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># This is line number3.</span></span><br><span class="line"><span class="comment"># This is test number3.</span></span><br></pre></td></tr></table></figure>

<p>equals 相关的案例，输出行号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat data1.txt </span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line">sed <span class="string">&#x27;=&#x27;</span> data1.txt </span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># The quick brown fox jumps over the lazy dog.</span></span><br></pre></td></tr></table></figure>

<p>搜索匹配的内容并打印行号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/number 4/&#123;</span></span><br><span class="line"><span class="string">&gt; =</span></span><br><span class="line"><span class="string">&gt; p</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data6.txt</span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>l - listing lines, 打印文字和特殊字符(non-printable characters). 下面的实验中，tab 符号答应失败了，可能什么设置问题把，不过结尾符 <code>$</code> 倒是么什么问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat data9.txt </span><br><span class="line"><span class="comment"># This    line    contains    tabs.</span></span><br><span class="line">sed -n <span class="string">&#x27;l&#x27;</span> data9.txt </span><br><span class="line"><span class="comment"># This    line    contains    tabs.$</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-files-with-sed"><a href="#Using-files-with-sed" class="headerlink" title="Using files with sed"></a>Using files with sed</h4><h5 id="Writing-to-a-file"><a href="#Writing-to-a-file" class="headerlink" title="Writing to a file"></a>Writing to a file</h5><p>通过 w 将匹配的内容写到文件 <code>[address]w filename</code>, 使用 -n 只在屏幕上显示匹配部分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1,2w test.txt&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line">cat test.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br></pre></td></tr></table></figure>

<p>这个技巧在筛选数据的时候格外好用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data11.txt </span><br><span class="line"><span class="comment"># Blum, R       Browncoat</span></span><br><span class="line"><span class="comment"># McGuiness, A  Alliance</span></span><br><span class="line"><span class="comment"># Bresnahan, C  Browncoat</span></span><br><span class="line"><span class="comment"># Harken, C     Alliance</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;/Browncoat/w Browncoats.txt&#x27;</span> data11.txt </span><br><span class="line">cat Browncoats.txt </span><br><span class="line"><span class="comment"># Blum, R       Browncoat</span></span><br><span class="line"><span class="comment"># Bresnahan, C  Browncoat</span></span><br></pre></td></tr></table></figure>

<h5 id="Reading-data-from-a-file"><a href="#Reading-data-from-a-file" class="headerlink" title="Reading data from a file"></a>Reading data from a file</h5><p>The read command(r) allows you to insert data contained in a separate file. format at: <code>[address]r filename</code></p>
<p>filename 可以是相对路径，也可以是绝对路径。你不能使用 range of address for the read command. you can only specify a single line number or text pattern address.</p>
<p>读取目标文件中的内容并插入到指定位置<strong>的后面</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat data12.txt </span><br><span class="line"><span class="comment"># This is an added line.</span></span><br><span class="line"><span class="comment"># This is the second added line.</span></span><br><span class="line"></span><br><span class="line">cat data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;3r data12.txt&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is an added line.</span></span><br><span class="line"><span class="comment"># This is the second added line.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>pattern 同样支持</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/number 2/r data12.txt&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is an added line.</span></span><br><span class="line"><span class="comment"># This is the second added line.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br></pre></td></tr></table></figure>

<p>添加到末尾</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;$r data12.txt&#x27;</span> data6.txt </span><br><span class="line"><span class="comment"># This is line number 1.</span></span><br><span class="line"><span class="comment"># This is line number 2.</span></span><br><span class="line"><span class="comment"># This is line number 3.</span></span><br><span class="line"><span class="comment"># This is line number 4.</span></span><br><span class="line"><span class="comment"># This is an added line.</span></span><br><span class="line"><span class="comment"># This is the second added line.</span></span><br></pre></td></tr></table></figure>

<p>将 read 和 delete 结合使用，我们就可以有类似于替换的效果了</p>
<p>下面例子中我们将名单用 LIST 这个单词做为占位符，将 data11.txt 中的内容替换进去</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat notice.std </span><br><span class="line"><span class="comment"># Would the following people:</span></span><br><span class="line"><span class="comment"># LIST</span></span><br><span class="line"><span class="comment"># please report to the ship&#x27;s captain.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/LIST/&#123;</span></span><br><span class="line"><span class="string">&gt; r data11.txt</span></span><br><span class="line"><span class="string">&gt; d</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> notice.std</span><br><span class="line"><span class="comment"># Would the following people:</span></span><br><span class="line"><span class="comment"># Blum, R       Browncoat</span></span><br><span class="line"><span class="comment"># McGuiness, A  Alliance</span></span><br><span class="line"><span class="comment"># Bresnahan, C  Browncoat</span></span><br><span class="line"><span class="comment"># Harken, C     Alliance</span></span><br><span class="line"><span class="comment"># please report to the ship&#x27;s captain.</span></span><br></pre></td></tr></table></figure>

<h2 id="Chapter-20-Regular-Expressions"><a href="#Chapter-20-Regular-Expressions" class="headerlink" title="Chapter 20: Regular Expressions"></a>Chapter 20: Regular Expressions</h2><h3 id="What-Are-Regular-Expressions"><a href="#What-Are-Regular-Expressions" class="headerlink" title="What Are Regular Expressions"></a>What Are Regular Expressions</h3><h4 id="A-definition"><a href="#A-definition" class="headerlink" title="A definition"></a>A definition</h4><p>A regular expression is a pattern template you define that a Linux utility users to filter text.</p>
<h4 id="Types-of-regular-expressions"><a href="#Types-of-regular-expressions" class="headerlink" title="Types of regular expressions"></a>Types of regular expressions</h4><p>Linux 系统中，一些不同的应用采用不同的正则表达式。正则表达式通过 regular expression engine 实现。Linux 世界中有两个爆款 engines:</p>
<ul>
<li>The POSIX Basic Regular Expression(BRE) engine</li>
<li>The POSIX Extened Regular Expression(ERE) engine</li>
</ul>
<p>大多数 Linux 工具都会适配 RRE，sed 除外，它的目标是尽可能快的处理，所以只识别部分 BRE。</p>
<h3 id="Defining-BRE-Patterns"><a href="#Defining-BRE-Patterns" class="headerlink" title="Defining BRE Patterns"></a>Defining BRE Patterns</h3><h4 id="Plain-text"><a href="#Plain-text" class="headerlink" title="Plain text"></a>Plain text</h4><p>搜索的关键字是目标的一部分即可</p>
<h4 id="Special-characters"><a href="#Special-characters" class="headerlink" title="Special characters"></a>Special characters</h4><p>正则可以识别的特殊字符 <code>.*[]^$&#123;&#125;\+?|()</code>, 如果你想要使用文本版的这些特殊字符，在他们前面加 backslash character()</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;The cost is $4.00&#x27;</span> | sed -n <span class="string">&#x27;/\$/p&#x27;</span></span><br><span class="line"><span class="comment"># The cost is $4.00</span></span><br></pre></td></tr></table></figure>

<h4 id="Anchor-characters"><a href="#Anchor-characters" class="headerlink" title="Anchor characters"></a>Anchor characters</h4><h5 id="Starting-at-the-beginning"><a href="#Starting-at-the-beginning" class="headerlink" title="Starting at the beginning"></a>Starting at the beginning</h5><p>caret character(^) 指代文本开头</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The book store&quot;</span> | sed -n <span class="string">&#x27;/^book/p&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Books are great&quot;</span> | sed -n <span class="string">&#x27;/^Book/p&#x27;</span></span><br><span class="line"><span class="comment"># Books are great</span></span><br></pre></td></tr></table></figure>

<p>当符号出现在非开头位置，则他会被当作普通字符处理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This ^ is a test&quot;</span> | sed -n <span class="string">&#x27;/s ^/p&#x27;</span> </span><br><span class="line"><span class="comment"># This ^ is a test</span></span><br></pre></td></tr></table></figure>

<h5 id="Looking-for-the-ending"><a href="#Looking-for-the-ending" class="headerlink" title="Looking for the ending"></a>Looking for the ending</h5><p>The dollar sign($) 指代了文本的结尾</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a good book&quot;</span> | sed -n <span class="string">&#x27;/book$/p&#x27;</span></span><br><span class="line"><span class="comment"># This is a good book</span></span><br></pre></td></tr></table></figure>

<h4 id="The-dot-character"><a href="#The-dot-character" class="headerlink" title="The dot character"></a>The dot character</h4><p>dot 用于指代除换行外的任何字符, 如果 <code>.</code> 代表的位置没有东西，则匹配失败</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data6 </span><br><span class="line"><span class="comment"># This is a test of a line.</span></span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br><span class="line"><span class="comment"># This test is at line four.</span></span><br><span class="line"><span class="comment"># at ten o&#x27;clock we&#x27;ll go home.</span></span><br><span class="line">sed -n <span class="string">&#x27;/.at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br><span class="line"><span class="comment"># This test is at line four.</span></span><br></pre></td></tr></table></figure>

<h4 id="Character-classes"><a href="#Character-classes" class="headerlink" title="Character classes"></a>Character classes</h4><p>character class 用于限定匹配的内容，使用 square brackets([]) 表示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/[ch]at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br></pre></td></tr></table></figure>

<h4 id="Negating-character-classes"><a href="#Negating-character-classes" class="headerlink" title="Negating character classes"></a>Negating character classes</h4><p>和前面的相反，是不包含的意思</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/[^ch]at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># This test is at line four.</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-ranges"><a href="#Using-ranges" class="headerlink" title="Using ranges"></a>Using ranges</h4><p><code>sed -n &#39;/^[0-9][0-9][0-9][0-9][0-9]$/p&#39; data8</code> 这个技巧也使用于字符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/[c-h]at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br></pre></td></tr></table></figure>

<p>也可以指定非连续的字符集合</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/[a-ch-m]at/p&#x27;</span> data6</span><br><span class="line"><span class="comment"># The cat is sleeping.</span></span><br><span class="line"><span class="comment"># That is a very nice hat.</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I&#x27;m getting too fat&quot;</span> | sed -n <span class="string">&#x27;/[a-ch-m]at/p&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<h4 id="Special-character-classes"><a href="#Special-character-classes" class="headerlink" title="Special character classes"></a>Special character classes</h4><p>BRE Special Character classes</p>
<table>
<thead>
<tr>
<th align="left">Class</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[[:alpha:]]</td>
<td align="left">Matches any alphabetical character, either upper or lower case</td>
</tr>
<tr>
<td align="left">[[:alnum:]]</td>
<td align="left">Matches any alphanumberic character 0-9, A-Z or a-z</td>
</tr>
<tr>
<td align="left">[[:blank:]]</td>
<td align="left">Matches a space or Tab character</td>
</tr>
<tr>
<td align="left">[[:digit:]]</td>
<td align="left">Matches a numberical digit from 0-9</td>
</tr>
<tr>
<td align="left">[[:lower:]]</td>
<td align="left">Matches any lowercase alphabetical character a-z</td>
</tr>
<tr>
<td align="left">[[:print:]]</td>
<td align="left">Matches any printable character</td>
</tr>
<tr>
<td align="left">[[:punct:]]</td>
<td align="left">Matches a punctuation character</td>
</tr>
<tr>
<td align="left">[[:space:]]</td>
<td align="left">Matches any whitespace character: space, Table, NL, FF, VT CR</td>
</tr>
<tr>
<td align="left">[[:upper:]]</td>
<td align="left">Matches any uppercase alphabetical character A-Z</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abc&quot;</span> | sed -n <span class="string">&#x27;/[[:digit:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abc&quot;</span> | sed -n <span class="string">&#x27;/[[:alpha:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># abc</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abc123&quot;</span> | sed -n <span class="string">&#x27;/[[:digit:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># abc123</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is, a test&quot;</span> | sed -n <span class="string">&#x27;/[[:punct:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># This is, a test</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test&quot;</span> | sed -n <span class="string">&#x27;/[[:punct:]]/p&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<h4 id="The-asterisk"><a href="#The-asterisk" class="headerlink" title="The asterisk"></a>The asterisk</h4><p>星号标识字符出现一次或 n 次</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ik&quot;</span> | sed -n <span class="string">&#x27;/ie*k/p&#x27;</span></span><br><span class="line"><span class="comment"># ik</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;iek&quot;</span> | sed -n <span class="string">&#x27;/ie*k/p&#x27;</span></span><br><span class="line"><span class="comment"># iek</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ieeeek&quot;</span> | sed -n <span class="string">&#x27;/ie*k/p&#x27;</span></span><br><span class="line"><span class="comment"># ieeeek</span></span><br></pre></td></tr></table></figure>

<p>星号也可以和 character class 结合使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;baeeeet&quot;</span> | sed -n <span class="string">&#x27;/b[ae]*t/p&#x27;</span></span><br><span class="line"><span class="comment"># baeeeet</span></span><br></pre></td></tr></table></figure>

<h3 id="Extended-Regular-Expressions"><a href="#Extended-Regular-Expressions" class="headerlink" title="Extended Regular Expressions"></a>Extended Regular Expressions</h3><p>gawk 识别 ERE pattern，ERE 新增了一些符号来扩展功能</p>
<p><strong>Caution</strong> sed 和 gawk 采用了不同的引擎，gawk 可以适配大部分的扩展功能。sed 不能，但是 sed 更快</p>
<h4 id="The-question-mark"><a href="#The-question-mark" class="headerlink" title="The question mark"></a>The question mark</h4><p>问号(?)表示出现 0 次或 1 次。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/be?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bt</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/be?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk <span class="string">&#x27;/be?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>问号也可以结合 character class 使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bt</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bat&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bot&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beaet&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;baet&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beat&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk <span class="string">&#x27;/b[ae]?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<h4 id="The-plus-sign"><a href="#The-plus-sign" class="headerlink" title="The plus sign"></a>The plus sign</h4><p>加号(+), 出现一次或多次</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk <span class="string">&#x27;/be+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/be+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/be+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>结合方括号使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bat&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;baet&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># baet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beeet&quot;</span> | gawk <span class="string">&#x27;/b[ae]+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beeet</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-braces"><a href="#Using-braces" class="headerlink" title="Using braces"></a>Using braces</h4><p>花括号表示重复多次</p>
<ul>
<li>m: The regular expression appears exactly m times</li>
<li>m,n: The regular expression appears at least m times, but no more than n times</li>
</ul>
<p><strong>Cautim</strong> gawk 默认不识别这个模式，需要加上 –re-interval 参数增加这个功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>指定出现次数的区间</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beeet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>同样适用于 character class</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bat&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beat&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beet&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># beet</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;beeet&quot;</span> | gawk --re-interval <span class="string">&#x27;/b[ae]&#123;1,2&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<h4 id="The-pipe-symbol"><a href="#The-pipe-symbol" class="headerlink" title="The pipe symbol"></a>The pipe symbol</h4><p>pipe symbol 可以让你实现 OR 的逻辑，只要有一个匹配，就算 match 了 <code>expr1 | expr2 | ...</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The cat is asleep&quot;</span> | gawk <span class="string">&#x27;/cat|dog/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># The cat is asleep</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The dog is asleep&quot;</span> | gawk <span class="string">&#x27;/cat|dog/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># The dog is asleep</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The sheep is asleep&quot;</span> | gawk <span class="string">&#x27;/cat|dog/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># no matched</span></span><br></pre></td></tr></table></figure>

<p>结合 character class 使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;He has a hat&quot;</span> | gawk <span class="string">&#x27;/[ch]at|dog/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># He has a hat</span></span><br></pre></td></tr></table></figure>

<h4 id="Grouping-expressions"><a href="#Grouping-expressions" class="headerlink" title="Grouping expressions"></a>Grouping expressions</h4><p>可以使用括号(parentheses)表示 group. 这个 group 会被当成一个基本字符对待。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Sat&quot;</span> | gawk <span class="string">&#x27;/Sat(urday)?/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Sat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Saturday&quot;</span> | gawk <span class="string">&#x27;/Sat(urday)?/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Saturday</span></span><br></pre></td></tr></table></figure>

<p>group 经常和 pipe 结合使用来表示可能出现的组合</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cat&quot;</span> | gawk <span class="string">&#x27;/(c|b)a(b|t)/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># cat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cab&quot;</span> | gawk <span class="string">&#x27;/(c|b)a(b|t)/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># cab</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bat&quot;</span> | gawk <span class="string">&#x27;/(c|b)a(b|t)/&#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># bat</span></span><br></pre></td></tr></table></figure>

<h3 id="Regular-Expressions-in-Action"><a href="#Regular-Expressions-in-Action" class="headerlink" title="Regular Expressions in Action"></a>Regular Expressions in Action</h3><p>实操，介绍一些使用案例</p>
<h4 id="Counting-directory-files"><a href="#Counting-directory-files" class="headerlink" title="Counting directory files"></a>Counting directory files</h4><p>统计环境变量中的可执行文件数量</p>
<p>步骤：echo $PATH 拿到路径，通过 <code>:</code> 分割，最后通过 <code>ls</code> 列出文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat countfiles.sh                                     </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Count number of files in you PATH</span></span><br><span class="line"></span><br><span class="line">mypath=$(<span class="built_in">echo</span> <span class="variable">$PATH</span> | sed <span class="string">&#x27;s/:/ /g&#x27;</span>)</span><br><span class="line">count=0</span><br><span class="line"><span class="keyword">for</span> directory <span class="keyword">in</span> <span class="variable">$mypath</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    check=$(ls <span class="variable">$direcotry</span>)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable">$check</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$directory</span> - <span class="variable">$count</span>&quot;</span></span><br><span class="line">    count=0</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./countfiles.sh </span><br><span class="line"><span class="comment"># /usr/local/opt/mysql@5.7/bin - 4</span></span><br><span class="line"><span class="comment"># /Users/i306454/SAPDevelop/tools/maven/bin - 4</span></span><br><span class="line"><span class="comment"># ....</span></span><br></pre></td></tr></table></figure>

<h4 id="Validating-a-phone-number"><a href="#Validating-a-phone-number" class="headerlink" title="Validating a phone number"></a>Validating a phone number</h4><p>写一个脚本匹配电话号码，样本</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">000-000-0000</span><br><span class="line">123-456-7890</span><br><span class="line">212-555-1234</span><br><span class="line">(317)555-1234</span><br><span class="line">(202) 555-9876</span><br><span class="line">33523</span><br><span class="line">1234567890</span><br><span class="line">234.123.4567</span><br></pre></td></tr></table></figure>

<p>规则：如下四种格式是合法的，其他都不合法</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(123)456-7890</span><br><span class="line">(123) 456-7890</span><br><span class="line">123-456-7890</span><br><span class="line">123.456.7890</span><br></pre></td></tr></table></figure>

<p>找规律:</p>
<ul>
<li>可能以括号开头 <code>^\(?</code></li>
<li>接下来三位数是 area codes, 第一位是非 0，1的数，后两位是 0-9的数 <code>[2-9][0-9]&#123;2&#125;</code></li>
<li>可能存在的结束括号 <code>\)?</code></li>
<li>间隔符，可以没有，可以是空格，点，横线 <code>(| |-|\.)</code> 使用 group 把它看作一个集合，使用竖线表示 or</li>
<li>三个 0-9 的整数 <code>[0-9]&#123;3&#125;</code></li>
<li>空格(虽然例子上没显示)，横线或者点号 <code>( |-|\.)</code></li>
<li>最后接四位整数作为结尾 <code>[0-9]&#123;4&#125;$</code></li>
</ul>
<p>完整表达式 <code>^\(?[2-9][0-9]&#123;2&#125;\)?(| |-|\.)[0-9]&#123;3&#125;( |-|\.)[0-9]&#123;4&#125;$</code></p>
<p>测试:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat isphone              </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Script to filter out bad phone numbers</span></span><br><span class="line"></span><br><span class="line">gawk --re-interval <span class="string">&#x27;/^\(?[2-9][0-9]&#123;2&#125;\)?(| |-|\.)[0-9]&#123;3&#125;( |-|\.)[0-9]&#123;4&#125;$/&#123;print $0&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">cat phonelist | ./isphone       </span><br><span class="line"><span class="comment"># 212-555-1234</span></span><br><span class="line"><span class="comment"># (317)555-1234</span></span><br><span class="line"><span class="comment"># (202) 555-9876</span></span><br><span class="line"><span class="comment"># 234.123.4567</span></span><br></pre></td></tr></table></figure>

<p>PS: 中间那个过来间隔符的操作我之前是没有意识到的</p>
<h4 id="Parsing-an-e-mail-address"><a href="#Parsing-an-e-mail-address" class="headerlink" title="Parsing an e-mail address"></a>Parsing an e-mail address</h4><p>验证 email 的正则表达式</p>
<ul>
<li>用户名部分，可以是任何数字，字母，下划线，横杠和加号 <code>^([a-zA-Z0-9_\-\.\+]+)@</code></li>
<li>hostname 和名字部分一样的规则 <code>([a-zA-Z0-9_\-\.\+]+)</code></li>
<li>顶级域名值只能是字母，大于2个字符，小于5个字符 <code>\.([a-zA-Z]&#123;2,5&#125;)$</code></li>
</ul>
<p>完整表达式 <code>^([a-zA-Z0-9_\-\.\+]+)@([a-zA-Z0-9_\-\.\+]+)\.([a-zA-Z]&#123;2,5&#125;)$</code></p>
<p>测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat isemail </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Script to filter out bad email</span></span><br><span class="line"></span><br><span class="line">gawk --re-interval <span class="string">&#x27;/^([a-zA-Z0-9_\-\.\+]+)@([a-zA-Z0-9_\-\.\+]+)\.([a-zA-Z]&#123;2,5&#125;)$/&#123;print $0&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rich@here.now&quot;</span> | ./isemail</span><br><span class="line"><span class="comment"># rich@here.now</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rich@here.now.&quot;</span> | ./isemail</span><br><span class="line"><span class="comment"># no match</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rich.blum@here.now&quot;</span> | ./isemail</span><br><span class="line"><span class="comment"># rich.blum@here.now</span></span><br></pre></td></tr></table></figure>

<h2 id="Advanced-sed"><a href="#Advanced-sed" class="headerlink" title="Advanced sed"></a>Advanced sed</h2><h3 id="Looking-at-Multiline-Commands"><a href="#Looking-at-Multiline-Commands" class="headerlink" title="Looking at Multiline Commands"></a>Looking at Multiline Commands</h3><p>在前面的 sed 使用过程中，你可能已经察觉到了 sed 的一个限制，他只能按行处理。当 sed 拿到一个字符流时，他会将数据按照 newline characters 做分割，每次处理一行。</p>
<p>但是实际工作你总会遇到需要处理多行的情况，比如你要替换文件中的 <code>Linux System Administrators Group</code> 关键字，但是他可能分布在两行中，这时如果你安之前的 sed 做替换就会漏掉一些内容</p>
<p>为了应对这种情况，sed 提供了三个关键字来处理这种情况</p>
<ul>
<li>N add the next line in the data stream to create a multiline group for processing</li>
<li>D delete a single line in multiline group</li>
<li>P prints a single line in a multiline group</li>
</ul>
<h4 id="Navigating-the-next-command"><a href="#Navigating-the-next-command" class="headerlink" title="Navigating the next command"></a>Navigating the next command</h4><h5 id="Using-the-single-line-next-command"><a href="#Using-the-single-line-next-command" class="headerlink" title="Using the single-line next command"></a>Using the single-line next command</h5><p>下面的示例中，我们有5行文本，1，3，5有值，2，4为空。目标是通过 sed 只移除第二行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat data1.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is a data line.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br></pre></td></tr></table></figure>

<p>错误示范，会删掉所有空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^$/d&#x27;</span> data1.txt       </span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is a data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br></pre></td></tr></table></figure>

<p>通过使用 <code>n</code> 这个关键字，可以将下一行也包括到搜索范围内</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/header/&#123;n ; d&#125;&#x27;</span> data1.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is a data line.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the last line</span></span><br></pre></td></tr></table></figure>

<p>PS: MacOS 不支持，在 Ubantu 上做的实验</p>
<p>简单一句话就是，n 不会和前一句做合并处理. 说实话上面的例子还是不怎么理解，可能得另外找点书补充一下</p>
<h5 id="Combining-lines-of-text"><a href="#Combining-lines-of-text" class="headerlink" title="Combining lines of text"></a>Combining lines of text</h5><p>The single-line next command moves the next line of text from the data stream into the processing space(called the pattern space) of the sed editor.</p>
<p>The multiline version of the next command(which uses a captial N) adds the next line of text to the text already in the pattern space.</p>
<p>大写的 N 可以将两行拼成一行处理，中间用换行符隔开</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/first/&#123;N; s/\n/ /&#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line. This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br></pre></td></tr></table></figure>

<p>上面的例子中，我们找到包含 first 的行，然后将下一行接上一起处理，处理的时候，将换行替换为空格</p>
<p>再举一个需要测试的数据落在两个段落中的例子</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br><span class="line"><span class="comment"># Thank you for your attendance.</span></span><br></pre></td></tr></table></figure>

<p>第一个关键字替换失败，第二个成功，因为第一个用的换行，匹配用的空格</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N;s/System Administrator/Desktop User/&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br><span class="line"><span class="comment"># Thank you for your attendance</span></span><br></pre></td></tr></table></figure>

<p>替换成功不过换行消失了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N;s/System.Administrator/Desktop User/&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br><span class="line"><span class="comment"># Thank you for your attendance.</span></span><br></pre></td></tr></table></figure>

<p>使用两个替换分别应对换行和空格的情况</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br><span class="line"><span class="comment"># Thank you for your attendance.</span></span><br></pre></td></tr></table></figure>

<p>这里还有一个小问题，由于命令是 N 开头，他会先拿下一行到 pattern space，当处理最后一行时，下一行为空，直接结束了，如果要替换的目标在最后一行就会有遗漏</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;N</span></span><br><span class="line"><span class="string">s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br></pre></td></tr></table></figure>

<p>这时你可以换一下顺序</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; N</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br></pre></td></tr></table></figure>

<p>（；￣ェ￣）简直无情，太繁琐了</p>
<h4 id="Navigating-the-multiline-delete-command"><a href="#Navigating-the-multiline-delete-command" class="headerlink" title="Navigating the multiline delete command"></a>Navigating the multiline delete command</h4><p>当使用 N 的方式做 delete 的时候，它会将匹配到的两行内容全部删掉</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;N ; /System\nAdministrator/d&#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br></pre></td></tr></table></figure>

<p>sed 提供了一个只删除第一行内容的 flag - D</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N ; /System\nAdministrator/D&#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br></pre></td></tr></table></figure>

<p>类似的技巧可以用来删除文章开头的空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat -n data1.txt</span><br><span class="line">    <span class="comment">#  1</span></span><br><span class="line">    <span class="comment">#  2    This is the header line.</span></span><br><span class="line">    <span class="comment">#  3</span></span><br><span class="line">    <span class="comment">#  4    This is a data line.</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line">    <span class="comment">#  6    This is the last line</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/^$/&#123;N;/header/D&#125;&#x27;</span> data1.txt | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3    This is a data line.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5    This is the last line</span></span><br></pre></td></tr></table></figure>

<h4 id="Navigating-the-multiline-print-command"><a href="#Navigating-the-multiline-print-command" class="headerlink" title="Navigating the multiline print command"></a>Navigating the multiline print command</h4><p>和 p 对应的还有一个 P， 用法和上面的 D 一样，如果用 p 会打印两行，而用 P 则只打印第一行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;N ; /System\nAdministrator/P&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line">sed -n <span class="string">&#x27;N ; /System\nAdministrator/p&#x27;</span> data3.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux System</span></span><br><span class="line"><span class="comment"># Administrator&#x27;s group meeting will be held.</span></span><br></pre></td></tr></table></figure>

<h3 id="Holding-Space"><a href="#Holding-Space" class="headerlink" title="Holding Space"></a>Holding Space</h3><p>pattern space 是 sed 用于存放正在的处理文本的空间。但是这并不是存放文本的唯一的地方，还有一个叫做 hold space. 下列是五个可以操作 hold space 的命令</p>
<p>The sed Editor Hold Space Commands</p>
<table>
<thead>
<tr>
<th align="left">Command</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">h</td>
<td align="left">Copies pattern space to hold space</td>
</tr>
<tr>
<td align="left">H</td>
<td align="left">Appends pattern space to hold space</td>
</tr>
<tr>
<td align="left">g</td>
<td align="left">Copies hold space to pattern sapce</td>
</tr>
<tr>
<td align="left">G</td>
<td align="left">Appends hold space to pattern space</td>
</tr>
<tr>
<td align="left">x</td>
<td align="left">Exchanges contents of pattern and hold spaces</td>
</tr>
</tbody></table>
<p>这些命令可以让 pattern space 空出来处理其他文本。一般来说，你在通过 h/H 将 pattern space 的内容移动到 hold space 之后，都会再通过 g/G/x 将内容在放回到 pattern space 中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;/first/ &#123;h ; p ; n ; p ; g ; p &#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br></pre></td></tr></table></figure>

<p>解析上面的命令</p>
<ol>
<li>sed 通过 RE 过滤包含 first 的语句</li>
<li>匹配到目标语句后，开始执行 {} 中的内容，h 会将语句 copy 到 hold space 中</li>
<li>第一个 p 打印当前 pattern space 中内容</li>
<li>n 提取下一行内容并放到 pattern space</li>
<li>第二个 p 打印当前 pattern space 中内容, 即包含 second 的语句</li>
<li>g 将 hold space 中的内容再 copy 回去</li>
<li>第三个 p 打印当前 pattern space 中内容, 即包含 first 的语句</li>
</ol>
<h3 id="Negating-a-Command"><a href="#Negating-a-Command" class="headerlink" title="Negating a Command"></a>Negating a Command</h3><p>使用叹号(!)对操作取反</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br><span class="line">sed -n <span class="string">&#x27;/header/p&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line">sed -n <span class="string">&#x27;/header/!p&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line</span></span><br><span class="line"><span class="comment"># This is the last line</span></span><br></pre></td></tr></table></figure>

<p>N 也有取反操作, 之前的例子</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;N</span></span><br><span class="line"><span class="string">s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All System Administrators should attend.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;$!N</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data4.txt</span><br><span class="line"><span class="comment"># On Tuesday, the Linux Desktop</span></span><br><span class="line"><span class="comment"># User&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="comment"># All Desktop Users should attend.</span></span><br></pre></td></tr></table></figure>

<p><code>$!N</code> 消失 最后一行不执行 N 的操作。。。</p>
<p>通过上面介绍的这些技巧，你可以利用 hold space 做文本倒序的功能</p>
<ol>
<li>Place a line in the pattern space</li>
<li>Place the line from the pattern space to the hold space</li>
<li>Put the next line of text in the pattern space</li>
<li>Append the hold space to the pattern space</li>
<li>Place everything in the pttern space into the hold space</li>
<li>Repeat step 3-5 until you’ve put all the lines in reverse oder in the hold space</li>
<li>Retrieve the lines, and print them</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat -n data2.txt</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  3    This is the second data line</span></span><br><span class="line">    <span class="comment">#  4    This is the last line</span></span><br><span class="line"></span><br><span class="line">sed -n <span class="string">&#x27;&#123;1!G; h; $p&#125;&#x27;</span> data2.txt | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the last line</span></span><br><span class="line">    <span class="comment">#  2    This is the second data line</span></span><br><span class="line">    <span class="comment">#  3    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  4    This is the header line.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>1!G</code> 第一行时不用将 hold space 的内容 append 过来, 不加的话会多一个空行</li>
<li><code>h</code> copy to hold space</li>
<li><code>$p</code> 最后一行的话 打印</li>
</ul>
<p>这尼玛也太精巧了把，我感觉我想不出来 （；￣ェ￣）</p>
<p>PS: 如果真要倒序，直接用 tac 即可， cat 的倒写</p>
<h3 id="Changing-the-Flow"><a href="#Changing-the-Flow" class="headerlink" title="Changing the Flow"></a>Changing the Flow</h3><p>默认情况下 sed 是从头到尾的处理的，但是他也提供了方法改变处理顺序，感觉像有点像结构化语言</p>
<h4 id="Branching"><a href="#Branching" class="headerlink" title="Branching"></a>Branching</h4><p>效果和叹号一样，只不过他是会根据 address 的标识批量操作而已</p>
<p>branch command: [address]b [label]</p>
<p>下面的例子中， sed 在做替换是根据 <code>2,3b</code> 跳过了第 2-3 行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;&#123;2,3b; s/This is/Is this/; s/line./test?/&#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># Is this the header test?</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># Is this the last test?</span></span><br></pre></td></tr></table></figure>

<p>label 的作用是设置一个跳点，本来看了第一个例子我还想说它很像 if condition 但是感觉上说他是 goto 还更恰当一点。 label 最长为 7 个字符</p>
<p>下面的例子，jump1 更像是 if, 如果 match 则跳过条件直接执行 :jump1 之后的命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;&#123;/first/b jump1; s/This is the/No jump on/</span></span><br><span class="line"><span class="string">&gt; :jump1</span></span><br><span class="line"><span class="string">&gt; s/This is the/Jump here on/&#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># No jump on header line.</span></span><br><span class="line"><span class="comment"># Jump here on first data line.</span></span><br><span class="line"><span class="comment"># No jump on second data line.</span></span><br><span class="line"><span class="comment"># No jump on last line.</span></span><br></pre></td></tr></table></figure>

<p>当 b 匹配的内容出现，则跳过第一个替换，直接执行后一个。更骚的操作是下面的这个循环替换逗号的操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This, is, a, test, to, remove, commas.&quot;</span> | sed -n <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; :start</span></span><br><span class="line"><span class="string">&gt; s/,//1p</span></span><br><span class="line"><span class="string">&gt; b start</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># This is, a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove commas.</span></span><br><span class="line"><span class="comment"># ^C</span></span><br></pre></td></tr></table></figure>

<p>这个例子大致意思我是懂得，但是不清楚为什么执行操作的时候文本一直有效，不会被冲掉吗？可能要深入了解一下 pattern space 才能直到原因。这个cmd 需要 Ctrl + C 才能强制结束, 下面是改进版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This, is, a, test, to, remove, commas.&quot;</span> | sed -n <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/,//1p</span></span><br><span class="line"><span class="string">/,/b start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># This is, a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove commas.</span></span><br></pre></td></tr></table></figure>

<h4 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h4><p>语法和 branch 很像 <code>[address]t [label]</code></p>
<p>test command provide a cheap way to perform a basic if-then statement on the text in the data stream</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line">sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; s/first/matched/</span></span><br><span class="line"><span class="string">&gt; t</span></span><br><span class="line"><span class="string">&gt; s/This is the/No match on/</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># No match on header line.</span></span><br><span class="line"><span class="comment"># This is the matched data line.</span></span><br><span class="line"><span class="comment"># No match on second data line.</span></span><br><span class="line"><span class="comment"># No match on last line.</span></span><br></pre></td></tr></table></figure>

<p>如果 t 前面的 cmd 匹配则执行，不然直接执行后一个命令。之前循环替换逗号的例子用 t 的形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This, is, a, test, to, remove, commas.&quot;</span> | sed -n <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/,//1p</span></span><br><span class="line"><span class="string">t start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># This is, a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a, test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test, to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to, remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove, commas.</span></span><br><span class="line"><span class="comment"># This is a test to remove commas.</span></span><br></pre></td></tr></table></figure>

<h3 id="Replacing-via-a-Pattern"><a href="#Replacing-via-a-Pattern" class="headerlink" title="Replacing via a Pattern"></a>Replacing via a Pattern</h3><p>通过 sed 做精确替换还是简单的, 比如下面的例子要在 cat 外面添加双引号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The cat sleeps in his hat.&quot;</span> | sed <span class="string">&#x27;s/cat/&quot;cat&quot;/&#x27;</span></span><br><span class="line"><span class="comment"># The &quot;cat&quot; sleeps in his hat.</span></span><br></pre></td></tr></table></figure>

<p>但是如果你想要在所有 .at 外面加双引号可能有会遇到问题了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The cat sleeps in his hat.&quot;</span> | sed <span class="string">&#x27;s/.at/&quot;.at&quot;/g&#x27;</span></span><br><span class="line"><span class="comment"># The &quot;.at&quot; sleeps in his &quot;.at&quot;.</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-the-ampersand"><a href="#Using-the-ampersand" class="headerlink" title="Using the ampersand"></a>Using the ampersand</h4><p>为了解决上面的问题，sed 提供了 <code>&amp;</code> 符号指代匹配的字符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The cat sleeps in his hat.&quot;</span> | sed <span class="string">&#x27;s/.at/&quot;&amp;&quot;/g&#x27;</span></span><br><span class="line"><span class="comment"># The &quot;cat&quot; sleeps in his &quot;hat&quot;.</span></span><br></pre></td></tr></table></figure>

<h4 id="Replacing-individual-words"><a href="#Replacing-individual-words" class="headerlink" title="Replacing individual words"></a>Replacing individual words</h4><p>如果你只想替换一部分内容，说人话就是支持 group 的模式减少 typing</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This System Administractor manual&quot;</span> | sed <span class="string">&#x27;</span></span><br><span class="line"><span class="string">s/\(System\) Administractor/\1 User/&#x27;</span></span><br><span class="line"><span class="comment"># This System User manual</span></span><br></pre></td></tr></table></figure>

<ul>
<li>group 需要用反斜线</li>
<li>指代 group 用反斜线加数子</li>
</ul>
<p>下面的例子中我们用原句中的一部分代替原有部分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;That furry cat is pretty&quot;</span> | sed <span class="string">&#x27;s/furry \(.at\)/\1/&#x27;</span></span><br><span class="line"><span class="comment"># That cat is pretty</span></span><br></pre></td></tr></table></figure>

<p>这个技巧在插入值的时候很好用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1234567&quot;</span> | sed <span class="string">&#x27;&#123;                                    </span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/\(.*[0-9]\)\([0-9]\&#123;3\&#125;\)/\1,\2/</span></span><br><span class="line"><span class="string">t start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 1,234,567</span></span><br></pre></td></tr></table></figure>

<p>有两个分组</p>
<ul>
<li>.*[0-9]</li>
<li>[0-9]{3}</li>
</ul>
<p>第一次替换结果为 1234,567，第二次 1,234,567</p>
<h3 id="Placing-sed-Commands-in-Script"><a href="#Placing-sed-Commands-in-Script" class="headerlink" title="Placing sed Commands in Script"></a>Placing sed Commands in Script</h3><p>展示一些脚本中使用 sed 的技巧</p>
<h4 id="Using-wrappers"><a href="#Using-wrappers" class="headerlink" title="Using wrappers"></a>Using wrappers</h4><p>每次使用 sed 的时候现打会很累赘，你可以将他们写到脚本中并调用</p>
<p>下面的例子中，我们将之前实现的 reverse 功能通过脚本调用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat reverse.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Shell wrapper for sed editor script.</span></span><br><span class="line"><span class="comment">#           to reverse text file lines</span></span><br><span class="line">sed -n <span class="string">&#x27;&#123;1!G; h; $p&#125;&#x27;</span> <span class="variable">$1</span></span><br><span class="line"></span><br><span class="line">cat data2.txt</span><br><span class="line"><span class="comment"># This is the header line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line"></span><br><span class="line">./reverse.sh data2.txt</span><br><span class="line"><span class="comment"># This is the last line.</span></span><br><span class="line"><span class="comment"># This is the second data line.</span></span><br><span class="line"><span class="comment"># This is the first data line.</span></span><br><span class="line"><span class="comment"># This is the header line.</span></span><br></pre></td></tr></table></figure>

<h4 id="Redirecting-sed-output"><a href="#Redirecting-sed-output" class="headerlink" title="Redirecting sed output"></a>Redirecting sed output</h4><p>sed 操作后的输出可以用 $() 包裹起来作为结果引用</p>
<p>下面的例子中我们计算斐波那契额数列并用之前写的 sed 表达式为它加上逗号分割</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat fact.sh                        </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Add commas to number in factorial answer</span></span><br><span class="line"></span><br><span class="line">factorial=1</span><br><span class="line">counter=1</span><br><span class="line">number=<span class="variable">$1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$counter</span> -le <span class="variable">$number</span> ]</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    factorial=$[ <span class="variable">$factorial</span> * <span class="variable">$counter</span> ]</span><br><span class="line">    counter=$[ <span class="variable">$counter</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">result=$(<span class="built_in">echo</span> <span class="variable">$factorial</span> | sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/\(.*[0-9]\)\([0-9]\&#123;3\&#125;\)/\1,\2/</span></span><br><span class="line"><span class="string">t start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The result is <span class="variable">$result</span>&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">./fact.sh 20      </span><br><span class="line"><span class="comment"># The result is 2,432,902,008,176,640,000</span></span><br></pre></td></tr></table></figure>

<h3 id="Creating-sed-Utilities"><a href="#Creating-sed-Utilities" class="headerlink" title="Creating sed Utilities"></a>Creating sed Utilities</h3><p>分享一些数据处理函数</p>
<h4 id="Spacing-with-double-lines"><a href="#Spacing-with-double-lines" class="headerlink" title="Spacing with double lines"></a>Spacing with double lines</h4><p>为文本中的每一行后面新家一个空行, 如果最后一行不想加空格，可以用叹号取反</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;G&#x27;</span> data2.txt  | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5    This is the second data line.</span></span><br><span class="line">    <span class="comment">#  6</span></span><br><span class="line">    <span class="comment">#  7    This is the last line.</span></span><br><span class="line">    <span class="comment">#  8</span></span><br><span class="line"> sed <span class="string">&#x27;$!G&#x27;</span> data2.txt  | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5    This is the second data line.</span></span><br><span class="line">    <span class="comment">#  6</span></span><br><span class="line">    <span class="comment">#  7    This is the last line.</span></span><br></pre></td></tr></table></figure>

<h4 id="Spacing-files-that-may-have-blanks"><a href="#Spacing-files-that-may-have-blanks" class="headerlink" title="Spacing files that may have blanks"></a>Spacing files that may have blanks</h4><p>如果你的文件中已经存在空行了，那么用上面的技巧，你的文件中可能出现多个空行，怎么保证空行数只有一个呢</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;$!G&#x27;</span> data6.txt | cat -n</span><br><span class="line">    <span class="comment">#  1    This is line number1.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3    This is line number2.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line">    <span class="comment">#  6</span></span><br><span class="line">    <span class="comment">#  7    This is line number3.</span></span><br><span class="line">    <span class="comment">#  8</span></span><br><span class="line">    <span class="comment">#  9    This is line number4.</span></span><br></pre></td></tr></table></figure>

<p>解决方案，现将所有空格去了，再做加空行的操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^$/d; $!G;&#x27;</span> data6.txt  | cat  -A</span><br><span class="line"><span class="comment"># This is line number 1.$</span></span><br><span class="line"><span class="comment"># $</span></span><br><span class="line"><span class="comment"># This is line number 2.$</span></span><br><span class="line"><span class="comment"># $</span></span><br><span class="line"><span class="comment"># This is line number 3.$</span></span><br><span class="line"><span class="comment"># $</span></span><br><span class="line"><span class="comment"># This is line number 4.$</span></span><br></pre></td></tr></table></figure>

<p>PS: 使用 <code>i\</code> 的语法添加空行会带有一个空格，推荐使用 <code>1G</code> 的方式</p>
<h4 id="Numbering-lines-in-a-file"><a href="#Numbering-lines-in-a-file" class="headerlink" title="Numbering lines in a file"></a>Numbering lines in a file</h4><p>19 章时我们介绍过用 <code>=</code> 显示行号的操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;=&#x27;</span> data2.txt </span><br><span class="line">1</span><br><span class="line">This is the header line.</span><br><span class="line">2</span><br><span class="line">This is the first data line.</span><br><span class="line">3</span><br><span class="line">This is the second data line.</span><br><span class="line">4</span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure>

<p>这种格式有点奇怪，更友好的方式应该时行号和字串在一行中，这里可以用 N</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;=&#x27;</span> data2.txt | sed <span class="string">&#x27;N; s/\n/ /&#x27;</span></span><br><span class="line"><span class="comment"># 1 This is the header line.</span></span><br><span class="line"><span class="comment"># 2 This is the first data line.</span></span><br><span class="line"><span class="comment"># 3 This is the second data line.</span></span><br><span class="line"><span class="comment"># 4 This is the last line.</span></span><br></pre></td></tr></table></figure>

<p>这中方式最大的好处是，没有加行额外的空格，一些其他的工具，比如 nl, cat -n 会在结果前面添加一些空格</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nl data2.txt</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  3    This is the second data line.</span></span><br><span class="line">    <span class="comment">#  4    This is the last line.</span></span><br><span class="line"></span><br><span class="line">cat -n data2.txt</span><br><span class="line">    <span class="comment">#  1    This is the header line.</span></span><br><span class="line">    <span class="comment">#  2    This is the first data line.</span></span><br><span class="line">    <span class="comment">#  3    This is the second data line.</span></span><br><span class="line">    <span class="comment">#  4    This is the last line.</span></span><br></pre></td></tr></table></figure>

<h4 id="Printing-last-lines"><a href="#Printing-last-lines" class="headerlink" title="Printing last lines"></a>Printing last lines</h4><p>只打印最后一行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;$p&#x27;</span> data2.txt</span><br><span class="line"><span class="comment"># This is the last line.</span></span><br></pre></td></tr></table></figure>

<p>使用类似的技巧，你可以显示末尾几行数据，这种做法叫做 rolling window</p>
<p>rolling window 中我们结合使用 N，将整块的文本存储到 pattern space 中</p>
<p>下面的例子中我们将用 sed 显示文本最后10行的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat data7.txt</span><br><span class="line"><span class="comment"># This is line 1.</span></span><br><span class="line"><span class="comment"># This is line 2.</span></span><br><span class="line"><span class="comment"># This is line 3.</span></span><br><span class="line"><span class="comment"># This is line 4.</span></span><br><span class="line"><span class="comment"># This is line 5.</span></span><br><span class="line"><span class="comment"># This is line 6.</span></span><br><span class="line"><span class="comment"># This is line 7.</span></span><br><span class="line"><span class="comment"># This is line 8.</span></span><br><span class="line"><span class="comment"># This is line 9.</span></span><br><span class="line"><span class="comment"># This is line 10.</span></span><br><span class="line"><span class="comment"># This is line 11.</span></span><br><span class="line"><span class="comment"># This is line 12.</span></span><br><span class="line"><span class="comment"># This is line 13.</span></span><br><span class="line"><span class="comment"># This is line 14.</span></span><br><span class="line"><span class="comment"># This is line 15.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">$q; N; 11,$D</span></span><br><span class="line"><span class="string">b start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data7.txt</span><br><span class="line"><span class="comment"># This is line 6.</span></span><br><span class="line"><span class="comment"># This is line 7.</span></span><br><span class="line"><span class="comment"># This is line 8.</span></span><br><span class="line"><span class="comment"># This is line 9.</span></span><br><span class="line"><span class="comment"># This is line 10.</span></span><br><span class="line"><span class="comment"># This is line 11.</span></span><br><span class="line"><span class="comment"># This is line 12.</span></span><br><span class="line"><span class="comment"># This is line 13.</span></span><br><span class="line"><span class="comment"># This is line 14.</span></span><br><span class="line"><span class="comment"># This is line 15.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>$q</code> 退出</li>
<li><code>N</code> 将下一行 append 到 pattern space</li>
<li><code>11,$D</code> 如果当前为 10 行以后，删除第一行</li>
</ul>
<h4 id="Deleting-lines-1"><a href="#Deleting-lines-1" class="headerlink" title="Deleting lines"></a>Deleting lines</h4><p>这节将介绍一些快速移除空白行的操作</p>
<h5 id="Deleting-consecutive-blank-lines"><a href="#Deleting-consecutive-blank-lines" class="headerlink" title="Deleting consecutive blank lines"></a>Deleting consecutive blank lines</h5><p>删除多余空行，这里用了另外一种解决方案。这里的规则是，起始于任何非空行，终止于空行的内容都不会被删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat -n data8.txt   </span><br><span class="line">    <span class="comment">#  1  This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3</span></span><br><span class="line">    <span class="comment">#  4  This is the first data line.</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line">    <span class="comment">#  6  This is the second data line.</span></span><br><span class="line">    <span class="comment">#  7</span></span><br><span class="line">    <span class="comment">#  8</span></span><br><span class="line">    <span class="comment">#  9  This is the last line.</span></span><br><span class="line">    <span class="comment"># 10</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/./,/^$/!d&#x27;</span> data8.txt | cat -n</span><br><span class="line">    <span class="comment">#  1  This is the header line.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3  This is the first data line.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5  This is the second data line.</span></span><br><span class="line">    <span class="comment">#  6</span></span><br><span class="line">    <span class="comment">#  7  This is the last line.</span></span><br><span class="line">    <span class="comment">#  8</span></span><br></pre></td></tr></table></figure>

<h5 id="Deleting-leading-blank-lines"><a href="#Deleting-leading-blank-lines" class="headerlink" title="Deleting leading blank lines"></a>Deleting leading blank lines</h5><p>删除开头部分的空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat -n data9.txt </span><br><span class="line">    <span class="comment">#  1</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3  This is line one.</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5  This is line two.</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/./,$!d&#x27;</span> data9.txt | cat -n</span><br><span class="line">    <span class="comment">#  1  This is line one.</span></span><br><span class="line">    <span class="comment">#  2</span></span><br><span class="line">    <span class="comment">#  3  This is line two.</span></span><br></pre></td></tr></table></figure>

<p>任何有内容的行开始，到结束不删除</p>
<h5 id="Deleting-trailing-blank-lines"><a href="#Deleting-trailing-blank-lines" class="headerlink" title="Deleting trailing blank lines"></a>Deleting trailing blank lines</h5><p>删除结尾部分的空行要比删除开头部分的空行麻烦一点，需要一些技巧和循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat -n data10.txt</span><br><span class="line">    <span class="comment">#  1    This is the first line.</span></span><br><span class="line">    <span class="comment">#  2    This is the second line.</span></span><br><span class="line">    <span class="comment">#  3</span></span><br><span class="line">    <span class="comment">#  4</span></span><br><span class="line">    <span class="comment">#  5</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">/^\n*$/&#123;$d; N; b start&#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data10.txt | cat -n</span><br><span class="line">    <span class="comment">#  1    This is the first line.</span></span><br><span class="line">    <span class="comment">#  2    This is the second line.</span></span><br></pre></td></tr></table></figure>

<p>匹配任何只包含换行的 line, 如果是最后一行，则删除，如果不是就再次执行</p>
<h4 id="Removing-HTML-tags"><a href="#Removing-HTML-tags" class="headerlink" title="Removing HTML tags"></a>Removing HTML tags</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat data11.txt</span><br><span class="line"><span class="comment"># &lt;html&gt;</span></span><br><span class="line"><span class="comment"># &lt;head&gt;</span></span><br><span class="line"><span class="comment"># &lt;title&gt;This is the page title&lt;/title&gt;</span></span><br><span class="line"><span class="comment"># &lt;/head&gt;</span></span><br><span class="line"><span class="comment"># &lt;body&gt;</span></span><br><span class="line"><span class="comment"># &lt;p&gt;</span></span><br><span class="line"><span class="comment"># This is the &lt;b&gt;first&lt;/b&gt; line in the Web page.</span></span><br><span class="line"><span class="comment"># This should provide some &lt;i&gt;useful&lt;/i&gt;</span></span><br><span class="line"><span class="comment"># information to use in our sed script.</span></span><br><span class="line"><span class="comment"># &lt;/p&gt;</span></span><br><span class="line"><span class="comment"># &lt;/body&gt;</span></span><br><span class="line"><span class="comment"># &lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果直接使用 <code>s/&lt;.*&gt;//g</code> 会出问题，一些文本类似 <code>&lt;b&gt;abc&lt;/b&gt;</code> 也会被删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/&lt;.*&gt;//g&#x27;</span> data11.txt | cat -n </span><br><span class="line">    <span class="comment">#  1</span></span><br><span class="line">    <span class="comment">#  2   </span></span><br><span class="line">    <span class="comment">#  3    </span></span><br><span class="line">    <span class="comment">#  4   </span></span><br><span class="line">    <span class="comment">#  5   </span></span><br><span class="line">    <span class="comment">#  6    </span></span><br><span class="line">    <span class="comment">#  7     This is the  line in the Web page.</span></span><br><span class="line">    <span class="comment">#  8     This should provide some </span></span><br><span class="line">    <span class="comment">#  9     information to use in our sed script.</span></span><br><span class="line">    <span class="comment"># 10    </span></span><br><span class="line">    <span class="comment"># 11   </span></span><br><span class="line">    <span class="comment"># 12</span></span><br></pre></td></tr></table></figure>

<p>这个是由于 sed 将内嵌的 <code>&gt;</code> 识别为 <code>.*</code> 的一部分了，可以使用 <code>s/&lt;[^&gt;]*&gt;//g</code> 修复, 再结合删除空格的语法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/&lt;[^&gt;]*&gt;//g; /^$/d&#x27;</span> data11.txt             </span><br><span class="line"><span class="comment"># This is the page title</span></span><br><span class="line"><span class="comment"># This is the first line in the Web page.</span></span><br><span class="line"><span class="comment"># This should provide some useful</span></span><br><span class="line"><span class="comment"># information to use in our sed script.</span></span><br></pre></td></tr></table></figure>

<h2 id="Chapter-22-Advanced-gawk"><a href="#Chapter-22-Advanced-gawk" class="headerlink" title="Chapter 22: Advanced gawk"></a>Chapter 22: Advanced gawk</h2><h3 id="Using-Variables"><a href="#Using-Variables" class="headerlink" title="Using Variables"></a>Using Variables</h3><p>gawk 支持两种不同类型的变量</p>
<ul>
<li>Built-in variables</li>
<li>User-defined variables</li>
</ul>
<h4 id="Built-in-variables"><a href="#Built-in-variables" class="headerlink" title="Built-in variables"></a>Built-in variables</h4><p>这一节将展示 gawk 自带变量的使用办法</p>
<h5 id="The-field-and-record-separator-variables"><a href="#The-field-and-record-separator-variables" class="headerlink" title="The field and record separator variables"></a>The field and record separator variables</h5><p>The gawk Data Field and REcord Variables</p>
<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">FIELDWIDTHS</td>
<td align="left">A space-separated list of numbers defining the exact width(in spaces) of each data field</td>
</tr>
<tr>
<td align="left">FS</td>
<td align="left">Input field separator character</td>
</tr>
<tr>
<td align="left">RS</td>
<td align="left">Input record separator character</td>
</tr>
<tr>
<td align="left">OFS</td>
<td align="left">Output field separator character</td>
</tr>
<tr>
<td align="left">ORS</td>
<td align="left">Output record separator character</td>
</tr>
</tbody></table>
<p>下面的例子展示了 FS 的使用方法, 通过 FS 指定分割符，只输出每行前三组数据</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat data1</span><br><span class="line"><span class="comment"># data11,data12,data13,data14,data15</span></span><br><span class="line"><span class="comment"># data21,data22,data23,data24,data25</span></span><br><span class="line"><span class="comment"># data31,data32,data33,data34,data35</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; &#123;print $1, $2, $3&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11 data12 data13</span></span><br><span class="line"><span class="comment"># data21 data22 data23</span></span><br><span class="line"><span class="comment"># data31 data32 data33</span></span><br></pre></td></tr></table></figure>

<p>OFS 指定输出时候的分割符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;; OFS=&quot;--&quot;&#125; &#123;print $1, $2, $3&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11--data12--data13</span></span><br><span class="line"><span class="comment"># data21--data22--data23</span></span><br><span class="line"><span class="comment"># data31--data32--data33</span></span><br></pre></td></tr></table></figure>

<p>有些数据并不是用固定的分割符做刷剧划分的，而是用的位置，这个时候你就要用到 FIELDWIDTHS 了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat data1b                                                               </span><br><span class="line"><span class="comment"># 1005.3247596.37</span></span><br><span class="line"><span class="comment"># 115-2.349194.00</span></span><br><span class="line"><span class="comment"># 05810.1298100.1</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FIELDWIDTHS=&quot;3 5 2 5&quot;&#125; &#123;print $1, $2, $3 $4&#125;&#x27;</span> data1b</span><br><span class="line"><span class="comment"># 100 5.324 7596.37</span></span><br><span class="line"><span class="comment"># 115 -2.34 9194.00</span></span><br><span class="line"><span class="comment"># 058 10.12 98100.1</span></span><br></pre></td></tr></table></figure>

<p>PS: FIEDLWIDTHS 必须是常数，变量是不支持的</p>
<p>RS/ORS 用于行数据，默认的 RS 即为换行符</p>
<p>下面是一个解析电话号码的例子，我们想要解析出用户和对应的电话号码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat data2    </span><br><span class="line"><span class="comment"># Riley Mullen</span></span><br><span class="line"><span class="comment"># 123 Main Street</span></span><br><span class="line"><span class="comment"># Chicago, IL  60601</span></span><br><span class="line"><span class="comment"># (312)555-1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Frank Williams</span></span><br><span class="line"><span class="comment"># 456 Oak Street</span></span><br><span class="line"><span class="comment"># Indianapolis, IN  46201</span></span><br><span class="line"><span class="comment"># (317)555-9876</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Haley Snell</span></span><br><span class="line"><span class="comment"># 4231 Elm Street</span></span><br><span class="line"><span class="comment"># Detroit, MI 48201</span></span><br><span class="line"><span class="comment"># (313)555-4938</span></span><br></pre></td></tr></table></figure>

<p>如果我们还是用默认的换行符，则不能解析。我们可以将 <code>\n</code> 设置为字段分割符，将空行作为行分割符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;print $1, $4&#125;&#x27;</span> data2 </span><br><span class="line"><span class="comment"># Riley Mullen (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell (313)555-4938</span></span><br></pre></td></tr></table></figure>

<h5 id="Data-variables"><a href="#Data-variables" class="headerlink" title="Data variables"></a>Data variables</h5><p>More gawk Built-In Variables</p>
<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ARGC</td>
<td align="left">The number of command line parameters present</td>
</tr>
<tr>
<td align="left">ARGIND</td>
<td align="left">The index in ARGV of the current file being proecssed</td>
</tr>
<tr>
<td align="left">ARGV</td>
<td align="left">An array of command line parameters</td>
</tr>
<tr>
<td align="left">CONVFMT</td>
<td align="left">The conversion format for numbers(see the printf statement), with a default value of %.6 g</td>
</tr>
<tr>
<td align="left">ENVIRON</td>
<td align="left">An associative array of the current shell environment variables and their values</td>
</tr>
<tr>
<td align="left">FNR</td>
<td align="left">The current record number in the data file</td>
</tr>
<tr>
<td align="left">NF</td>
<td align="left">The total number of data fields in the data file</td>
</tr>
<tr>
<td align="left">NR</td>
<td align="left">The number of input records processed</td>
</tr>
</tbody></table>
<p>其他懒得打了</p>
<p>ARGC, ARGV 和之前 shell 变量概念很想，不过 ARGV 是不会将 script 统计在内的，这个有点不一样</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;print ARGC, ARGV[0], ARGV[1]&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># 2 gawk data1</span></span><br></pre></td></tr></table></figure>

<p>PS: 表达式也有点不一样，变量前不需要加 $</p>
<p>获取环境变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;                                          </span></span><br><span class="line"><span class="string">quote&gt; BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; print ENVIRON[&quot;HOME&quot;]                    </span></span><br><span class="line"><span class="string">quote&gt; print ENVIRON[&quot;PATH&quot;]                    </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># /Users/i306454</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>FNR, NF, NR 可以标记 field 的位置。 NF 可以让你在不清楚 field 数量的情况下处理最后一个 field</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;; OFS=&quot;--&quot;&#125; &#123;print $1,$NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line"><span class="comment"># _nearbyd--/usr/bin/false</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">cat /etc/passwd | tail -3                                </span><br><span class="line"><span class="comment"># _coreml:*:280:280:CoreML Services:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _trustd:*:282:282:trustd:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false</span></span><br></pre></td></tr></table></figure>

<p>FNR 表示当前 field 的序号. 下面的例子中，我们传入两个 data file, 每个文件处理完后 FNR 会重制</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125;&#123;print $1, &quot;FNR=&quot;FNR&#125;&#x27;</span> data1 data1    </span><br><span class="line"><span class="comment"># data11 FNR=1</span></span><br><span class="line"><span class="comment"># data21 FNR=2</span></span><br><span class="line"><span class="comment"># data31 FNR=3</span></span><br><span class="line"><span class="comment"># data11 FNR=1</span></span><br><span class="line"><span class="comment"># data21 FNR=2</span></span><br><span class="line"><span class="comment"># data31 FNR=3</span></span><br></pre></td></tr></table></figure>

<p>NR 则是将所有的传入数据一起统计的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125;                            </span></span><br><span class="line"><span class="string">quote&gt; &#123;print $1, &quot;FNR=&quot;FNR, &quot;NR=&quot;NR&#125;</span></span><br><span class="line"><span class="string">quote&gt; END&#123;print &quot;There were&quot;, NR, &quot;records processed&quot;&#125;&#x27;</span> data1 data1</span><br><span class="line"><span class="comment"># data11 FNR=1 NR=1</span></span><br><span class="line"><span class="comment"># data21 FNR=2 NR=2</span></span><br><span class="line"><span class="comment"># data31 FNR=3 NR=3</span></span><br><span class="line"><span class="comment"># data11 FNR=1 NR=4</span></span><br><span class="line"><span class="comment"># data21 FNR=2 NR=5</span></span><br><span class="line"><span class="comment"># data31 FNR=3 NR=6</span></span><br><span class="line"><span class="comment"># There were 6 records processed</span></span><br></pre></td></tr></table></figure>

<p>单个文件处理时 FNR 和 NR 是一致的，多个文件处理时不一样</p>
<h4 id="User-defined-variables"><a href="#User-defined-variables" class="headerlink" title="User-defined variables"></a>User-defined variables</h4><p>gawk 自第一变量不能以数字开头，大小写敏感</p>
<h5 id="Assigning-variables-in-scripts"><a href="#Assigning-variables-in-scripts" class="headerlink" title="Assigning variables in scripts"></a>Assigning variables in scripts</h5><p>使用方式了 shell 中一致, 下面例子中我们将数字，字符赋值给变量，而且支持计算</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;             </span></span><br><span class="line"><span class="string">quote&gt; BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; testing=&quot;This is a test&quot;</span></span><br><span class="line"><span class="string">quote&gt; print testing                            </span></span><br><span class="line"><span class="string">quote&gt; testing=45        </span></span><br><span class="line"><span class="string">quote&gt; print testing                            </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># This is a test</span></span><br><span class="line"><span class="comment"># 45</span></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;x=4; x=x*2+3; print x&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 11</span></span><br></pre></td></tr></table></figure>

<h5 id="Assigning-variables-on-the-command-line"><a href="#Assigning-variables-on-the-command-line" class="headerlink" title="Assigning variables on the command line"></a>Assigning variables on the command line</h5><p>支持从终端接受参数的形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat script1               </span><br><span class="line"><span class="comment"># BEGIN&#123;FS=&quot;,&quot;&#125;</span></span><br><span class="line"><span class="comment"># &#123;print $n&#125;</span></span><br><span class="line"></span><br><span class="line">gawk -f script1 n=2 data1                                      </span><br><span class="line"><span class="comment"># data12</span></span><br><span class="line"><span class="comment"># data22</span></span><br><span class="line"><span class="comment"># data32</span></span><br><span class="line">gawk -f script1 n=3 data1</span><br><span class="line"><span class="comment"># data13</span></span><br><span class="line"><span class="comment"># data23</span></span><br><span class="line"><span class="comment"># data33</span></span><br></pre></td></tr></table></figure>

<p>开起来挺好的，但是这里有一个问题，终端传入的参数，BEGIN 里面是访问不到的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat script2                    </span><br><span class="line"><span class="comment"># BEGIN&#123;print &quot;The starting value is&quot;, n; FS=&quot;,&quot;&#125;</span></span><br><span class="line"><span class="comment"># &#123;print $n&#125;</span></span><br><span class="line"></span><br><span class="line">gawk -f script2 n=3 data1</span><br><span class="line"><span class="comment"># The starting value is </span></span><br><span class="line"><span class="comment"># data13</span></span><br><span class="line"><span class="comment"># data23</span></span><br><span class="line"><span class="comment"># data33</span></span><br></pre></td></tr></table></figure>

<p>你可以用 -v 参数解决这个问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gawk -v n=3 -f script2 data1</span><br><span class="line"><span class="comment"># The starting value is 3</span></span><br><span class="line"><span class="comment"># data13</span></span><br><span class="line"><span class="comment"># data23</span></span><br><span class="line"><span class="comment"># data33</span></span><br></pre></td></tr></table></figure>

<h3 id="Working-with-Arrays"><a href="#Working-with-Arrays" class="headerlink" title="Working with Arrays"></a>Working with Arrays</h3><p>和很多其他语言一样，gawk 提供了 array 相关的功能，叫做 associative arrays. 个人感觉可以叫做 map, 行为方式是根据键拿值</p>
<h4 id="Defining-array-variables"><a href="#Defining-array-variables" class="headerlink" title="Defining array variables"></a>Defining array variables</h4><p>格式 <code>var[index] = element</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">captial[&quot;Illinois&quot;] = &quot;Springfield&quot;</span></span><br><span class="line"><span class="string">print captial[&quot;Illinois&quot;]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Springfield</span></span><br></pre></td></tr></table></figure>

<p>对数字也有效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; var[1] = 34                         </span></span><br><span class="line"><span class="string">quote&gt; var[2] = 3                          </span></span><br><span class="line"><span class="string">quote&gt; total = var[1] + var[2]</span></span><br><span class="line"><span class="string">quote&gt; print total                              </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># 37</span></span><br></pre></td></tr></table></figure>

<h4 id="Iterating-through-array-variables"><a href="#Iterating-through-array-variables" class="headerlink" title="Iterating through array variables"></a>Iterating through array variables</h4><p>gawk 中遍历 map 的语法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (var <span class="keyword">in</span> arry)</span><br><span class="line">&#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>遍历 map 的示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; var[&quot;a&quot;] = 1                        </span></span><br><span class="line"><span class="string">quote&gt; var[&quot;g&quot;] = 2</span></span><br><span class="line"><span class="string">quote&gt; var[&quot;m&quot;] = 3</span></span><br><span class="line"><span class="string">quote&gt; var[&quot;u&quot;] = 4</span></span><br><span class="line"><span class="string">quote&gt; for (test in var)            </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; print &quot;index:&quot;, test, &quot; - value:&quot;, var[test]</span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># index: u  - value: 4</span></span><br><span class="line"><span class="comment"># index: m  - value: 3</span></span><br><span class="line"><span class="comment"># index: a  - value: 1</span></span><br><span class="line"><span class="comment"># index: g  - value: 2</span></span><br></pre></td></tr></table></figure>

<p>背后的实现和 hash 一样，不保证顺序</p>
<h4 id="Deleting-array-variables"><a href="#Deleting-array-variables" class="headerlink" title="Deleting array variables"></a>Deleting array variables</h4><p>语法：delete array[index]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">var[&quot;a&quot;] = 1</span></span><br><span class="line"><span class="string">var[&quot;g&quot;] = 2</span></span><br><span class="line"><span class="string">for (test in var)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    print &quot;Index:&quot;, test, &quot; - Value:&quot;, var[test]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">delete var[&quot;g&quot;]             </span></span><br><span class="line"><span class="string">print &quot;---&quot;                              </span></span><br><span class="line"><span class="string">for (test in var)   </span></span><br><span class="line"><span class="string">    print &quot;Index:&quot;, test, &quot; - Value:&quot;, var[test]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Index: a  - Value: 1</span></span><br><span class="line"><span class="comment"># Index: g  - Value: 2</span></span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line"><span class="comment"># Index: a  - Value: 1</span></span><br></pre></td></tr></table></figure>

<p>PS: 原来他也支持单行 for 循环吗。。。</p>
<h3 id="Using-Patterns"><a href="#Using-Patterns" class="headerlink" title="Using Patterns"></a>Using Patterns</h3><p>本章介绍如何定义 pattern</p>
<h4 id="Regular-expressions"><a href="#Regular-expressions" class="headerlink" title="Regular expressions"></a>Regular expressions</h4><p>gawk 同时支持 BRE 和 ERE，正则要保证出现在 program script 之前</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; /11/&#123;print $1&#125;&#x27;</span> data1    </span><br><span class="line"><span class="comment"># data11</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; /,d/&#123;print $1&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11</span></span><br><span class="line"><span class="comment"># data21</span></span><br><span class="line"><span class="comment"># data31</span></span><br></pre></td></tr></table></figure>

<h4 id="The-matching-operator"><a href="#The-matching-operator" class="headerlink" title="The matching operator"></a>The matching operator</h4><p>gawk 使用波浪线(~)表示匹配的动作，格式 <code>$1 ~ /^data/</code>. 下面的例子中，我们适配所有出现在 $2 这个位置上的 field， 以 data2 开头的即使我们寻在的目标</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; $2 ~ /^data2/&#123;print $0&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data21,data22,data23,data24,data25</span></span><br></pre></td></tr></table></figure>

<p>这个技巧在 gawk 中经常被用到, 下面是在 passwd 文件中寻找包含 root 关键字的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gawk -F: <span class="string">&#x27;$1 ~/root/&#123;print $1, $NF&#125;&#x27;</span> /etc/passwd               </span><br><span class="line"><span class="comment"># root /bin/sh</span></span><br><span class="line"><span class="comment"># _cvmsroot /usr/bin/false</span></span><br></pre></td></tr></table></figure>

<p>这个操作还支持取反 <code>$1 !~ /expression/</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; $2 !~ /^data2/&#123;print $0&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11,data12,data13,data14,data15</span></span><br><span class="line"><span class="comment"># data31,data32,data33,data34,data35</span></span><br></pre></td></tr></table></figure>

<h4 id="Mathematical-expressions"><a href="#Mathematical-expressions" class="headerlink" title="Mathematical expressions"></a>Mathematical expressions</h4><p>gawk 还支持直接在表达式中做计算的, 下面的例子中我们统计 group 等于 0 的用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk -F: <span class="string">&#x27;$4 == 0&#123;print $1&#125;&#x27;</span> /etc/passwd           </span><br><span class="line"><span class="comment"># root</span></span><br></pre></td></tr></table></figure>

<p>支持的算数表达式</p>
<ul>
<li>x == y: Value x is equal to y</li>
<li>x &lt;= y</li>
<li>x &lt; y</li>
<li>x &gt;=y</li>
<li>x &gt; y</li>
</ul>
<p><code>==</code> 也可以用于文字表示式，但是表示的是精确匹配</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gawk -F, <span class="string">&#x27;$1 == &quot;data&quot;&#123;print $1&#125;&#x27;</span> data1  </span><br><span class="line"><span class="comment"># no match</span></span><br><span class="line">gawk -F, <span class="string">&#x27;$1 == &quot;data11&quot;&#123;print $1&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11</span></span><br></pre></td></tr></table></figure>

<h3 id="Structured-Commands"><a href="#Structured-Commands" class="headerlink" title="Structured Commands"></a>Structured Commands</h3><p>结构化脚本</p>
<h4 id="The-if-statement"><a href="#The-if-statement" class="headerlink" title="The if statement"></a>The if statement</h4><p>支持 if-then-else 语法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition)</span><br><span class="line">    statement1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一行的格式也 OK</span></span><br><span class="line"><span class="keyword">if</span> (condition) statement1</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat data4 </span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 13</span></span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 34</span></span><br><span class="line">gawk <span class="string">&#x27;&#123;if ($1 &gt; 20) print $1&#125;&#x27;</span> data4               </span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 34</span></span><br></pre></td></tr></table></figure>

<p>如果 if 有多个条件，需要用花括号包裹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;                             </span></span><br><span class="line"><span class="string">quote&gt; if ($1 &gt; 20)             </span></span><br><span class="line"><span class="string">quote&gt; &#123; </span></span><br><span class="line"><span class="string">quote&gt; x = $1 * 2                              </span></span><br><span class="line"><span class="string">quote&gt; print x                                  </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data4</span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 68</span></span><br></pre></td></tr></table></figure>

<p>带 else 的例子</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">quote&gt; if ($1 &gt; 20)             </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; x = $1 * 2                              </span></span><br><span class="line"><span class="string">quote&gt; print x                                  </span></span><br><span class="line"><span class="string">quote&gt; &#125; else </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; x = $1 / 2                              </span></span><br><span class="line"><span class="string">quote&gt; print x                                  </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#125;&#x27;</span> data4</span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 2.5</span></span><br><span class="line"><span class="comment"># 6.5</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 68</span></span><br></pre></td></tr></table></figure>

<p>也可以写在一行, 格式 <code>if (condition) statement1; else statement2</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;if ($1 &gt; 20) print $1 * 2; else print $1 /2&#125;&#x27;</span> data4</span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 2.5</span></span><br><span class="line"><span class="comment"># 6.5</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 68</span></span><br></pre></td></tr></table></figure>

<h4 id="The-while-statement"><a href="#The-while-statement" class="headerlink" title="The while statement"></a>The while statement</h4><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (condition)</span><br><span class="line">&#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat data5 </span><br><span class="line"><span class="comment"># 130 120 135</span></span><br><span class="line"><span class="comment"># 160 113 140</span></span><br><span class="line"><span class="comment"># 145 170 215</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">total = 0</span></span><br><span class="line"><span class="string">i = 1</span></span><br><span class="line"><span class="string">while (i&lt;4)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">total += $i</span></span><br><span class="line"><span class="string">i++</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">avg = total / 3</span></span><br><span class="line"><span class="string">print &quot;Average:&quot;, avg</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data5</span><br><span class="line"><span class="comment"># Average: 128.333</span></span><br><span class="line"><span class="comment"># Average: 137.667</span></span><br><span class="line"><span class="comment"># Average: 176.667</span></span><br></pre></td></tr></table></figure>

<p>支持 break，continue 打断循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">quote&gt; total = 0      </span></span><br><span class="line"><span class="string">quote&gt; i = 1   </span></span><br><span class="line"><span class="string">quote&gt; while (i&lt;4)                                  </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt;      total += $i    </span></span><br><span class="line"><span class="string">quote&gt;      if (i == 2)              </span></span><br><span class="line"><span class="string">quote&gt;           break             </span></span><br><span class="line"><span class="string">quote&gt;      i++     </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; avg = total/2                                                          </span></span><br><span class="line"><span class="string">quote&gt; print &quot;The average of the first two data is:&quot; , avg</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data5</span><br><span class="line"><span class="comment"># The average of the first two data is: 125</span></span><br><span class="line"><span class="comment"># The average of the first two data is: 136.5</span></span><br><span class="line"><span class="comment"># The average of the first two data is: 157.5</span></span><br></pre></td></tr></table></figure>

<h4 id="The-do-while-statement"><a href="#The-do-while-statement" class="headerlink" title="The do-while statement"></a>The do-while statement</h4><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    statemnets</span><br><span class="line">&#125; <span class="keyword">while</span> (condition)</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">quote&gt; total = 0      </span></span><br><span class="line"><span class="string">quote&gt; i = 1   </span></span><br><span class="line"><span class="string">quote&gt; do                          </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; total += $i    </span></span><br><span class="line"><span class="string">quote&gt; i++     </span></span><br><span class="line"><span class="string">quote&gt; &#125; while (total &lt; 150)</span></span><br><span class="line"><span class="string">quote&gt; print total &#125;&#x27;</span> data5                     </span><br><span class="line"><span class="comment"># 250</span></span><br><span class="line"><span class="comment"># 160</span></span><br><span class="line"><span class="comment"># 315</span></span><br></pre></td></tr></table></figure>

<h4 id="The-for-statement"><a href="#The-for-statement" class="headerlink" title="The for statement"></a>The for statement</h4><p>格式 <code>for( variable assignment; condition; iteration process)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">quote&gt; total = 0      </span></span><br><span class="line"><span class="string">quote&gt; for  (i=1; i&lt;4; i++)</span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; total += $i    </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; avg = total /3                                                           </span></span><br><span class="line"><span class="string">quote&gt; print &quot;Average:&quot;, avg                    </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data5</span><br><span class="line"><span class="comment"># Average: 128.333</span></span><br><span class="line"><span class="comment"># Average: 137.667</span></span><br><span class="line"><span class="comment"># Average: 176.667</span></span><br></pre></td></tr></table></figure>

<h3 id="Formatted-Printing"><a href="#Formatted-Printing" class="headerlink" title="Formatted Printing"></a>Formatted Printing</h3><p>gawk 使用 printf 格式化输出 <code>printf &quot;format string&quot;, var1, var2...</code></p>
<p>format string 是格式化输出的关键，采用的 C 语言相同的 printf 功能。格式为 <code>%[modifier]control-letter</code></p>
<p>Format Specifier Control Letters</p>
<table>
<thead>
<tr>
<th align="left">Control Letter</th>
<th align="left">Desciption</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c</td>
<td align="left">Displays a number as an ASCII character</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">Displays an integer value</td>
</tr>
<tr>
<td align="left">i</td>
<td align="left">Displays an integer value(same as d)</td>
</tr>
<tr>
<td align="left">e</td>
<td align="left">Displays a number in scientific notation</td>
</tr>
<tr>
<td align="left">f</td>
<td align="left">Displays a floating-point value</td>
</tr>
<tr>
<td align="left">g</td>
<td align="left">Displays eigher scientific notation or floating point, whichever is shorter</td>
</tr>
<tr>
<td align="left">o</td>
<td align="left">Displays an octal value</td>
</tr>
<tr>
<td align="left">s</td>
<td align="left">Displays a text string</td>
</tr>
<tr>
<td align="left">x</td>
<td align="left">Displays a hexadecimal value</td>
</tr>
<tr>
<td align="left">X</td>
<td align="left">Displays a hexadecimal value, but using capital letters for A through F</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;                                       </span></span><br><span class="line"><span class="string">quote&gt; x = 1 * 100                              </span></span><br><span class="line"><span class="string">quote&gt; printf &quot;The answer is: %e\n&quot;, x</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># The answer is: 1.000000e+02</span></span><br></pre></td></tr></table></figure>

<p>出来上面的控制符外，printf 还提供了另外三个控制项</p>
<ul>
<li>width, 控制宽度，小于设定值，给出空格补全，大于则用实际值覆盖</li>
<li>prec, </li>
<li>-(minus sign) 强制左对齐</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;print $1, $4&#125;&#x27;</span> data2</span><br><span class="line"><span class="comment"># Riley Mullen (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell (313)555-4938</span></span><br><span class="line"></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;printf &quot;%s %s \n&quot;, $1, $4&#125;&#x27;</span> data2</span><br><span class="line"><span class="comment"># Riley Mullen (312)555-1234 </span></span><br><span class="line"><span class="comment"># Frank Williams (317)555-9876 </span></span><br><span class="line"><span class="comment"># Haley Snell (313)555-4938</span></span><br></pre></td></tr></table></figure>

<p>如果用 printf 需要自己打印换行符号，这种设定当你想讲多行数据放在一行的时候就很好使</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; &#123;printf &quot;%s &quot;, $1&#125; END&#123;printf &quot;\n&quot;&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11 data21 data31</span></span><br></pre></td></tr></table></figure>

<p>下面的例子我们通过 modifier 格式化名字这个字段</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;printf &quot;%16s %s\n &quot;, $1, $4&#125;&#x27;</span> data2</span><br><span class="line"><span class="comment">#     Riley Mullen (312)555-1234</span></span><br><span class="line"><span class="comment">#    Frank Williams (317)555-9876</span></span><br><span class="line"><span class="comment">#       Haley Snell (313)555-4938</span></span><br></pre></td></tr></table></figure>

<p>默认是右对齐的，可以使用 minus sign 来左对齐</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gawk &#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;printf &quot;%-16s %s\n &quot;, $1, $4&#125;&#x27; data2Riley Mullen     (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams   (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell      (313)555-4938</span></span><br></pre></td></tr></table></figure>

<p>格式化浮点类型</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;&#123;                                                          </span></span><br><span class="line"><span class="string">quote&gt; total = 0      </span></span><br><span class="line"><span class="string">quote&gt; for (i=0; i&lt;4; i++)          </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; total += $i    </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; avg = total / 3                                                          </span></span><br><span class="line"><span class="string">quote&gt; printf &quot;Average: %5.1f\n&quot;, avg</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data5</span><br><span class="line"><span class="comment"># Average: 171.7</span></span><br><span class="line"><span class="comment"># Average: 191.0</span></span><br><span class="line"><span class="comment"># Average: 225.0</span></span><br></pre></td></tr></table></figure>

<h3 id="Built-In-Functions"><a href="#Built-In-Functions" class="headerlink" title="Built-In Functions"></a>Built-In Functions</h3><p>gawk 提供了不少的内建函数帮助你完成一些特定功能。</p>
<h4 id="Mathematical-functions"><a href="#Mathematical-functions" class="headerlink" title="Mathematical functions"></a>Mathematical functions</h4><p>The gawk Mathematical Functions</p>
<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">atan2(x, y)</td>
<td align="left">The arctangent of x/y, with x and y specified in radians</td>
</tr>
<tr>
<td align="left">cos(x)</td>
<td align="left">The cosine of x, with x specified in radians</td>
</tr>
<tr>
<td align="left">exp(x)</td>
<td align="left">The exponential of x</td>
</tr>
<tr>
<td align="left">int(x)</td>
<td align="left">The integer part of x, truncated toward 0</td>
</tr>
<tr>
<td align="left">log(x)</td>
<td align="left">The natural logarithm of x</td>
</tr>
<tr>
<td align="left">rand()</td>
<td align="left">A random floating point value larger thant 0 and less than 1</td>
</tr>
<tr>
<td align="left">sin(x)</td>
<td align="left">The sine of x, with x specified in radians</td>
</tr>
<tr>
<td align="left">sqrt(x)</td>
<td align="left">The square root of x</td>
</tr>
<tr>
<td align="left">srand(x)</td>
<td align="left">Specifies a seed value for calculating random numbers</td>
</tr>
</tbody></table>
<p>gawk 是有计算上线的，比如 exp(1000) 就会抛错</p>
<p>gawk 还提供了位运算</p>
<ul>
<li>and(v1, v2)</li>
<li>compl(val) 补全</li>
<li>lshift(val, count) 左移</li>
<li>or(v1, v2)</li>
<li>rshift(val, count)</li>
<li>xor(v1, v2) 异或</li>
</ul>
<h4 id="String-functions"><a href="#String-functions" class="headerlink" title="String functions"></a>String functions</h4><p>支持一些常规的字符操作，比如排序，截取，匹配，分割等</p>
<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">split(s, r [,a])</td>
<td align="left">This function splits s into array a using the FS character, or the regular expression r if supplied. It returns the number of fields</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;x=&quot;testing&quot;; print toupper(x); print length(x)&#125;&#x27;</span></span><br><span class="line"><span class="comment"># TESTING</span></span><br><span class="line"><span class="comment"># 7</span></span><br></pre></td></tr></table></figure>

<p>sort 比较复杂, 下面的 asort 例子中，我们将原始 map 和输出结果 test 传给 asort 然后遍历打印 test. 打印时可以看到，原来的字母 index 被替换成了数字</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">var[&quot;a&quot;] = 1</span></span><br><span class="line"><span class="string">var[&quot;g&quot;] = 2</span></span><br><span class="line"><span class="string">var[&quot;m&quot;] = 3</span></span><br><span class="line"><span class="string">var[&quot;u&quot;] = 4</span></span><br><span class="line"><span class="string">asort(var, test)</span></span><br><span class="line"><span class="string">for (i in test)</span></span><br><span class="line"><span class="string">print &quot;Index:&quot;, i, &quot; - value:&quot;, test[i]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># Index: 1  - value: 1</span></span><br><span class="line"><span class="comment"># Index: 2  - value: 2</span></span><br><span class="line"><span class="comment"># Index: 3  - value: 3</span></span><br><span class="line"><span class="comment"># Index: 4  - value: 4</span></span><br></pre></td></tr></table></figure>

<p>下面是 split 的测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat data1</span><br><span class="line"><span class="comment"># data11,data12,data13,data14,data15</span></span><br><span class="line"><span class="comment"># data21,data22,data23,data24,data25</span></span><br><span class="line"><span class="comment"># data31,data32,data33,data34,data35</span></span><br><span class="line">gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125;&#123;</span></span><br><span class="line"><span class="string">split($0, var)</span></span><br><span class="line"><span class="string">    print var[1], var[5]                     </span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data1</span><br><span class="line"><span class="comment"># data11 data15</span></span><br><span class="line"><span class="comment"># data21 data25</span></span><br><span class="line"><span class="comment"># data31 data35</span></span><br></pre></td></tr></table></figure>

<h4 id="Time-functions"><a href="#Time-functions" class="headerlink" title="Time functions"></a>Time functions</h4><table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mktime(datespec)</td>
<td align="left">Converts a date specified in the format YYYY NN DD HH MM SS[DST] into a timestamp value</td>
</tr>
<tr>
<td align="left">strftime(format[,timestamp])</td>
<td align="left">Formats either the current time of day timestamp, or timestamp if provided, into a formatted data and date, using the date() shell function format</td>
</tr>
<tr>
<td align="left">systime()</td>
<td align="left">Returns the timestamp for the current time of day</td>
</tr>
</tbody></table>
<p>时间函数在处理带时间相关的 log 文件时很有用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;BEGIN&#123;        </span></span><br><span class="line"><span class="string">quote&gt; date = systime()            </span></span><br><span class="line"><span class="string">quote&gt; day = strftime(&quot;%A, %B %d, %Y&quot;, date)</span></span><br><span class="line"><span class="string">quote&gt; print day                                </span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># Tuesday, June 15, 2021</span></span><br></pre></td></tr></table></figure>

<h3 id="User-Defined-Functions"><a href="#User-Defined-Functions" class="headerlink" title="User-Defined Functions"></a>User-Defined Functions</h3><h4 id="Defining-a-function"><a href="#Defining-a-function" class="headerlink" title="Defining a function"></a>Defining a function</h4><p>语法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> name([variables])</span><br><span class="line">&#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> printthird()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="variable">$3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>允许返回值 <code>return value</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> myrand(<span class="built_in">limit</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> int(<span class="built_in">limit</span> * rand())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Using-your-functions"><a href="#Using-your-functions" class="headerlink" title="Using your functions"></a>Using your functions</h4><p>当你定义一个函数的时候，它必须在最开始部分(before BEGIN).</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gawk <span class="string">&#x27;      </span></span><br><span class="line"><span class="string">quote&gt; function myprint()                 </span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; printf &quot;%-16s - %s\n&quot;, $1, $4                                          </span></span><br><span class="line"><span class="string">quote&gt; &#125;</span></span><br><span class="line"><span class="string">quote&gt; BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125;</span></span><br><span class="line"><span class="string">quote&gt; &#123;</span></span><br><span class="line"><span class="string">quote&gt; myprint()</span></span><br><span class="line"><span class="string">quote&gt; &#125;&#x27;</span> data2</span><br><span class="line"><span class="comment"># Riley Mullen     - (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams   - (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell      - (313)555-4938</span></span><br></pre></td></tr></table></figure>

<h4 id="Creating-a-function-library"><a href="#Creating-a-function-library" class="headerlink" title="Creating a function library"></a>Creating a function library</h4><ol>
<li>为自定义还是创建库</li>
<li>将 gawk 脚本也存到文件中</li>
<li>在终端同时调用两个脚本</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat funclib </span><br><span class="line"><span class="comment"># function myprint()</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     printf &quot;%-16s - %s\n&quot;, $1, $4</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># function myrand(limit)</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     return int(limit * rand())</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># function printthird()</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     print $3</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">cat script4</span><br><span class="line"><span class="comment"># BEGIN&#123; FS=&quot;\n&quot;; RS=&quot;&quot;&#125;</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     myprint()</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">gawk -f funclib -f script4 data2         </span><br><span class="line"><span class="comment"># Riley Mullen     - (312)555-1234</span></span><br><span class="line"><span class="comment"># Frank Williams   - (317)555-9876</span></span><br><span class="line"><span class="comment"># Haley Snell      - (313)555-4938</span></span><br></pre></td></tr></table></figure>

<h3 id="Working-through-a-Practical-Example"><a href="#Working-through-a-Practical-Example" class="headerlink" title="Working through a Practical Example"></a>Working through a Practical Example</h3><p>When work with data files, the key is to first group related data records together and then perform any calculations required on the related data.</p>
<p>下面是一个保龄球得分统计的例子, 每一行分别包含 名字，组名，得分 的信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat scores.txt </span><br><span class="line"><span class="comment"># Rich Blum,team1,100,115,95</span></span><br><span class="line"><span class="comment"># Barbara Blum,team1,110,115,100</span></span><br><span class="line"><span class="comment"># Christine Bresnahan,team2,120,115,118</span></span><br><span class="line"><span class="comment"># Tim Bresnahan,team2,125,112,116</span></span><br></pre></td></tr></table></figure>

<p>目标：统计每个 team 的总分以及平均分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat bowling.sh                               </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> team <span class="keyword">in</span> $(gawk -F, <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> scores.txt | uniq)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    gawk -v team=<span class="variable">$team</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">    BEGIN&#123; FS=&quot;,&quot;; total=0 &#125;</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        if ($2==team)</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            total += $3 + $4 + $5;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    END &#123;</span></span><br><span class="line"><span class="string">        avg = total/6;</span></span><br><span class="line"><span class="string">        print &quot;Total for&quot;, team, &quot;is&quot;, total, &quot;, the average is&quot;,avg</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &#x27;</span> scores.txt</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./bowling.sh </span><br><span class="line"><span class="comment"># Total for team1 is 635 , the average is 105.833</span></span><br><span class="line"><span class="comment"># Total for team2 is 706 , the average is 117.667</span></span><br></pre></td></tr></table></figure>

<p>计算方法：先遍历文件，取得所有的组名，然后再每个组名遍历一遍文件统计一次，打印一次。一开始我还以为可以一次对结果做分类统计的，如果是每次循环的话，还是很容易理解的</p>
<h2 id="Working-with-Alternative-Shells"><a href="#Working-with-Alternative-Shells" class="headerlink" title="Working with Alternative Shells"></a>Working with Alternative Shells</h2><p>介绍除 bash 外其他一些常见的 shell, 暂时不关心，pass</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Jack Zheng
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://jack-zheng.github.io/hexo/2021/06/05/LSCASSB-partiii-advanced-shell-scripting/" title="Linux命令行与shell脚本编程大全 第三章 Shell 高级用法">https://jack-zheng.github.io/hexo/2021/06/05/LSCASSB-partiii-advanced-shell-scripting/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/hexo/tags/Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8-3rd/" rel="tag"># Linux命令行与shell脚本编程大全 3rd</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/hexo/2021/05/31/LSCASSB-parti-the-linux-command-line/" rel="next" title="Linux命令行与shell脚本编程大全 第一章 Linux 命令行">
                  <i class="fa fa-chevron-left"></i> Linux命令行与shell脚本编程大全 第一章 Linux 命令行
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/hexo/2021/06/14/Java-web-practice/" rel="prev" title="Java web practice">
                  Java web practice <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-Functions"><span class="nav-number">1.</span> <span class="nav-text">Creating Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Basic-Script-Functions"><span class="nav-number">1.1.</span> <span class="nav-text">Basic Script Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-a-function"><span class="nav-number">1.1.1.</span> <span class="nav-text">Creating a function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-functions"><span class="nav-number">1.1.2.</span> <span class="nav-text">Using functions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Returning-a-Value"><span class="nav-number">1.2.</span> <span class="nav-text">Returning a Value</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-default-exit-status"><span class="nav-number">1.2.1.</span> <span class="nav-text">The default exit status</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-the-return-command"><span class="nav-number">1.2.2.</span> <span class="nav-text">Using the return command</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-function-output"><span class="nav-number">1.2.3.</span> <span class="nav-text">Using function output</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Variables-in-Functions"><span class="nav-number">1.3.</span> <span class="nav-text">Using Variables in Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Passing-parameters-to-a-function"><span class="nav-number">1.3.1.</span> <span class="nav-text">Passing parameters to a function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Handling-variables-in-a-function"><span class="nav-number">1.3.2.</span> <span class="nav-text">Handling variables in a function</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Array-Variables-and-Functions"><span class="nav-number">1.4.</span> <span class="nav-text">Array Variables and Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Passing-arrays-to-functions"><span class="nav-number">1.4.1.</span> <span class="nav-text">Passing arrays to functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Return-arrays-from-functions"><span class="nav-number">1.4.2.</span> <span class="nav-text">Return arrays from functions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Function-Recursion"><span class="nav-number">1.5.</span> <span class="nav-text">Function Recursion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-Library"><span class="nav-number">1.6.</span> <span class="nav-text">Creating a Library</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Functions-on-the-Command-Line"><span class="nav-number">1.7.</span> <span class="nav-text">Using Functions on the Command Line</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-functions-on-the-command-line"><span class="nav-number">1.7.1.</span> <span class="nav-text">Creating functions on the command line</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Defining-functions-in-the-bashrc-file"><span class="nav-number">1.7.2.</span> <span class="nav-text">Defining functions in the .bashrc file</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Following-a-Practical-Example"><span class="nav-number">1.8.</span> <span class="nav-text">Following a Practical Example</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter-18-Writing-Scripts-for-Graphical-Desktops"><span class="nav-number">2.</span> <span class="nav-text">Chapter 18: Writing Scripts for Graphical Desktops</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter-19-Introducing-sed-and-gawk"><span class="nav-number">3.</span> <span class="nav-text">Chapter 19: Introducing sed and gawk</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Manipulating-Text"><span class="nav-number">3.1.</span> <span class="nav-text">Manipulating Text</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Getting-to-know-the-sed-editor"><span class="nav-number">3.1.1.</span> <span class="nav-text">Getting to know the sed editor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Defining-an-editor-command-int-the-command-line"><span class="nav-number">3.1.2.</span> <span class="nav-text">Defining an editor command int the command line</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-mulitple-editor-commands-int-the-command-line"><span class="nav-number">3.1.3.</span> <span class="nav-text">Using mulitple editor commands int the command line</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reading-editor-commands-from-a-file"><span class="nav-number">3.1.4.</span> <span class="nav-text">Reading editor commands from a file</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Getting-to-know-the-gawk-program"><span class="nav-number">3.1.5.</span> <span class="nav-text">Getting to know the gawk program</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Visiting-the-gawk-command-format"><span class="nav-number">3.1.6.</span> <span class="nav-text">Visiting the gawk command format</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reading-the-program-script-from-the-command-line"><span class="nav-number">3.1.7.</span> <span class="nav-text">Reading the program script from the command line</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-multiple-commands-in-the-program-script"><span class="nav-number">3.1.8.</span> <span class="nav-text">Using multiple commands in the program script</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reading-the-program-from-a-file"><span class="nav-number">3.1.9.</span> <span class="nav-text">Reading the program from a file</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Running-scripts-before-processing-data"><span class="nav-number">3.1.10.</span> <span class="nav-text">Running scripts before processing data</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Running-scripts-after-processing-data"><span class="nav-number">3.1.11.</span> <span class="nav-text">Running scripts after processing data</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Commanding-at-the-sed-Editor-Basics"><span class="nav-number">3.2.</span> <span class="nav-text">Commanding at the sed Editor Basics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Introducing-more-substitution-options"><span class="nav-number">3.2.1.</span> <span class="nav-text">Introducing more substitution options</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Substituting-flags"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">Substituting flags</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replacing-characters"><span class="nav-number">3.2.1.2.</span> <span class="nav-text">Replacing characters</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-addresses"><span class="nav-number">3.2.2.</span> <span class="nav-text">Using addresses</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Addressing-the-numberic-line"><span class="nav-number">3.2.2.1.</span> <span class="nav-text">Addressing the numberic line</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-text-pattern-filters"><span class="nav-number">3.2.2.2.</span> <span class="nav-text">Using text pattern filters</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Grouping-commands"><span class="nav-number">3.2.2.3.</span> <span class="nav-text">Grouping commands</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Deleting-lines"><span class="nav-number">3.2.2.4.</span> <span class="nav-text">Deleting lines</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Inserting-and-appending-text"><span class="nav-number">3.2.2.5.</span> <span class="nav-text">Inserting and appending text</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Changing-lines"><span class="nav-number">3.2.2.6.</span> <span class="nav-text">Changing lines</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Transforming-characters"><span class="nav-number">3.2.2.7.</span> <span class="nav-text">Transforming characters</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Printing-revisited"><span class="nav-number">3.2.2.8.</span> <span class="nav-text">Printing revisited</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-files-with-sed"><span class="nav-number">3.2.3.</span> <span class="nav-text">Using files with sed</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Writing-to-a-file"><span class="nav-number">3.2.3.1.</span> <span class="nav-text">Writing to a file</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Reading-data-from-a-file"><span class="nav-number">3.2.3.2.</span> <span class="nav-text">Reading data from a file</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter-20-Regular-Expressions"><span class="nav-number">4.</span> <span class="nav-text">Chapter 20: Regular Expressions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What-Are-Regular-Expressions"><span class="nav-number">4.1.</span> <span class="nav-text">What Are Regular Expressions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-definition"><span class="nav-number">4.1.1.</span> <span class="nav-text">A definition</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Types-of-regular-expressions"><span class="nav-number">4.1.2.</span> <span class="nav-text">Types of regular expressions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Defining-BRE-Patterns"><span class="nav-number">4.2.</span> <span class="nav-text">Defining BRE Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Plain-text"><span class="nav-number">4.2.1.</span> <span class="nav-text">Plain text</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Special-characters"><span class="nav-number">4.2.2.</span> <span class="nav-text">Special characters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Anchor-characters"><span class="nav-number">4.2.3.</span> <span class="nav-text">Anchor characters</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Starting-at-the-beginning"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">Starting at the beginning</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Looking-for-the-ending"><span class="nav-number">4.2.3.2.</span> <span class="nav-text">Looking for the ending</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-dot-character"><span class="nav-number">4.2.4.</span> <span class="nav-text">The dot character</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Character-classes"><span class="nav-number">4.2.5.</span> <span class="nav-text">Character classes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Negating-character-classes"><span class="nav-number">4.2.6.</span> <span class="nav-text">Negating character classes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-ranges"><span class="nav-number">4.2.7.</span> <span class="nav-text">Using ranges</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Special-character-classes"><span class="nav-number">4.2.8.</span> <span class="nav-text">Special character classes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-asterisk"><span class="nav-number">4.2.9.</span> <span class="nav-text">The asterisk</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Extended-Regular-Expressions"><span class="nav-number">4.3.</span> <span class="nav-text">Extended Regular Expressions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-question-mark"><span class="nav-number">4.3.1.</span> <span class="nav-text">The question mark</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-plus-sign"><span class="nav-number">4.3.2.</span> <span class="nav-text">The plus sign</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-braces"><span class="nav-number">4.3.3.</span> <span class="nav-text">Using braces</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-pipe-symbol"><span class="nav-number">4.3.4.</span> <span class="nav-text">The pipe symbol</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Grouping-expressions"><span class="nav-number">4.3.5.</span> <span class="nav-text">Grouping expressions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Regular-Expressions-in-Action"><span class="nav-number">4.4.</span> <span class="nav-text">Regular Expressions in Action</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Counting-directory-files"><span class="nav-number">4.4.1.</span> <span class="nav-text">Counting directory files</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Validating-a-phone-number"><span class="nav-number">4.4.2.</span> <span class="nav-text">Validating a phone number</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Parsing-an-e-mail-address"><span class="nav-number">4.4.3.</span> <span class="nav-text">Parsing an e-mail address</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-sed"><span class="nav-number">5.</span> <span class="nav-text">Advanced sed</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Looking-at-Multiline-Commands"><span class="nav-number">5.1.</span> <span class="nav-text">Looking at Multiline Commands</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Navigating-the-next-command"><span class="nav-number">5.1.1.</span> <span class="nav-text">Navigating the next command</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-the-single-line-next-command"><span class="nav-number">5.1.1.1.</span> <span class="nav-text">Using the single-line next command</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Combining-lines-of-text"><span class="nav-number">5.1.1.2.</span> <span class="nav-text">Combining lines of text</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Navigating-the-multiline-delete-command"><span class="nav-number">5.1.2.</span> <span class="nav-text">Navigating the multiline delete command</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Navigating-the-multiline-print-command"><span class="nav-number">5.1.3.</span> <span class="nav-text">Navigating the multiline print command</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Holding-Space"><span class="nav-number">5.2.</span> <span class="nav-text">Holding Space</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Negating-a-Command"><span class="nav-number">5.3.</span> <span class="nav-text">Negating a Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Changing-the-Flow"><span class="nav-number">5.4.</span> <span class="nav-text">Changing the Flow</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Branching"><span class="nav-number">5.4.1.</span> <span class="nav-text">Branching</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Testing"><span class="nav-number">5.4.2.</span> <span class="nav-text">Testing</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Replacing-via-a-Pattern"><span class="nav-number">5.5.</span> <span class="nav-text">Replacing via a Pattern</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-the-ampersand"><span class="nav-number">5.5.1.</span> <span class="nav-text">Using the ampersand</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Replacing-individual-words"><span class="nav-number">5.5.2.</span> <span class="nav-text">Replacing individual words</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Placing-sed-Commands-in-Script"><span class="nav-number">5.6.</span> <span class="nav-text">Placing sed Commands in Script</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-wrappers"><span class="nav-number">5.6.1.</span> <span class="nav-text">Using wrappers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Redirecting-sed-output"><span class="nav-number">5.6.2.</span> <span class="nav-text">Redirecting sed output</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-sed-Utilities"><span class="nav-number">5.7.</span> <span class="nav-text">Creating sed Utilities</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spacing-with-double-lines"><span class="nav-number">5.7.1.</span> <span class="nav-text">Spacing with double lines</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spacing-files-that-may-have-blanks"><span class="nav-number">5.7.2.</span> <span class="nav-text">Spacing files that may have blanks</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Numbering-lines-in-a-file"><span class="nav-number">5.7.3.</span> <span class="nav-text">Numbering lines in a file</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Printing-last-lines"><span class="nav-number">5.7.4.</span> <span class="nav-text">Printing last lines</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Deleting-lines-1"><span class="nav-number">5.7.5.</span> <span class="nav-text">Deleting lines</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Deleting-consecutive-blank-lines"><span class="nav-number">5.7.5.1.</span> <span class="nav-text">Deleting consecutive blank lines</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Deleting-leading-blank-lines"><span class="nav-number">5.7.5.2.</span> <span class="nav-text">Deleting leading blank lines</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Deleting-trailing-blank-lines"><span class="nav-number">5.7.5.3.</span> <span class="nav-text">Deleting trailing blank lines</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Removing-HTML-tags"><span class="nav-number">5.7.6.</span> <span class="nav-text">Removing HTML tags</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter-22-Advanced-gawk"><span class="nav-number">6.</span> <span class="nav-text">Chapter 22: Advanced gawk</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Variables"><span class="nav-number">6.1.</span> <span class="nav-text">Using Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Built-in-variables"><span class="nav-number">6.1.1.</span> <span class="nav-text">Built-in variables</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#The-field-and-record-separator-variables"><span class="nav-number">6.1.1.1.</span> <span class="nav-text">The field and record separator variables</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Data-variables"><span class="nav-number">6.1.1.2.</span> <span class="nav-text">Data variables</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#User-defined-variables"><span class="nav-number">6.1.2.</span> <span class="nav-text">User-defined variables</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Assigning-variables-in-scripts"><span class="nav-number">6.1.2.1.</span> <span class="nav-text">Assigning variables in scripts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Assigning-variables-on-the-command-line"><span class="nav-number">6.1.2.2.</span> <span class="nav-text">Assigning variables on the command line</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-Arrays"><span class="nav-number">6.2.</span> <span class="nav-text">Working with Arrays</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Defining-array-variables"><span class="nav-number">6.2.1.</span> <span class="nav-text">Defining array variables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Iterating-through-array-variables"><span class="nav-number">6.2.2.</span> <span class="nav-text">Iterating through array variables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Deleting-array-variables"><span class="nav-number">6.2.3.</span> <span class="nav-text">Deleting array variables</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Patterns"><span class="nav-number">6.3.</span> <span class="nav-text">Using Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Regular-expressions"><span class="nav-number">6.3.1.</span> <span class="nav-text">Regular expressions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-matching-operator"><span class="nav-number">6.3.2.</span> <span class="nav-text">The matching operator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mathematical-expressions"><span class="nav-number">6.3.3.</span> <span class="nav-text">Mathematical expressions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Structured-Commands"><span class="nav-number">6.4.</span> <span class="nav-text">Structured Commands</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-if-statement"><span class="nav-number">6.4.1.</span> <span class="nav-text">The if statement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-while-statement"><span class="nav-number">6.4.2.</span> <span class="nav-text">The while statement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-do-while-statement"><span class="nav-number">6.4.3.</span> <span class="nav-text">The do-while statement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-for-statement"><span class="nav-number">6.4.4.</span> <span class="nav-text">The for statement</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Formatted-Printing"><span class="nav-number">6.5.</span> <span class="nav-text">Formatted Printing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Built-In-Functions"><span class="nav-number">6.6.</span> <span class="nav-text">Built-In Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mathematical-functions"><span class="nav-number">6.6.1.</span> <span class="nav-text">Mathematical functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#String-functions"><span class="nav-number">6.6.2.</span> <span class="nav-text">String functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Time-functions"><span class="nav-number">6.6.3.</span> <span class="nav-text">Time functions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#User-Defined-Functions"><span class="nav-number">6.7.</span> <span class="nav-text">User-Defined Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Defining-a-function"><span class="nav-number">6.7.1.</span> <span class="nav-text">Defining a function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-your-functions"><span class="nav-number">6.7.2.</span> <span class="nav-text">Using your functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-a-function-library"><span class="nav-number">6.7.3.</span> <span class="nav-text">Creating a function library</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-through-a-Practical-Example"><span class="nav-number">6.8.</span> <span class="nav-text">Working through a Practical Example</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Working-with-Alternative-Shells"><span class="nav-number">7.</span> <span class="nav-text">Working with Alternative Shells</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jack Zheng"
      src="/hexo/images/jack.jpg">
  <p class="site-author-name" itemprop="name">Jack Zheng</p>
  <div class="site-description" itemprop="description">我是张江搬砖小码农, 知识搬运工</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hexo/archives/">
        
          <span class="site-state-item-count">196</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hexo/categories/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/hexo/tags/">
          
        <span class="site-state-item-count">178</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Zheng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">15:50</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v5.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/hexo/lib/anime.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.ui.min.js"></script>

<script src="/hexo/js/utils.js"></script>

<script src="/hexo/js/motion.js"></script>


<script src="/hexo/js/schemes/muse.js"></script>


<script src="/hexo/js/next-boot.js"></script>




  




  
<script src="/hexo/js/local-search.js"></script>














  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'd444c814810f7e73ee3a',
      clientSecret: '9b3c417a0c1076887b3cf583c7d7a27456b708ef',
      repo: 'hexo-comments',
      owner: 'jack-zheng',
      admin: ['jack-zheng'],
      id: '4e8bd0134d05ba02b35c28df7d209b21',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

</body>
</html>
