<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/hexo/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hexo/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hexo/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/hexo/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="UgODgWVmvTsdD--vjodDR3tPUZRWM3i7JpHzbYejxUM">

<link rel="stylesheet" href="/hexo/css/main.css">


<link rel="stylesheet" href="/hexo/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hexo/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Linux命令行与shell脚本编程大全 3rd 第二部分命令实验记录 Chapter 11: Basic Script buildingUsing Multiple Commands使用分号分隔命令 12345date ; who# Mon May 24 12:36:11 CST 2021# i306454  console  May 24 11:18 # i306454  ttys000  M">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux命令行与shell脚本编程大全 第二章 Shell 脚本基础知识">
<meta property="og:url" content="https://jack-zheng.github.io/hexo/2021/05/24/LSCASSB-partii-shell-scripting-basics/index.html">
<meta property="og:site_name" content="Jackpot">
<meta property="og:description" content="Linux命令行与shell脚本编程大全 3rd 第二部分命令实验记录 Chapter 11: Basic Script buildingUsing Multiple Commands使用分号分隔命令 12345date ; who# Mon May 24 12:36:11 CST 2021# i306454  console  May 24 11:18 # i306454  ttys000  M">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-05-24T03:04:47.000Z">
<meta property="article:modified_time" content="2021-06-09T11:57:54.684Z">
<meta property="article:author" content="Jack Zheng">
<meta property="article:tag" content="Linux命令行与shell脚本编程大全 3rd">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jack-zheng.github.io/hexo/2021/05/24/LSCASSB-partii-shell-scripting-basics/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Linux命令行与shell脚本编程大全 第二章 Shell 脚本基础知识 | Jackpot</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/hexo/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jackpot</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-tags">

    <a href="/hexo/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/hexo/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hexo/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/jack-zheng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2021/05/24/LSCASSB-partii-shell-scripting-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux命令行与shell脚本编程大全 第二章 Shell 脚本基础知识
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-24 11:04:47" itemprop="dateCreated datePublished" datetime="2021-05-24T11:04:47+08:00">2021-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-09 19:57:54" itemprop="dateModified" datetime="2021-06-09T19:57:54+08:00">2021-06-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Shell</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>62k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>56 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Linux命令行与shell脚本编程大全 3rd 第二部分命令实验记录</p>
<h2 id="Chapter-11-Basic-Script-building"><a href="#Chapter-11-Basic-Script-building" class="headerlink" title="Chapter 11: Basic Script building"></a>Chapter 11: Basic Script building</h2><h3 id="Using-Multiple-Commands"><a href="#Using-Multiple-Commands" class="headerlink" title="Using Multiple Commands"></a>Using Multiple Commands</h3><p>使用分号分隔命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">date ; who</span><br><span class="line"><span class="comment"># Mon May 24 12:36:11 CST 2021</span></span><br><span class="line"><span class="comment"># i306454  console  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys003  May 24 11:33</span></span><br></pre></td></tr></table></figure>

<h3 id="Creating-a-Script-File"><a href="#Creating-a-Script-File" class="headerlink" title="Creating a Script File"></a>Creating a Script File</h3><ol>
<li>新建文件 mysh.sh</li>
<li>填入内容</li>
<li>设置环境</li>
<li>运行</li>
</ol>
<blockquote>
<p>However, the fi rst line of a shell script fi le is a special case, and the pound sign followed by the exclamation point tells the shell what shell to run the script under<br>Shell script 的第一行表示你想要用哪个 Shell 运行你的脚本</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># This scri displays the date and who&#x27;s logged on</span></span><br><span class="line">date</span><br><span class="line">who</span><br></pre></td></tr></table></figure>

<p>尝试运行 <code>mysh.sh</code>，运行失败 <code>bash: mysh.sh: command not found</code></p>
<p>这是你有两种选择</p>
<ol>
<li>将包含脚本的目录添加到 PATH 中，eg: <code>export PATH=$PATH:path_to_folder</code></li>
<li>使用相对或绝对路径调用脚本, eg: <code>./mysh.sh</code></li>
</ol>
<p>PS: 发现直接用 <code>sh mysh.sh</code> 即可，还省去了赋权的操作</p>
<p>这里直接使用相对路径调用 <code>./mysh.sh</code>, 运行失败 <code>bash: ./mysh.sh: Permission denied</code>。通过 <code>ls -l mysh.sh</code> 查看权限, 发现并没有权限，然后赋权,再次尝试，运行成功。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls -l mysh.sh </span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  70 May 24 12:40 mysh.sh</span></span><br><span class="line"></span><br><span class="line">chmod u+x mysh.sh </span><br><span class="line">./mysh.sh </span><br><span class="line"><span class="comment"># Mon May 24 13:11:37 CST 2021</span></span><br><span class="line"><span class="comment"># i306454  console  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 24 11:18</span></span><br></pre></td></tr></table></figure>

<h3 id="Displaying-Messages"><a href="#Displaying-Messages" class="headerlink" title="Displaying Messages"></a>Displaying Messages</h3><p>使用 <code>echo</code> 打印信息</p>
<ul>
<li>当输出内容中没有什么特殊符号时，可以直接在 echo 后面接你要的内容</li>
<li>当输出内容中包含单/双引号时，需要将 echo 的内容包含在 双/单引号中</li>
<li>默认 echo 是会换行的，使用 <code>echo -n xxx</code> 取消换行</li>
</ul>
<h3 id="Using-Variables"><a href="#Using-Variables" class="headerlink" title="Using Variables"></a>Using Variables</h3><p><code>set</code>: 打印当前环境的所有环境变量, 输出内容包括 PATH，HOME 等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="comment"># ANT_HOME=/Users/i306454/SAPDevelop/tools/apache-ant-1.8.4</span></span><br><span class="line"><span class="comment"># BASH=/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># BASHOPTS=checkwinsize:cmdhist:complete_fullquote:expand_aliases:extquote:force_fignore:globasciiranges:hostcomplete:interactive_comments:progcomp:promptvars:sourcepath</span></span><br><span class="line"><span class="comment"># BASH_ALIASES=()</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>在你的 sh 脚本中，可以调用这些变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;User info for userid <span class="variable">$USER</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> UID: <span class="variable">$UID</span></span><br><span class="line"><span class="built_in">echo</span> HOME: <span class="variable">$HOME</span></span><br><span class="line"></span><br><span class="line">sh test_var.sh </span><br><span class="line"><span class="comment"># User info for userid i306454</span></span><br><span class="line"><span class="comment"># UID: 501</span></span><br><span class="line"><span class="comment"># HOME: /Users/i306454</span></span><br></pre></td></tr></table></figure>

<p>当你在输出语句中想要打印 <code>$</code> 这个特殊字符时，只需要在前面加斜杠</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This book cost <span class="variable">$15</span>&quot;</span></span><br><span class="line"><span class="comment"># This book cost 5</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This book cost \$15&quot;</span></span><br><span class="line"><span class="comment"># This book cost $15</span></span><br></pre></td></tr></table></figure>

<p>PS: <code>$&#123;variable&#125;</code> 也是合法的，这种声明起到强调变量名的作用</p>
<p>变量名限制：最多 20 个字符，可以是英文，数组或者下划线，区分大小写。使用等号链接，中间<strong>不允许</strong>有空格</p>
<blockquote>
<p>Command substitution</p>
</blockquote>
<p>你可以通过一下方式将 cmd 输出的值赋给你的变量</p>
<ol>
<li><code>`</code> 反引号符(backtick character)</li>
<li><code>$()</code> 表达式</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tdate=`date`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tdate</span></span><br><span class="line"><span class="comment"># Mon May 24 15:46:51 CST 2021</span></span><br><span class="line">tdate2=$(date)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tdate2</span></span><br><span class="line"><span class="comment"># Mon May 24 15:47:39 CST 2021</span></span><br></pre></td></tr></table></figure>

<p>这只是初级用法，更骚的操作是将输出定制之后用作后续命令的输出，比如下面这个例子，将文件夹下的所有目录写进 log 文件，并用时间戳做后缀 <code>today=$(date +%y%m%d); ls -al /usr/bin &gt; log.$today</code></p>
<p><strong>Caution:</strong> Command substitution creates what’s called a subshell to run the enclosed command. A subshell is a separate child shell generated from the shell that’s running the script. Because of that, any variables you create in the script aren’t available to the subshell command.</p>
<p>Command substitution 这种使用方法会创建一个子 shell 计算变量值，子 shell 运行的时候是看不到你外面的 shell 中定义的变量的</p>
<h3 id="Redirecting-Input-and-Output"><a href="#Redirecting-Input-and-Output" class="headerlink" title="Redirecting Input and Output"></a>Redirecting Input and Output</h3><blockquote>
<p>Output redirection</p>
</blockquote>
<p>可以使用大于号(greater-than symbol)将输出导入文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">date &gt; test6</span><br><span class="line">ls -l test6</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  29 May 24 18:31 test6</span></span><br><span class="line">cat test6</span><br><span class="line"><span class="comment"># Mon May 24 18:31:40 CST 2021</span></span><br></pre></td></tr></table></figure>

<p>如果文件已经存在，则覆盖原有内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">who &gt; test6</span><br><span class="line">cat test6</span><br><span class="line"><span class="comment"># i306454  console  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys003  May 24 18:00</span></span><br></pre></td></tr></table></figure>

<p>使用两个大于号(double greater-than symbol)来做 append 操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date &gt;&gt; test6</span><br><span class="line">cat test6</span><br><span class="line"><span class="comment"># i306454  console  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 24 11:18 </span></span><br><span class="line"><span class="comment"># i306454  ttys003  May 24 18:00 </span></span><br><span class="line"><span class="comment"># Mon May 24 18:35:12 CST 2021</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Input redirection</p>
</blockquote>
<p>使用小于号(less-htan symbol)将文件中的内容导入输入流 <code>command &lt; inputfile</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wc &lt; test6</span><br><span class="line"><span class="comment">#    4      21     125</span></span><br><span class="line"><span class="comment"># wc: show lines, words and bytes of input</span></span><br></pre></td></tr></table></figure>

<p>除了从文件导入，从命令行直接导入多行也是可行的，术语叫做 <code>inline input redirection</code>。这个之前在之前阿里云 setup 环境的时候操作过的。使用两个小于号(&lt;&lt;) + 起止描述符实现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wc &lt;&lt; EOF</span><br><span class="line">&gt; <span class="built_in">test</span> String 1</span><br><span class="line">&gt; <span class="built_in">test</span> String 2</span><br><span class="line">&gt; <span class="built_in">test</span> String 3</span><br><span class="line">&gt; EOF</span><br><span class="line"><span class="comment"># 3       9      42</span></span><br></pre></td></tr></table></figure>

<h3 id="Pipes"><a href="#Pipes" class="headerlink" title="Pipes"></a>Pipes</h3><p>使用方式 <code>command1 | command2</code></p>
<blockquote>
<p>Don’t think of piping as running two commands back to back. The Linux system actually runs both commands at the same time, linking them together internally in the system. As the fi rst command produces output, it’s sent immediately to the second command. No inter-mediate fi les or buffer areas are used to transfer the data.<br>pipe 中的命令是同时执行的，变量传递不涉及到中间变量</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls </span><br><span class="line"><span class="comment"># input.txt       mysh.sh         output.txt      test_echo.sh</span></span><br><span class="line"><span class="comment"># log.210524      out.txt         test6           test_var.sh</span></span><br><span class="line">ls | sort</span><br><span class="line"><span class="comment"># input.txt</span></span><br><span class="line"><span class="comment"># log.210524</span></span><br><span class="line"><span class="comment"># mysh.sh</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>pipe 可以无限级联 <code>cmd1 | cmd2 | cmd3 | ...</code></p>
<h3 id="Performing-Math"><a href="#Performing-Math" class="headerlink" title="Performing Math"></a>Performing Math</h3><p>Bash 中提供了两种方式进行计算</p>
<blockquote>
<p>The expr command</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expr 1 + 5</span><br><span class="line"><span class="comment"># 6</span></span><br></pre></td></tr></table></figure>

<p>expr 支持常规算数运行 + 与或非 + 正则 + 字符串操作等</p>
<p>这个 expr 表达式有点尴尬，他的一些常规运算是要加反斜杠的，简直无情</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">expr 1 * 6</span><br><span class="line"><span class="comment"># expr: syntax error</span></span><br><span class="line">expr 1 \* 6</span><br><span class="line"><span class="comment"># 6</span></span><br></pre></td></tr></table></figure>

<p>这个还算好的，如果在 sh 文件中调用，表达式就更操蛋了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line">var1=10</span><br><span class="line">var2=20</span><br><span class="line">var3=$(expr <span class="variable">$var2</span> / <span class="variable">$var1</span>)</span><br><span class="line"><span class="built_in">echo</span> The result is <span class="variable">$var3</span></span><br><span class="line"></span><br><span class="line">sh test_expr.sh </span><br><span class="line"><span class="comment"># The result is 2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using brackets</p>
</blockquote>
<p>Bash 中保留 <code>expr</code> 是为了兼容 Bourne shell,同时它提供了一种更简便的计算方式，<code>$[ operation ]</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var1=$[1 + 5]</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line">var2=$[ <span class="variable">$var1</span> * 2 ]</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var2</span></span><br><span class="line"><span class="comment"># 12</span></span><br></pre></td></tr></table></figure>

<p>方括号表达式可以自动完成计算符号的识别，不需要用反斜杠做转义符，唯一的缺陷是，他只能做整数运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var1=100</span><br><span class="line">var2=45</span><br><span class="line">var3=$[<span class="variable">$var1</span>/<span class="variable">$var2</span>]</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var3</span></span><br><span class="line"><span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>A floating-point solution</p>
</blockquote>
<p>bc: bash calculation, 他可以识别一下内容</p>
<ul>
<li>Number(integer + floating point)</li>
<li>Variables(simple variables + arrays)</li>
<li>Comments(# or /* … */)</li>
<li>Expressions</li>
<li>Programming statements(such as if-then statements)</li>
<li>Functions</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bc</span><br><span class="line">bc 1.06</span><br><span class="line">Copyright 1991-1994, 1997, 1998, 2000 Free Software Foundation, Inc.</span><br><span class="line">This is free software with ABSOLUTELY NO WARRANTY.</span><br><span class="line">For details <span class="built_in">type</span> `warranty<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">12 * 5.4</span></span><br><span class="line"><span class="string">64.8</span></span><br><span class="line"><span class="string">3.156 * (3 + 5)</span></span><br><span class="line"><span class="string">25.248</span></span><br><span class="line"><span class="string">quit</span></span><br></pre></td></tr></table></figure>

<p>可以通过 scale 关键字指定精确位, 默认 scale 为 0, <code>-q</code> 用于跳过命令文字说明</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bc -q </span><br><span class="line">3.44 / 5</span><br><span class="line">0</span><br><span class="line">scale=4</span><br><span class="line">3.44 / 5</span><br><span class="line">.6880</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>如前述，bc 可以识别变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bc -q</span><br><span class="line">var1=10</span><br><span class="line">var1 * 4</span><br><span class="line">40</span><br><span class="line">var2 = var1 / 5</span><br><span class="line"><span class="built_in">print</span> var2</span><br><span class="line">2</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>你可以通过 Command substitution，在 sh 脚本中调用 bc, 形式为 <code>variable=$(echo &quot;options; expression&quot; | bc)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat test9</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># var1=$(echo &quot;scale=4; 3.44/5&quot; | bc)</span></span><br><span class="line"><span class="comment"># echo This answer is $var1</span></span><br><span class="line"></span><br><span class="line">sh test9</span><br><span class="line"><span class="comment"># This answer is .6880</span></span><br></pre></td></tr></table></figure>

<p>脚本中定义的变量也可以使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat test10</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># var1=100</span></span><br><span class="line"><span class="comment"># var2=45</span></span><br><span class="line"><span class="comment"># var3=$(echo &quot;scale=4; $var1 / $var2&quot; | bc)</span></span><br><span class="line"><span class="comment"># echo The answer for this is $var3bash-5.1$ </span></span><br><span class="line">sh test10</span><br><span class="line"><span class="comment"># The answer for this is 2.2222</span></span><br></pre></td></tr></table></figure>

<p>当遇到很长的计算表达式时，可以用 &lt;&lt; 将他们串起来</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test12</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># var1=10.46</span></span><br><span class="line"><span class="comment"># var2=43.67</span></span><br><span class="line"><span class="comment"># var3=33.2</span></span><br><span class="line"><span class="comment"># var4=71</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># var5=$(bc &lt;&lt; EOF</span></span><br><span class="line"><span class="comment"># scale = 4</span></span><br><span class="line"><span class="comment"># a1 = ($var1 * $var2)</span></span><br><span class="line"><span class="comment"># b1 = ($var3 * $var4)</span></span><br><span class="line"><span class="comment"># a1 + b1</span></span><br><span class="line"><span class="comment"># EOF</span></span><br><span class="line"><span class="comment"># )</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo The final answer for this mess is $var5</span></span><br><span class="line">sh test12</span><br><span class="line"><span class="comment"># The final answer for this mess is 2813.9882</span></span><br></pre></td></tr></table></figure>

<p>PS: 在上面的脚本中我们用了 Command substitution 所以中间的变量前面都是要加 <code>$</code> 的，当终端调用 <code>bc</code> 时就不需要了</p>
<h3 id="Exiting-the-Script"><a href="#Exiting-the-Script" class="headerlink" title="Exiting the Script"></a>Exiting the Script</h3><p>There’s a more elegant way of completing things available to us. 每个命令结束时，系统都会分配一个 0-255 之间的整数给他</p>
<blockquote>
<p>Checking the exit status</p>
</blockquote>
<p>Linux 使用 <code>$?</code> 表示上一条命令的执行状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">date</span><br><span class="line"><span class="comment"># Mon May 24 19:47:29 CST 2021</span></span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 0</span></span><br></pre></td></tr></table></figure>

<p>运行正常，返回 0。如果有问题，则返回一个非零</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">asd</span><br><span class="line"><span class="comment"># bash: asd: command not found</span></span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 127</span></span><br></pre></td></tr></table></figure>

<p>常见错误码表</p>
<table>
<thead>
<tr>
<th align="left">Code</th>
<th align="left">Desc</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">Success</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">General unknown error</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Misuse of shell command</td>
</tr>
<tr>
<td align="left">126</td>
<td align="left">The cmd can’t execute</td>
</tr>
<tr>
<td align="left">127</td>
<td align="left">Cmd not found</td>
</tr>
<tr>
<td align="left">128</td>
<td align="left">Invalid exit argument</td>
</tr>
<tr>
<td align="left">128+x</td>
<td align="left">Fatal err with Linux singal x</td>
</tr>
<tr>
<td align="left">130</td>
<td align="left">Cmd terminated with Ctrl+C</td>
</tr>
<tr>
<td align="left">255</td>
<td align="left">Exit status out of range</td>
</tr>
</tbody></table>
<blockquote>
<p>The exit command</p>
</blockquote>
<p>exit 关键字让你可以定制脚本的返回值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test13</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing the exit status</span></span><br><span class="line"><span class="comment"># var1=10</span></span><br><span class="line"><span class="comment"># var2=20</span></span><br><span class="line"><span class="comment"># var3=$[$var1 + $var2]</span></span><br><span class="line"><span class="comment"># echo The answer is $var3</span></span><br><span class="line"><span class="comment"># exit 5</span></span><br><span class="line"></span><br><span class="line">chmod u+x test13</span><br><span class="line">./test13</span><br><span class="line"><span class="comment"># The answer is 30</span></span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 5</span></span><br></pre></td></tr></table></figure>

<p>PS: 这里看出来差别了，如果我直接用 sh test13 执行的话，结果是 0</p>
<p>这里需要指出的是，exit code 最大为 255 如果超出了，系统会自己做修正</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat test14</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # exit code more than 255</span></span><br><span class="line"><span class="comment"># var=300</span></span><br><span class="line"><span class="comment"># exit $var</span></span><br><span class="line"></span><br><span class="line">chmod u+x test14</span><br><span class="line">./test14</span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 44</span></span><br></pre></td></tr></table></figure>

<h2 id="Chapter-12-Using-Structured-Commands"><a href="#Chapter-12-Using-Structured-Commands" class="headerlink" title="Chapter 12: Using Structured Commands"></a>Chapter 12: Using Structured Commands</h2><p>本章内容主要包括 loigc flow control 部分</p>
<blockquote>
<p>Working with the if-then Statement</p>
</blockquote>
<p>if-then 是最基本的控制方式，format 如下, 判断依据是 command 的 exit code, 如果是 0 则表示 success，其他的则为 fail.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">command</span></span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">command</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>positive sample 如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test1.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing the if statement</span></span><br><span class="line"><span class="comment"># if pwd</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;It worked&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">chmod u+x test1.sh </span><br><span class="line">./test1.sh</span><br><span class="line"><span class="comment"># /Users/i306454/gitStore/hexo</span></span><br><span class="line"><span class="comment"># It worked</span></span><br></pre></td></tr></table></figure>

<p>negative sample 如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test2.sh </span><br><span class="line"><span class="comment"># # #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # # testing a bad command</span></span><br><span class="line"><span class="comment"># if IamNotACommand</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;It worked&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"><span class="comment"># echo &quot;We are outside the if statement&quot;</span></span><br><span class="line">chmod u+x test2.sh</span><br><span class="line">./test2.sh </span><br><span class="line"><span class="comment"># ./test2.sh: line 3: IamNotACommand: command not found</span></span><br><span class="line"><span class="comment"># We are outside the if statement</span></span><br></pre></td></tr></table></figure>

<p>PS: <code>if-then</code> 可以改一下 format，将 if-then 写在一行，看上去更贴近其他语言的表现形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">command</span>; <span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>then 中可以写代码段，如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat test3.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing multiple commands in the then section</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># testuser=MySQL</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if grep $testuser /etc/passwd</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;This is my first command&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;This is my second command&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;I can even put in other commands beside echo:&quot;</span></span><br><span class="line"><span class="comment">#     ls -a /home/$testuser/.b*</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test3.sh </span><br><span class="line"><span class="comment"># _mysql:*:74:74:MySQL Server:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment"># This is my first command</span></span><br><span class="line"><span class="comment"># This is my second command</span></span><br><span class="line"><span class="comment"># I can even put in other commands beside echo:</span></span><br><span class="line"><span class="comment"># ls: /home/MySQL/.b*: No such file or directory</span></span><br></pre></td></tr></table></figure>

<p>PS：由于是 mac 系统，有点出入，但是目的还是达到了。顺便测了一下缩进，将 echo 的缩进去了一样 work</p>
<blockquote>
<p>Exploring the if-then-else Statement</p>
</blockquote>
<p>格式如下, </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">command</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>改进 test3.sh 如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing multiple commands in the then section</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># testuser=NoSuchUser</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if grep $testuser /etc/passwd</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;This is my first command&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;This is my second command&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;I can even put in other commands beside echo:&quot;</span></span><br><span class="line"><span class="comment">#     ls -a /home/$testuser/.b*</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The user $testuser does not exist on this system.&quot;</span></span><br><span class="line"><span class="comment">#     echo</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test4.sh </span><br><span class="line"><span class="comment"># The user NoSuchUser does not exist on this system.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Nesting if</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> command1</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">elif</span> command2</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    more commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>写脚本检测帐户是否存在，然后检测用户文件夹是否存在</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test5.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing nested ifs - use elif</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># testuser=NoSuchUser</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if grep $testuser /etc/passwd</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The user $testuser exists on this system&quot;</span></span><br><span class="line"><span class="comment"># elif ls -d /home/$testuser</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The user $testuser does not exist on this system&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;However, $testuset has directory.&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">chmod u+x test5.sh </span><br><span class="line">./test5.sh </span><br><span class="line"><span class="comment"># ls: /home/NoSuchUser: No such file or directory</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips</strong>: Keep in mind that, with an elif statement, any else statements immediately following it are for that elif code block. They are not part of a preceding if-then statement code block.(elif 之后紧跟的 else 是一对的，它不属于前面的 if-then)</p>
<p>多个 elif 串连的形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> command1</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 1</span><br><span class="line"><span class="keyword">elif</span> command2</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 2</span><br><span class="line"><span class="keyword">elif</span> command3</span><br><span class="line"><span class="keyword">then</span>    </span><br><span class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 3</span><br><span class="line"><span class="keyword">elif</span> command4</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">command</span> <span class="built_in">set</span> 4</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Trying the test Command</p>
</blockquote>
<p>if-then 条件判断只支持 exit code，为了使它更通用，Linux 提供了 test 工具集，如果 test 判定结果为 TRUE 则返回 0 否则非 0，格式为 <code>test condition</code>, 将它和 if-then 结合，格式如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> condition</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>如果没有写 condition，则默认为非 0 返回值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test6.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the test command</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if test</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;No expression return a True&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;No expression return a False&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test6.sh </span><br><span class="line"><span class="comment"># No expression return a False</span></span><br></pre></td></tr></table></figure>

<p>将测试条件替换为变量，输出 True 的语句</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test6.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the test command</span></span><br><span class="line"><span class="comment"># my_variable=&quot;Full&quot;</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if my_variable</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The $my_variable expression return a True&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The $my_variable expression return a False&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test6.sh </span><br><span class="line"><span class="comment"># The Full expression return a False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># replace my_variable=&quot;&quot;</span></span><br><span class="line">./test6.sh </span><br><span class="line"><span class="comment"># The  expression return a False</span></span><br></pre></td></tr></table></figure>

<p>测试条件还可以简写成如下形式</p>
<p>Be careful; you <strong>must have a space</strong> after the first bracket and a space before the last bracket, or you’ll get an error message.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ condition ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>test condition 可以测试如下三种情景</p>
<ul>
<li>Numeric comparisons</li>
<li>String comparisons</li>
<li>File comparisions</li>
</ul>
<blockquote>
<p>Using numeric comparisons</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Comparison</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">n1 -eq n2</td>
<td align="left">Check if n1 is equal to n2</td>
</tr>
<tr>
<td align="left">n1 -ge n2</td>
<td align="left">Check if n1 greater than or equal to n2</td>
</tr>
<tr>
<td align="left">n1 -gt n2</td>
<td align="left">Check if n1 is greater than n2</td>
</tr>
<tr>
<td align="left">n1 -le n2</td>
<td align="left">Check if n1 is less than or equal to n2</td>
</tr>
<tr>
<td align="left">n1 -lt n2</td>
<td align="left">Check if n1 less than n2</td>
</tr>
<tr>
<td align="left">n1 -ne n2</td>
<td align="left">Check if n1 is not equal to n2</td>
</tr>
</tbody></table>
<p>test condition 对变量也是有效的，示例如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat numeric_test.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Using numeric test eveluations</span></span><br><span class="line"><span class="comment"># value1=10</span></span><br><span class="line"><span class="comment"># value2=11</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $value1 -gt 5 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The test value $value1 is greater than 5&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $value1 -eq $value2 ]</span></span><br><span class="line"><span class="comment"># then echo &quot;The values are equal&quot;</span></span><br><span class="line"><span class="comment"># else </span></span><br><span class="line"><span class="comment">#     echo &quot;The values are different&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./numeric_test.sh </span><br><span class="line"><span class="comment"># The test value 10 is greater than 5</span></span><br><span class="line"><span class="comment"># The values are different</span></span><br></pre></td></tr></table></figure>

<p>但是 test condition 有个缺陷，它不能测试浮点型数据</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">value1=5.55</span><br><span class="line">[ <span class="variable">$value1</span> -gt 5 ]; <span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># bash: [: 5.55: integer expression expected</span></span><br><span class="line"><span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<p><strong>Caution:</strong> Remember that the only numbers the bash shell can handle are integers.</p>
<blockquote>
<p>Using string comparisons</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Comparison</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">str1 = str2</td>
<td align="left">Check if str1 is the same as string str2</td>
</tr>
<tr>
<td align="left">str1 != str2</td>
<td align="left">Check if str1 is not the same as string str2</td>
</tr>
<tr>
<td align="left">str1 &lt; str2</td>
<td align="left">Check if str1 is less than str2</td>
</tr>
<tr>
<td align="left">str1 &gt; str2</td>
<td align="left">Check if str1 is greater than string str2</td>
</tr>
<tr>
<td align="left">-n str1</td>
<td align="left">Check if str1 has a length greater than zero</td>
</tr>
<tr>
<td align="left">-z str1</td>
<td align="left">Check if str1 has a length of zero</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test8.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing string equality</span></span><br><span class="line"><span class="comment"># testuser=baduser</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $USER != $testuser ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;This is $testuser&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;Welcome $testuser&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test8.sh </span><br><span class="line"><span class="comment"># This is baduser</span></span><br></pre></td></tr></table></figure>

<p>在处理 <code>&lt;</code> 和 <code>&gt;</code> 时，shell 会有一些很奇怪的注意点</p>
<ul>
<li><code>&lt;</code> 和 <code>&gt;</code> 必须使用转义符号，不然系统会把他们当作流操作</li>
<li><code>&lt;</code> 和 <code>&gt;</code> 的用法和 sort 中的用法时不一致的</li>
</ul>
<p>针对第一点的测试，测试中，比较符号被当成了流操作符，新生产了一个 hockey 文件。这个操作 exit code 是 0 所以执行了 true 的 loop. 你需要将条件语句改为 <code>if [ $val1 \&gt; $val2 ]</code> 才能生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat badtest.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # mis-using string comparisons</span></span><br><span class="line"><span class="comment"># val1=baseball</span></span><br><span class="line"><span class="comment"># val2=hockey</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $val1 &gt; $val2 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;$val1 is greater than $val2&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;$val1 is less than $val2&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">/badtest.sh </span><br><span class="line"><span class="comment"># baseball is greater than hockey</span></span><br><span class="line">ls</span><br><span class="line"><span class="comment"># badtest.sh      hockey</span></span><br></pre></td></tr></table></figure>

<p>针对第二点，sort 和 test 对 string 的比较是相反的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat test9b.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing string sort order</span></span><br><span class="line"><span class="comment"># val1=Testing</span></span><br><span class="line"><span class="comment"># val2=testing</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ $val1 \&gt; $val2 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;$val1 is greater than $val2&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;$val1 is less than $val2&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test9b.sh </span><br><span class="line">Testing is less than testing</span><br><span class="line"></span><br><span class="line">sort &lt;&lt; EOF</span><br><span class="line">&gt; Testing</span><br><span class="line">&gt; testing</span><br><span class="line">&gt; EOF</span><br><span class="line">Testing</span><br><span class="line">testing</span><br></pre></td></tr></table></figure>

<p>PS: 这里和书本上有出入，我在 MacOS 里测试两者是一致的，大写要小于小些，可能 Ubantu 上不一样把，有机会可以测一测</p>
<p><strong>Note:</strong> The test command and test expressions use the standard mathematical comparison symbols for string compari-sons and text codes for numerical comparisons. This is a subtle feature that many programmers manage to get reversed. If you use the mathematical comparison symbols for numeric values, the shell interprets them as string values and may not produce the correct results.</p>
<p>test condition 的处理模式是 数字 + test codes(-eq); string + 运算符(&lt;/&gt;/=)，刚好是交叉的，便于记忆</p>
<p>对 <code>-n</code> 和 <code>-z</code> 进行测试，undefined 的变量默认长度为 0</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat test10.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # testing string length</span></span><br><span class="line"><span class="comment"># val1=testing</span></span><br><span class="line"><span class="comment"># val2=&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ -n $val1 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val1&#x27; is not empty&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val1&#x27; is empty&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ -z $val2 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val2&#x27; is empty&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val2&#x27; is not empty&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># if [ -z $val3 ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val3&#x27; is empty&quot;</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;The string &#x27;$val3&#x27; is not empty&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line">./test10.sh </span><br><span class="line"><span class="comment"># The string &#x27;testing&#x27; is not empty</span></span><br><span class="line"><span class="comment"># The string &#x27;&#x27; is empty</span></span><br><span class="line"><span class="comment"># The string &#x27;&#x27; is empty</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using file comparisons</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Comparison</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-d file</td>
<td align="left">Check if file exists and is a directory</td>
</tr>
<tr>
<td align="left">-e file</td>
<td align="left">Check if file or directory exists</td>
</tr>
<tr>
<td align="left">-f file</td>
<td align="left">Check if file exists and is a file</td>
</tr>
<tr>
<td align="left">-r file</td>
<td align="left">Check if file exists and is readable</td>
</tr>
<tr>
<td align="left">-s file</td>
<td align="left">Check if file exists and is not empty</td>
</tr>
<tr>
<td align="left">-w file</td>
<td align="left">Check if file exists and is writable</td>
</tr>
<tr>
<td align="left">-x file</td>
<td align="left">Check if file exists and is executable</td>
</tr>
<tr>
<td align="left">-O file</td>
<td align="left">Check if file exists and is owned by the current user</td>
</tr>
<tr>
<td align="left">-G file</td>
<td align="left">Check if file exists and the default group is the same as the current user</td>
</tr>
<tr>
<td align="left">file1 -nt file2</td>
<td align="left">Check if file1 is newer than file2</td>
</tr>
<tr>
<td align="left">file1 -ot file2</td>
<td align="left">Check if file1 is older than file2</td>
</tr>
</tbody></table>
<p>测试范例如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mkdir test_folder</span><br><span class="line">[ -d test_folder ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ -e test_folder ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ -e xxx ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line"></span><br><span class="line">chmod u+xrw test_file.sh </span><br><span class="line">ls -l test_file.sh </span><br><span class="line"><span class="comment"># -rwxr--r--  1 i306454  staff  190 May 25 17:51 test_file.sh</span></span><br><span class="line">[ -r test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ -w test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ -x test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line"></span><br><span class="line">chmod u-rxw test_file.sh </span><br><span class="line">ls -l test_file.sh </span><br><span class="line"><span class="comment"># ----r--r--  1 i306454  staff  190 May 25 17:51 test_file.sh</span></span><br><span class="line">[ -r test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line">[ -w test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line">[ -x test_file.sh ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line"></span><br><span class="line">touch tmp_file</span><br><span class="line">[ -s tmp_file ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line"><span class="built_in">echo</span> new line &gt;&gt; tmp_file </span><br><span class="line">[ -s tmp_file ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line"></span><br><span class="line">ls -l</span><br><span class="line"><span class="comment"># total 8</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  9 May 25 17:59 tmp_file</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  0 May 25 18:01 tmp_file2</span></span><br><span class="line">[ tmp_file2 -nt tmp_file ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ tmp_file -nt tmp_file2 ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line">[ tmp_file -ot tmp_file2 ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line">[ tmp_file2 -ot tmp_file ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br></pre></td></tr></table></figure>

<h3 id="Considering-Compound-Testing"><a href="#Considering-Compound-Testing" class="headerlink" title="Considering Compound Testing"></a>Considering Compound Testing</h3><p>组合条件</p>
<ul>
<li>[ condition1 ] &amp;&amp; [  condition2 ]</li>
<li>[ condition1 ] || [  condition2 ]</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ -f tmp_file ] &amp;&amp; [ -d <span class="variable">$HOME</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br></pre></td></tr></table></figure>

<h3 id="Working-with-Advanced-if-then-Features"><a href="#Working-with-Advanced-if-then-Features" class="headerlink" title="Working with Advanced if-then Features"></a>Working with Advanced if-then Features</h3><p>if-then 的增强模式</p>
<ul>
<li>Double parentheses for mathematical expressions(双括号)</li>
<li>Double square brackets for advanced string handling functions(双方括号)</li>
</ul>
<blockquote>
<p>Using double parentheses</p>
</blockquote>
<p>创括号是针对算数运算的</p>
<p>test command 只提供了简单的算术运算，双括号提供的算力更强，效果和其他语言类似，格式 <code>(( expression ))</code>. 除了 test 支持的运算，它还支持如下运算</p>
<table>
<thead>
<tr>
<th align="left">Comparison</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">val++</td>
<td align="left">Post-incremnet</td>
</tr>
<tr>
<td align="left">val–</td>
<td align="left">Post-decrement</td>
</tr>
<tr>
<td align="left">++val</td>
<td align="left">Pre-increment</td>
</tr>
<tr>
<td align="left">–val</td>
<td align="left">Pre-decrement</td>
</tr>
<tr>
<td align="left">!</td>
<td align="left">Logical negation</td>
</tr>
<tr>
<td align="left">~</td>
<td align="left">Bitwise negation</td>
</tr>
<tr>
<td align="left">**</td>
<td align="left">Exponentiation</td>
</tr>
<tr>
<td align="left">&lt;&lt;</td>
<td align="left">Left bitwise shift</td>
</tr>
<tr>
<td align="left">&gt;&gt;</td>
<td align="left">Right bitwise shift</td>
</tr>
<tr>
<td align="left">&amp;</td>
<td align="left">Bitwise Boolean AND</td>
</tr>
<tr>
<td align="left">|</td>
<td align="left">Bitwise Boolean OR</td>
</tr>
<tr>
<td align="left">&amp;&amp;</td>
<td align="left">Logical AND</td>
</tr>
<tr>
<td align="left">||</td>
<td align="left">Logical OR</td>
</tr>
</tbody></table>
<p>测试范例如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ** 次方操作</span></span><br><span class="line">(( <span class="variable">$val1</span>**2 &gt; 90 )) &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using double bracket</p>
</blockquote>
<p>双方括号是针对字符运算的，格式为 <code>[[ expression ]]</code>. 除了 test 相同的计算外，他还额外提供了<strong>正则</strong>的支持</p>
<p><strong>Note:</strong> bash 是支持双方括号的，但是其他 shell 就不一定了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[ <span class="variable">$USER</span> == i* ]] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br></pre></td></tr></table></figure>

<p>PS: 双等(==)表示 string 符合 pattern，直接用等号也是可以的</p>
<h3 id="Considering-the-case-Command"><a href="#Considering-the-case-Command" class="headerlink" title="Considering the case Command"></a>Considering the case Command</h3><p>对应 Java 中的 switch-case 语法, 格式如下. 当内容和 pattern 匹配时，就会执行对应的语句</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> variable <span class="keyword">in</span></span><br><span class="line">pattern1 | pattern2) command1;;</span><br><span class="line">pattern3) command2;;</span><br><span class="line">*) default commands;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat test26.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # using the case command</span></span><br><span class="line"><span class="comment"># case $USER in </span></span><br><span class="line"><span class="comment"># rich | barbara)</span></span><br><span class="line"><span class="comment">#     echo &quot;Welcome $USER&quot;</span></span><br><span class="line"><span class="comment">#     echo &quot;Please enjoy your visit&quot;;;</span></span><br><span class="line"><span class="comment"># i306454)</span></span><br><span class="line"><span class="comment">#     echo &quot;Special testing account&quot;;;</span></span><br><span class="line"><span class="comment"># jessica)</span></span><br><span class="line"><span class="comment">#     echo &quot;Do not forget to log off when you&#x27;re done&quot;;;</span></span><br><span class="line"><span class="comment"># *)</span></span><br><span class="line"><span class="comment">#     echo &quot;Sorry, you are not allowed here&quot;;;</span></span><br><span class="line"><span class="comment"># esac</span></span><br><span class="line">./test26.sh </span><br><span class="line"><span class="comment"># Special testing account</span></span><br></pre></td></tr></table></figure>

<h3 id="Issues"><a href="#Issues" class="headerlink" title="Issues"></a>Issues</h3><p><strong>Issue1:</strong> 写脚本的时候，发现一个很奇怪的问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 未赋值的变脸 -n 会返回 true ?!</span></span><br><span class="line">[ -n <span class="variable">$ret23</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># true</span></span><br><span class="line"><span class="comment"># 经多方查证，需要加引号</span></span><br><span class="line">[ -n <span class="string">&quot;<span class="variable">$ret23</span>&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里就体现出增强型的好处了</span></span><br><span class="line">[[ -n <span class="variable">$ret23</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="literal">true</span> || <span class="built_in">echo</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># false</span></span><br></pre></td></tr></table></figure>

<p>以后可以的话都用增强型把，容错率更高</p>
<h2 id="More-Structured-Commands"><a href="#More-Structured-Commands" class="headerlink" title="More Structured Commands"></a>More Structured Commands</h2><p>这章介绍了其他一些流程控制的关键词</p>
<h3 id="The-for-Command"><a href="#The-for-Command" class="headerlink" title="The for Command"></a>The for Command</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> list</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>PS: for 和 do 也可以写一起(for var in list; do)，和 if-then 那样</p>
<blockquote>
<p>Reading values in a list</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test1.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # basic for command</span></span><br><span class="line"><span class="comment"># for test in a b c d e</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo The character is $test</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test1.sh </span><br><span class="line"><span class="comment"># The character is a</span></span><br><span class="line"><span class="comment"># The character is b</span></span><br><span class="line"><span class="comment"># The character is c</span></span><br><span class="line"><span class="comment"># The character is d</span></span><br><span class="line"><span class="comment"># The character is e</span></span><br></pre></td></tr></table></figure>

<p>当 for 结束后变量还会存在</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat test1b.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the for variable after the looping</span></span><br><span class="line"><span class="comment"># for test in a b c d e</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo The character is $test</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo The last character is $test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># test=Connecticut</span></span><br><span class="line"><span class="comment"># echo &quot;Wait, now we&#x27;re visiting $test&quot;</span></span><br><span class="line">./test1b.sh </span><br><span class="line"><span class="comment"># The character is a</span></span><br><span class="line"><span class="comment"># The character is b</span></span><br><span class="line"><span class="comment"># The character is c</span></span><br><span class="line"><span class="comment"># The character is d</span></span><br><span class="line"><span class="comment"># The character is e</span></span><br><span class="line"><span class="comment"># The last character is e</span></span><br><span class="line"><span class="comment"># Wait, now we&#x27;re visiting Connecticut</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading complex values in a list</p>
</blockquote>
<p>当 list 中包含一些标点时，结果可能就不是预期的那样了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat badtest1.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # another example of how not to use the for command</span></span><br><span class="line"><span class="comment"># for test in I don&#x27;t know if this&#x27;ll work, append some thing more?</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo The character is $test</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./badtest1.sh </span><br><span class="line"><span class="comment"># The character is I</span></span><br><span class="line"><span class="comment"># The character is dont know if thisll</span></span><br><span class="line"><span class="comment"># The character is work,</span></span><br><span class="line"><span class="comment"># The character is append</span></span><br><span class="line"><span class="comment"># The character is some</span></span><br><span class="line"><span class="comment"># The character is thing</span></span><br><span class="line"><span class="comment"># The character is more?</span></span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<ol>
<li>给引号加转义符(for test in I don&#39;t know if this&#39;ll work, append some thing more?)</li>
<li>将 string 用双引号包裹(for test in I don”‘“t know if this”‘“ll work, append some thing more?)</li>
</ol>
<p><code>for</code> 默认使用空格做分割，如果想要连词，你需要将对一个的词用双引号包裹起来</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat badtest2.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # another example of how not to use the for command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for test in Nevada New Hampshire New Mexico New York North Carolina</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Now going to $test&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./badtest2.sh </span><br><span class="line"><span class="comment"># Now going to Nevada</span></span><br><span class="line"><span class="comment"># Now going to New</span></span><br><span class="line"><span class="comment"># Now going to Hampshire</span></span><br><span class="line"><span class="comment"># Now going to New</span></span><br><span class="line"><span class="comment"># Now going to Mexico</span></span><br><span class="line"><span class="comment"># Now going to New</span></span><br><span class="line"><span class="comment"># Now going to York</span></span><br><span class="line"><span class="comment"># Now going to North</span></span><br><span class="line"><span class="comment"># Now going to Carolina</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update to: for test in Nevada &quot;New Hampshire&quot; &quot;New Mexico&quot; &quot;New York&quot;</span></span><br><span class="line">./badtest2.sh </span><br><span class="line"><span class="comment"># Now going to Nevada</span></span><br><span class="line"><span class="comment"># Now going to New Hampshire</span></span><br><span class="line"><span class="comment"># Now going to New Mexico</span></span><br><span class="line"><span class="comment"># Now going to New York</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading a list from a variable</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat test4.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # using a variable to hold the list</span></span><br><span class="line"><span class="comment"># list=&quot;Alabama Alaska Arizona Arkansas Colorado&quot;</span></span><br><span class="line"><span class="comment"># list=$list&quot; Connecticut&quot;</span></span><br><span class="line"><span class="comment"># for state in $list</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Have you ever visited $state?&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test4.sh </span><br><span class="line"><span class="comment"># Have you ever visited Alabama?</span></span><br><span class="line"><span class="comment"># Have you ever visited Alaska?</span></span><br><span class="line"><span class="comment"># Have you ever visited Arizona?</span></span><br><span class="line"><span class="comment"># Have you ever visited Arkansas?</span></span><br><span class="line"><span class="comment"># Have you ever visited Colorado?</span></span><br><span class="line"><span class="comment"># Have you ever visited Connecticut?</span></span><br></pre></td></tr></table></figure>

<p>PS: <code>list=$list&quot; Connecticut&quot;</code> 是 shell 中 append 字符串的常见操作</p>
<blockquote>
<p>Reading values from a command</p>
</blockquote>
<p>结合其他命令，计算出 list 的值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> a b c &gt; states</span><br><span class="line">cat test5.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # reading values from a file</span></span><br><span class="line"><span class="comment"># file=states</span></span><br><span class="line"><span class="comment"># for state in $(cat $file)</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Visit beautiful $state&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test5.sh </span><br><span class="line"><span class="comment"># Visit beautiful a</span></span><br><span class="line"><span class="comment"># Visit beautiful b</span></span><br><span class="line"><span class="comment"># Visit beautiful c</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Changing the field separator</p>
</blockquote>
<p>有一个特殊的环境变量叫做 IFS(internal field separator). 他可以作为分割 field 的依据。默认的分割符有</p>
<ul>
<li>A space</li>
<li>A tab</li>
<li>A newline</li>
</ul>
<p>如果你想要将换行作为分割符，你可以使用 <code>IFS=$&#39;\n&#39;</code></p>
<p><strong>Caution:</strong> 定制 IFS 之后一定要还原</p>
<p>测试环节：如何打印当前 IFS 的值？</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$IFS</span>&quot;</span> | hexdump</span><br><span class="line"><span class="comment"># 0000000 20 09 0a</span></span><br><span class="line"><span class="comment"># 0000003</span></span><br><span class="line"><span class="built_in">printf</span> %q <span class="string">&quot;<span class="variable">$IFS</span>&quot;</span></span><br><span class="line"><span class="comment"># &#x27; \t\n&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>Caution:</strong> 变量和引号之间的关系：</p>
<ul>
<li>单引号，所见即所得。写什么即是什么</li>
<li>双引号，中间的变量会做计算</li>
<li>没符号，用于连续的内容，如果内容中带空格，需要加双引号</li>
</ul>
<p>脚本中 <code>IFS.OLD=$IFS</code> 的赋值语句经常会抛异常 <code>./test_csv.sh: line 3: IFS.OLD=: command not found</code> 但是写成 <code>IFS_OLD</code> 的话就可以运行，可能是点号的形式会变成其他一些什么调用也说不定。以后为了稳定，还是用下划线的形式把 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IFS_OLD=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">&lt;use the new IFS value <span class="keyword">in</span> code&gt;</span><br><span class="line">IFS=<span class="variable">$IFS_OLD</span></span><br></pre></td></tr></table></figure>

<p>其他定制分割符 <code>IFS=:</code>, 或者多分割符 <code>IFS=$&#39;\n&#39;:;&quot;</code></p>
<blockquote>
<p>Reading a directory using wildcards</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat test6.sh</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # iterate through all the files in a directory</span></span><br><span class="line"><span class="comment"># for file in /Users/i306454/tmp/*</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     if [ -d &quot;$file&quot; ]</span></span><br><span class="line"><span class="comment">#     then </span></span><br><span class="line"><span class="comment">#         echo &quot;$file is a directory&quot;</span></span><br><span class="line"><span class="comment">#     elif [ -f &quot;$file&quot; ]</span></span><br><span class="line"><span class="comment">#     then</span></span><br><span class="line"><span class="comment">#         echo &quot;$file is a file&quot;</span></span><br><span class="line"><span class="comment">#     fi</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test6.sh </span><br><span class="line"><span class="comment"># /Users/i306454/tmp/backup is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/bash_test is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/csv is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/dfile is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/ifenduser.sh is a file</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/plantuml is a directory</span></span><br><span class="line"><span class="comment"># /Users/i306454/tmp/sh is a directory</span></span><br></pre></td></tr></table></figure>

<p>PS: 在这个例子中有一个很有意思的点，在 test 中，将变量 file 使用双引号包裹起来了。这是因为 Linux 中带空格的文件或文件夹是合法的，如果没有引号，解析就会出错</p>
<p><strong>Caution:</strong> It’s always a good idea to test each file or directory before trying to process it.</p>
<h3 id="The-C-Style-for-command"><a href="#The-C-Style-for-command" class="headerlink" title="The C-Style for command"></a>The C-Style for command</h3><p>C 语言中 for 循环如下</p>
<blockquote>
<p>The C language for command</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The next number is %d\n&quot;</span>, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>bash 中也提供了类似的功能, 语法为 <code>for (( variable assignment; condition; iteration process ))</code> 例子：<code>for(( a=1; a&lt;10; a++ ))</code></p>
<p>限制：</p>
<ul>
<li>The assignment of the variable value can contain space</li>
<li>The variable in the condition isn’t preceded with a dollar sign</li>
<li>The equation for the iteration process doesn’t use the expr command format</li>
</ul>
<p>这种用法，对我倒是很亲切，但是和之前用过的那些变量赋值之类的语句确实有一些语法差异的。这个语句中各种缩进，空格都不作限制</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test8.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the C-style for loop</span></span><br><span class="line"><span class="comment"># for ((i=1; i&lt;= 3; i++))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;The next number is $i&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test8.sh </span><br><span class="line"><span class="comment"># The next number is 1</span></span><br><span class="line"><span class="comment"># The next number is 2</span></span><br><span class="line"><span class="comment"># The next number is 3</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using multiple variables</p>
</blockquote>
<p>for 中包含多个参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test9.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the C-style for loop</span></span><br><span class="line"><span class="comment"># for ((a=1, b=10; a&lt;= 3; a++, b--))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo $a - $b</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test9.sh </span><br><span class="line"><span class="comment"># 1 - 10</span></span><br><span class="line"><span class="comment"># 2 - 9</span></span><br><span class="line"><span class="comment"># 3 - 8</span></span><br></pre></td></tr></table></figure>

<h3 id="The-while-Command"><a href="#The-while-Command" class="headerlink" title="The while Command"></a>The while Command</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">test</span> <span class="built_in">command</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    other commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test10.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # while command test</span></span><br><span class="line"><span class="comment"># var1=3</span></span><br><span class="line"><span class="comment"># while [ $var1 -gt 0 ]</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo $var1</span></span><br><span class="line"><span class="comment">#     var1=$[ $var1 - 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test10.sh </span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using multiple test commands</p>
</blockquote>
<p>while 判断的时候可以接多个条件，但是只有最后一个条件的 exit code 起决定作用。就算第一个条件我直接改为 <code>cmd</code> 每次都抛错，循环照常进行</p>
<p>还有，每个条件要新起一行, 当然用分号隔开也是可以的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test11.sh </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing a multicommand while loop</span></span><br><span class="line"><span class="comment"># var1=3</span></span><br><span class="line"><span class="comment"># while echo $var1</span></span><br><span class="line"><span class="comment">#     [ $var1 -gt 0 ]</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;This is inside the loop&quot;</span></span><br><span class="line"><span class="comment">#     var1=$[ $var1 - 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test11.sh </span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># This is inside the loop</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># This is inside the loop</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># This is inside the loop</span></span><br><span class="line"><span class="comment"># 0</span></span><br></pre></td></tr></table></figure>

<h3 id="The-until-Command"><a href="#The-until-Command" class="headerlink" title="The until Command"></a>The until Command</h3><p>语意上和 while 相反，但是用法一致</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">until <span class="built_in">test</span> commands</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    other commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test12 </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # using the until command</span></span><br><span class="line"><span class="comment"># var1=100</span></span><br><span class="line"><span class="comment"># until [ $var1 -eq 0 ]</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo $var1</span></span><br><span class="line"><span class="comment">#     var1=$[ $var1 - 25 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test12 </span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 75</span></span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 25</span></span><br></pre></td></tr></table></figure>

<h3 id="Nesting-Loops"><a href="#Nesting-Loops" class="headerlink" title="Nesting Loops"></a>Nesting Loops</h3><p>循环嵌套，很常见</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat test14             </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # nesting for loops</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;=3; a++))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Starting loop $a:&quot;</span></span><br><span class="line"><span class="comment">#     for (( b=1; b&lt;=3; b++ ))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         echo &quot;    Inside loop: $b&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test14</span><br><span class="line"><span class="comment"># Starting loop 1:</span></span><br><span class="line"><span class="comment">#     Inside loop: 1</span></span><br><span class="line"><span class="comment">#     Inside loop: 2</span></span><br><span class="line"><span class="comment">#     Inside loop: 3</span></span><br><span class="line"><span class="comment"># Starting loop 2:</span></span><br><span class="line"><span class="comment">#     Inside loop: 1</span></span><br><span class="line"><span class="comment">#     Inside loop: 2</span></span><br><span class="line"><span class="comment">#     Inside loop: 3</span></span><br><span class="line"><span class="comment"># Starting loop 3:</span></span><br><span class="line"><span class="comment">#     Inside loop: 1</span></span><br><span class="line"><span class="comment">#     Inside loop: 2</span></span><br><span class="line"><span class="comment">#     Inside loop: 3</span></span><br></pre></td></tr></table></figure>

<p>while + for 的例子。树上的例子 for 中 边界条件是 <code>$var2&lt;3;</code> 和之前表现的语法不一样，试了一下，有无 <code>$</code> 都是可以的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat test14</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # nesting for loops</span></span><br><span class="line"><span class="comment"># var1=3</span></span><br><span class="line"><span class="comment"># while [ $var1 -ge 0 ]</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Outer loop: $var1&quot;</span></span><br><span class="line"><span class="comment">#     for (( var2=1; var2&lt;3; var2++))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         var3=$[ $var1*$var2 ]</span></span><br><span class="line"><span class="comment">#         echo &quot;    Inner loop: $var1 * $var2 = $var3&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment">#     var1=$[ $var1 - 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test14</span><br><span class="line"><span class="comment"># Outer loop: 3</span></span><br><span class="line"><span class="comment">#     Inner loop: 3 * 1 = 3</span></span><br><span class="line"><span class="comment">#     Inner loop: 3 * 2 = 6</span></span><br><span class="line"><span class="comment"># Outer loop: 2</span></span><br><span class="line"><span class="comment">#     Inner loop: 2 * 1 = 2</span></span><br><span class="line"><span class="comment">#     Inner loop: 2 * 2 = 4</span></span><br><span class="line"><span class="comment"># Outer loop: 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 1 * 1 = 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 1 * 2 = 2</span></span><br><span class="line"><span class="comment"># Outer loop: 0</span></span><br><span class="line"><span class="comment">#     Inner loop: 0 * 1 = 0</span></span><br><span class="line"><span class="comment">#     Inner loop: 0 * 2 = 0</span></span><br></pre></td></tr></table></figure>

<h3 id="Looping-on-File-Data"><a href="#Looping-on-File-Data" class="headerlink" title="Looping on File Data"></a>Looping on File Data</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4128235/what-is-the-exact-meaning-of-ifs-n">Stackoverflow</a> 上看到一篇解释 IFS=$’\n’ 的帖子，挺好。一句话就是 <code>$&#39;...&#39;</code> 的语法可以表示转义符</p>
<p>通常来说，你会需要遍历文件中的内容，这需要两个知识点</p>
<ol>
<li>Using nested loops</li>
<li>Changing the IFS environment variable</li>
</ol>
<p>通过设置 IFS 你可以在包含空格的情况下处理一行内容. 下面是处理 <code>/etc/passwd</code> 文件是案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat test1</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # changing the IFS value</span></span><br><span class="line"><span class="comment"># IFS.OLD=$IFS</span></span><br><span class="line"><span class="comment"># IFS=$&#x27;\n&#x27;</span></span><br><span class="line"><span class="comment"># for entry in $(cat /etc/passwd)</span></span><br><span class="line"><span class="comment"># do </span></span><br><span class="line"><span class="comment">#     echo &quot;Values in $entry -&quot;</span></span><br><span class="line"><span class="comment">#     IFS=:</span></span><br><span class="line"><span class="comment">#     for value in $entry</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         echo &quot;    $value&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test1</span><br><span class="line"><span class="comment"># Values in _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false</span></span><br><span class="line"><span class="comment">#     _oahd</span></span><br><span class="line"><span class="comment">#     badtest1.sh</span></span><br><span class="line"><span class="comment">#     badtest2.sh</span></span><br><span class="line"><span class="comment">#     test1</span></span><br><span class="line"><span class="comment">#     test12</span></span><br><span class="line"><span class="comment">#     test14</span></span><br><span class="line"><span class="comment">#     test15</span></span><br><span class="line"><span class="comment">#     441</span></span><br><span class="line"><span class="comment">#     441</span></span><br><span class="line"><span class="comment">#     OAH Daemon</span></span><br><span class="line"><span class="comment">#     /var/empty</span></span><br><span class="line"><span class="comment">#     /usr/bin/false</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<h3 id="Controlling-the-loop"><a href="#Controlling-the-loop" class="headerlink" title="Controlling the loop"></a>Controlling the loop</h3><p>通过 break, continue 控制流程</p>
<blockquote>
<p>The break command</p>
</blockquote>
<p>打断单层循环, 这个语法适用于任何循环语句，比如 for, while, until 等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat test17</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Breaking out of a for loop</span></span><br><span class="line"><span class="comment"># for var1 in 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     if [ $var1 -eq 3 ]</span></span><br><span class="line"><span class="comment">#     then</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line"><span class="comment">#     fi</span></span><br><span class="line"><span class="comment">#     echo &quot;Iteration number: $var1&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"><span class="comment"># echo &quot;The for loop is completed&quot;</span></span><br><span class="line">./test17</span><br><span class="line"><span class="comment"># Iteration number: 1</span></span><br><span class="line"><span class="comment"># Iteration number: 2</span></span><br><span class="line"><span class="comment"># The for loop is completed</span></span><br></pre></td></tr></table></figure>

<p>打断内层循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat test19</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Breaking out of an inner loop</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;4; a++ ))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Outer loop: $a&quot;</span></span><br><span class="line"><span class="comment">#     for (( b=1; b&lt;4; b++ ))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         if [ $b -eq 2 ]</span></span><br><span class="line"><span class="comment">#         then</span></span><br><span class="line"><span class="comment">#             break</span></span><br><span class="line"><span class="comment">#         fi</span></span><br><span class="line"><span class="comment">#         echo &quot;    Inner loop: $b&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test19</span><br><span class="line"><span class="comment"># Outer loop: 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 1</span></span><br><span class="line"><span class="comment"># Outer loop: 2</span></span><br><span class="line"><span class="comment">#     Inner loop: 1</span></span><br><span class="line"><span class="comment"># Outer loop: 3</span></span><br><span class="line"><span class="comment">#     Inner loop: 1</span></span><br></pre></td></tr></table></figure>

<p>在内部循环执行过程中，打断外层循环，这个特性倒是很新颖，Java 中没见过 Haha</p>
<p><code>break n</code> 默认是 1，打断当前的循环，设置成 2 就是打断外面一层直接退出。下面例子中，我们通过在 inner for 中 break 2 直接退出了外层 for 循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat test20 </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Breaking out of an outer loop</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;4; a++ ))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;Outer loop: $a&quot;</span></span><br><span class="line"><span class="comment">#     for (( b=1; b&lt;4; b++ ))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         if [ $b -gt 2 ]</span></span><br><span class="line"><span class="comment">#         then</span></span><br><span class="line"><span class="comment">#             break 2</span></span><br><span class="line"><span class="comment">#         fi</span></span><br><span class="line"><span class="comment">#         echo &quot;    Inner loop: $b&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test20</span><br><span class="line"><span class="comment"># Outer loop: 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 1</span></span><br><span class="line"><span class="comment">#     Inner loop: 2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The continue command</p>
</blockquote>
<p>提前结束循环，继续下一次循环. 下面例子中，当当前变量 3 &lt; x &lt; 8 时跳过打印. 前面介绍的循环体都适用，如 for, while 和 until</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test21 </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Using the continue command</span></span><br><span class="line"><span class="comment"># for (( var1=1; var1&lt;10; var1++ ))</span></span><br><span class="line"><span class="comment"># do </span></span><br><span class="line"><span class="comment">#     if [ $var1 -gt 3 ] &amp;&amp; [ $var1 -lt 8 ]</span></span><br><span class="line"><span class="comment">#     then</span></span><br><span class="line"><span class="comment">#         continue</span></span><br><span class="line"><span class="comment">#     fi</span></span><br><span class="line"><span class="comment">#     echo &quot;Iteration number: $var1&quot;</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test21 </span><br><span class="line"><span class="comment"># Iteration number: 1</span></span><br><span class="line"><span class="comment"># Iteration number: 2</span></span><br><span class="line"><span class="comment"># Iteration number: 3</span></span><br><span class="line"><span class="comment"># Iteration number: 8</span></span><br><span class="line"><span class="comment"># Iteration number: 9</span></span><br></pre></td></tr></table></figure>

<p>和 break 一样，continue 也支持 <code>continue n</code> 来跳过循环。测试用例中，当外层变量值 2 &lt; x &lt; 4 时，跳过打印</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat test22</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Continuing an outer loop</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;=5; a++ ))</span></span><br><span class="line"><span class="comment"># do </span></span><br><span class="line"><span class="comment">#     echo &quot;Iteration $a:&quot;</span></span><br><span class="line"><span class="comment">#     for (( b=1; b&lt;3; b++))</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         if [ $a -gt 2 ] &amp;&amp; [ $a -lt 4 ]</span></span><br><span class="line"><span class="comment">#         then</span></span><br><span class="line"><span class="comment">#             continue 2</span></span><br><span class="line"><span class="comment">#         fi</span></span><br><span class="line"><span class="comment">#         var3=$[ $a * $b ]</span></span><br><span class="line"><span class="comment">#         echo &quot;    The result of $a * $b is $var3&quot;</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test22</span><br><span class="line"><span class="comment"># Iteration 1:</span></span><br><span class="line"><span class="comment">#     The result of 1 * 1 is 1</span></span><br><span class="line"><span class="comment">#     The result of 1 * 2 is 2</span></span><br><span class="line"><span class="comment"># Iteration 2:</span></span><br><span class="line"><span class="comment">#     The result of 2 * 1 is 2</span></span><br><span class="line"><span class="comment">#     The result of 2 * 2 is 4</span></span><br><span class="line"><span class="comment"># Iteration 3:</span></span><br><span class="line"><span class="comment"># Iteration 4:</span></span><br><span class="line"><span class="comment">#     The result of 4 * 1 is 4</span></span><br><span class="line"><span class="comment">#     The result of 4 * 2 is 8</span></span><br><span class="line"><span class="comment"># Iteration 5:</span></span><br><span class="line"><span class="comment">#     The result of 5 * 1 is 5</span></span><br><span class="line"><span class="comment">#     The result of 5 * 2 is 10</span></span><br></pre></td></tr></table></figure>

<h3 id="Processing-the-Output-of-a-Loop"><a href="#Processing-the-Output-of-a-Loop" class="headerlink" title="Processing the Output of a Loop"></a>Processing the Output of a Loop</h3><p><code>for</code> 中打印的语句可以在 <code>done</code> 后面接文件操作符一起导入，还有这种功能。。。那我之前写脚本用的 printf 不是显得有点呆</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test23</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # redirecting the for output to a file</span></span><br><span class="line"><span class="comment"># for (( a=1; a&lt;=5; a++ ))</span></span><br><span class="line"><span class="comment"># do </span></span><br><span class="line"><span class="comment">#     echo &quot;The number is $a&quot;</span></span><br><span class="line"><span class="comment"># done &gt; test23.txt</span></span><br><span class="line">cat test23.txt </span><br><span class="line"><span class="comment"># The number is 1</span></span><br><span class="line"><span class="comment"># The number is 2</span></span><br><span class="line"><span class="comment"># The number is 3</span></span><br><span class="line"><span class="comment"># The number is 4</span></span><br><span class="line"><span class="comment"># The number is 5</span></span><br></pre></td></tr></table></figure>

<p>PS: 试了一下，<code>echo -n</code> 也是 OK 的</p>
<p>同理，<code>done</code> 后面还可以接其他的命令, 这个扩展很赞</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test24</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # piping a loop to another command</span></span><br><span class="line"><span class="comment"># for state in &quot;North Dakota&quot; Connecticut Illinois Alabama Tennessee</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;$state is the next place to go&quot;</span></span><br><span class="line"><span class="comment"># done | sort</span></span><br><span class="line"><span class="comment"># echo &quot;This completes our travels&quot;</span></span><br><span class="line">./test24</span><br><span class="line"><span class="comment"># Alabama is the next place to go</span></span><br><span class="line"><span class="comment"># Connecticut is the next place to go</span></span><br><span class="line"><span class="comment"># Illinois is the next place to go</span></span><br><span class="line"><span class="comment"># North Dakota is the next place to go</span></span><br><span class="line"><span class="comment"># Tennessee is the next place to go</span></span><br><span class="line"><span class="comment"># This completes our travels</span></span><br></pre></td></tr></table></figure>

<h3 id="Practical-Examples"><a href="#Practical-Examples" class="headerlink" title="Practical Examples"></a>Practical Examples</h3><p>一些实用的脚本范例</p>
<blockquote>
<p>Finding executable files</p>
</blockquote>
<p>通过遍历 PATH 中的路径，统计处你可以运行的 commands 列表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat test25</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Finding file in the PATH</span></span><br><span class="line"><span class="comment"># IFS.OLD=$IFS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># IFS=:</span></span><br><span class="line"><span class="comment"># for folder in $PATH</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;$folder:&quot;</span></span><br><span class="line"><span class="comment">#     for file in $folder/*</span></span><br><span class="line"><span class="comment">#     do</span></span><br><span class="line"><span class="comment">#         if [ -x $file ]</span></span><br><span class="line"><span class="comment">#         then</span></span><br><span class="line"><span class="comment">#             echo &quot;    $file&quot;</span></span><br><span class="line"><span class="comment">#         fi</span></span><br><span class="line"><span class="comment">#     done</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># IFS=$IFS.OLD</span></span><br><span class="line">./test25 | more</span><br><span class="line"><span class="comment"># /Users/i306454/.jenv/bin:</span></span><br><span class="line"><span class="comment"># /usr/local/sbin:</span></span><br><span class="line"><span class="comment">#     /usr/local/sbin/unbound</span></span><br><span class="line"><span class="comment">#     ....</span></span><br></pre></td></tr></table></figure>

<p>PS: 这个 <code>more</code> 就用的很灵性！！</p>
<blockquote>
<p>Creating multiple user accounts</p>
</blockquote>
<p>将需要创建的新用户写到文件中，并通过脚本解析文件，批量创建</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Process new user accounts</span></span><br><span class="line"></span><br><span class="line">input=<span class="string">&quot;users.csv&quot;</span></span><br><span class="line"><span class="keyword">while</span> IFS=<span class="string">&#x27;,&#x27;</span> <span class="built_in">read</span> -r userid name</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;adding <span class="variable">$userid</span>&quot;</span></span><br><span class="line">    useradd -c <span class="string">&quot;<span class="variable">$name</span>&quot;</span> -m <span class="variable">$userid</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="string">&quot;<span class="variable">$input</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Chapter-14-Handling-User-Input"><a href="#Chapter-14-Handling-User-Input" class="headerlink" title="Chapter 14: Handling User Input"></a>Chapter 14: Handling User Input</h2><p>这章主要讲如何在脚本中做交互</p>
<h3 id="Passing-Parameters"><a href="#Passing-Parameters" class="headerlink" title="Passing Parameters"></a>Passing Parameters</h3><blockquote>
<p>Reading parameters</p>
</blockquote>
<p>bash 会将传入的所有变量都赋给 positional parameters. 这些位置变量以 <code>$</code> 开头，<code>$0</code> 为脚本名称，<code>$1</code> 为第一个参数，以此类推</p>
<p>根据传入参数计算斐波那契额终值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test1</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Using one command line parameter</span></span><br><span class="line"><span class="comment"># factorial=1</span></span><br><span class="line"><span class="comment"># for (( number=1; number&lt;=$1; number++ ))</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     factorial=$[ $factorial * $number ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"><span class="comment"># echo The factorial of $1 is $factorial</span></span><br><span class="line">./test1 5</span><br><span class="line"><span class="comment"># The factorial of 5 is 120</span></span><br></pre></td></tr></table></figure>

<p>多参数调用案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test2</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing two command line parameters</span></span><br><span class="line"><span class="comment"># total=$[ $1 * $2 ]</span></span><br><span class="line"><span class="comment"># echo The first parameter is $1</span></span><br><span class="line"><span class="comment"># echo The first parameter is $2</span></span><br><span class="line"><span class="comment"># echo The total value is $total</span></span><br><span class="line"></span><br><span class="line">./test2 2 5</span><br><span class="line"><span class="comment"># The first parameter is 2</span></span><br><span class="line"><span class="comment"># The first parameter is 5</span></span><br><span class="line"><span class="comment"># The total value is 10</span></span><br></pre></td></tr></table></figure>

<p>字符串作为参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat test3</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing string parameters</span></span><br><span class="line"><span class="comment"># echo Hello $1, glad to meet you</span></span><br><span class="line"></span><br><span class="line">bash-5.1$ ./test3 jack</span><br><span class="line"><span class="comment"># Hello jack, glad to meet you</span></span><br></pre></td></tr></table></figure>

<p>如果字符串之间有空格，需要用引号包裹起来</p>
<p>当参数数量超过 <strong>9</strong> 个的时候，你需要用花括号来调用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">at ./test4</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # handling lots of parameters</span></span><br><span class="line"><span class="comment"># total=$[ $&#123;10&#125; * $&#123;11&#125; ]</span></span><br><span class="line"><span class="comment"># echo The tenth parameter is $&#123;10&#125;</span></span><br><span class="line"><span class="comment"># echo The eleventh parameter is $&#123;11&#125;</span></span><br><span class="line"><span class="comment"># echo The total is $total</span></span><br><span class="line">./test4 1 2 3 4 5 6 7 8 9 10 11 12</span><br><span class="line"><span class="comment"># The tenth parameter is 10</span></span><br><span class="line"><span class="comment"># The eleventh parameter is 11</span></span><br><span class="line"><span class="comment"># The total is 110</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading the script name</p>
</blockquote>
<p>`$0 代表了脚本文件的名字</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test5</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing the $0 parameter</span></span><br><span class="line"><span class="comment"># echo the zero parameter is set to: $0</span></span><br><span class="line"></span><br><span class="line">bash test5</span><br><span class="line"><span class="comment"># the zero parameter is set to: test5</span></span><br><span class="line">./test5</span><br><span class="line"><span class="comment"># the zero parameter is set to: ./test5</span></span><br><span class="line">bash /Users/i306454/tmp/bash_test/test5</span><br><span class="line"><span class="comment"># the zero parameter is set to: /Users/i306454/tmp/bash_test/test5</span></span><br></pre></td></tr></table></figure>

<p>不一样的调用方式，得到的第 0 参数值会不一样，如果像统一得到文件名，可以使用 basename 命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat test5b</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Using basename with the $0 parameter</span></span><br><span class="line"><span class="comment"># name=$(basename $0)</span></span><br><span class="line"><span class="comment"># echo the zero parameter is set to: $name</span></span><br><span class="line"></span><br><span class="line">bash-5.1$ ./test5b</span><br><span class="line"><span class="comment"># the zero parameter is set to: test5b</span></span><br><span class="line">sh test5b</span><br><span class="line"><span class="comment"># the zero parameter is set to: test5b</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Testing parameters</p>
</blockquote>
<p>当脚本中需要用到参数，但是参数没有给，则脚本会抛异常，但是我们可以更优雅的处理这种情况</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test7 </span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing parameters before use</span></span><br><span class="line"><span class="comment"># if [ -n &quot;$1&quot; ]</span></span><br><span class="line"><span class="comment"># then</span></span><br><span class="line"><span class="comment">#     echo Hello $1, glad to meet you.</span></span><br><span class="line"><span class="comment"># else</span></span><br><span class="line"><span class="comment">#     echo &quot;Sorry, you did not identity yourself.&quot;</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"></span><br><span class="line">./test7 jack</span><br><span class="line"><span class="comment"># Hello jack, glad to meet you.</span></span><br><span class="line">./test7</span><br><span class="line"><span class="comment"># Sorry, you did not identity yourself.</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Special-Parameter-Variables"><a href="#Using-Special-Parameter-Variables" class="headerlink" title="Using Special Parameter Variables"></a>Using Special Parameter Variables</h3><blockquote>
<p>Counting parameters</p>
</blockquote>
<p><code>$#</code> 用于统计参数数量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test8</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Getting the number of parameters</span></span><br><span class="line"><span class="comment"># echo There were $# parameters supplied.</span></span><br><span class="line">./test8</span><br><span class="line"><span class="comment"># There were 0 parameters supplied.</span></span><br><span class="line">./test8 123</span><br><span class="line"><span class="comment"># There were 1 parameters supplied.</span></span><br><span class="line">./test8 1 2 3</span><br><span class="line"><span class="comment"># There were 3 parameters supplied.</span></span><br><span class="line">./test8 <span class="string">&quot;jack zheng&quot;</span></span><br><span class="line"><span class="comment"># There were 1 parameters supplied.</span></span><br></pre></td></tr></table></figure>

<p>根据上面的特性我们可以试着发散一下思路，尝试拿到最后一个参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat badtest1</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing grabbing last parameter</span></span><br><span class="line"><span class="comment"># echo The last parameter was $&#123;$#&#125;</span></span><br><span class="line">./badtest1 1 2 3</span><br><span class="line"><span class="comment"># The last parameter was 13965</span></span><br></pre></td></tr></table></figure>

<p>尝试失败，语法上来说，花括号中间是不允许有 <code>$</code> 符号的，你可以用叹号表达上面的意思</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing grabbing last parameter</span></span><br><span class="line"><span class="comment"># echo The last parameter was $&#123;!#&#125;</span></span><br><span class="line"></span><br><span class="line">./badtest1 1 2 3</span><br><span class="line"><span class="comment"># The last parameter was 3</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Grabbing all the data</p>
</blockquote>
<p>你可以使用 <code>$*</code> 或者 <code>$@</code> 拿到所有的参数，区别如下</p>
<ul>
<li><code>$*</code> 会将所有的参数当作一个变量对待</li>
<li><code>$@</code> 会将所有的参数当作类似数组那种概念，分开对待。也就是说，你可以在 for 中循环处理</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test11</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing $* and $@</span></span><br><span class="line"><span class="comment"># echo</span></span><br><span class="line"><span class="comment"># echo &quot;Using the \$* method: $*&quot;</span></span><br><span class="line"><span class="comment"># echo &quot;Using the \$@ method: $@&quot;</span></span><br><span class="line"></span><br><span class="line">./test11 a b c d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using the $* method: a b c d</span></span><br><span class="line"><span class="comment"># Using the $@ method: a b c d</span></span><br></pre></td></tr></table></figure>

<p>看上去没区别。。。这里需要结合 for 来观察</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat test12</span><br><span class="line"><span class="comment"># #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># # Testing $* and $@</span></span><br><span class="line"><span class="comment"># echo</span></span><br><span class="line"><span class="comment"># count=1</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># for param in &quot;$*&quot;</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;\$* Parameter #$count = $param&quot;</span></span><br><span class="line"><span class="comment">#     count=$[ $count + 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># echo</span></span><br><span class="line"><span class="comment"># count=1</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># for param in &quot;$@&quot;</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"><span class="comment">#     echo &quot;\$@ Parameter #$count = $param&quot;</span></span><br><span class="line"><span class="comment">#     count=$[ $count + 1 ]</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line">./test12 a b c d</span><br><span class="line"></span><br><span class="line"><span class="comment"># $* Parameter #1 = a b c d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $@ Parameter #1 = a</span></span><br><span class="line"><span class="comment"># $@ Parameter #2 = b</span></span><br><span class="line"><span class="comment"># $@ Parameter #3 = c</span></span><br><span class="line"><span class="comment"># $@ Parameter #4 = d</span></span><br></pre></td></tr></table></figure>

<h3 id="Being-Shify"><a href="#Being-Shify" class="headerlink" title="Being Shify"></a>Being Shify</h3><p>我们可以通过 <code>shift</code> 关键字将参数左移，默认左移一位.</p>
<p>PS: note that the value for variable <code>$0</code>, the program name, remains unchanged</p>
<p>PPS: Be careful when working with the shift command. When a parameter is shifted out, its value is lost and can’t be recovered.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test13</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Demostrating the shift command</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span> = <span class="variable">$1</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test13 a b c d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Parameter #1 = a</span></span><br><span class="line"><span class="comment"># Parameter #2 = b</span></span><br><span class="line"><span class="comment"># Parameter #3 = c</span></span><br><span class="line"><span class="comment"># Parameter #4 = d</span></span><br></pre></td></tr></table></figure>

<p>移动多个位置测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test14</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Demostrating a multi-position shift</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The original parameters: $*&quot;</span></span><br><span class="line"><span class="built_in">shift</span> 2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The changed parameters: $*&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Here is the new first parameter: <span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test14 1 2 3 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># The original parameters: 1 2 3 4</span></span><br><span class="line"><span class="comment"># The changed parameters: 3 4</span></span><br><span class="line"><span class="comment"># Here is the new first parameter: 3</span></span><br></pre></td></tr></table></figure>

<h3 id="Working-with-Options"><a href="#Working-with-Options" class="headerlink" title="Working with Options"></a>Working with Options</h3><p>介绍三种添加 Options 的方法，Options 顾名思义，就是命令中的可选参数。</p>
<blockquote>
<p>Finding your options</p>
</blockquote>
<p><strong>单个依次处理法：</strong> 可以使用 case + shift 的语法识别 options。将预先设置的 Options 添加在 case 的过滤列表中，然后遍历 <code>$1</code> 识别它</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat test15</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Extracting command line options as parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> </span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span>;;</span><br><span class="line">        -b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option&quot;</span>;;</span><br><span class="line">        -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span>;;</span><br><span class="line">         *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test15 -a -b -c -d asd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># -d is not an option</span></span><br><span class="line"><span class="comment"># asd is not an option</span></span><br></pre></td></tr></table></figure>

<p><strong>Options parameters 分开处理法：</strong> 我们可以认为的在两种参数中间添加一个分割符，比如 <code>--</code> 作为 options 的结束和 parameter 的开始. 在脚本中现实的识别并处理它。</p>
<p>PS: 突然意识到 <code>$0</code> 是不算在 <code>$*</code> 和 <code>$@</code> 中的</p>
<p>下面的例子中，如果没有 <code>--</code>，则所有参数都在第一个 do-while 中处理了。加了之后会在两个 loop 中处理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">cat test16</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Extracting options and parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span>;;</span><br><span class="line">        -b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option&quot;</span>;;</span><br><span class="line">        -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span>;;</span><br><span class="line">        --) <span class="built_in">shift</span></span><br><span class="line">            <span class="built_in">break</span>;;</span><br><span class="line">         *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test16 -c -a -b test1 test2 test3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option</span></span><br><span class="line"><span class="comment"># test1 is not an option</span></span><br><span class="line"><span class="comment"># test2 is not an option</span></span><br><span class="line"><span class="comment"># test3 is not an option</span></span><br><span class="line"></span><br><span class="line">./test16 -c -a -b -- test1 test2 test3</span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option</span></span><br><span class="line"><span class="comment"># Parameter #1: test1</span></span><br><span class="line"><span class="comment"># Parameter #2: test2</span></span><br><span class="line"><span class="comment"># Parameter #3: test3</span></span><br></pre></td></tr></table></figure>

<p><strong>带值的 options 处理：</strong> 有些命令中 options 是带值的，比如 <code>./testing.sh -a test1 -b -c -d test2</code>。这是我们就需要在脚本中识别可选参对应的值</p>
<p>下面的例子中 <code>-b test1</code> 是一个带值的可选参数，我们在 识别到 <code>-b</code> 后立即拿到 <code>$2</code> 即为对应的值</p>
<p>PS: 但是怎么看，bash 中添加可选参数都很麻烦啊，如果是可选参数带多个值呢，那不是还得加逻辑。。。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat test17</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Extracting command line options and values</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span>;;</span><br><span class="line">        -b) param=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Found the -b option, with parameter value <span class="variable">$param</span>&quot;</span></span><br><span class="line">            <span class="built_in">shift</span> ;;</span><br><span class="line">        -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span>;;</span><br><span class="line">        --) <span class="built_in">shift</span></span><br><span class="line">            <span class="built_in">break</span>;;</span><br><span class="line">         *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test17 -a -b test1 -d </span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with parameter value test1</span></span><br><span class="line"><span class="comment"># -d is not an option</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using the getopt command</p>
</blockquote>
<p>介绍 <code>getopt</code> 工具函数，方便处理传入的参数</p>
<p><strong>Looking at the command format</strong> <code>getopt</code> 可以接受一系列的 options 和 parameters 并以正确的格式返回, 语法如下 <code>getopt optstring parameters</code></p>
<p><strong>Tips</strong> getopt 还有一个增强版 getopts, 后面章节会介绍</p>
<p>测试 getopt, b 后面添加了冒号表示它是带值的可选参数. 如果输入的命令带有未定义的参数，则会给出错误信息。如果想要忽略错误信息，则需要 getopt 带 -q 参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getopt ab:<span class="built_in">cd</span> -a -b test1 -<span class="built_in">cd</span> test2 test3</span><br><span class="line"><span class="comment">#  -a -b test1 -c -d -- test2 test3</span></span><br><span class="line"></span><br><span class="line">getopt ab:<span class="built_in">cd</span> -a -b test1 -cde test2 test3</span><br><span class="line"><span class="comment"># getopt: illegal option -- e</span></span><br><span class="line"><span class="comment">#  -a -b test1 -c -d -- test2 test3</span></span><br><span class="line"></span><br><span class="line">getopt -q  ab:<span class="built_in">cd</span> -a -b test1 -cde test2 test3</span><br><span class="line"><span class="comment">#  -a -b &#x27;test1&#x27; -c -d -- &#x27;test2&#x27; &#x27;test3&#x27;</span></span><br></pre></td></tr></table></figure>

<p>PS: MacOS 的 bash 是不支持 -q 参数的！使用 docker 绕过了这个限制 诶嘿 ╮(￣▽￣””)╭</p>
<p><strong>Using getopt in your scripts</strong> 这里有一个小技巧，我们需要将 getopt 和 set 配和使用 <code>set -- $(getopt -q ab:cd &quot;$@&quot;)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Extracting command line options and values with getopt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">set</span> -- $(getopt ab:<span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>)</span><br><span class="line"><span class="comment"># 为了兼容 Mac version bash, 将参数去掉了</span></span><br><span class="line"><span class="comment"># set -- $(getopt -q ab:cd &quot;$@&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span>;;</span><br><span class="line">        -b) param=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Found the -b option, with parameter value <span class="variable">$param</span>&quot;</span></span><br><span class="line">            <span class="built_in">shift</span> ;;</span><br><span class="line">        -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span>;;</span><br><span class="line">        --) <span class="built_in">shift</span></span><br><span class="line">            <span class="built_in">break</span>;;</span><br><span class="line">         *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test18 -ac</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"></span><br><span class="line">./test18 -a -b test1 -<span class="built_in">cd</span> test2 test3 test4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with parameter value test1</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># -d is not an option</span></span><br><span class="line"><span class="comment"># Parameter #1: test2</span></span><br><span class="line"><span class="comment"># Parameter #2: test3</span></span><br><span class="line"><span class="comment"># Parameter #3: test4</span></span><br><span class="line"></span><br><span class="line">./test18 -a -b test1 -<span class="built_in">cd</span> <span class="string">&quot;test2 test3&quot;</span> test4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with parameter value test1</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"><span class="comment"># -d is not an option</span></span><br><span class="line"><span class="comment"># Parameter #1: test2</span></span><br><span class="line"><span class="comment"># Parameter #2: test3</span></span><br><span class="line"><span class="comment"># Parameter #3: test4</span></span><br></pre></td></tr></table></figure>

<p>PS: 最后一个例子中可以看到 getopt 并不能很好的处理字符串， “test2 test3” 被分开解析了。幸运的是，我们有办法解决这个问题</p>
<blockquote>
<p>Advancing to getopts</p>
</blockquote>
<p><code>getopts</code> 是 <code>getopt</code> 的增强版本，格式如下 <code>getopts optstring variable</code>, optstring 以冒号开始</p>
<p>如下所示，<code>getopts</code> </p>
<ul>
<li>自动为我们将每个参数封装到 opt 变量中</li>
<li>删选的时候省区了 <code>-</code></li>
<li>提供了内置的 <code>$OPTARG</code> 代表可选参数的值</li>
<li>将为定义的参数类型用问好替换</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat test19</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Simple demostration of the getopts command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> :ab:c opt</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$opt</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span> ;;</span><br><span class="line">        b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option, with value <span class="variable">$OPTARG</span>&quot;</span> ;;</span><br><span class="line">        c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span> ;;</span><br><span class="line">        *) <span class="built_in">echo</span> <span class="string">&quot;Unknown option: <span class="variable">$opt</span>&quot;</span> ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test19 -ab test1 -c </span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with value test1</span></span><br><span class="line"><span class="comment"># Found the -c option</span></span><br><span class="line"></span><br><span class="line">./test19 -b <span class="string">&quot;test1 test2&quot;</span> -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -b option, with value test1 test2</span></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"></span><br><span class="line">./test19 -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Unknown option: ?</span></span><br></pre></td></tr></table></figure>

<p><code>getopts</code> 还内置了一个 OPTIND 变量，可以在处理每个参数的时候自动 +1. OPTIND 变量初始值为 1，如果要取 params 部分，则 shift $[ $OPTIND - 1 ]</p>
<p>下面例子中, </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">cat test20</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Processing options $ paramters with getopts</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> start index: <span class="string">&quot;<span class="variable">$OPTIND</span>&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> :ab:<span class="built_in">cd</span> opt</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$opt</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span> ;;</span><br><span class="line">        b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option, with value <span class="variable">$OPTARG</span>&quot;</span> ;;</span><br><span class="line">        c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span> ;;</span><br><span class="line">        d) <span class="built_in">echo</span> <span class="string">&quot;Found the -d option&quot;</span> ;;</span><br><span class="line">        *) <span class="built_in">echo</span> <span class="string">&quot;Unknown option: <span class="variable">$opt</span>&quot;</span> ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">echo</span> changing index: <span class="string">&quot;<span class="variable">$OPTIND</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> opt index: <span class="string">&quot;<span class="variable">$OPTIND</span>&quot;</span></span><br><span class="line"><span class="built_in">shift</span> $[ <span class="variable">$OPTIND</span> -1 ]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Parameter <span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test20 -a -b test1 -d test2 test3 test4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Found the -a option</span></span><br><span class="line"><span class="comment"># Found the -b option, with value test1</span></span><br><span class="line"><span class="comment"># Found the -d option</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># opt index: 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parameter 1: test2</span></span><br><span class="line"><span class="comment"># Parameter 2: test3</span></span><br><span class="line"><span class="comment"># Parameter 3: test4</span></span><br></pre></td></tr></table></figure>

<h3 id="Standardizing-Options"><a href="#Standardizing-Options" class="headerlink" title="Standardizing Options"></a>Standardizing Options</h3><p>介绍 shell 中参数表示的 comman sense</p>
<table>
<thead>
<tr>
<th align="center">Option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-a</td>
<td align="left">Shows all objects</td>
</tr>
<tr>
<td align="center">-c</td>
<td align="left">Produces a count</td>
</tr>
<tr>
<td align="center">-d</td>
<td align="left">Specifies a directory</td>
</tr>
<tr>
<td align="center">-e</td>
<td align="left">Expands an object</td>
</tr>
<tr>
<td align="center">-f</td>
<td align="left">Specifies a file to read data from</td>
</tr>
<tr>
<td align="center">-h</td>
<td align="left">Displays a help message for the command</td>
</tr>
<tr>
<td align="center">-i</td>
<td align="left">Ignores text case</td>
</tr>
<tr>
<td align="center">-l</td>
<td align="left">Produces a long format version of the output</td>
</tr>
<tr>
<td align="center">-n</td>
<td align="left">Uses a non-interactive(batch) mode</td>
</tr>
<tr>
<td align="center">-o</td>
<td align="left">Specifies an output file to redirect all output</td>
</tr>
<tr>
<td align="center">-q</td>
<td align="left">Run in quiet mode</td>
</tr>
<tr>
<td align="center">-r</td>
<td align="left">Processes directories and files recursively</td>
</tr>
<tr>
<td align="center">-s</td>
<td align="left">Runs in silent mode</td>
</tr>
<tr>
<td align="center">-v</td>
<td align="left">Produces verbose output</td>
</tr>
<tr>
<td align="center">-x</td>
<td align="left">Excludes an object</td>
</tr>
<tr>
<td align="center">-y</td>
<td align="left">Answers yes to all questions</td>
</tr>
</tbody></table>
<h3 id="Getting-User-Input"><a href="#Getting-User-Input" class="headerlink" title="Getting User Input"></a>Getting User Input</h3><p>bash 提供了 read 方法来作为用户输入</p>
<blockquote>
<p>Reading basics</p>
</blockquote>
<p><code>read</code> 可以从键盘或文件中获取输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test21</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the read command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Enter your name: &quot;</span></span><br><span class="line"><span class="built_in">read</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello <span class="variable">$name</span>, welcome to my program.&quot;</span></span><br><span class="line"></span><br><span class="line">./test21 </span><br><span class="line"><span class="comment"># Enter your name: jack</span></span><br><span class="line"><span class="comment"># Hello jack, welcome to my program.</span></span><br><span class="line"></span><br><span class="line">./test21</span><br><span class="line"><span class="comment"># Enter your name: jack zheng</span></span><br><span class="line"><span class="comment"># Hello jack zheng, welcome to my program.</span></span><br></pre></td></tr></table></figure>

<p>上面的例子中，cmd 会将所有的输入看作一个变量处理</p>
<p>带用户提示的输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test22</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the read -p option</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please enter your age: &quot;</span> age</span><br><span class="line">days=$[ <span class="variable">$age</span> * 365 ]</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;That makes you over <span class="variable">$days</span> days old! &quot;</span></span><br><span class="line"></span><br><span class="line">./test22</span><br><span class="line"><span class="comment"># Please enter your age: 5</span></span><br><span class="line"><span class="comment"># That makes you over 1825 days old!</span></span><br></pre></td></tr></table></figure>

<p>和第一个实验对照，cmd 也可以将所有输入当作 list 处理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat test23</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the read command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter your name: &quot;</span> first last</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Checking data for <span class="variable">$last</span>, <span class="variable">$first</span>&quot;</span></span><br><span class="line"></span><br><span class="line">./test23</span><br><span class="line"><span class="comment"># Enter your name: jack zheng</span></span><br><span class="line"><span class="comment"># Checking data for zheng, jack</span></span><br></pre></td></tr></table></figure>

<p>如果你没有为 read 指定变量，bash 会自动将这个值赋给环境变量 $REPLY</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat test24</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the REPLY Environment variable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Enter your name: &quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello <span class="variable">$REPLY</span>, welcome to my program.&quot;</span></span><br><span class="line"></span><br><span class="line">./test24 </span><br><span class="line"><span class="comment"># Enter your name: jack zheng</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hello jack zheng, welcome to my program.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Timing out</p>
</blockquote>
<p>默认情况下 read 会一直阻塞在那里，等待用户输入，但是我们也可以设置一个等待时间</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test25</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Timing the data entry</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">read</span> -t 5 -p <span class="string">&quot;Please enter your name: &quot;</span> name</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Hello <span class="variable">$name</span>, welcome to my script&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Sorry, too slow! &quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">./test25</span><br><span class="line"><span class="comment"># Please enter your name: </span></span><br><span class="line"><span class="comment"># Sorry, too slow! </span></span><br><span class="line">./test25</span><br><span class="line"><span class="comment"># Please enter your name: jack</span></span><br><span class="line"><span class="comment"># Hello jack, welcome to my script</span></span><br></pre></td></tr></table></figure>

<p>read 还可以指定输入的长度, 设定好长度后，你输入对应长度的内容，他立马就执行下去了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat test26</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Getting just one character of input</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -n1 -p <span class="string">&quot;Do you want to continue [Y/N]? &quot;</span> answer</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$answer</span> <span class="keyword">in</span></span><br><span class="line">Y | y)  <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;fine, continue on...&quot;</span> ;;</span><br><span class="line">N | n) <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">echo</span> OK, goodbye</span><br><span class="line">        <span class="built_in">exit</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the script&quot;</span></span><br><span class="line"></span><br><span class="line">./test26</span><br><span class="line"><span class="comment"># Do you want to continue [Y/N]? y</span></span><br><span class="line"><span class="comment"># fine, continue on...</span></span><br><span class="line"><span class="comment"># This is the end of the script</span></span><br><span class="line"></span><br><span class="line">./test26</span><br><span class="line"><span class="comment"># Do you want to continue [Y/N]? n</span></span><br><span class="line"><span class="comment"># OK, goodbye</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading with no display</p>
</blockquote>
<p>在输入一些敏感信息时，你不希望他显示在屏幕上，可以用 -s 参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test27</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># hiding input data from the monitor</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -s -p <span class="string">&quot;Enter your password: &quot;</span> pass</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Is you password really <span class="variable">$pass</span>? &quot;</span></span><br><span class="line"></span><br><span class="line">./test27</span><br><span class="line"><span class="comment"># Enter your password: </span></span><br><span class="line"><span class="comment"># Is you password really jack?</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reading from a file</p>
</blockquote>
<p>Linux 系统中，可以通过 read 命令从文件中按行读取。当读完后，返回非 0</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat test28</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Reading data from a file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line">cat <span class="built_in">test</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Line <span class="variable">$count</span>: <span class="variable">$line</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Finished process the file&quot;</span></span><br><span class="line"></span><br><span class="line">cat <span class="built_in">test</span></span><br><span class="line"><span class="comment"># line 1</span></span><br><span class="line"><span class="comment"># line 2</span></span><br><span class="line">./test28</span><br><span class="line">Line 1: line 1</span><br><span class="line">Line 2: line 2</span><br><span class="line">Finished process the file</span><br></pre></td></tr></table></figure>

<p>PS: 如果文件的末行没有换行，则最后一行并不会被处理</p>
<h2 id="Presenting-Data"><a href="#Presenting-Data" class="headerlink" title="Presenting Data"></a>Presenting Data</h2><p>这章主要向你展示更多的输出流处理技巧</p>
<h3 id="Understanding-Input-and-Output"><a href="#Understanding-Input-and-Output" class="headerlink" title="Understanding Input and Output"></a>Understanding Input and Output</h3><p>现在为止，我们主要采取两种输出流展示方式</p>
<ul>
<li>终端屏显</li>
<li>重定向到文件</li>
</ul>
<p>目前为止我们只能将全部内容一起输出到文件或屏幕，在下面的小节中，我们将尝试将内容分开处理</p>
<blockquote>
<p>Standard file descriptors</p>
</blockquote>
<p>Linux 系统通过 file descriptor 来指代每一个文件对象，这个 decriptor 是一个唯一的非负的整数。每个进程同一时间允许至多 9 个打开的文件。bash 中将 0，1 和 2 用于特定的用途</p>
<table>
<thead>
<tr>
<th align="center">File descriptor</th>
<th align="center">Abbreviation</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">STDIN</td>
<td align="center">Standard input</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">STDOUT</td>
<td align="center">Standard output</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">STDERR</td>
<td align="center">Standard error</td>
</tr>
</tbody></table>
<p><strong>STDIN</strong> 标准输入，比如终端的键盘输入和 <code>&lt;</code> 的文件输入. 很多 bash 命令接收 STDIN 的输入，比如 cat， 如果你没有指定文件，他就会接收键盘输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat </span><br><span class="line">thi</span><br><span class="line">thi</span><br><span class="line">this</span><br><span class="line">this</span><br></pre></td></tr></table></figure>

<p><strong>STDOUT</strong> shell 的标准输出就是 terminal monitor.</p>
<p><strong>STDERR</strong> 当运行命令出异常了，可以使用这个 descriptor 导流</p>
<h3 id="Redirecting-errors"><a href="#Redirecting-errors" class="headerlink" title="Redirecting errors"></a>Redirecting errors</h3><blockquote>
<p>Redirecting error only</p>
</blockquote>
<p>像前面表哥所示，STDERR 的文件描述符是 2，你可以在 redirection symbol 前加上这个标识符来指定导向</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -al badfile 2&gt; test4</span><br><span class="line">cat test4</span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br></pre></td></tr></table></figure>

<p>下面的例子中，badfile 不存在，所以错误信息写入 test5 中，test4 存在，所以在屏幕上显示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -al test4 badfile 2&gt; test5</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  0 May 29 14:07 test4</span></span><br><span class="line">cat test5</span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Redirecting errors and data</p>
</blockquote>
<p>如果你想将正常和异常的信息都输出到文件，你需要指定两个输出</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ls </span><br><span class="line"><span class="comment"># test5</span></span><br><span class="line">ls -al test5 badfile 2&gt; test6 1&gt; test7</span><br><span class="line">ls</span><br><span class="line"><span class="comment"># test5   test6   test7</span></span><br><span class="line">cat test6</span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br><span class="line">cat test7</span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  39 May 29 14:08 test5</span></span><br></pre></td></tr></table></figure>

<p>如果你想将这两种信息都导入一个文件，bash 提供了一个特殊的 redirection symbol 来做这个事情 <code>&amp;&gt;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -al test5 badfile &amp;&gt; test8</span><br><span class="line">cat test8</span><br><span class="line"><span class="comment"># ls: badfile: No such file or directory</span></span><br><span class="line"><span class="comment"># -rw-r--r--  1 i306454  staff  39 May 29 14:08 test5</span></span><br></pre></td></tr></table></figure>

<h3 id="Redirecting-Output-in-Scripts"><a href="#Redirecting-Output-in-Scripts" class="headerlink" title="Redirecting Output in Scripts"></a>Redirecting Output in Scripts</h3><p>通过 STDOUT 和 STDERR 你可以将输出导入任何 file discriptors. 有两种方式可以重定向输出</p>
<ul>
<li>Temporarily redirecting each line</li>
<li>Permanently redirecting all comands in the script</li>
</ul>
<blockquote>
<p>Temorary redirections</p>
</blockquote>
<p>这段文字的描述有点蹩脚，还是直接用案例说明把。假如你想将你的 echo 内容输出到 STDERR 指定的流中，需要怎么做？这种用法就是打印自己的 err log 啊, 可以使用 <code>&gt;&amp;2</code> 的格式</p>
<p>下面的例子中，test8 中指定第一个 echo 通过 STDERR 输出，第二个 STDOUT 输出。当直接调用时，由于两个输出默认都是打在公屏上的，所以没什么区别，但是当我指定 err 输出到 test9 时，区别就出现了。只有错误信息导到 test9 了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test8</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing STDERR messages</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is an error&quot;</span> &gt;&amp;2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is normal output&quot;</span></span><br><span class="line"></span><br><span class="line">./test8</span><br><span class="line">This is an error</span><br><span class="line">This is normal output</span><br><span class="line"></span><br><span class="line">./test8 2&gt; test9</span><br><span class="line"><span class="comment"># This is normal output</span></span><br><span class="line">cat test9</span><br><span class="line"><span class="comment"># This is an error</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Permanent redirections</p>
</blockquote>
<p>上面的情况适合少量打 log 的情况。如果你有好多 err 需要重新导向，你可以这么做</p>
<p>exec 会启动一个新的 shell，下例中新启动的 shell 会将 STDOUT 的内容都发送的 testout 文件中去</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat test10</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting all output to a file</span></span><br><span class="line"><span class="built_in">exec</span> 1&gt;testout</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test of redirecting all output&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;from a script to another file.&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Without having to redirect every individual line&quot;</span></span><br><span class="line"></span><br><span class="line">./test10</span><br><span class="line">cat testout</span><br><span class="line"><span class="comment"># This is a test of redirecting all output</span></span><br><span class="line"><span class="comment"># from a script to another file.</span></span><br><span class="line"><span class="comment"># Without having to redirect every individual line</span></span><br></pre></td></tr></table></figure>

<p>你可以在程序中间做这样的操作. 下面的例子中，我们在开头部分指定 err 输出到 testerror 文件，接着打印两个普通输出。再指定普通输出，输出到文件，最后指定 err 输出到 err 文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat test11</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting output to different locations</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 2&gt; testerror</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the start of the script&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;now redirecting all output to another location&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 1&gt;testout</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This output should go to the testout file&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;but this should go to the testerror file&quot;</span> &gt;&amp;2</span><br><span class="line"></span><br><span class="line">./test11</span><br><span class="line"><span class="comment"># This is the start of the script</span></span><br><span class="line"><span class="comment"># now redirecting all output to another location</span></span><br><span class="line">cat testout</span><br><span class="line"><span class="comment"># This output should go to the testout file</span></span><br><span class="line">cat testerror</span><br><span class="line"><span class="comment"># but this should go to the testerror file</span></span><br></pre></td></tr></table></figure>

<p>当你改变了 STDOUT 或者 STDERR 后，要再改回来就不是那么容易了，如果你需要切换这些流，需要用到一些技巧，这些将在后面的 Creating Your Own Redirection 章节讲到</p>
<h3 id="Redirecting-Input-in-Scripts"><a href="#Redirecting-Input-in-Scripts" class="headerlink" title="Redirecting Input in Scripts"></a>Redirecting Input in Scripts</h3><p>和输出流一样，我们可以通过定向符号操纵输入流 <code>exec 0&lt; testfile</code></p>
<p>下面的例子中，我们以文件中的命令代替键盘输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat test12</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting file input</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 0&lt; test12</span><br><span class="line">count=1</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line </span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Line #<span class="variable">$count</span>: <span class="variable">$line</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test12</span><br><span class="line"><span class="comment"># Line #1: #!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Line #2: # Redirecting file input</span></span><br><span class="line"><span class="comment"># Line #3: </span></span><br><span class="line"><span class="comment"># Line #4: exec 0&lt; test12</span></span><br><span class="line"><span class="comment"># Line #5: count=1</span></span><br><span class="line"><span class="comment"># Line #6: </span></span><br><span class="line"><span class="comment"># Line #7: while read line</span></span><br><span class="line"><span class="comment"># Line #8: do</span></span><br><span class="line"><span class="comment"># Line #9: echo &quot;Line #$count: $line&quot;</span></span><br><span class="line"><span class="comment"># Line #10: count=$[ $count + 1 ]</span></span><br><span class="line"><span class="comment"># Line #11: done</span></span><br><span class="line"><span class="comment"># Line #12:</span></span><br></pre></td></tr></table></figure>

<h3 id="Creating-Your-Own-Redirection"><a href="#Creating-Your-Own-Redirection" class="headerlink" title="Creating Your Own Redirection"></a>Creating Your Own Redirection</h3><p>shell 中最多只能有 9 个 file descriptor， 我们已经用了 0，1，2.下面我们将使用 3-8 自定义我们自己的 file descriptor.</p>
<blockquote>
<p>Creating output file descriptors</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test13</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using an alternative file descriptor</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test13out</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This should display on the monitor&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;and this should stored in the file&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Then this should be back on the monitor&quot;</span></span><br><span class="line"></span><br><span class="line">./test13</span><br><span class="line"><span class="comment"># This should display on the monitor</span></span><br><span class="line"><span class="comment"># Then this should be back on the monitor</span></span><br><span class="line">cat test13out </span><br><span class="line"><span class="comment"># and this should stored in the file</span></span><br></pre></td></tr></table></figure>

<p>这个概念听起来有点复杂，但是其实很直接了当的，用法也和前面的默认文件描述符是一致的。</p>
<blockquote>
<p>Redirecting file descriptors</p>
</blockquote>
<p>下面的例子中我们会做重定向的切换。开始时，我们用 3 号 descriptor 代替 1 的位置。就是所有的 echo 都会输入到 3 号中，之后，我们还原，echo 就又输出到屏幕了。这个其实只用到了一个语法 <code>3&gt;&amp;1</code>，这个语句就是用 3 代替 1， 还原的时候顺序翻一下即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat test14</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using STDOUT, then coming back to it</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;1</span><br><span class="line"><span class="built_in">exec</span> 1&gt;test14out</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This should store in the output file&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;along with this lien&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 1&gt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Now things should be back to normal&quot;</span></span><br><span class="line"></span><br><span class="line">./test14</span><br><span class="line"><span class="comment"># Now things should be back to normal</span></span><br><span class="line">cat test14out</span><br><span class="line"><span class="comment"># This should store in the output file</span></span><br><span class="line"><span class="comment"># along with this lien</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Creating input file descriptors</p>
</blockquote>
<p>和输出流一样，输入流也可以用上面的这个技巧。下面的例子中，我们先用 6 号代替原始的 0 号键盘输入，做完操作后将它还原</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat test15</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting input file descriptors</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&amp;0</span><br><span class="line"><span class="built_in">exec</span> 0&lt; testfile</span><br><span class="line"></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Line #<span class="variable">$count</span>: <span class="variable">$line</span>&quot;</span></span><br><span class="line">    count=$[ <span class="variable">$ount</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 0&lt;&amp;6</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Are you done now? &quot;</span> answer</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$answer</span> <span class="keyword">in</span></span><br><span class="line">Y | y) <span class="built_in">echo</span> <span class="string">&quot;Goodbye&quot;</span> ;;</span><br><span class="line">N | n) <span class="built_in">echo</span> <span class="string">&quot;Sorry, this is the end.&quot;</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">./test15</span><br><span class="line"><span class="comment"># Line #1: line 1</span></span><br><span class="line"><span class="comment"># Line #1: line 2</span></span><br><span class="line"><span class="comment"># Line #1: line 3</span></span><br><span class="line"><span class="comment"># Are you done now? y</span></span><br><span class="line"><span class="comment"># Goodbye</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Creating a read/write file descriptor</p>
</blockquote>
<p>感觉这个例子有点。。。鸡肋。虽然实用性不高，但是挺有趣</p>
<p>下面的例子中，我们会将 3 同时设置为输入输出描述符。先读取一行，再输入一行。读取一行后，位置定位到第二行开头，这个时候写我们自己的内容，他会覆盖之前的内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat test16</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Redirecting input/output file descriptor</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&lt;&gt; testfile</span><br><span class="line"><span class="built_in">read</span> line &lt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Read: <span class="variable">$line</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line">cat testfile </span><br><span class="line"><span class="comment"># This is the first line.</span></span><br><span class="line"><span class="comment"># This is the second line.</span></span><br><span class="line"><span class="comment"># This is the third line.</span></span><br><span class="line"></span><br><span class="line">./test16</span><br><span class="line"><span class="comment"># Read: This is the first line.</span></span><br><span class="line"></span><br><span class="line">cat testfile</span><br><span class="line"><span class="comment"># This is the first line.</span></span><br><span class="line"><span class="comment"># This is a test line</span></span><br><span class="line"><span class="comment"># ine.</span></span><br><span class="line"><span class="comment"># This is the third line.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Closing file descriptors</p>
</blockquote>
<p>新创建的 file descriptors 都会在脚本结束时自动关闭。但是如果你想在接本结束前手动关闭，需要做什么？</p>
<p>关闭的格式如下 <code>exec 3&gt;&amp;-</code>, 下面的实验中我们将 3 号指向文件，输出内容，再关闭它，再试着输出内容。可以看到，关闭后再输出会抛异常</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat badtest</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing closing file descriptors</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test17file</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line of data&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This won&#x27;t work&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line">./badtest</span><br><span class="line"><span class="comment"># ./badtest: line 10: 3: Bad file descriptor</span></span><br><span class="line">cat test17file</span><br><span class="line"><span class="comment"># This is a test line of data</span></span><br></pre></td></tr></table></figure>

<p>除此之外还有一个更重要的细节需要注意，如果你在一个脚本中，关闭后再使用同一个 file descriptor 的话。它会将之前写的内容覆盖掉</p>
<p>下面实验中，我们先用 3 号描述符将信息写入文件，关闭后 cat 输出，再打开它写东西。最后发现之前写的被覆盖了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test17</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing closing file descriptors</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test17file</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line of data&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line"></span><br><span class="line">cat test17file</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test17file</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This&#x27;ll be bad&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line">./test17</span><br><span class="line"><span class="comment"># This is a test line of data</span></span><br><span class="line">cat test17file </span><br><span class="line"><span class="comment"># This&#x27;ll be bad</span></span><br></pre></td></tr></table></figure>

<h3 id="Listing-Open-File-Descriptors"><a href="#Listing-Open-File-Descriptors" class="headerlink" title="Listing Open File Descriptors"></a>Listing Open File Descriptors</h3><p><code>lsof</code> 可以列出整个系统所有发开的 file descriptor, 这个在权限方面有些争议。MacOS 也有这个命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> lsof</span><br><span class="line"><span class="comment"># /usr/sbin/lsof</span></span><br></pre></td></tr></table></figure>

<p>显示当前进程的文件描述符使用情况</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lsof -a -p $$ -d 0,1,2</span><br><span class="line"><span class="comment"># COMMAND   PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span></span><br><span class="line"><span class="comment"># bash    35349 i306454    0u   CHR   16,1 0t937569  667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    35349 i306454    1u   CHR   16,1 0t937569  667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    35349 i306454    2u   CHR   16,1 0t937569  667 /dev/ttys001</span></span><br></pre></td></tr></table></figure>

<p>lsof 输出说明</p>
<table>
<thead>
<tr>
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">COMMAND</td>
<td align="left">The first nine characters of the name of the command in the process</td>
</tr>
<tr>
<td align="left">PID</td>
<td align="left">The process ID of the process</td>
</tr>
<tr>
<td align="left">USER</td>
<td align="left">The login name of the user who owns the process</td>
</tr>
<tr>
<td align="left">FD</td>
<td align="left">The file descriptor number and access type. r-read, w-write, u-read/write</td>
</tr>
<tr>
<td align="left">TYPE</td>
<td align="left">The type of file. CHR-character, BLK-block, DIR-directory, REG-regular file</td>
</tr>
<tr>
<td align="left">DEVICE</td>
<td align="left">The device numbers(major and minor) of the device</td>
</tr>
<tr>
<td align="left">SIZE</td>
<td align="left">If available, the size of the file</td>
</tr>
<tr>
<td align="left">NODE</td>
<td align="left">The node number of the local file</td>
</tr>
<tr>
<td align="left">NAME</td>
<td align="left">The name of the file</td>
</tr>
</tbody></table>
<p>作为对比，下面是一个文件中的 file descriptor 的信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test18</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing lsof with file descriptors</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt; test18file1</span><br><span class="line"><span class="built_in">exec</span> 6&gt; test18file2</span><br><span class="line"><span class="built_in">exec</span> 7&lt; testfile</span><br><span class="line"></span><br><span class="line">lsof -a -p $$ -d 0,1,2,3,6,7</span><br><span class="line"></span><br><span class="line">./test18</span><br><span class="line"><span class="comment"># COMMAND   PID    USER   FD   TYPE DEVICE SIZE/OFF     NODE NAME</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    0u   CHR   16,1 0t937995      667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    1u   CHR   16,1 0t937995      667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    2u   CHR   16,1 0t937995      667 /dev/ttys001</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    3w   REG    1,5        0 51179042 /Users/i306454/tmp/bash_test/test18file1</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    6w   REG    1,5        0 51179043 /Users/i306454/tmp/bash_test/test18file2</span></span><br><span class="line"><span class="comment"># bash    39156 i306454    7r   REG    1,5       73 51174255 /Users/i306454/tmp/bash_test/testfile</span></span><br></pre></td></tr></table></figure>

<h3 id="Suppressing-Command-Output"><a href="#Suppressing-Command-Output" class="headerlink" title="Suppressing Command Output"></a>Suppressing Command Output</h3><p>有些时候，你并不想看到任何异常输出，比如后台运行的时候。这时你可以将 STDERR 的内容输出到 null file 中去，位置是 /dev/null</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls -al &gt; /dev/null</span><br><span class="line"><span class="comment"># cat /dev/null</span></span><br><span class="line"></span><br><span class="line">ls -al badfile test16 2&gt; /dev/null</span><br><span class="line"><span class="comment"># -rwxr--r--  1 i306454  staff  151 May 30 15:12 test16</span></span><br></pre></td></tr></table></figure>

<p>你也可以将输入指定到 null file. 这样做可以快速清空一个文件，算是 rm + touch 的简化版</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat testfile</span><br><span class="line"><span class="comment"># This is the first line.</span></span><br><span class="line"><span class="comment"># This is a test line</span></span><br><span class="line"><span class="comment"># ine.</span></span><br><span class="line"><span class="comment"># This is the third line.</span></span><br><span class="line"></span><br><span class="line">cat /dev/null &gt; testfile</span><br><span class="line">cat testfile</span><br></pre></td></tr></table></figure>

<h3 id="Using-Temporary-Files"><a href="#Using-Temporary-Files" class="headerlink" title="Using Temporary Files"></a>Using Temporary Files</h3><p>Linux 系统预留了 <code>/tmp</code> 文件夹放置临时文件, 设置提供了专用命令 <code>mktemp</code> 来创建临时文件，这个命令创建的文件在 umask 上给创建者所有权限，其他人则没有权限</p>
<blockquote>
<p>Creating a local temporary file</p>
</blockquote>
<p>零时文件名字中的末尾的大写 X 会被替换成随机数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mktemp testing.XXXXXX</span><br><span class="line">ls testing*</span><br><span class="line"><span class="comment"># testing.I3p5pe</span></span><br></pre></td></tr></table></figure>

<p>实验脚本中，我们创建一个临时文件并写入内容，然后关闭流，并 cat 一下。最后移除文件。把异常信息丢掉不显示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat test19</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Creating and using a temp file</span></span><br><span class="line"></span><br><span class="line">tempfile=$(mktemp test19.XXXXXX)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt;<span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This script writes to temp file <span class="variable">$tempfile</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the first line&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the second line&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the third line&quot;</span> &gt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Done creating temp file. the contents are:&quot;</span></span><br><span class="line">cat <span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line">rm -f <span class="variable">$tempfile</span> 2&gt; /dev/null</span><br><span class="line"></span><br><span class="line">./test19</span><br><span class="line"><span class="comment"># This script writes to temp file test19.ksgCft</span></span><br><span class="line"><span class="comment"># Done creating temp file. the contents are:</span></span><br><span class="line"><span class="comment"># This is the first line</span></span><br><span class="line"><span class="comment"># This is the second line</span></span><br><span class="line"><span class="comment"># This is the third line</span></span><br><span class="line">ls test19*</span><br><span class="line"><span class="comment"># test19</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Creating a temporary file in /tmp</p>
</blockquote>
<p>前面的临时文件都是创建在当前文件夹下的，下面介绍在 tmp 文件夹下的创建办法，其实就是加一个 -t 的参数。。。结果和书上有区别，并该是 MacOS 定制过</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mktemp -t test.XXXXXX</span><br><span class="line"><span class="comment"># /var/folders/yr/8yr4mzlj1x34tf4m9c_wh2_h0000gn/T/test.XXXXXX.enBtwKYB</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat test20</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Creating a temp file in /tmp</span></span><br><span class="line"></span><br><span class="line">tempfile=$(mktemp tmp.XXXXXX)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test file.&quot;</span> &gt; <span class="variable">$tempfile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the second line of the test.&quot;</span> &gt;&gt; <span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The temp file is located at: <span class="variable">$tempfile</span>&quot;</span></span><br><span class="line">cat <span class="variable">$tempfile</span></span><br><span class="line">rm -f <span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line">./test20</span><br><span class="line"><span class="comment"># The temp file is located at: tmp.OldzdO</span></span><br><span class="line"><span class="comment"># This is a test file.</span></span><br><span class="line"><span class="comment"># This is the second line of the test.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Creating a temporary directory</p>
</blockquote>
<p>-d 创建临时文件夹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat test21</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using a temporary directory</span></span><br><span class="line"></span><br><span class="line">tempdir=$(mktemp -d dir.XXXXXX)</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$tempdir</span></span><br><span class="line">tempfile1=$(mktemp temp.XXXXXX)</span><br><span class="line">tempfile2=$(mktemp temp.XXXXXX)</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 7&gt; <span class="variable">$tempfile1</span></span><br><span class="line"><span class="built_in">exec</span> 8&gt; <span class="variable">$tempfile2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Sending data to directory <span class="variable">$tempdir</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line of data for <span class="variable">$tempfile1</span>&quot;</span> &gt;&amp;7</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test line of data for <span class="variable">$tempfile2</span>&quot;</span> &gt;&amp;8</span><br><span class="line"></span><br><span class="line">./test21</span><br><span class="line"><span class="comment"># Sending data to directory dir.hE8Hbr</span></span><br><span class="line"></span><br><span class="line">ls -l dir*</span><br><span class="line"><span class="comment"># total 16</span></span><br><span class="line"><span class="comment"># -rw-------  1 i306454  staff  44 May 30 16:53 temp.2V4FAk</span></span><br><span class="line"><span class="comment"># -rw-------  1 i306454  staff  44 May 30 16:53 temp.59JjLm</span></span><br><span class="line"></span><br><span class="line">cat dir.hE8Hbr/temp.2V4FAk </span><br><span class="line"><span class="comment"># This is a test line of data for temp.2V4FAk</span></span><br><span class="line">cat dir.hE8Hbr/temp.59JjLm </span><br><span class="line"><span class="comment"># This is a test line of data for temp.59JjLm</span></span><br></pre></td></tr></table></figure>

<h3 id="Logging-Messages"><a href="#Logging-Messages" class="headerlink" title="Logging Messages"></a>Logging Messages</h3><p>有时你可能想一个流即打印到屏幕上，也输出到文件中，这个时候，你可以使用 tee</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">date | tee testfile </span><br><span class="line"><span class="comment"># Sun May 30 16:58:30 CST 2021</span></span><br><span class="line">cat testfile </span><br><span class="line"><span class="comment"># Sun May 30 16:58:30 CST 2021</span></span><br></pre></td></tr></table></figure>

<p>注意，tee 默认会覆盖原有内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">who | tee testfile</span><br><span class="line"><span class="comment"># i306454  console  May 27 15:12 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 27 16:21 </span></span><br><span class="line">cat testfile </span><br><span class="line"><span class="comment"># i306454  console  May 27 15:12 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 27 16:21</span></span><br></pre></td></tr></table></figure>

<p>之前 date 的内容被覆盖了，你可以用 -a 做 append 操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date | tee -a testfile</span><br><span class="line"><span class="comment"># Sun May 30 17:00:41 CST 2021</span></span><br><span class="line">cat testfile </span><br><span class="line"><span class="comment"># i306454  console  May 27 15:12 </span></span><br><span class="line"><span class="comment"># i306454  ttys000  May 27 16:21 </span></span><br><span class="line"><span class="comment"># Sun May 30 17:00:41 CST 2021</span></span><br></pre></td></tr></table></figure>

<p>实操</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test22</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Using the tee command for logging</span></span><br><span class="line"></span><br><span class="line">tempfile=test22file</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the start of the test&quot;</span> | tee <span class="variable">$tempfile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the second of the test&quot;</span> | tee -a <span class="variable">$tempfile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the test&quot;</span> | tee -a <span class="variable">$tempfile</span></span><br><span class="line"></span><br><span class="line">./test22</span><br><span class="line"><span class="comment"># This is the start of the test</span></span><br><span class="line"><span class="comment"># This is the second of the test</span></span><br><span class="line"><span class="comment"># This is the end of the test</span></span><br><span class="line">cat test22file </span><br><span class="line"><span class="comment"># This is the start of the test</span></span><br><span class="line"><span class="comment"># This is the second of the test</span></span><br><span class="line"><span class="comment"># This is the end of the test</span></span><br></pre></td></tr></table></figure>

<h3 id="Practical-Example"><a href="#Practical-Example" class="headerlink" title="Practical Example"></a>Practical Example</h3><p>解析一个 csv 文件，将其中的内容重组成一个 SQL 文件用作 import</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- cat members.csv  --&gt;</span><br><span class="line">Blum,Richard,123 Main St.,Chicago,IL,60601</span><br><span class="line">Blum,Barbara,123 Main St.,Chicago,IL,60601</span><br><span class="line">Bresnahan,Christine,456 Oak Ave.,Columbus,OH,43201</span><br><span class="line">Bresnahan,Timothy,456 Oak Ave.,Columbus,OH,43201bash-5.1$ .&#x2F;test23</span><br></pre></td></tr></table></figure>

<p>主要语法说明</p>
<ul>
<li>done &lt; ${1}: 将命令行中给的文件做输入</li>
<li>read lname…: 以逗号为分割，每个字段给个名字，方便后面调用</li>
<li>cat &gt;&gt; $outfile &lt;&lt; EOF: cat 会拿到一行的内容，并对这些内容做替换放到 outfile 中去. 这个用法和 tee myfile &lt;&lt; EOF.. 有异曲同工之妙</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat test23</span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Read file and create INSERT statements for MySQL</span></span><br><span class="line"></span><br><span class="line">outfile=<span class="string">&#x27;members.sql&#x27;</span></span><br><span class="line">IFS=<span class="string">&#x27;,&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> lname fname address city state zip</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    cat &gt;&gt; <span class="variable">$outfile</span> &lt;&lt; EOF</span><br><span class="line">    INSERT INTO members (lname, fname, address, city, state, zip) VALUES (<span class="string">&#x27;$lanme&#x27;</span>, <span class="string">&#x27;$fname&#x27;</span>, <span class="string">&#x27;$address&#x27;</span>, <span class="string">&#x27;$city&#x27;</span>, <span class="string">&#x27;$state&#x27;</span>, <span class="string">&#x27;$zip&#x27;</span>);</span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$&#123;1&#125;</span></span><br><span class="line"></span><br><span class="line">./test23 members.csv </span><br><span class="line">cat members.sql </span><br><span class="line">    INSERT INTO members (lname, fname, address, city, state, zip) VALUES (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Richard&#x27;</span>, <span class="string">&#x27;123 Main St.&#x27;</span>, <span class="string">&#x27;Chicago&#x27;</span>, <span class="string">&#x27;IL&#x27;</span>, <span class="string">&#x27;60601&#x27;</span>);</span><br><span class="line">    INSERT INTO members (lname, fname, address, city, state, zip) VALUES (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Barbara&#x27;</span>, <span class="string">&#x27;123 Main St.&#x27;</span>, <span class="string">&#x27;Chicago&#x27;</span>, <span class="string">&#x27;IL&#x27;</span>, <span class="string">&#x27;60601&#x27;</span>);</span><br><span class="line">    INSERT INTO members (lname, fname, address, city, state, zip) VALUES (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Christine&#x27;</span>, <span class="string">&#x27;456 Oak Ave.&#x27;</span>, <span class="string">&#x27;Columbus&#x27;</span>, <span class="string">&#x27;OH&#x27;</span>, <span class="string">&#x27;43201&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Script-Control"><a href="#Script-Control" class="headerlink" title="Script Control"></a>Script Control</h2><h3 id="Handling-Signals"><a href="#Handling-Signals" class="headerlink" title="Handling Signals"></a>Handling Signals</h3><table>
<thead>
<tr>
<th align="left">Signal</th>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">SIGHUP</td>
<td align="left">Hangs up</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">SIGINT</td>
<td align="left">Interrupts</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">SIGQUIT</td>
<td align="left">Stops running</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">SIGKILL</td>
<td align="left">Unconditionally terminates</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">SIGSEGV</td>
<td align="left">Produces segment violation</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">SIGTERM</td>
<td align="left">Terminates if possible</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left">SIGSTOP</td>
<td align="left">Stops unconditionally, but doesn’t terminate</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left">SIGTSTP</td>
<td align="left">Stops or pauses, but continues to run in background</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left">SIGCONT</td>
<td align="left">Resumes execution after STOP or TSTP</td>
</tr>
</tbody></table>
<p>默认情况下，bash shell 会忽略 QUIT 和 TERM 这两个信息，但是可以识别 HUP 和 INT。</p>
<blockquote>
<p>Generating signals</p>
</blockquote>
<p>通过键盘操作你可以产生两种信号</p>
<p><strong>Interrupting a process</strong> <code>Ctrl + C</code> 可以生成 SIGINT 信号并把它发送到任何终端正在执行的进程中</p>
<p><strong>Pausing a process</strong> <code>Ctrl + Z</code> 停止一个进程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sleep 100</span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line"><span class="comment"># [1]+  Stopped                 sleep 100</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line"><span class="comment"># There are stopped jobs.</span></span><br></pre></td></tr></table></figure>

<p>当有 stop 的进程是，你是不能退出 bash 的可以用 ps 查看. 对应的 job 的 S(status) 为 T。你可以使用 kill 杀死它</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ps -l </span><br><span class="line"><span class="comment">#   UID   PID  PPID        F CPU PRI NI       SZ    RSS WCHAN     S             ADDR TTY           TIME CMD</span></span><br><span class="line"><span class="comment">#   ...</span></span><br><span class="line"><span class="comment">#   501 17153 12576     4006   0  31  0  4268408    672 -      T                   0 ttys001    0:00.00 sleep 100</span></span><br><span class="line"><span class="comment">#   ...</span></span><br><span class="line"><span class="built_in">kill</span> -9 17153</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Trapping signals</p>
</blockquote>
<p>脚本中我们可以指定需要忽略的 signal, 格式为 <code>trap command signals</code>。</p>
<p>下面的示例中，我们在脚本中指定忽略 <code>Ctrl + C</code> 发出的 SIGINT 信号，运行过程中即使按下组合键脚本继续运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cat test1.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Testing signal trapping</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27; Sorry! I have trapped Ctrl-C&#x27;&quot;</span> SIGINT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> This is a <span class="built_in">test</span> script</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the test script&quot;</span></span><br><span class="line"></span><br><span class="line">./test1.sh </span><br><span class="line"><span class="comment"># This is a test script</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># ^C Sorry! I have trapped Ctrl-C</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># Loop #6</span></span><br><span class="line"><span class="comment"># Loop #7</span></span><br><span class="line"><span class="comment"># Loop #8</span></span><br><span class="line"><span class="comment"># Loop #9</span></span><br><span class="line"><span class="comment"># Loop #10</span></span><br><span class="line"><span class="comment"># ^C Sorry! I have trapped Ctrl-C</span></span><br><span class="line"><span class="comment"># This is the end of the test script</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Trapping a script exit</p>
</blockquote>
<p>trap 命令还可以做到，当脚本结束时执行命令的效果，即使是通过 Ctrl + C 结束也会被出发。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat test2.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Trapping the script exit</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo Goodbye...&quot;</span> EXIT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the end of the test script&quot;</span></span><br><span class="line"></span><br><span class="line">./test2.sh </span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^CGoodbye...</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Modifying or removing a trap</p>
</blockquote>
<p>下面示例中展示了如何修改 trap 的动作。我们先定义当遇到 SIGINT 时 echo 的内容。当 5 秒循环后修改 echo 的内容。通过触发 SIGINT 查看改动是否生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cat test3.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Modifying a set trap</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27;Sorry... Ctrl-C is trapped.&#x27;&quot;</span> SIGINT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27; I modified the trap!&#x27;&quot;</span> SIGINT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test3.sh </span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^CSorry... Ctrl-C is trapped.</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># ^CSorry... Ctrl-C is trapped.</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^C I modified the trap!</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># ^C I modified the trap!</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br></pre></td></tr></table></figure>

<p>你也可以通过 <code>trap -- SIGINT</code> 移除定义的 trap</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">cat test3b.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Modifying a set trap</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27;Sorry... Ctrl-C is trapped.&#x27;&quot;</span> SIGINT</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">trap</span> -- SIGINT</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I just removed the trap&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">./test3b.sh </span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^CSorry... Ctrl-C is trapped.</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># I just removed the trap</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^C</span></span><br></pre></td></tr></table></figure>

<p><strong>Tip</strong> 上面的去除也可以用单横线 <code>trap - SIGINT</code></p>
<h3 id="Running-scripts-in-Background-Mode"><a href="#Running-scripts-in-Background-Mode" class="headerlink" title="Running scripts in Background Mode"></a>Running scripts in Background Mode</h3><p>试想一下下面的情形，如果你的脚本需要执行比较长的时间，如果你在终端运行了它，那么你就没有终端可用了。你可以使用 background 的模式跑类似的脚本，<code>ps</code> 显示那些 process 很多都是后台运行的</p>
<blockquote>
<p>Running in the background</p>
</blockquote>
<p>想要后台运行脚本是很简单的，只需要在调用脚本时后面接一个 ampersand symbol <code>&amp;</code> 即可</p>
<p>下面程序中，我们声明了一个计时器，并在后台运行。运行时他会给出 PID 信息。当脚本执行结束时会打印 done 的信息</p>
<p>PS: bash 测试的时候要我会车才会打印，zsh 自动打印</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat test4.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test running in the background</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">./test4.sh &amp;</span><br><span class="line"><span class="comment"># [1] 16253</span></span><br><span class="line"><span class="comment"># [1]  + 16360 done       ./test4.sh</span></span><br></pre></td></tr></table></figure>

<p>当使用 background mode 的时候，他还是用的 STDOUT 和 STDERR</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat test5.sh                                 </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test running in the background with output</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Start the test script&quot;</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test script is complete&quot;</span></span><br><span class="line"></span><br><span class="line">./test5.sh &amp;</span><br><span class="line"><span class="comment"># [1] 16474</span></span><br><span class="line"><span class="comment"># bash-5.1$ Start the test script</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># Test script is complete</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [1]+  Done                    ./test5.sh</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Running multiple background jobs</p>
</blockquote>
<p>如果你想启动多个 background job 只需要终端运行多个 <code>xx.sh &amp;</code> 即可。每次系统多会分配一个 job id 和 process id 给后台进程，可以通过 ps 查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">./test5.sh &amp;</span><br><span class="line">./test5.sh &amp;</span><br><span class="line">ps                  </span><br><span class="line"><span class="comment">#   PID TTY           TIME CMD</span></span><br><span class="line"><span class="comment">#  8019 ttys000    0:04.39 /bin/zsh --login -i</span></span><br><span class="line"><span class="comment">#  1479 ttys001    0:01.61 /bin/zsh -l</span></span><br><span class="line"><span class="comment"># 16661 ttys001    0:00.01 /usr/local/bin/bash ./test5.sh</span></span><br><span class="line"><span class="comment"># 16681 ttys001    0:00.01 /usr/local/bin/bash ./test5.sh</span></span><br><span class="line"><span class="comment"># 16700 ttys001    0:00.00 sleep 1</span></span><br><span class="line"><span class="comment"># 16702 ttys001    0:00.00 sleep 1</span></span><br><span class="line"><span class="comment">#  3202 ttys002    0:04.87 -zsh</span></span><br><span class="line"><span class="comment">#  9415 ttys003    0:01.10 -zsh</span></span><br></pre></td></tr></table></figure>

<h3 id="Running-Scripts-without-a-Hang-Up"><a href="#Running-Scripts-without-a-Hang-Up" class="headerlink" title="Running Scripts without a Hang-Up"></a>Running Scripts without a Hang-Up</h3><p>通过 <code>nohup</code> 命令，你可以让脚本始终在后台运行，即使关闭终端也行</p>
<p><code>nohup</code> 会将 script 和 STDOUT， STDERR 解绑。自动将输出绑定到 nohup.out 文件。如果你在一个文件夹下启动多个 nohup process, 他们的输出会混在一起</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">nohup ./test1.sh &amp;</span><br><span class="line">cat nohup.out </span><br><span class="line"><span class="comment"># This is a test script</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># Loop #3</span></span><br><span class="line"><span class="comment"># Loop #4</span></span><br><span class="line"><span class="comment"># Loop #5</span></span><br><span class="line"><span class="comment"># Loop #6</span></span><br><span class="line"><span class="comment"># Loop #7</span></span><br><span class="line"><span class="comment"># Loop #8</span></span><br><span class="line"><span class="comment"># Loop #9</span></span><br><span class="line"><span class="comment"># Loop #10</span></span><br><span class="line"><span class="comment"># This is the end of the test script</span></span><br><span class="line"><span class="comment"># [1]+  Done                    nohup ./test1.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="Controlling-the-Job"><a href="#Controlling-the-Job" class="headerlink" title="Controlling the Job"></a>Controlling the Job</h3><p>job control 即 开始/通知/kill/重启 jobs 的动作</p>
<blockquote>
<p>Viewing jobs</p>
</blockquote>
<p><code>jobs</code> cmd 让你可以查看 shell 正在运行的 jobs</p>
<p>下面的例子中，我们启动一个计时器脚本。第一次运行，中间通过 Ctrl + Z stop 它。第二次采用后台运行。然后通过 jobs 命令观察这两个 job 的状态。jobs -l 可以显示 PID</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cat test10.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test job control</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># $$ to display the PID of process running this script</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Script Process ID: $$&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loop #<span class="variable">$count</span>&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;End of script...&quot;</span></span><br><span class="line"></span><br><span class="line">./test10.sh </span><br><span class="line"><span class="comment"># Script Process ID: 17179</span></span><br><span class="line"><span class="comment"># Loop #1</span></span><br><span class="line"><span class="comment"># Loop #2</span></span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line"><span class="comment"># [1]+  Stopped                 ./test10.sh</span></span><br><span class="line">./test10.sh &gt; test10.out &amp;</span><br><span class="line"><span class="comment"># [2] 17192</span></span><br><span class="line"><span class="built_in">jobs</span> </span><br><span class="line"><span class="comment"># [1]+  Stopped                 ./test10.sh</span></span><br><span class="line"><span class="comment"># [2]-  Running                 ./test10.sh &gt; test10.out &amp;</span></span><br><span class="line"><span class="built_in">jobs</span> -l </span><br><span class="line"><span class="comment"># [1]+ 17179 Suspended: 18           ./test10.sh</span></span><br><span class="line"><span class="comment"># [2]- 17192 Done                    ./test10.sh &gt; test10.out</span></span><br></pre></td></tr></table></figure>

<p>jobs 命令的可选参数</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-l</td>
<td align="left">List the PID of the process along with the job number</td>
</tr>
<tr>
<td align="left">-n</td>
<td align="left">Lists only jobs that have changed their status since the last notification from the shell</td>
</tr>
<tr>
<td align="left">-p</td>
<td align="left">Lists only the PIDs of the jobs</td>
</tr>
<tr>
<td align="left">-r</td>
<td align="left">Lists only the running jobs</td>
</tr>
<tr>
<td align="left">-s</td>
<td align="left">Lists only stopped jobs</td>
</tr>
</tbody></table>
<p>jobs 列出的信息可以看到加号和减号。<code>+</code> 表示 default job. <code>-</code> 表示即将变成 default job 的 job。同一时间，只有一个带 加号 的 job 和一个带 减号 的 job。</p>
<p>下面实验中，我们启动三个后台脚本并观察 jobs 状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">./test10.sh &gt; test10a.out &amp;</span><br><span class="line"><span class="comment"># [1] 17444</span></span><br><span class="line">./test10.sh &gt; test10b.out &amp;</span><br><span class="line"><span class="comment"># [2] 17448</span></span><br><span class="line">./test10.sh &gt; test10c.out &amp;</span><br><span class="line"><span class="comment"># [3] 17456</span></span><br><span class="line"><span class="built_in">jobs</span> -l </span><br><span class="line"><span class="comment"># [1]  17444 Running                 ./test10.sh &gt; test10a.out &amp;</span></span><br><span class="line"><span class="comment"># [2]- 17448 Running                 ./test10.sh &gt; test10b.out &amp;</span></span><br><span class="line"><span class="comment"># [3]+ 17456 Running                 ./test10.sh &gt; test10c.out &amp;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 杀死进程</span></span><br><span class="line"><span class="built_in">kill</span> 17444</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Restarting stopped jobs</p>
</blockquote>
<p>通过 bash 的 job control 你可以重新启动停止的脚本，启动方式有 background 和 foreground 两种，后者会接管终端</p>
<p>当有多个 script 停止时，可以使用 bg + num 的方式启动对应的脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat test11.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test job control</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sleep 1</span><br><span class="line">    count=$[ <span class="variable">$count</span> + 1 ] </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;End of script...&quot;</span></span><br><span class="line"></span><br><span class="line">./test11.sh </span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line"><span class="comment"># [1]+  Stopped                 ./test11.sh</span></span><br><span class="line">./test11.sh </span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line"><span class="comment"># [2]+  Stopped                 ./test11.sh</span></span><br><span class="line"><span class="built_in">jobs</span> -l</span><br><span class="line"><span class="comment"># [1]- 17657 Suspended: 18           ./test11.sh</span></span><br><span class="line"><span class="comment"># [2]+ 17659 Suspended: 18           ./test11.sh</span></span><br><span class="line"><span class="built_in">bg</span> 2</span><br><span class="line"><span class="comment"># [2]+ ./test11.sh &amp;</span></span><br><span class="line"><span class="comment"># End of script...</span></span><br></pre></td></tr></table></figure>

<p><code>bg</code> 和 <code>fg</code> 的最主要的区别。如果用 bg, 你还可以在当前终端运行命令，如果是 fg 你需要等命令全部执行完了才能继续运行</p>
<h3 id="Being-Nice"><a href="#Being-Nice" class="headerlink" title="Being Nice"></a>Being Nice</h3><p>Linux 系统中各 process 都有优先级，从 -20 到 19 不等。 shell 启动的 process 默认都是 0。19 是最低优先级的。可以通过 Nice guys finish last 方便记忆</p>
<blockquote>
<p>Using the nice command</p>
</blockquote>
<p>当需要指定优先级时，可以通过使用 <code>nice</code> 命令指定优先级等级</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MacOS 不支持 cmd column</span></span><br><span class="line">nice -n 10 ./test4.sh &gt; test4.out &amp;</span><br><span class="line"><span class="comment"># [2] 18051</span></span><br><span class="line"><span class="comment"># [1]   Done                    nice -n 10 ./test4.sh &gt; test4.out</span></span><br><span class="line">ps -p 18051 -o pid,ppid,ni</span><br><span class="line"><span class="comment">#   PID  PPID NI</span></span><br><span class="line"><span class="comment"># 18051 16881 10</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Using the renice command</p>
</blockquote>
<p>当 process 运行是，可以通过 <code>renice</code> 调整优先级</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./test11.sh &amp;</span><br><span class="line"><span class="comment"># [1] 18154</span></span><br><span class="line">ps -p 18154 -o pid,ni</span><br><span class="line"><span class="comment">#   PID NI</span></span><br><span class="line"><span class="comment"># 18154  0</span></span><br><span class="line">renice -n 10 -p 18154</span><br><span class="line">ps -p 18154 -o pid,ni</span><br><span class="line"><span class="comment">#   PID NI</span></span><br><span class="line"><span class="comment"># 18154 10</span></span><br></pre></td></tr></table></figure>

<p>和 nice 一样，renice 也有以下限制</p>
<ul>
<li>只能 renice 你自己 own 的 processes</li>
<li>renice 只能将优先级调低</li>
<li>root 用户可以用 renice 调整到任何等级</li>
</ul>
<h3 id="Running-Like-Clockwork"><a href="#Running-Like-Clockwork" class="headerlink" title="Running Like Clockwork"></a>Running Like Clockwork</h3><p>这章我们将会使用 <code>at</code> 和 <code>corn</code> 命令让我们的脚本定时运行</p>
<blockquote>
<p>Scheduling a job using the at command</p>
</blockquote>
<p><code>at</code> 让你可以定时的在系统中运行脚本，大多数 Linux 系统会在启动时开启一个 atd 的守进程，定时 check 并运行目标路径(/var/spool/at) 下的脚本</p>
<blockquote>
<p>Understanding the at command format</p>
</blockquote>
<p><code>at</code> 的基本格式很简单 <code>at [-f filename] time</code>. at 可以识别多种时间格式</p>
<ul>
<li>A standard hour and minute, such as 10:15</li>
<li>An AM/PM indicator, such as 10:15PM</li>
<li>A specific named time, such as now, noon, midnight or teatime(4PM)</li>
</ul>
<p>同时你可以指定特定格式的日期</p>
<ul>
<li>A standard date format, such as MMDDYY, MM/DD/YY, or DD.MM.YY</li>
<li>A text date, such as Jul 4 or Dec 25, with or withour the year</li>
<li>A time increment:<ul>
<li>Now + 25 minutes</li>
<li>10:15PM tomorrow</li>
<li>10:15 + 7 days</li>
</ul>
</li>
</ul>
<p>当使用 at 命令的时候，对应的 job 提交到 job queue 中。系统中有 26 种 job 可选，队列名字为字母大小写的 a-z</p>
<p><strong>Note</strong> 以前还有一个 batch 命令可以让你在 low useage 状态下运行 script，现在它只是通过调用 at + b queue 完成的定时脚本。队列的字母顺序越靠后，优先级越低。默认 job 优先级为 a</p>
<blockquote>
<p>Retrieving job output</p>
</blockquote>
<p>Linux 系统中，当 job 运行时是没有监测的地方的。系统会将内容记录到邮件中并发送给联系人</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat test13.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test using at command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This script ran at <span class="subst">$(date +%B%d,%T)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> sleep 5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the script&#x27;s end&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">at -f test13.sh now</span><br><span class="line"><span class="comment"># job 1 at Thu Jun  3 12:27:19 2021</span></span><br></pre></td></tr></table></figure>

<p>如果你系统没有配置邮箱，那就收不到邮件了，你可以直接指定输入到文件</p>
<p>PS: 这个实验失败，运行后我并没有看到 out 文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat test13b.sh </span><br><span class="line"><span class="meta">#!/usr/local/bin/bash</span></span><br><span class="line"><span class="comment"># Test using at command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This script ran at <span class="subst">$(date +%B%d,%T)</span>&quot;</span> &gt; test13b.out</span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; test13b.out</span><br><span class="line"><span class="built_in">echo</span> sleep 5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the script&#x27;s end&quot;</span> &gt;&gt; test13b.out</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查了一下 at 并没有 -M 这个可选参数啊。。</span></span><br><span class="line">at -M -f test13b.sh now </span><br><span class="line"><span class="comment"># job 3 at Thu Jun  3 12:34:11 2021</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Listing pending jobs</p>
</blockquote>
<p>显示所有 pendng 的 job, 我还以为也是用 jobs 呢，忙乎了半天</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">atq</span><br><span class="line"><span class="comment"># 1       Thu Jun  3 12:27:00 2021</span></span><br><span class="line"><span class="comment"># 4       Thu Jun  3 12:35:00 2021</span></span><br><span class="line"><span class="comment"># 5       Thu Jun  3 12:35:00 2021</span></span><br><span class="line"><span class="comment"># 2       Thu Jun  3 12:32:00 2021</span></span><br><span class="line"><span class="comment"># 3       Thu Jun  3 12:34:00 2021</span></span><br><span class="line"><span class="comment"># 6       Thu Jun  3 16:00:00 2021</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Removing jobs</p>
</blockquote>
<p>删除 at queue 中的 job</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">atrm 1</span><br><span class="line">atq</span><br><span class="line"><span class="comment"># 4       Thu Jun  3 12:35:00 2021</span></span><br><span class="line"><span class="comment"># 5       Thu Jun  3 12:35:00 2021</span></span><br><span class="line"><span class="comment"># 2       Thu Jun  3 12:32:00 2021</span></span><br><span class="line"><span class="comment"># 3       Thu Jun  3 12:34:00 2021</span></span><br><span class="line"><span class="comment"># 6       Thu Jun  3 16:00:00 2021</span></span><br></pre></td></tr></table></figure>

<p>Mac 是不是有什么特殊设置啊， 之前启动的 at job 都 block 了</p>
<h4 id="Scheduling-regular-scripts"><a href="#Scheduling-regular-scripts" class="headerlink" title="Scheduling regular scripts"></a>Scheduling regular scripts</h4><p>at 只能配置一次性 job, 如果要配置可重复的 job，可以用 cron. cron 在后台运行，他会检查 cron tables 看哪些 job 需要运行</p>
<h5 id="Looking-at-the-cron-table"><a href="#Looking-at-the-cron-table" class="headerlink" title="Looking at the cron table"></a>Looking at the cron table</h5><p>cron job 的语法：<code>min hour dayofmonth month dayofweek command</code> 示例如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># * 表示 每 的意思</span></span><br><span class="line"><span class="comment"># 下面的定时为 每天 10:15 </span></span><br><span class="line">15 10 * * * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个周一的 16:15</span></span><br><span class="line">15 16 * * 1 <span class="built_in">command</span></span><br><span class="line"><span class="comment"># dayofweek 也可以是三个字母的表示 mon, tue, wed, thu, fri, sat, sun</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个月的第一天 12:00</span></span><br><span class="line">00 12 1 * * <span class="built_in">command</span></span><br><span class="line"><span class="comment"># dayofmonth 为 1-31</span></span><br></pre></td></tr></table></figure>

<p><strong>Note</strong> 怎么设置每月最后天 run 的 job? 可以通过检查明天是不是第一天解决这个问题，示例：<code>00 12 * * * if [</code>date +%d -d tomorrow<code>= 01 ] ;  then ; command</code> 解释：每天中午检查一下明天是不是下个月的第一天，如果是则执行 command</p>
<p>cron job 必须指出脚本的全路径 <code>15 10 * * * /home/rich/test4.sh &gt; test4out</code></p>
<h5 id="Building-the-cron-table"><a href="#Building-the-cron-table" class="headerlink" title="Building the cron table"></a>Building the cron table</h5><p>显示当前用户的 cron job</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br><span class="line"><span class="comment"># crontab: no crontab for i306454</span></span><br></pre></td></tr></table></figure>

<h5 id="View-cron-directories"><a href="#View-cron-directories" class="headerlink" title="View cron directories"></a>View cron directories</h5><p>mac 下没有这些配置，先跳过</p>
<h3 id="Starting-scripts-with-a-new-shell"><a href="#Starting-scripts-with-a-new-shell" class="headerlink" title="Starting scripts with a new shell"></a>Starting scripts with a new shell</h3><p>书中说的是 set shell features, 所以下面这一段讲的是配置问题</p>
<p>启动 shell 时配置文件加载顺序如下，当前面的被发现时，后面的就会被忽略</p>
<ul>
<li>$HOME/.bash_profile</li>
<li>$HOME/.bash_login</li>
<li>$HOME/.profile</li>
</ul>
<p>这里用的是 runs the <code>.bashrc</code> 所以感觉 rc 文件更像是添加什么新功能的感觉(主管臆测，就我本人，感觉什么东西都塞到 rc 中了，也能 work)</p>
<p>每次 bash shell 启动时都会运行 <code>.bashrc</code> 中的内容</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Jack Zheng
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://jack-zheng.github.io/hexo/2021/05/24/LSCASSB-partii-shell-scripting-basics/" title="Linux命令行与shell脚本编程大全 第二章 Shell 脚本基础知识">https://jack-zheng.github.io/hexo/2021/05/24/LSCASSB-partii-shell-scripting-basics/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/hexo/tags/Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8-3rd/" rel="tag"># Linux命令行与shell脚本编程大全 3rd</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/hexo/2021/05/20/Spring-bean-injection/" rel="next" title="Spring 如何注入 bean">
                  <i class="fa fa-chevron-left"></i> Spring 如何注入 bean
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/hexo/2021/05/31/LSCASSB-parti-the-linux-command-line/" rel="prev" title="Linux命令行与shell脚本编程大全 第一章 Linux 命令行">
                  Linux命令行与shell脚本编程大全 第一章 Linux 命令行 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter-11-Basic-Script-building"><span class="nav-number">1.</span> <span class="nav-text">Chapter 11: Basic Script building</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Multiple-Commands"><span class="nav-number">1.1.</span> <span class="nav-text">Using Multiple Commands</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-Script-File"><span class="nav-number">1.2.</span> <span class="nav-text">Creating a Script File</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Displaying-Messages"><span class="nav-number">1.3.</span> <span class="nav-text">Displaying Messages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Variables"><span class="nav-number">1.4.</span> <span class="nav-text">Using Variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redirecting-Input-and-Output"><span class="nav-number">1.5.</span> <span class="nav-text">Redirecting Input and Output</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pipes"><span class="nav-number">1.6.</span> <span class="nav-text">Pipes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Performing-Math"><span class="nav-number">1.7.</span> <span class="nav-text">Performing Math</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exiting-the-Script"><span class="nav-number">1.8.</span> <span class="nav-text">Exiting the Script</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter-12-Using-Structured-Commands"><span class="nav-number">2.</span> <span class="nav-text">Chapter 12: Using Structured Commands</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Considering-Compound-Testing"><span class="nav-number">2.1.</span> <span class="nav-text">Considering Compound Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-Advanced-if-then-Features"><span class="nav-number">2.2.</span> <span class="nav-text">Working with Advanced if-then Features</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Considering-the-case-Command"><span class="nav-number">2.3.</span> <span class="nav-text">Considering the case Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Issues"><span class="nav-number">2.4.</span> <span class="nav-text">Issues</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#More-Structured-Commands"><span class="nav-number">3.</span> <span class="nav-text">More Structured Commands</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-for-Command"><span class="nav-number">3.1.</span> <span class="nav-text">The for Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-C-Style-for-command"><span class="nav-number">3.2.</span> <span class="nav-text">The C-Style for command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-while-Command"><span class="nav-number">3.3.</span> <span class="nav-text">The while Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-until-Command"><span class="nav-number">3.4.</span> <span class="nav-text">The until Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nesting-Loops"><span class="nav-number">3.5.</span> <span class="nav-text">Nesting Loops</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Looping-on-File-Data"><span class="nav-number">3.6.</span> <span class="nav-text">Looping on File Data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Controlling-the-loop"><span class="nav-number">3.7.</span> <span class="nav-text">Controlling the loop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Processing-the-Output-of-a-Loop"><span class="nav-number">3.8.</span> <span class="nav-text">Processing the Output of a Loop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Practical-Examples"><span class="nav-number">3.9.</span> <span class="nav-text">Practical Examples</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter-14-Handling-User-Input"><span class="nav-number">4.</span> <span class="nav-text">Chapter 14: Handling User Input</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Passing-Parameters"><span class="nav-number">4.1.</span> <span class="nav-text">Passing Parameters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Special-Parameter-Variables"><span class="nav-number">4.2.</span> <span class="nav-text">Using Special Parameter Variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Being-Shify"><span class="nav-number">4.3.</span> <span class="nav-text">Being Shify</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-Options"><span class="nav-number">4.4.</span> <span class="nav-text">Working with Options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Standardizing-Options"><span class="nav-number">4.5.</span> <span class="nav-text">Standardizing Options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getting-User-Input"><span class="nav-number">4.6.</span> <span class="nav-text">Getting User Input</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Presenting-Data"><span class="nav-number">5.</span> <span class="nav-text">Presenting Data</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Understanding-Input-and-Output"><span class="nav-number">5.1.</span> <span class="nav-text">Understanding Input and Output</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redirecting-errors"><span class="nav-number">5.2.</span> <span class="nav-text">Redirecting errors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redirecting-Output-in-Scripts"><span class="nav-number">5.3.</span> <span class="nav-text">Redirecting Output in Scripts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redirecting-Input-in-Scripts"><span class="nav-number">5.4.</span> <span class="nav-text">Redirecting Input in Scripts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-Your-Own-Redirection"><span class="nav-number">5.5.</span> <span class="nav-text">Creating Your Own Redirection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Listing-Open-File-Descriptors"><span class="nav-number">5.6.</span> <span class="nav-text">Listing Open File Descriptors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Suppressing-Command-Output"><span class="nav-number">5.7.</span> <span class="nav-text">Suppressing Command Output</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Temporary-Files"><span class="nav-number">5.8.</span> <span class="nav-text">Using Temporary Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Logging-Messages"><span class="nav-number">5.9.</span> <span class="nav-text">Logging Messages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Practical-Example"><span class="nav-number">5.10.</span> <span class="nav-text">Practical Example</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Script-Control"><span class="nav-number">6.</span> <span class="nav-text">Script Control</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Handling-Signals"><span class="nav-number">6.1.</span> <span class="nav-text">Handling Signals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Running-scripts-in-Background-Mode"><span class="nav-number">6.2.</span> <span class="nav-text">Running scripts in Background Mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Running-Scripts-without-a-Hang-Up"><span class="nav-number">6.3.</span> <span class="nav-text">Running Scripts without a Hang-Up</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Controlling-the-Job"><span class="nav-number">6.4.</span> <span class="nav-text">Controlling the Job</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Being-Nice"><span class="nav-number">6.5.</span> <span class="nav-text">Being Nice</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Running-Like-Clockwork"><span class="nav-number">6.6.</span> <span class="nav-text">Running Like Clockwork</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Scheduling-regular-scripts"><span class="nav-number">6.6.1.</span> <span class="nav-text">Scheduling regular scripts</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Looking-at-the-cron-table"><span class="nav-number">6.6.1.1.</span> <span class="nav-text">Looking at the cron table</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Building-the-cron-table"><span class="nav-number">6.6.1.2.</span> <span class="nav-text">Building the cron table</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#View-cron-directories"><span class="nav-number">6.6.1.3.</span> <span class="nav-text">View cron directories</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Starting-scripts-with-a-new-shell"><span class="nav-number">6.7.</span> <span class="nav-text">Starting scripts with a new shell</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jack Zheng"
      src="/hexo/images/jack.jpg">
  <p class="site-author-name" itemprop="name">Jack Zheng</p>
  <div class="site-description" itemprop="description">我是张江搬砖小码农, 知识搬运工</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hexo/archives/">
        
          <span class="site-state-item-count">157</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hexo/categories/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/hexo/tags/">
          
        <span class="site-state-item-count">179</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Zheng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">742k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">11:15</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v5.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/hexo/lib/anime.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.ui.min.js"></script>

<script src="/hexo/js/utils.js"></script>

<script src="/hexo/js/motion.js"></script>


<script src="/hexo/js/schemes/muse.js"></script>


<script src="/hexo/js/next-boot.js"></script>




  




  
<script src="/hexo/js/local-search.js"></script>














  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'd444c814810f7e73ee3a',
      clientSecret: '9b3c417a0c1076887b3cf583c7d7a27456b708ef',
      repo: 'hexo-comments',
      owner: 'jack-zheng',
      admin: ['jack-zheng'],
      id: '097f26e3b83b4f5f83d136b8496b4aa3',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

</body>
</html>
