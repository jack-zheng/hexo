<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/hexo/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hexo/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hexo/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/hexo/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="UgODgWVmvTsdD--vjodDR3tPUZRWM3i7JpHzbYejxUM">

<link rel="stylesheet" href="/hexo/css/main.css">


<link rel="stylesheet" href="/hexo/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hexo/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="我是张江搬砖小码农, 知识搬运工">
<meta property="og:type" content="website">
<meta property="og:title" content="Jackpot">
<meta property="og:url" content="https://jack-zheng.github.io/hexo/index.html">
<meta property="og:site_name" content="Jackpot">
<meta property="og:description" content="我是张江搬砖小码农, 知识搬运工">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jack Zheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jack-zheng.github.io/hexo/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Jackpot</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/hexo/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jackpot</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-tags">

    <a href="/hexo/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/hexo/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hexo/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/jack-zheng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/08/17/On-java-8-streams/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/08/17/On-java-8-streams/" class="post-title-link" itemprop="url">On java 8 流式编程</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-17 10:44:37" itemprop="dateCreated datePublished" datetime="2022-08-17T10:44:37+08:00">2022-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/On-Java-8/" itemprop="url" rel="index">
                    <span itemprop="name">On Java 8</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>155</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>集合优化了对象存储，Streams则是关于一组对象的处理。Steams 是与任何特定存储机制无关的元素序列，流没有存储。</p>
<p>流可以在不使用赋值或可变数据的情况下，对有状态的系统建模，这非常有用</p>
<p>Java 8 通过在即可中添加 default 方法的方式，使流式编程整合到集合类中，流操作有三类：创建流，修改流元素，消费流元素。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/08/12/On-java-8-functional-programing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/08/12/On-java-8-functional-programing/" class="post-title-link" itemprop="url">On java 8 函数式编程</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-12 16:48:53" itemprop="dateCreated datePublished" datetime="2022-08-12T16:48:53+08:00">2022-08-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/On-Java-8/" itemprop="url" rel="index">
                    <span itemprop="name">On Java 8</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>976</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>OO（object oriented，面向对象）是抽象数据，FP（functional programming，函数式编程）是抽象行为。</p>
<p>纯粹的函数是编程有额外约束，数据必须不可变：设置一次，永不改变。这种方式解决了多处理器时数据竞争的问题</p>
<p>Lambda 表达式是使用最小可能语法编写的函数定义</p>
<ul>
<li>Lambda表达式产生函数，而不是类</li>
<li>Lambda语法尽可能少，这正是为了使Lambda易于编写和使用</li>
</ul>
<p>Lambda表达式基本语法：</p>
<ol>
<li>参数</li>
<li>-&gt; 可视为产出</li>
<li>-&gt; 之后的内容都是方法体</li>
</ol>
<p>Lambda 表达式通常比匿名内部类产生更容易读懂的代码</p>
<p>方法引用：类名或对象名::方法名</p>
<p>函数式接口，只能包含一个方法，如果出现多个，会抛 exception(这个结论有问题 Function 这个接口就有多个方法)。这个接口可以添加 @FunctionalInterface 注释，但是可选项，不加也没问题。</p>
<p>java.util.function 包旨在创建一组完整的目标接口，使得我们一般情况下不需要再定义自己的接口。他们的命名规则如下：</p>
<ol>
<li>如果处理对象而非基本类型，名称则为 Function, Consumer, Predicate 等。参数类型通过泛型添加。</li>
<li>如果接受基本类型，则由名称的第一部分表示，如 LongConsumer, DoubleFunction，IntPredicate 等，返回基本类型的 Supplier 例外</li>
<li>如果返回值为基本类型，则用 To 表示,如 ToLongFunction<T> 和 IntToLongFunction</li>
<li>返回类型与参数类型一致，则是一个运算符，单个参数用UnaryOperator,两个参数用BinaryOperator</li>
<li>接收两个参数，返回布尔值用 Predicate</li>
<li>加收的两个参数类型不同，则名字中有一个 Bi</li>
</ol>
<p>使用函数接口时，方法名无关紧要，只要参数类型和返回值相同即可。</p>
<p>高阶函数：指一个消费或产生函数的函数。</p>
<p>闭包：讲了一写变量作用域的问题，不过不太看的懂。大概是函数中的变量都相当于 final 吧，大概这个意思。</p>
<p>函数组合：多个函数组成新的函数，是函数式编程的基本组成部分。</p>
<p>柯里化：将一个多参的函数转化为一系列单参函数, 套娃表达式，理解上有点难读懂</p>
<p>纯函数式编程：Java支持并发，但是如果你的业务核心部分都是并发的，应该考虑使用 Scala或者 Clojure， 他们在一开始就为保持不变性而设计的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/08/05/Effective-Java-exceptions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/08/05/Effective-Java-exceptions/" class="post-title-link" itemprop="url">Effective Java 异常</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-05 10:44:32" itemprop="dateCreated datePublished" datetime="2022-08-05T10:44:32+08:00">2022-08-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Effective-Java/" itemprop="url" rel="index">
                    <span itemprop="name">Effective Java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>异常章节摘抄</p>
<ul>
<li>只针对异常的情况才使用异常</li>
<li>对可恢复的情况使用 checked exception, 不可恢复的使用 runtime exception</li>
<li>避免滥用 checked exception</li>
<li>优先使用 JDK 提供的标准异常</li>
<li>抛出与上下文匹配的异常</li>
<li>在方法注释上，为每个抛出的异常编写文档</li>
<li>异常信息中包含失败信息</li>
<li>让失败保持源字形</li>
<li>不要忽略异常</li>
</ul>
<h2 id="只针对异常的情况才使用异常"><a href="#只针对异常的情况才使用异常" class="headerlink" title="只针对异常的情况才使用异常"></a>只针对异常的情况才使用异常</h2><p>展示一个产品代码中遇到的违反这条建议的的奇葩例子。底层 team 给了一个很奇葩的接口，一个 findPersonIdByPersonUUID 的方法，当找不到结果的时候，竟然会抛出 exception 而不是返回 null, 导致我这个调用方处理起来像是吃了屎一样难受。。。而且这样的逻辑把 ‘找不到’ 和 ‘代码异常’ 两中情况混在一起了，抛出了异常之后都不知道具体的 root cause，简直了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 底层实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BadPracticeServiceA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getPersonIdByPersonUUID</span><span class="params">(String personUuid)</span> </span>&#123;</span><br><span class="line">        Long person = getPersonId();</span><br><span class="line">        <span class="keyword">if</span> (person == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServiceApplicationException(<span class="string">&quot;Can not find PersonID by PersonUUID&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为上层的调用者，我在调用上述方法的时候不得不显示的处理他抛出的异常</span></span><br><span class="line"><span class="keyword">try</span> &#123;   </span><br><span class="line">    <span class="keyword">long</span> target = badPracticeServiceA.getPersonIdByPersonUUID(<span class="string">&quot;uuid&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">    log.info(<span class="string">&quot;Exception when get person id by person uuid &#123;&#125;, detail log msg: &#123;&#125;&quot;</span>, <span class="string">&quot;uuid&quot;</span>, e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p>看 Effective Java 中 Stack 实现的时候又有了新的感悟。这里的 get 方法和 stack 里的 pop() 方法很像，而 pop 在拿不到值的时候会抛异常，和上面找不到的情况也很类似。不过相对以 Stack 的例子，上面如果要在找不到的时候抛异常，也不应该是 Exception 而是更友好的 RuntimeException。或者其他自定义的 NotFoundExcepiton 才对。</p>
<h2 id="对可恢复的情况使用-checked-exception-不可恢复的使用-runtime-exception"><a href="#对可恢复的情况使用-checked-exception-不可恢复的使用-runtime-exception" class="headerlink" title="对可恢复的情况使用 checked exception, 不可恢复的使用 runtime exception"></a>对可恢复的情况使用 checked exception, 不可恢复的使用 runtime exception</h2><ul>
<li>如果期望调用者能够适当的恢复，对于这种情况应该使用 checked exception</li>
<li>runtime exception 和 error 行为上是等同的，没有捕获，当前线程停止</li>
<li>runtime exception 表明程序错误</li>
</ul>
<h2 id="避免滥用-checked-exception"><a href="#避免滥用-checked-exception" class="headerlink" title="避免滥用 checked exception"></a>避免滥用 checked exception</h2><p>滥用 checked exception 会使你的 API 调用极其麻烦。一旦抛出 checked exception，调用者就必须 catch 他或者在方法标签中 throw，传播出去，无论哪种处理方式，都是对调用者不可忽视的负担。</p>
<p>绕过 checked exception 的方法：</p>
<ul>
<li>使用 runtime exception 代替</li>
<li>重构逻辑</li>
</ul>
<h2 id="优先使用-JDK-提供的标准异常"><a href="#优先使用-JDK-提供的标准异常" class="headerlink" title="优先使用 JDK 提供的标准异常"></a>优先使用 JDK 提供的标准异常</h2><p>常见的标准异常</p>
<ul>
<li>IllegalArgmentException</li>
<li>IllegalStateException</li>
<li>NullPointException</li>
<li>IndexOutOfBoundsException</li>
<li>ConcurrentModificationException</li>
<li>UnsupportedOperaitonException</li>
</ul>
<h2 id="抛出与上下文匹配的异常"><a href="#抛出与上下文匹配的异常" class="headerlink" title="抛出与上下文匹配的异常"></a>抛出与上下文匹配的异常</h2><p>底层异常，传递到上层是可能和当前上下文不匹配，污染 API。这是需要在上层转译一下，重新抛出异常。如果异常栈对错误排查很有帮助，可以将 exception chain 一并传递给新的异常(Throwable 的 initCause 方法)</p>
<p>异常转译比直接传递底层异常好，但更好的处理方式应该是调用底层方法之前确保他能执行成功，避免抛出一场。有时调用底层之前，先做一下参数监测可能是更好的方式。</p>
<p>如果无法避免底层异常，次选方案是让上层悄悄绕开这些异常，从而使上层调用者和底层问题隔离开来，通常这是还会打个 log 记录，方便回溯问题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/08/05/Effective-Java-generics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/08/05/Effective-Java-generics/" class="post-title-link" itemprop="url">Effective Java 异常</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-05 10:44:32" itemprop="dateCreated datePublished" datetime="2022-08-05T10:44:32+08:00">2022-08-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/Effective-Java/" itemprop="url" rel="index">
                    <span itemprop="name">Effective Java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>章节摘抄</p>
<ul>
<li>新写的代码中有泛型支持的要加上检测，别去掉。e.g. List<String> 而不是直接 List list=…</li>
<li>消除非受检警告</li>
<li>列表优先于数组</li>
<li>优先考虑泛型 - 这个建议中给出的 Stack 例子，属实没有 get 到他要讲的点</li>
</ul>
<p>泛型那段读不下去了，很多概念性的东西读起来很吃力，需要再重新看看泛型相关的知识点了，应该可以结合 Collection 来看效果会比较好。</p>
<h2 id="请不要在新代码中使用原生态类型"><a href="#请不要在新代码中使用原生态类型" class="headerlink" title="请不要在新代码中使用原生态类型"></a>请不要在新代码中使用原生态类型</h2><p>原生态类型指的是原本可以使用泛型的地方，没有指定，比如 List<String> 写出 List list =… 的情况</p>
<p>泛型给了你在编译器检测类型匹配的能力</p>
<p>List<String> 是 List 的子类，而不是 List<Object> 的子类，语法上是这么规定的，挺神奇。</p>
<p>现在还能使用原生态类型是为了向下兼容，Java 1.5 才出的泛型</p>
<p>无限制通配符类型，比如 Set<E> 的无限制形式 Set&lt;?&gt; 读作 ‘某个类型的集合’</p>
<p>Java 1.5 之后，只有两种情况允许使用原生态类型，一种是类 class 操作的时候，比如 List.class, String[].class, int.class。另一种是与 instanceof 相关的操作，比如 <code>if(o instance of Set)</code></p>
<h2 id="消除非受检警告"><a href="#消除非受检警告" class="headerlink" title="消除非受检警告"></a>消除非受检警告</h2><p>使用泛型是会碰到很多 unchecked warning，把他们都修复，这个可以保证代码运行时不会出现 ClassCastException.</p>
<h2 id="列表优先于数组"><a href="#列表优先于数组" class="headerlink" title="列表优先于数组"></a>列表优先于数组</h2><p>数组是协变的(covariant)，如果 sub 是 super 的子类，那么 sub[] 就是 super[] 的子类。</p>
<p>泛型是不可变的(invariant), 如果 Type1 是 Type2 的子类，List<Type1> 和 List<Type2> 没有继承关系。</p>
<p>作则认为上面的这种特性是数组的缺点。举个例子，下面两种变量都不能将 String 放入变量中，第一种要运行时才能发现，第二种编译期就抛错了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object[] a = <span class="keyword">new</span> Long[<span class="number">1</span>];</span><br><span class="line">a[<span class="number">0</span>]=<span class="string">&quot;I don&#x27;t fit it&quot;</span>; <span class="comment">// 可以添加，运行时出错</span></span><br><span class="line"></span><br><span class="line">List&lt;Object&gt; b = <span class="keyword">new</span> ArrayList&lt;Long&gt;(); <span class="comment">// 编译时就会抛错</span></span><br><span class="line">b.add(<span class="string">&quot;I don&#x27;t fit it&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>数组是具体化的，泛型则通过擦除机制保证代码的通用性。应为数组的类型不安全的，所以不能创建泛型数组，这种做法和泛型的定义相违背。</p>
<p>像 E, List<E>, List<String> 这样的类型称作不可具体化的(non-reifiable)类型，是运行时表示法包含的信息比编译时表示法包含的信息更好的类型。唯一可以具体化的参数化类型是无限制通配符，但是不常用</p>
<p>当遇到泛型数组创建错误时，最好的方案是用集合类型List<E> 代替数组类型 E[], 这样可能会损失一些性能或者简洁性，但是却有更高的安全性和通用性。</p>
<p>一般来说，数组和泛型不能混用，如果混合使用时出现编译错误或警告，第一反应因该是用列表代替数组。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/07/27/Java-Unified-Authorization-Architecture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/07/27/Java-Unified-Authorization-Architecture/" class="post-title-link" itemprop="url">Java Unified Authorization Architecture</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-27 16:57:48" itemprop="dateCreated datePublished" datetime="2022-07-27T16:57:48+08:00">2022-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前段时间，组内连续出了两个和 SCA 的 role/feature config 相关的 P1 issue，由于不知道它的实现原理，只能通过对比 PR 来找问题，太 low 了，特意读一下他的源码，学习一下下次再出现这种情况要怎么处理</p>
<h2 id="Unified-Authorization-Architecture-是什么"><a href="#Unified-Authorization-Architecture-是什么" class="headerlink" title="Unified Authorization Architecture 是什么"></a>Unified Authorization Architecture 是什么</h2><p>这套框架的最终目的是阻止没有授权的用户执行某些 service command。从 MVC 分层上来说，它是在 controller 和 service 之间新加了一层逻辑，每次 service 执行之前都会检测一下，当前用户是否有权执行该 service。</p>
<p>检测分两层，第一层是 company feature test, 第二层是 Role test</p>
<h2 id="怎么配置"><a href="#怎么配置" class="headerlink" title="怎么配置"></a>怎么配置</h2><p>每个 repo 的 resource 文件夹中都有两个配置文件，分别叫做 featuer-access.xml 和 role-access.xml。他们就是两层检测的配置文件</p>
<h3 id="Feature-protected-Service-Command"><a href="#Feature-protected-Service-Command" class="headerlink" title="Feature-protected Service Command"></a>Feature-protected Service Command</h3><p>feature 控制配置文件如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity-feature-map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">id</span>=<span class="string">&quot;com.path.CreateUser&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">feature</span> <span class="attr">id</span>=<span class="string">&quot;Manage User&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity-feature-map</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>他表示的意思是，对于当前 company，只有开启的 Manage User 这个 feature 才被允许执行 CreateUser 这个 service。所有可用的 feature 都存在 FeatureEnum.java 中。他位于 provisioning 文件夹下，那我估计他是和 provisioning 里的 company feature 挂钩的，之前还以为是和 RBP 的 permission 有关呢。</p>
<p>PS: 但是当前几乎所有的 feature 配置都会默认配置 <code>&lt;feature id=&quot;*&quot;/&gt;</code>，也就是说，feature check 名存实亡</p>
<h3 id="Role-protected-Service-Command"><a href="#Role-protected-Service-Command" class="headerlink" title="Role-protected Service Command"></a>Role-protected Service Command</h3><p>基于 role 的校验可以达到没有配置的用户不能执行 service 的效果</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity-permission-map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity-group</span> <span class="attr">id</span>=<span class="string">&quot;myGroup01&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activity</span> <span class="attr">id</span>=<span class="string">&quot;com.path.CreateUser&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity-group</span> <span class="attr">id</span>=<span class="string">&quot;myGroup02&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activity</span> <span class="attr">id</span>=<span class="string">&quot;com.path.DeleteUser&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity-group</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="tag">&lt;<span class="name">role</span> <span class="attr">id</span>=<span class="string">&quot;processJob&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activity-group</span> <span class="attr">refid</span>=<span class="string">&quot;myGroup01&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">role</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activity-group</span> <span class="attr">refid</span>=<span class="string">&quot;myGroup02&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity-permission-map</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>按照上述配置，login user 只能执行 delete user 这个 service 而不能执行 create user，如果执行了会抛出异常</p>
<p>所有支持爹 role 定义在 PermissionBean 中，也可以去 Permission table 的 permission_type 中查看</p>
<h3 id="特殊的-role"><a href="#特殊的-role" class="headerlink" title="特殊的 role"></a>特殊的 role</h3><p>当一个用户通过 /login, /samllogin 登陆到系统中后，对应的 permission 会存到 PermissionListBean 中。但还有其他特殊情况</p>
<table>
<thead>
<tr>
<th align="left">User type</th>
<th align="left">Role</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Provisioners</td>
<td align="left">provisioner</td>
<td align="left">users authenticated via /provisioning_login.</td>
</tr>
<tr>
<td align="left">SFV4 Client or Quartz Job</td>
<td align="left">processJob</td>
<td align="left">allows the SFV4 client/Quartz Job to execute service</td>
</tr>
<tr>
<td align="left">Any Login User</td>
<td align="left">user</td>
<td align="left">any user authenticated via /login or /samllogin</td>
</tr>
</tbody></table>
<p>还有一个很神奇的 User type, Anonymous, ParamBean 有一个方法 getAnonymousPrincipal() 注释说，这个 type 表示一个没有经过授权的 user, 猜测，比如，登陆前需要做一些测试，比如看  account 是否存在，这个时候就要用到这种类型的 user type 了。</p>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><p><a target="_blank" rel="noopener" href="https://confluence.successfactors.com/display/ENG/Unified+Authorization+Architecture+Technical+Specification">https://confluence.successfactors.com/display/ENG/Unified+Authorization+Architecture+Technical+Specification</a></p>
<p>AppSec, short for application secirity. 看他的描述，是参考了 OWASP ESAPI 这个项目。</p>
<p>This API will provide initially just two things:</p>
<ul>
<li>A thread local to store the current user</li>
<li>A set of access control APIs</li>
</ul>
<p>The ThreadLocal principal is designed to be populated and cleared by a Servlet filter</p>
<p>逻辑推测，server 启动的时候会加载分析 role/feature 配置文件，并存到一个静态类中，作为共用部分。后续当 SCA engine 调用 impl 之前，都会有一个 auth check 的过程。过程中会使用 AppSec 作为入口检测权限。大致过程就是这样，再细致的分析就得涉及到 RBP 那部分的内容了。最主要的参考文档应该是这个</p>
<p><a target="_blank" rel="noopener" href="https://confluence.successfactors.com/display/ENG/Unified+Authorization+Architecture+Technical+Specification">https://confluence.successfactors.com/display/ENG/Unified+Authorization+Architecture+Technical+Specification</a></p>
<p>他告诉这个过程的规范，涉及到的类和关系等</p>
<p>public class AppsecConfigListener implements ServletContextListener 这个 class 被注册到 web.xml 中，看实现的接口应该是 servlet 启动结束后，到各个 module 中的加载 feature 和 role 的配置信息。</p>
<p>ProvisioningLoginServlet.java - process() - provisionerBean.createProvisionerParamBean()</p>
<p>  public ParamBean createProvisionerParamBean(CompanyBean cb) {<br>    ParamBean p = ParamBean.createDefaultParamBean(cb, PROVISIONER_PARAMBEAN_ROLE);<br>    p.getAppSecRoles().addAll(getAppSecRoles());<br>    return p;<br>  }</p>
<p>ParamBean role as provisioner, 并将 sf_provisioner 中 flag 这个 column 里解析出来的 permission 加上 APP_SEC_PREFIX 添加到 role 中</p>
<p>UiAuthenticationProcessorImpl.java - process() - start login</p>
<p>GenericAuthorizationFilter 每次结束之后会将 appsec current user 置为 null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">09:35:44,710 ERROR [AuditConfigExecutor] getConfigsFromDb error, company:QAAUTOCAND_RCMGoldenApp7.</span><br><span class="line">sf_class&#x3D;com.successfactors.appsec.AbstractAccessController line&#x3D;39 method&#x3D;assertAuthorizedFor depth&#x3D;1 </span><br><span class="line">AccessDeniedException&#123;user&#x3D;[RCMGoldenApp7,RCMGoldenApp7,QAAUTOCAND_RCMGoldenApp7.,dbPool1,null,null,en_US] , activity&#x3D;Activity&#123;type&#x3D;SERVICE, name&#x3D;&#39;com.successfactors.auditloggingservice.service.audit.command.AuditConfigQueryCmd&#39;, context&#x3D;null&#125;&#125;</span><br><span class="line">    at com.successfactors.appsec.AbstractAccessController.assertAuthorizedFor(AbstractAccessController.java:39)</span><br><span class="line">    at com.successfactors.appsec.AppSec.assertAuthorizedForService(AppSec.java:231)</span><br><span class="line">    at com.successfactors.sca.ServiceCommandEngine.authorizeService(ServiceCommandEngine.java:312)</span><br><span class="line">    at com.successfactors.sca.ServiceCommandEngine.execute(ServiceCommandEngine.java:238)</span><br><span class="line">    at com.successfactors.sca.service.spring.ServiceCommandProcessorSpring.execute(ServiceCommandProcessorSpring.java:451)</span><br><span class="line">    at com.successfactors.sca.service.handler.spring.SpringAppSCAHandler.execute(SpringAppSCAHandler.java:36)</span><br><span class="line">    at com.successfactors.auditloggingservice.service.audit.executor.AuditConfigExecutor.getConfigsFromDb(AuditConfigExecutor.java:85)</span><br><span class="line">    at com.successfactors.auditloggingservice.service.audit.executor.AuditConfigExecutor.getConfigValue(AuditConfigExecutor.java:55)</span><br><span class="line">    at com.successfactors.auditloggingservice.service.audit.executor.AuditConfigExecutor.getConfigValue(AuditConfigExecutor.java:49)</span><br><span class="line">    at com.successfactors.auditloggingservice.service.audit.executor.AuditKafkaSaveExecutor.needSave(AuditKafkaSaveExecutor.java:118)</span><br><span class="line">    at com.successfactors.auditloggingservice.service.audit.executor.AuditKafkaSaveExecutor.update(AuditKafkaSaveExecutor.java:80)</span><br><span class="line">    at com.successfactors.auditloggingservice.service.audit.executor.AuditKafkaSaveExecutor.lambda$0(AuditKafkaSaveExecutor.java:69)</span><br><span class="line">    at java.base&#x2F;java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)</span><br><span class="line">    at java.base&#x2F;java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)</span><br><span class="line">    at java.base&#x2F;java.lang.Thread.run(Unknown Source)</span><br></pre></td></tr></table></figure>


<h2 id="怎么测试"><a href="#怎么测试" class="headerlink" title="怎么测试"></a>怎么测试</h2><p>针对之前的两个 P1 issue 应该怎么写测试</p>
<h2 id="市面上的同类型产品"><a href="#市面上的同类型产品" class="headerlink" title="市面上的同类型产品"></a>市面上的同类型产品</h2><p><a target="_blank" rel="noopener" href="https://confluence.successfactors.com/display/CST/12+SCA+Home">https://confluence.successfactors.com/display/CST/12+SCA+Home</a> 这个页面可以应该是 最全的 sca 文档了</p>
<p>ESAPI</p>
<feature id="Generic Objects"/>
<activity-feature-map>
    <module>
        <activity id="com.successfactors.identityprofile.scimv2.service.pendingdata.SavePendingData">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.service.pendingdata.RemovePendingData">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.domainevent.incoming.personassignment.sca.ProcessPersonCreate">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.domainevent.incoming.personassignment.sca.SyncPersonDataAndClearPendingData">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.service.pendingdata.FindScimPendingDataEntityByAttributeNameAndValue">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.service.pendingdata.FindScimPendingDataEntitiesByUserResourceId">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.FindScimUserResourceByAccountId">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.FindScimUserResourceByPerPersonUuid">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.CreateScimUserResource">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.UpdateScimUserResource">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.DeleteScimUserResource">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.service.sca.SearchUserResourceV2">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.service.sca.CreateUserResourceV2">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.service.sca.UpdateUserResourceV2">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.service.sca.FindUserResourceV2ById">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.service.sca.DeleteUserResourceV2">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.ScimUserResourceMigration">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.realtimeidentitysync.identityconfiguration.dbmigration.CreateIdentityRealTimeSyncIgsConfiguration">
            <feature id="*"/>
        </activity>
        <activity id="com.successfactors.identityprofile.technicaluser.service.sca.IPSRealTimeSyncTechnicalUserPermissions">
            <feature id="*"/>
        </activity>
    </module>
</activity-feature-map>


<activity-permission-map>
    <module>
        <activity-group id="PendingData">
            <activity id="com.successfactors.identityprofile.scimv2.service.pendingdata.SavePendingData"/>
            <activity id="com.successfactors.identityprofile.scimv2.service.pendingdata.RemovePendingData"/>
            <activity id="com.successfactors.identityprofile.scimv2.service.pendingdata.FindScimPendingDataEntityByAttributeNameAndValue"/>
            <activity id="com.successfactors.identityprofile.scimv2.service.pendingdata.FindScimPendingDataEntitiesByUserResourceId"/>
        </activity-group>
        <activity-group id="personAssignmentDataHandler">
            <activity id="com.successfactors.identityprofile.scimv2.domainevent.incoming.personassignment.sca.SyncPersonDataAndClearPendingData"/>
            <activity id="com.successfactors.identityprofile.scimv2.domainevent.incoming.personassignment.sca.ProcessPersonCreate" />
        </activity-group>
        <activity-group id="ScimUserResoure">
            <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.FindScimUserResourceByAccountId"/>
            <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.FindScimUserResourceByPerPersonUuid"/>
            <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.CreateScimUserResource"/>
            <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.UpdateScimUserResource"/>
            <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.DeleteScimUserResource"/>
            <activity id="com.successfactors.identityprofile.scimv2.service.sca.SearchUserResourceV2"/>
            <activity id="com.successfactors.identityprofile.scimv2.service.sca.CreateUserResourceV2"/>
            <activity id="com.successfactors.identityprofile.scimv2.service.sca.UpdateUserResourceV2"/>
            <activity id="com.successfactors.identityprofile.scimv2.service.sca.FindUserResourceV2ById"/>
            <activity id="com.successfactors.identityprofile.scimv2.service.sca.DeleteUserResourceV2"/>
            <activity id="com.successfactors.identityprofile.scimv2.scimuserresource.sca.ScimUserResourceMigration"/>
        </activity-group>
        <activity-group id="igsintegration">
            <activity id="com.successfactors.identityprofile.realtimeidentitysync.identityconfiguration.dbmigration.CreateIdentityRealTimeSyncIgsConfiguration"/>
            <activity id="com.successfactors.identityprofile.technicaluser.service.sca.IPSRealTimeSyncTechnicalUserPermissions"/>
        </activity-group>

<pre><code>    &lt;role id=&quot;processJob&quot;&gt;
        &lt;activity-group refid=&quot;PendingData&quot;/&gt;
        &lt;activity-group refid=&quot;ScimUserResoure&quot;/&gt;
        &lt;activity-group refid=&quot;personAssignmentDataHandler&quot;/&gt;
        &lt;activity-group refid=&quot;igsintegration&quot;/&gt;
    &lt;/role&gt;
    &lt;role id=&quot;user&quot;&gt;
        &lt;activity-group refid=&quot;PendingData&quot;/&gt;
        &lt;activity-group refid=&quot;ScimUserResoure&quot;/&gt;
        &lt;activity-group refid=&quot;personAssignmentDataHandler&quot;/&gt;
        &lt;activity-group refid=&quot;igsintegration&quot;/&gt;
    &lt;/role&gt;
    &lt;role id=&quot;anonymous&quot;&gt;
        &lt;activity-group refid=&quot;PendingData&quot;/&gt;
        &lt;activity-group refid=&quot;ScimUserResoure&quot;/&gt;
        &lt;activity-group refid=&quot;personAssignmentDataHandler&quot;/&gt;
    &lt;/role&gt;
&lt;/module&gt;</code></pre></activity-permission-map>


<p>a user which has not been authenticated.</p>
<p>curl –location –request GET ‘<a target="_blank" rel="noopener" href="http://localhost:8080/rest/iam/scim/v2/Users/0bfa4ec0-a35d-4f64-881f-ed759108ff47&#39;">http://localhost:8080/rest/iam/scim/v2/Users/0bfa4ec0-a35d-4f64-881f-ed759108ff47&#39;</a></p>
<p>AppsecConfigListener</p>
<p>ServiceCommandEngine</p>
<activity-group refid="DynamicGroups"/>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/07/25/Statistics-histogram-and-distribution-curve/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/07/25/Statistics-histogram-and-distribution-curve/" class="post-title-link" itemprop="url">Statistics histogram and distribution curve</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-25 16:15:44" itemprop="dateCreated datePublished" datetime="2022-07-25T16:15:44+08:00">2022-07-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index">
                    <span itemprop="name">数学</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>207</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>总结柱状图，分布曲线，平均值等概念</p>
<h2 id="柱状图和分布曲线"><a href="#柱状图和分布曲线" class="headerlink" title="柱状图和分布曲线"></a>柱状图和分布曲线</h2><p>柱状图: 通过方块面积表示占比</p>
<p>分布曲线: 是柱状图的一个大致的拟合</p>
<p>正态分布曲线: 分布曲线的一种特殊形式</p>
<h2 id="mean-vs-median-vs-mode"><a href="#mean-vs-median-vs-mode" class="headerlink" title="mean vs median vs mode"></a>mean vs median vs mode</h2><ul>
<li>mean 很好理解，就是平均数，(N0 + N1 + … Nn )/n</li>
<li>median 所有数排序，取中间那个即为 median</li>
<li>mode, 用单词 most often 来解释好了，出现频率最高的那个数。比如有数组 1，2，3，3，5，5，5，5 那么 mode 为 5</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/07/22/Java-Autocloseable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/07/22/Java-Autocloseable/" class="post-title-link" itemprop="url">Autocloseable 接口示例</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-22 17:51:52" itemprop="dateCreated datePublished" datetime="2022-07-22T17:51:52+08:00">2022-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近在看其他 team 的代码时，看到一个在 Filter 中添加 AutoCloseable 的方式来达到记录 perf log 的目的，听新颖的，记录一下并熟悉一下 AutoCloseable 接口的用法</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>在这之前，我一直以为，想要在方法(request)执行前后记录执行时间，只能通过新建一个 拦截器 或者使用类似 Aspect 的技术。API team 的这个实现着实让我对 AutoCloseable 的使用有了新认识，之前对这个接口只是看到过的程度，哈哈。大致模型如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// perf 类实现 AutoCloseable 接口，在 close</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleAutoCloseable</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleAutoCloseable</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Start to record time cost for scope: &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Stop record, print time cost: xx ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>(SimpleAutoCloseable auto = <span class="keyword">new</span> SimpleAutoCloseable(<span class="string">&quot;Request&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;special filter logic...&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;filterChain.doFilter(request, response)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类中，我们调用 client 的方法触发 try-with-resource 流程，查看 console log, 可以看到当 chain 的 doFilter 整体执行结束之后，自动打印了 perf 信息，666</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_AutoCloseable_class_will_execute_close_after_try_block</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Client client = <span class="keyword">new</span> Client();</span><br><span class="line">    client.doFilter();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start to record time cost for scope: Request</span></span><br><span class="line"><span class="comment">// special filter logic...</span></span><br><span class="line"><span class="comment">// filterChain.doFilter(request, response)</span></span><br><span class="line"><span class="comment">// Stop record, print time cost: xx ms</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/07/22/Python-Superset-quick-start/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/07/22/Python-Superset-quick-start/" class="post-title-link" itemprop="url">Python Superset install</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-22 11:19:30" itemprop="dateCreated datePublished" datetime="2022-07-22T11:19:30+08:00">2022-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在同事的安利下安装完了 Superset, 然后大致浏览了一下他的功能特性，发现并不是我想要的。。。他属于一个 BI(Business Inteligence)工具，定位应该是提供了一整套数据可视化的方案。让你可以很方便的将数据展示给别人看。对于我现在的需求，我想要画一下某组数据的分布曲线，这个需求反而太原始了，用这个工具有点牛刀小用，而且效果不怎么好，可能我还是得回到 jupyter 那边去，哈哈</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>docker 方式安装 Superset 的步骤中有一步是 load_example, 这步的过程中会去 github 上下载案例。不过由于 GFW 的问题，下载会失败。解决方案为，手动下载这个 repo 并在本地起一个服务器挂载这些资源，然后修改 docker 中下载 sample 脚本的配置即可。以下是下载资源，起服务部分配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/apache-superset/examples-data/archive/refs/heads/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/apache-superset/examples-data.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是 zip 包方式，输入 cd examples-data-master</span></span><br><span class="line"><span class="built_in">cd</span> examples-data </span><br><span class="line"><span class="comment"># 启动服务器，这是你通过访问 localhost:9999 就能看到这个网站服务了</span></span><br><span class="line">python -m http.server 9999 </span><br><span class="line"><span class="comment"># 查看本机 ip 用于后续修改下载地址</span></span><br><span class="line"><span class="comment"># 显示结果中有一行格式类似 inet xx.xx.xx.xx netmask 0xffffe000 broadcast xx.xx.xx.xx</span></span><br><span class="line"><span class="comment"># 第一个 ip 段就是我们想要的</span></span><br><span class="line">ifconfig | grep inet</span><br></pre></td></tr></table></figure>


<h2 id="安装-Superset"><a href="#安装-Superset" class="headerlink" title="安装 Superset"></a>安装 Superset</h2><p>访问 <a target="_blank" rel="noopener" href="https://hub.docker.com/r/apache/superset">dockerhub</a> 查看安装文档，其实就是跟着指导 CV 一遍指令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉镜像并启动服务，通过 -p 参数修改外部暴露的端口 -p port_you_want:8088</span></span><br><span class="line">docker run -d -p 8080:8088 --name superset apache/superset</span><br><span class="line"><span class="comment"># 创建账户</span></span><br><span class="line">docker <span class="built_in">exec</span> -it superset superset fab create-admin \</span><br><span class="line">              --username admin \</span><br><span class="line">              --firstname Superset \</span><br><span class="line">              --lastname Admin \</span><br><span class="line">              --email admin@superset.com \</span><br><span class="line">              --password admin</span><br><span class="line"><span class="comment"># 升级 DB</span></span><br><span class="line">docker <span class="built_in">exec</span> -it superset superset db upgrade</span><br><span class="line"><span class="comment"># 修改下载地址</span></span><br><span class="line">docker <span class="built_in">exec</span> -it superset /bin/bash</span><br><span class="line">sed -i <span class="string">&#x27;s/BASE_URL = .*&quot;/BASE_URL = &quot;http:\/\/xx.xx.xx.xx:9999\/&quot;/g&#x27;</span> superset/examples/helpers.py</span><br><span class="line">sed -i <span class="string">&#x27;s/https:\/\/github.com\/apache-superset\/examples-data\/raw\/master\//http:\/\/xx.xx.xx.xx:9999\//g&#x27;</span> superset/examples/configs/datasets/examples/*.yaml</span><br><span class="line">sed -i <span class="string">&#x27;s/https:\/\/github.com\/apache-superset\/examples-data\/raw\/lowercase_columns_examples\//http:\/\/xx.xx.xx.xx:9999\//g&#x27;</span> superset/examples/configs/datasets/examples/*.yaml</span><br><span class="line">sed -i <span class="string">&#x27;s/https:\/\/raw.githubusercontent.com\/apache-superset\/examples-data\/master\//http:\/\/xx.xx.xx.xx:9999\//g&#x27;</span> superset/examples/configs/datasets/examples/*.yaml</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># 加载案例</span></span><br><span class="line">docker <span class="built_in">exec</span> -it superset superset load_examples</span><br><span class="line"><span class="comment"># 官方说是 setup roles, 目测是账号权限之类的东西</span></span><br><span class="line">docker <span class="built_in">exec</span> -it superset superset init</span><br></pre></td></tr></table></figure>

<p>到这里安装结束，通过访问 <a target="_blank" rel="noopener" href="http://localhost:8080/login/">http://localhost:8080/login/</a> 查看页面，使用 admin/admin 登陆</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/07/20/Statistics-concept/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/07/20/Statistics-concept/" class="post-title-link" itemprop="url">统计学上的一些概念</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-20 14:38:06" itemprop="dateCreated datePublished" datetime="2022-07-20T14:38:06+08:00">2022-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index">
                    <span itemprop="name">数学</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>133</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="mean-vs-median-vs-mode"><a href="#mean-vs-median-vs-mode" class="headerlink" title="mean vs median vs mode"></a>mean vs median vs mode</h2><ul>
<li>mean 很好理解，就是平均数，(N0 + N1 + … Nn )/n</li>
<li>median 所有数排序，取中间那个即为 median</li>
<li>mode, 用单词 most often 来解释好了，出现频率最高的那个数。比如有数组 1，2，3，3，5，5，5，5 那么 mode 为 5</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jack-zheng.github.io/hexo/hexo/2022/07/04/Lesson-keep-humble/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo/images/jack.jpg">
      <meta itemprop="name" content="Jack Zheng">
      <meta itemprop="description" content="我是张江搬砖小码农, 知识搬运工">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jackpot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/hexo/2022/07/04/Lesson-keep-humble/" class="post-title-link" itemprop="url">学徒的心</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-04 13:24:24" itemprop="dateCreated datePublished" datetime="2022-07-04T13:24:24+08:00">2022-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 15:56:47" itemprop="dateModified" datetime="2022-08-30T15:56:47+08:00">2022-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo/categories/%E6%9D%82%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">杂记</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近这个从 session 中删除 provisioner bean 的工作做的确实不细致，有点懈怠了。在项目开始之前就没有做好工作安排，导致测试环境上出了 bug, 而且被其他 team challenge 了，实力打脸。以后应该吸取这个教训，案件还原如下。</p>
<p>某日 MCAP 的需求提上日程(MCAP 是将现有服务移到公有云上的这么一个项目，所以要减小内存开销)，突然要落地这个 remove 的项目。前期有调研过，可行性方面还是没问题的，原始业务如下：</p>
<p>在登陆时，将 provisioner bean 塞入 session， 在后续如果需要用到这个 bean, 通过 <code>context.get(&quot;provisionerBean&quot;)</code> 或者 <code>@Inject ProvisionerBean provisionerBean</code> 的方式获取。在查看原有业务时，我们发现，在存入 bean 的时候还会将对应的 id 存入 session。 那么作为解决方案，我们可以在现有拿 bean 的地方，通过拿 id 并查 DB 拿到 user 的方式绕过去。</p>
<p>在给 module team 实施修改方案的时候，他们提出一些 concern：多了访问 DB 的过程，有降低 performance 的风险。和 arch review 了这种风险，结合我们的实际使用场景，这个 provisioner 是后台管理人员，作为维护和系统 setup 的角色，使用频率很低，所以可以忽略这种风险。</p>
<p>目前为止都 OK 但是改代码的时候就有点粗暴，原来使用方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ProvisionerBean provisionerBean = SFContext.getContext().getInstance(SessionConstants.PROVISIONER_BEAN, <span class="keyword">false</span>);</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="meta">@Qualifier(SessionConstants.PROVISIONER_BEAN)</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="keyword">private</span> ProvisionerBean provisionerBean;</span><br></pre></td></tr></table></figure>

<p>这种使用方式是不会抛异常的，只要 get 就行了，但是用查 DB 的方式代替之后，会额外附带异常处理类似</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String provisionerId = SFContext.getContext().getInstance(SessionConstants.PROVISIONER_ID, <span class="keyword">false</span>);</span><br><span class="line">ProvisionerDataService provisionerDataService = SFContext.getContext().getInstance(ProvisionerDataService.NAME, <span class="keyword">true</span>);</span><br><span class="line">ProvisionerBean provisionerBean = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    provisionerBean = provisionerDataService.findProvisionerById(provisionerId);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ServiceApplicationException e) &#123;</span><br><span class="line">    LOGGER.error(<span class="string">&quot;Exception occured while getting provisionerBean&quot;</span>,e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>module team 反馈这种改法侵入性太强，会对他们的代码结构有很大的改变，涉及到源码和大批的 UT 改动。和他们讨论之后，我们打算将这个改动封装到我们内部的类中，并通过统一的接口暴露给外部使用。接口中处理异常，module 只负责调用而不产生其他副作用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// provisionerServiceImpl.class</span></span><br><span class="line">fetchProvisionerFromContext() &#123;</span><br><span class="line">    String provisionerId = context.get(<span class="string">&quot;provisionerId&quot;</span>);</span><br><span class="line">    ProvisionerBean provisionerBean = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (provisionerId != empty) &#123;</span><br><span class="line">        provisionerBean = service.findProvisionerFromDB(provisionerId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        provisionerBean = context.get(provisionerBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> provisionerBean</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的只是简化版，实际代码中的逻辑还包括了从 session 中拿 provisioner bean 和 db 中查询结果做比较，如果不同则返回 session 中的结果并打印 log 记录。然后我们有另外一套 Splunk 的系统，我们可以在代码部署后通过检查 log 检测是否有预期外的行为，而且这种方式不会对现有的行为产生任何影响。</p>
<p>然而世事难料，和 Arch review 代码的时候，他提出了一种新的修改方式，由于我们要改的那些东西是在 SFContext 里面的，我们也许可以通过框架层面的修改来改变 bean 的生成方式，这种方式的侵入性是最小的。ProvisionerBean 是通过 factory bean 的方式向 context 的中注入 bean 的，我们可以 refactor 一下生成方式，改为先从 session 中拿到 id 然后调用 service 拿 DB 数据组成 bean。这样的话，所有调用点都不用改了，perfect！</p>
<p>又经过一轮 research，大致确定了通过修改 factory bean 的方案，我们返回 prototype 类型的 bean, 使用过后通过 GC 回收。而且后续其他 module 需要修改的代码量减少了很多, 对比如下</p>
<table>
<thead>
<tr>
<th align="left">Before</th>
<th align="left">After</th>
</tr>
</thead>
<tbody><tr>
<td align="left">repo:13, call: 34</td>
<td align="left">repo: 6, call: 9</td>
</tr>
</tbody></table>
<p>如果修改点比较多，还需要专门建立一个文档记录修改做追踪用</p>
<p>感觉这才是 Arch 这个角色的价值。contract, 就硬改，也不会看修改的地方是什么feature，不会想测测是不是有可能做回归。我现能达到的程度是，能够将这个 refactor 的任务条理理清楚，做改动的时候有这个 sense 去看看调用栈，看看会不会有什么没考虑到的情况并考虑如何测试改动。Arch 则是看了要改的地方，先看看系统本身是不是有地方提供了统一处理的能里，在达到目的的同时，将影响最小化，做法很优雅。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/hexo/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/hexo/page/23/">23</a><a class="extend next" rel="next" href="/hexo/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jack Zheng"
      src="/hexo/images/jack.jpg">
  <p class="site-author-name" itemprop="name">Jack Zheng</p>
  <div class="site-description" itemprop="description">我是张江搬砖小码农, 知识搬运工</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hexo/archives/">
        
          <span class="site-state-item-count">225</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hexo/categories/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/hexo/tags/">
          
        <span class="site-state-item-count">203</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Zheng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">1.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">16:53</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v5.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/hexo/lib/anime.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.min.js"></script>
  <script src="/hexo/lib/velocity/velocity.ui.min.js"></script>

<script src="/hexo/js/utils.js"></script>

<script src="/hexo/js/motion.js"></script>


<script src="/hexo/js/schemes/muse.js"></script>


<script src="/hexo/js/next-boot.js"></script>




  




  
<script src="/hexo/js/local-search.js"></script>














  

  


</body>
</html>
